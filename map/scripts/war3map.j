globalsforce udg_IGRAET=nullinteger udg_PreD_Dop=0integer udg_PreD_Osn=0integer udg_BaZa_PrEd=0texttag udg_TEXT=nullunit array udg_player_heromultiboard udg_Multiboard=nullunit udg_KripsLill=nullinteger udg_Time_second=0integer udg_Time_minuts=0integer udg_Time_hours=0
force udg_Liver=null
integer udg_SkillLevel=0
weathereffect array udg_Les_Luna
unit array udg_Dammy_Portaltimer udg_Timer_Nomera_Volni=nullinteger array udg_Wave_Unit_tape
integer udg_number_of_otriad_mobs=0integer udg_Nomer_samoi_volni=0boolean array udg_Igraet_Igrokforce array udg_Duel_Igrokunit array udg_herounitinteger udg_Hero_Duel_Raund=0unit array udg_hero_Duel_Unitunit udg_Shield_Marshal_Cater=nullinteger udg_DrenorBugaiRage=0unit udg_Gnev_Caster=nullunit udg_GrorTar=nullunit array udg_Weave
group udg_Weave_group=nulllocation array udg_Weave_pointinteger array udg_Items_massiveinteger udg_Integer_item=0timer udg_Timer_Check_Forkreep_system=nullinteger udg_Integer_kreeps_system_check=0hashtable udg_hash=nullinteger array udg_Heroes_Typesinteger udg_Random_Hero_Count=0integer udg_Total_Heroes_Count=0
integer array udg_Heroes_Random_Data
integer udg_Hero_Random_Local=0force udg_Gruppa_Igrokov_Vibor_Heroev=nullreal udg_RealAngelPovorotLocalEitiArena=0integer udg_IntegerEitiAbilityPassiveSkill=0
unit udg_EEETTTIII=nulltimer udg_Timer_Eiti_Areni=nullgroup udg_Gruppa_HeroUnitov_Geroev=nullinteger array udg_Integer_Kolvo_Giznei_EtitArena
group udg_OtriadPortalUnitsEitiArena=nullweathereffect udg_BossFightWeather=nullunit udg_Unit_FilterMostNearUnit=nullgroup udg_DamageGroup=nullinteger array udg_spirits_of_waterunit udg_preloader=nullinteger udg_Integer_spirits_of_water=0leaderboard udg_HandleBoard=null
timer udg_DrenorBugaiRageTimer=nulltimer udg_GrogTarRageTimer=nullgroup udg_GroupRandomUnitFromGroup=nulldialog udg_Dialog_Select_Difficult=nullbutton array udg_Dialog_Button_Select_Difficultinteger udg_Difficult_Level=0timer udg_TimerMobsAttackBase=nullforce udg_Players_Enemy_Group=nullinteger udg_count=0timer udg_Timer_Dialog_Select=nullsound udg_SimError=nullstring udg_strCounter=""
string array udg_ColorString
unit udg_selectedunittest=nullinteger udg_Reks=0real array udg_Temp_Real
player array udg_Temp_Player
integer udg_Peski=0unit udg_Temp_Unit=nullinteger array udg_Temp_Integerinteger udg_bb=0
force udg_Players_Ally_Group=nullinteger udg_CountPlayers=0integer array udg_PlayerNumberInMBmultiboard udg_MultiBoard=nullstring array udg_MutliBoardHeroIconinteger udg_CountPlayersInTeam1=0force udg_PlayerGroup=nullinteger array udg_MultiBoard_Player_Kills_Countinteger array udg_MultiBoard_Player_Deaths_Count
integer array udg_MultiBoard_Player_Assist_Count
integer array udg_Hero_Respawn_Timestring array udg_Potion_Effectstring array udg_Potion_Type
integer array udg_Potion_Heal_Amount
real array udg_Potion_Sizeweathereffect udg_BossFightWeather2=null
timerdialog udg_TimerDialog_Nomera_Volni=nullinteger udg_Integer_Item_Recipe_Level=0boolean udg_Show_Item_Link_Text=falsetimer udg_ttt=nullunit array udg_ShopSelectedForPlayer
effect array udg_ShopEffectSelectedForPlayer
weathereffect array udg_Weatherunit array udg_DummyHeroPick
boolean udg_IsMinimapPingGuardsAttacked=falseinteger udg_CountGuardsExorcist=0boolean udg_IsGameEnd=falsegroup udg_PortalCastersMagi=null
fogmodifier array udg_BaseVisionFogModifiertimer udg_InitMapTimer=nulltimer array udg_HintsTimerPlayer
force udg_Drenor_Bull_Hint_Player_Group=null
string array udg_Hero_Player_Color_Stringsound array udg_Game_Soundreal array udg_Player_Taken_Damage_Currentreal array udg_Player_Taken_Damage_Allreal array udg_Player_Received_Damage_Currentboolean array udg_System_ShowAbil_And_Items_Hint
timer udg_TimerShowAndFlushAllPlayerDmg=null
boolean array udg_Boolean_Player_Fast_Purchaselocation array udg_Temp_Location
boolean udg_Boolean_Is_Rain=falsetimer udg_Timer_Lightning_Strike_Weather=nullinteger array udg_Integer_Creep_On_Line_Spawngroup array udg_Group_Pickeds_Refrence_Panel
real udg_Time_Before_Creeps_Spawn=0integer udg_Count_Players_Fast_Wave_Start=0boolean array udg_Is_Player_Fast_Wave_Startboolean udg_Is_Fast_Wave_Start_On_Off=falseinteger array udg_Count_Item_Tips_Messageunit array udg_Rune_On_Base_Dummyreal array udg_Rune_On_Base_Dummy_Xreal array udg_Rune_On_Base_Dummy_Yeffect array udg_Rune_On_Base_Effect
string array udg_Rune_On_Base_Effect_Stringtimer udg_Timer_Hint_About_Fast_Start=nullinteger array udg_Bonus_Gold_ChestGoldinteger udg_Wave_Progress_for_MultiBoard=0boolean udg_Is_Eiti_Arena_Already_Go=falseboolean udg_Fire_Boss_Turn_On=falsegroup array udg_Temp_Grouplocation udg_TempPoint=nullboolean array udg_Is_Rune_On_Positioninteger array udg_Rune_Position_Xinteger array udg_Rune_Position_Ytimer udg_Timer_Arrow_Pointer_Guide=null
integer array udg_Arrow_Pointer_Guide_Xinteger array udg_Arrow_Pointer_Guide_Yinteger array udg_Arrow_Pointer_Guide_Angleunit array udg_Arrow_Pointer_Guide_Uniteffect array udg_Arrow_Pointer_Guide_Effectinteger udg_Arrow_Pointer_Guide_Count=0integer array udg_EnergyWallXinteger array udg_EnergyWallYinteger array udg_EnergyWallAngleinteger array udg_EnergyWallCountunit array udg_EnergyWallUnitdestructable array udg_EnergyWallBlockunit array udg_BeornDenHouse
unit udg_BeornBoss=nullinteger udg_Ishod_S_Beornami=0boolean udg_BeornBossFightEnd=falseboolean udg_IsBeronsFightWin=falseunit udg_Marshal=nullgroup udg_gdamageallnew=null
unit udg_Hero_Randomed=nullboolean array udg_Is_Player_Got_Randomed
rect gg_rct_Miners_Arena=nullrect gg_rct_Duel_left=nullrect gg_rct_Portal_1_down_left_Start=nullrect gg_rct_Base=nullrect gg_rct_Portal_baza=null
rect gg_rct_Les_2=nullrect gg_rct_Les_1=nullrect gg_rct_Pogoda_v_bolote=null
rect gg_rct_cast_magi=nullrect gg_rct_Event_Bonus_Etei_arena_1=nullrect gg_rct_Portal_3_up_Start=nullrect gg_rct_Portal_2_down_right_Start=nullrect gg_rct_Oblstb_Tavern=nullrect gg_rct_Hero_Arena=nullrect gg_rct_les_3=nullrect gg_rct_Respawn_Heroes=nullrect gg_rct_Oblast_Teleporta_Arena_Bot=nullrect gg_rct_Oblast_Teleporta_Arena_Top=nullrect gg_rct_6=nullrect gg_rct_BaseDopVision=nullrect gg_rct_Center_Vision=nullrect gg_rct_Portal_Attack_Dummy_Left=nullrect gg_rct_Portal_Attack_Dummy_Right=nullrect gg_rct_Portal_Attack_Dummy_Top=null
rect gg_rct_Duel_right=nullrect gg_rct_PlayableAreaVisionDeBag=null
rect gg_rct_MinusVision1=nullrect gg_rct_Les1_Dop1=nullrect gg_rct_Les1_Dop2=nullrect gg_rct_Beorn_Boss_Area=null
rect gg_rct_Beorn_Boss_Area2=nullcamerasetup gg_cam_Kamera_na_taverni=nullcamerasetup gg_cam_Kamera_glavnoi_bazi=nullcamerasetup gg_cam_Camera_Eiti_Arena=nullcamerasetup gg_cam_Camera_Eiti_Arena_Top_Portal=null
camerasetup gg_cam_Camera_Eiti_Arena_Bot_Portal=null
camerasetup gg_cam_Camera_miners_arena=nullcamerasetup gg_cam_Camera_BossFightStart=nullcamerasetup gg_cam_Camera_Duel_Arena=nullcamerasetup gg_cam_Kamera_cast_magi=null
camerasetup gg_cam_Camera_Beorn_Den1=nullcamerasetup gg_cam_Camera_Beorn_Den2=nullcamerasetup gg_cam_Camera_Beorn_Den3=nullcamerasetup gg_cam_Camera_Beorn_Den4=nullcamerasetup gg_cam_Camera_Beorn_Den5=nullcamerasetup gg_cam_Camera_Beorn_Den6=nullsound gg_snd_HeroFirelordYesAttack1=null
sound gg_snd_HeroFirelordYesAttack2=null
sound gg_snd_HeroFirelordYesAttack3=null
sound gg_snd_HeroFirelordWarcry1=nullsound gg_snd_HeroLichReady1=null
sound gg_snd_HeroLichYesAttack1=null
sound gg_snd_HeroLichYesAttack2=null
sound gg_snd_HeroLichYesAttack3=null
sound gg_snd_DeathSound1=nullsound gg_snd_KnightNoGold1=nullsound gg_snd_KnightInventoryFull1=nullsound gg_snd_HeroStep1=nullsound gg_snd_HeroStep2=nullsound gg_snd_HeroStep3=nullsound gg_snd_HeroStep4=nullsound gg_snd_HuntressYesAttack4=null
sound gg_snd_WardenAttackEffort1=nullsound gg_snd_AlchemistChemicalBurst1=nullsound gg_snd_AlchemistMorph1=nullsound gg_snd_HeroAlchemistYesAttack1=nulltrigger gg_trg_Animation_test_____________________u=null
trigger gg_trg_Players_Start_Script=null
trigger gg_trg_InitMap=nulltrigger gg_trg_InitMapStage2=nulltrigger gg_trg_System_Spells_Load=nulltrigger gg_trg_Items_Preload=nulltrigger gg_trg_Igrok_Massiv_Save=nulltrigger gg_trg_Load_Vsiakoe=null
trigger gg_trg_Igrok_Massiv_Liver=nulltrigger gg_trg_Messager=null
trigger gg_trg_Create_TExttags_about_Shops=nulltrigger gg_trg_InitHashtable=nulltrigger gg_trg_Save_Sounds=nulltrigger gg_trg_HandleCounter=nulltrigger gg_trg_Set_Chlenix=nulltrigger gg_trg_Set_Energy_Walls=null
trigger gg_trg_Test_System_Anvar=nulltrigger gg_trg_test_eiti_arena=nulltrigger gg_trg_Nachalo_Eiti_aren=nulltrigger gg_trg_HeroDeadonEitiArena=nulltrigger gg_trg__PortalCheckTop=nulltrigger gg_trg__PortalCheckBot=nulltrigger gg_trg_Eiti_Dead=nulltrigger gg_trg_LinkItemsInit=nulltrigger gg_trg_ItemPickedUp=null
trigger gg_trg_ChargesConnecting=nulltrigger gg_trg_Remove_Dammi_Items=nulltrigger gg_trg_Save_Items_Cost=nulltrigger gg_trg_Ice_Boss=null
trigger gg_trg_Ice_Wall=null
trigger gg_trg_Ice_Storm=nulltrigger gg_trg_Ice_Rain=null
trigger gg_trg_Cold_Punishment=nulltrigger gg_trg_Ice_Restoration=nulltrigger gg_trg_Turn_on_Fire_Bossfight=nulltrigger gg_trg_test_fire_boss=nulltrigger gg_trg_BossStart=nulltrigger gg_trg_FlameSpells=nulltrigger gg_trg_Fire_Circle=nulltrigger gg_trg_Fire_Meteor=nulltrigger gg_trg_Upgrade_Summons=nulltrigger gg_trg_____________________________________007=nulltrigger gg_trg_UseBeornSpells=nulltrigger gg_trg_Start_Beorn_Den=nulltrigger gg_trg_Beorn_Push=nulltrigger gg_trg_Beorn_Stomp=nulltrigger gg_trg_HeroUnitGameSave=null
trigger gg_trg_INIT=null
trigger gg_trg_Pick_Hero_Upgrade=nulltrigger gg_trg_Pick_Hero=nulltrigger gg_trg_Hero_Dead=nulltrigger gg_trg_asd=nulltrigger gg_trg_Start_Duel=nulltrigger gg_trg_Hero_Death_On_Duel=nulltrigger gg_trg_Test_plus_wwave_number=nulltrigger gg_trg_Timer_Check=nulltrigger gg_trg_go_mochiytb_portal=nulltrigger gg_trg_Start_game=nulltrigger gg_trg_StartWave=nulltrigger gg_trg_MobsAttackBase=nulltrigger gg_trg_TeleportStuckedCreeps=nulltrigger gg_trg_vhodit_v_zony=nulltrigger gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps=nulltrigger gg_trg_Init_System_Receiving_Gold_for_Creeps=nulltrigger gg_trg_Init_System_Receiving_Experience_for_Creeps=nulltrigger gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps=nulltrigger gg_trg_Test_Potion_System=nulltrigger gg_trg_Init_Potion_System=nulltrigger gg_trg_Mob_Dead_Create_Potion=nulltrigger gg_trg_Check_Potion_Picked_Up=nulltrigger gg_trg_InitSystem=nulltrigger gg_trg_EnterUnit=nulltrigger gg_trg_AddDamage=nulltrigger gg_trg_TimeTalisman=null
trigger gg_trg_Take_Paladin_Armor=nulltrigger gg_trg_Take_Archimagus_Staff=nulltrigger gg_trg_Lost_Charged_Staff_of_Lightning=nulltrigger gg_trg_Blood_Bow=nulltrigger gg_trg_Balance_Ring=null
trigger gg_trg_Armageddon_Staff=null
trigger gg_trg_Sargeras_Crown=nulltrigger gg_trg_Lost_Sargeras_Crown=nulltrigger gg_trg_Take_Sargeras_Crown=nulltrigger gg_trg_Lost_Archimagus_Armor=nulltrigger gg_trg_Take_Archimagus_Armor=nulltrigger gg_trg_Sorcerers_Talisman_Cast=nulltrigger gg_trg_Sorcerers_Talisman=nulltrigger gg_trg_Sorcerers_Talisman_Dead_Unit=null
trigger gg_trg_Orc_Banner=nulltrigger gg_trg_Devil_Axe=nulltrigger gg_trg_Devil_Axe_Kill_Unit=nulltrigger gg_trg_Tokugawas_Katan_Kill_Unit=nulltrigger gg_trg_Tokugawas_Katan=nulltrigger gg_trg_Kings_Armor=nulltrigger gg_trg_Steel_Bib=nulltrigger gg_trg_Archimagus_Staff=null
trigger gg_trg_Isidors_Scepter=nulltrigger gg_trg_Detached_Shield_Use=nulltrigger gg_trg_Cuirass_of_Invulnerable_Use2=null
trigger gg_trg_Cuirass_of_Invulnerable_Use=nulltrigger gg_trg_Detached_Shield_and_Cuirass_of_Invulnerable_Issue_Order=nulltrigger gg_trg_Lost_Cuirass_of_Invulnerable=null
trigger gg_trg_Take_Cuirass_of_Invulnerable=null
trigger gg_trg_Fire_Staff=nulltrigger gg_trg_Demon_Axe=nulltrigger gg_trg_Demon_Axe_Kill_Unit=nulltrigger gg_trg_Boots_Rescue=null
trigger gg_trg_Astral_Staff=null
trigger gg_trg_Healer_Staff=null
trigger gg_trg_Magic_Amulet=null
trigger gg_trg_Blood_Dagger=null
trigger gg_trg_Agility_Blade=nulltrigger gg_trg_Bone_Staff_Set_Summon_Ability_Level=nulltrigger gg_trg_Novice_Amulet=nulltrigger gg_trg_Glove_of_Andromat=nulltrigger gg_trg_Glove_of_Midas=nulltrigger gg_trg_Ring_illusionist=null
trigger gg_trg_Armor_Skill=nulltrigger gg_trg_Steel_gauntlets=nulltrigger gg_trg_Dagger_Cruelty=nulltrigger gg_trg_Heroes_more_attacked_priority_when_guards=nulltrigger gg_trg_Player_Fast_Purchase_System=nulltrigger gg_trg_Show_hint_abount_hints=nulltrigger gg_trg_Show_Hint_Abount_Items=nulltrigger gg_trg_Hint_About_Random=nulltrigger gg_trg_Show_hint_abount_reference_panel=null
trigger gg_trg_Show_Ability_Learn=nulltrigger gg_trg_System_Personal_Items_Buy_Item=nulltrigger gg_trg_System_Personal_Items_Pick_Up_Item=nulltrigger gg_trg_no_attack=nulltrigger gg_trg_Select_Refrence_Panel=nulltrigger gg_trg_ShopAnimation=nulltrigger gg_trg_ShopStopAnimation=nulltrigger gg_trg_RedMarkToUnit=nulltrigger gg_trg_UnSelectedDummyRedMark=nulltrigger gg_trg_SpecEffect_on_Casters=nulltrigger gg_trg_PortalSpecEffects=nulltrigger gg_trg_Gates_Start_Animation=nulltrigger gg_trg_PlayerEnterGameCommand=nulltrigger gg_trg_PlayerUseSpellGameCommand=nulltrigger gg_trg_GuardsExorcistDead=nulltrigger gg_trg_PauseUnitWhenDefeat=nulltrigger gg_trg_PauseUnitWhenWin=null
trigger gg_trg_GameEndWin=nulltrigger gg_trg_Respawn_trees_Init=nulltrigger gg_trg_Respawn_trees=nulltrigger gg_trg_Day_Weather=nulltrigger gg_trg_Sky_Morning=nulltrigger gg_trg_Sky_Day=nulltrigger gg_trg_Night_Weather=nulltrigger gg_trg_Sky_Evening=nulltrigger gg_trg_Sky_Night=nulltrigger gg_trg_Lightnings_Weather_Effect_Rainy=nulltrigger gg_trg_Periodic_Rune_Creation=nulltrigger gg_trg_Rune_PickedUp=nulltrigger gg_trg_Initialization_MultiBoard=nulltrigger gg_trg_Hero_MultiBoard_LvlUp=nulltrigger gg_trg_Time_Check_and_Player_Gold_for_MultiBoard=nulltrigger gg_trg_Reincarnation_Skeletons=nulltrigger gg_trg_BossSkeletRaise=nulltrigger gg_trg_BossSkeletSkillActiv=null
trigger gg_trg_Fire_Arrow=nulltrigger gg_trg_Use_UnholyFrenzy_and_Fire_Arrow=nulltrigger gg_trg_Use_UnholyFrenzy_and_Fire_Arrow_____________________u=nulltrigger gg_trg_Create_Tombstone=null
trigger gg_trg_ZombieExploadDeath=nulltrigger gg_trg_Damned_Soul=nulltrigger gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul=null
trigger gg_trg_Throw_Meat=nulltrigger gg_trg_Earth_Clap=nulltrigger gg_trg_Use_PowerofHorror_and_Curse_and_Slam_____________________u=nulltrigger gg_trg_Ghoul_Jump=nulltrigger gg_trg_BurrowStrike=null
trigger gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump=nulltrigger gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul______________________u=nulltrigger gg_trg_BeetleCorpseBurrowCast=nulltrigger gg_trg_BeetleCorpseBurrow=nulltrigger gg_trg_Cocoon_Creation=nulltrigger gg_trg_Poisonous_Spittle_Cast=nulltrigger gg_trg_Holes_Of_Grave_Diggers_Debug_Kill=nulltrigger gg_trg_Holes_Of_Grave_Diggers_Cast=nulltrigger gg_trg_Nerub_Spider=null
trigger gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger=nulltrigger gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Old=nulltrigger gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDa_____________________u=nulltrigger gg_trg_Damned_Ents_Reincarnation=nulltrigger gg_trg_Rage_of_Decay=nulltrigger gg_trg_Use_ThrowStone_and_TurnIntoEnt=nulltrigger gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay=nulltrigger gg_trg_Troll_Dead_Remove_Bugs=nulltrigger gg_trg_Boss_Troll_Entangle_Throw=nulltrigger gg_trg_Use_Berserk_and_BerserkBoss=nulltrigger gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle=nulltrigger gg_trg_Aspect_of_Magic_Protection=nulltrigger gg_trg_Remove_Effects_From_Bosses=nulltrigger gg_trg_Metka_Dreneev=nulltrigger gg_trg_Fast_Attack=nulltrigger gg_trg_Bash_Attack=nulltrigger gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack=nulltrigger gg_trg_Magic_Fire=nulltrigger gg_trg_Blink_Strike=null
trigger gg_trg_Damned_Skull=null
trigger gg_trg_Weakness_of_Emptiness=nulltrigger gg_trg_Essence_of_Emptiness=null
trigger gg_trg_Piercing_Strike=nulltrigger gg_trg_Victim_Search=nulltrigger gg_trg_Black_Hole=nulltrigger gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar=nulltrigger gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH=null
trigger gg_trg_Weakness=null
trigger gg_trg_Pain_Sphere=nulltrigger gg_trg_Astral_Dispersal=null
trigger gg_trg_Infernal_Ram=null
trigger gg_trg_Fiery_Blow=nulltrigger gg_trg_Bloody_Jump=nulltrigger gg_trg_Blood_Absorption=null
trigger gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u=nulltrigger gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4=nulltrigger gg_trg_Hatred_of_fire=nulltrigger gg_trg_set_fire=null
trigger gg_trg_set_fire_2=nulltrigger gg_trg_the_creation_of_the_image=nulltrigger gg_trg_fiery_explosions=null
trigger gg_trg_Breathoffire=null
trigger gg_trg_Wall_of_Fire=null
trigger gg_trg_Fire_Explosions=nulltrigger gg_trg_BossStomp=nulltrigger gg_trg_Mark_of_Fire=null
trigger gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire=nulltrigger gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp=nulltrigger gg_trg_Power_of_Skeletons=nulltrigger gg_trg_Water_Elemental_Load=null
trigger gg_trg_Init_kreeps=nulltrigger gg_trg_spirits_of_water_dead=nulltrigger gg_trg_Skill_Gertva=null
trigger gg_trg_Opening_Streams=nulltrigger gg_trg_Water_Explosion=nulltrigger gg_trg_Tsunami=nulltrigger gg_trg_Guardsman_Load=nulltrigger gg_trg_Protective_Stand_Switch=nulltrigger gg_trg_Learn_Fighting_Skills=nulltrigger gg_trg_Ram_Board=nulltrigger gg_trg_Warcry=nulltrigger gg_trg_____________________________________001=nulltrigger gg_trg_____________________________________001______________________2=nulltrigger gg_trg_Drenor_Bull_Show_Rage_____________________u=nulltrigger gg_trg_Drenor_Bull_Load=null
trigger gg_trg_Drenor_Bull_Show_Hint=nulltrigger gg_trg_Drenor_Bull_Show_Rage=nulltrigger gg_trg_Axe_Throw=nulltrigger gg_trg_Violent_Roar=null
trigger gg_trg_upgrade_Berserk=nulltrigger gg_trg_Learn_Spell_Rage=null
trigger gg_trg_GrogTarDead=nulltrigger gg_trg_attack_hero_Rage=null
trigger gg_trg_kill_hero_Rage=nulltrigger gg_trg_Sniatie_Rage=null
trigger gg_trg_Timer_Rage=nulltrigger gg_trg_Illusionist_Load=null
trigger gg_trg_Reflection=nulltrigger gg_trg_Illusory_Attack=nulltrigger gg_trg_Summon_Illusions_with_Reflection=null
trigger gg_trg_Illusions_with_Phantoms_Dead=null
trigger gg_trg_BladeMaster_Load=null
trigger gg_trg_Dissection=nulltrigger gg_trg_Whirlwind=nulltrigger gg_trg_Imboweling=nulltrigger gg_trg_Master_of_Lightnings_Load=nulltrigger gg_trg_Thundercloud=null
trigger gg_trg_Power_of_Lightnings=nulltrigger gg_trg_Electric_Field=nulltrigger gg_trg_Storm=nulltrigger gg_trg_Respawnlol=nulltrigger gg_trg_Ranger_Load=nulltrigger gg_trg_MultiShotSwitch=nulltrigger gg_trg_Learn_Release_of_Arrows=nulltrigger gg_trg_Release_of_Arrows=nulltrigger gg_trg_Dexterity_of_the_Ranger=nulltrigger gg_trg_Healer_Load=nulltrigger gg_trg_Good_Healing=null
trigger gg_trg_Spiritual_Communication=nulltrigger gg_trg_Curing_Light=null
trigger gg_trg_Guardian_Angel=nulltrigger gg_trg_Paladin_Load=null
trigger gg_trg_Spiral_of_Light=nulltrigger gg_trg_Keeper_Seal=nulltrigger gg_trg_Light_Hammer=null
trigger gg_trg_God_Hand=null
trigger gg_trg_Stone_Guard_Load=null
trigger gg_trg_Boulder_Throw=nulltrigger gg_trg_Earth_Shiver=null
trigger gg_trg_Learn_Stone_Armor=nulltrigger gg_trg_Rock_Strike=nulltrigger gg_trg_Archdruid_Load=nulltrigger gg_trg_Energy_of_Nature=null
trigger gg_trg_Life_Chain=nulltrigger gg_trg_Ent_Creation=null
trigger gg_trg_Nature_Wrath=null
trigger gg_trg_Falling_Star=null
trigger gg_trg_Moon_Chackram=nulltrigger gg_trg_Moon_Wind=nulltrigger gg_trg_Night_Heart=nulltrigger gg_trg_MoonWarrior_Load=null
trigger gg_trg_Ancient_Communication=nulltrigger gg_trg_Learn_Power_of_Ancestors=null
trigger gg_trg_Switch_Power_of_Ancestors=nulltrigger gg_trg_Earth_Split=nulltrigger gg_trg_Ancient_Help=null
trigger gg_trg_SpiritBreaker_Load=nulltrigger gg_trg_Power_of_Ancestors_Switch=nulltrigger gg_trg_Dash=null
trigger gg_trg_Dagger_Throw=null
trigger gg_trg_Kara_Justice=null
trigger gg_trg_Warden_Load=nulltrigger gg_trg_Strength_Fist=nulltrigger gg_trg_Fighting_Impact=nulltrigger gg_trg_Learn_Marshal_Armor=nulltrigger gg_trg_Illusive_Army=nulltrigger gg_trg_Marshal_Load=null
trigger gg_trg_Chain_Lightning=nulltrigger gg_trg_Magic_Trap=nulltrigger gg_trg_Remove_Lightning_Form_Dead_Units=null
trigger gg_trg_EnergyWave=nulltrigger gg_trg_Magic_Epicenter=nulltrigger gg_trg_Load_ArchMage=nulltrigger gg_trg_Toxic_Field=nulltrigger gg_trg_Poison_Bomb=nulltrigger gg_trg_Learn_Ogre_Rage=nulltrigger gg_trg_Potion_of_Growth=null
trigger gg_trg_Load_Alchemist=nulltrigger gg_trg_Case_Shot=nulltrigger gg_trg_Learn_Fire_Position=nulltrigger gg_trg_Dwarf_Cannon=null
trigger gg_trg_Load_Sniper=nulltrigger gg_trg_InitSkills_damage=nulltrigger gg_trg_Vhodit_v_zony_damage=null
trigger gg_trg_Passive_Skill_Storm_bolt=null
trigger gg_trg_The_power_of_the_rider=nulltrigger gg_trg_Collision_flight=null
trigger gg_trg_Thunderous_Storm=null
trigger gg_trg_Hero_Dead______________________4=null
trigger gg_trg_Hero_Dead______________________3=null
trigger gg_trg_Hero_Dead______________________2=null
trigger gg_trg_Hero_Dead_____________________u=nullunit gg_unit_o003_0028=nullunit gg_unit_o003_0027=nullunit gg_unit_n00Y_0102=nullunit gg_unit_h01K_0100=nullunit gg_unit_e002_0106=nullunit gg_unit_e002_0108=nullunit gg_unit_n00Y_0101=nullunit gg_unit_h01K_0109=nullendglobalsfunction InitGlobals takes nothing returns nothinglocal integer i=0set udg_IGRAET=CreateForce()
set udg_Multiboard=CreateMultiboard()set udg_Liver=CreateForce()set udg_Timer_Nomera_Volni=CreateTimer()
set i=0loop
exitwhen(i>1)set udg_Igraet_Igrok[i]=falseset udg_Duel_Igrok[i]=CreateForce()set udg_Heroes_Random_Data[i]=0set udg_Integer_Kolvo_Giznei_EtitArena[i]=0set udg_ColorString[i]=""set udg_Temp_Real[i]=0set udg_Temp_Integer[i]=0set udg_PlayerNumberInMB[i]=0set udg_MutliBoardHeroIcon[i]=""
set udg_MultiBoard_Player_Kills_Count[i]=0set udg_MultiBoard_Player_Deaths_Count[i]=0set udg_MultiBoard_Player_Assist_Count[i]=0set udg_Hero_Respawn_Time[i]=0set udg_Potion_Effect[i]=""set udg_Potion_Type[i]=""set udg_Potion_Heal_Amount[i]=0set udg_Potion_Size[i]=0
set udg_HintsTimerPlayer[i]=CreateTimer()set udg_Hero_Player_Color_String[i]=""set udg_Player_Taken_Damage_Current[i]=0
set udg_Player_Taken_Damage_All[i]=0
set udg_Player_Received_Damage_Current[i]=0set udg_System_ShowAbil_And_Items_Hint[i]=trueset udg_Boolean_Player_Fast_Purchase[i]=falseset udg_Integer_Creep_On_Line_Spawn[i]=0
set udg_Group_Pickeds_Refrence_Panel[i]=CreateGroup()set udg_Is_Player_Fast_Wave_Start[i]=falseset udg_Count_Item_Tips_Message[i]=0
set udg_Rune_On_Base_Dummy_X[i]=0set udg_Rune_On_Base_Dummy_Y[i]=0set udg_Rune_On_Base_Effect_String[i]=""
set udg_Bonus_Gold_ChestGold[i]=0set udg_Temp_Group[i]=CreateGroup()set udg_Is_Rune_On_Position[i]=false
set udg_Rune_Position_X[i]=0
set udg_Rune_Position_Y[i]=0
set udg_Arrow_Pointer_Guide_X[i]=0set udg_Arrow_Pointer_Guide_Y[i]=0set udg_Arrow_Pointer_Guide_Angle[i]=0set udg_EnergyWallX[i]=0
set udg_EnergyWallY[i]=0
set udg_EnergyWallAngle[i]=0
set udg_EnergyWallCount[i]=0
set udg_Is_Player_Got_Randomed[i]=falseset i=i+1endloopset udg_Weave_group=CreateGroup()set udg_Timer_Check_Forkreep_system=CreateTimer()set udg_Gruppa_Igrokov_Vibor_Heroev=CreateForce()set udg_Timer_Eiti_Areni=CreateTimer()set udg_Gruppa_HeroUnitov_Geroev=CreateGroup()set udg_OtriadPortalUnitsEitiArena=CreateGroup()
set udg_DamageGroup=CreateGroup()set udg_DrenorBugaiRageTimer=CreateTimer()set udg_GrogTarRageTimer=CreateTimer()set udg_GroupRandomUnitFromGroup=CreateGroup()set udg_Dialog_Select_Difficult=DialogCreate()set udg_TimerMobsAttackBase=CreateTimer()set udg_Players_Enemy_Group=CreateForce()set udg_Timer_Dialog_Select=CreateTimer()set udg_Players_Ally_Group=CreateForce()
set udg_MultiBoard=CreateMultiboard()set udg_PlayerGroup=CreateForce()set udg_ttt=CreateTimer()set udg_PortalCastersMagi=CreateGroup()set udg_InitMapTimer=CreateTimer()set udg_Drenor_Bull_Hint_Player_Group=CreateForce()set udg_TimerShowAndFlushAllPlayerDmg=CreateTimer()set udg_Timer_Lightning_Strike_Weather=CreateTimer()
set udg_Timer_Hint_About_Fast_Start=CreateTimer()set udg_Timer_Arrow_Pointer_Guide=CreateTimer()set udg_gdamageallnew=CreateGroup()endfunctionfunction InitSounds takes nothing returns nothingset gg_snd_HeroFirelordYesAttack1=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordYesAttack1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordYesAttack1,"HeroFireLordYesAttack")call SetSoundDuration(gg_snd_HeroFirelordYesAttack1,$984)set gg_snd_HeroFirelordYesAttack2=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordYesAttack2.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordYesAttack2,"HeroFireLordYesAttack")call SetSoundDuration(gg_snd_HeroFirelordYesAttack2,$DAF)set gg_snd_HeroFirelordYesAttack3=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordYesAttack3.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordYesAttack3,"HeroFireLordYesAttack")call SetSoundDuration(gg_snd_HeroFirelordYesAttack3,$AD1)set gg_snd_HeroFirelordWarcry1=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordWarcry1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordWarcry1,"HeroFireLordWarcry")call SetSoundDuration(gg_snd_HeroFirelordWarcry1,5072)set gg_snd_HeroLichReady1=CreateSound("Units\\Undead\\HeroLich\\HeroLichReady1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichReady1,"HeroLichReady")call SetSoundDuration(gg_snd_HeroLichReady1,4337)set gg_snd_HeroLichYesAttack1=CreateSound("Units\\Undead\\HeroLich\\HeroLichYesAttack1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichYesAttack1,"HeroLichYesAttack")call SetSoundDuration(gg_snd_HeroLichYesAttack1,$A4C)set gg_snd_HeroLichYesAttack2=CreateSound("Units\\Undead\\HeroLich\\HeroLichYesAttack2.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichYesAttack2,"HeroLichYesAttack")call SetSoundDuration(gg_snd_HeroLichYesAttack2,$9D4)set gg_snd_HeroLichYesAttack3=CreateSound("Units\\Undead\\HeroLich\\HeroLichYesAttack3.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichYesAttack3,"HeroLichYesAttack")call SetSoundDuration(gg_snd_HeroLichYesAttack3,$872)set gg_snd_DeathSound1=CreateSound("Units\\Creeps\\Bandit\\BanditYesAttack1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_DeathSound1,"BanditYesAttack")call SetSoundDuration(gg_snd_DeathSound1,$4EE)set gg_snd_KnightNoGold1=CreateSound("Sound\\Interface\\Warning\\Human\\KnightNoGold1.wav",false,false,false,$A,$A,"")call SetSoundParamsFromLabel(gg_snd_KnightNoGold1,"NoGoldHuman")
call SetSoundDuration(gg_snd_KnightNoGold1,$57D)
set gg_snd_KnightInventoryFull1=CreateSound("Sound\\Interface\\Warning\\Human\\KnightInventoryFull1.wav",false,false,false,$A,$A,"")
call SetSoundParamsFromLabel(gg_snd_KnightInventoryFull1,"InventoryFullHuman")call SetSoundDuration(gg_snd_KnightInventoryFull1,$3E8)set gg_snd_HeroStep1=CreateSound("Sound\\Units\\Footsteps\\HeroStep1.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep1,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep1,947)set gg_snd_HeroStep2=CreateSound("Sound\\Units\\Footsteps\\HeroStep2.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep2,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep2,697)set gg_snd_HeroStep3=CreateSound("Sound\\Units\\Footsteps\\HeroStep3.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep3,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep3,599)set gg_snd_HeroStep4=CreateSound("Sound\\Units\\Footsteps\\HeroStep4.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep4,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep4,$E5)set gg_snd_HuntressYesAttack4=CreateSound("Units\\NightElf\\Huntress\\HuntressYesAttack4.wav",false,false,false,'d',$A,"DefaultEAXON")call SetSoundParamsFromLabel(gg_snd_HuntressYesAttack4,"HuntressYesAttack")call SetSoundDuration(gg_snd_HuntressYesAttack4,$55E)call SetSoundChannel(gg_snd_HuntressYesAttack4,0)set gg_snd_WardenAttackEffort1=CreateSound("Units\\NightElf\\HeroWarden\\WardenAttackEffort1.wav",false,true,true,$A,$A,"CombatSoundsEAX")call SetSoundParamsFromLabel(gg_snd_WardenAttackEffort1,"WardenAttack")call SetSoundDuration(gg_snd_WardenAttackEffort1,$54E)set gg_snd_AlchemistChemicalBurst1=CreateSound("Units\\Creeps\\HEROGoblinALCHEMIST\\AlchemistChemicalBurst1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_AlchemistChemicalBurst1,"GoblinAlchemistMorph")call SetSoundDuration(gg_snd_AlchemistChemicalBurst1,$801)call SetSoundChannel(gg_snd_AlchemistChemicalBurst1,0)set gg_snd_AlchemistMorph1=CreateSound("Units\\Creeps\\HEROGoblinALCHEMIST\\AlchemistMorph1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_AlchemistMorph1,"GoblinAlchemistMorphAlternate")
call SetSoundDuration(gg_snd_AlchemistMorph1,$67F)call SetSoundChannel(gg_snd_AlchemistMorph1,0)set gg_snd_HeroAlchemistYesAttack1=CreateSound("Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistYesAttack1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_HeroAlchemistYesAttack1,"HEROGoblinALCHEMISTYesAttack")call SetSoundDuration(gg_snd_HeroAlchemistYesAttack1,$942)call SetSoundChannel(gg_snd_HeroAlchemistYesAttack1,0)endfunctionfunction CreateNeutralPassiveBuildings takes nothing returns nothing
local player p=Player($F)local unit u
local integer unitID
local trigger tlocal real lifeset u=CreateUnit(p,'h00S',2144.,-5184.,225.)
set u=CreateUnit(p,'h002',2176.,-5760.,270.)
set u=CreateUnit(p,'h001',2144.,-5312.,225.)
set u=CreateUnit(p,'n004',5120.,4032.,270.)call SetUnitColor(u,ConvertPlayerColor(6))set u=CreateUnit(p,'n002',4736.,4032.,270.)call SetUnitColor(u,ConvertPlayerColor(0))set u=CreateUnit(p,'n005',4928.,3648.,270.)call SetUnitColor(u,ConvertPlayerColor(1))set u=CreateUnit(p,'h003',2176.,-6016.,270.)
set u=CreateUnit(p,'h000',2176.,-5504.,180.)
set u=CreateUnit(p,'h00D',2176.,-6272.,225.)
set u=CreateUnit(p,'h00Y',2176.,-4992.,270.)
endfunctionfunction CreateNeutralPassive takes nothing returns nothinglocal player p=Player($F)local unit u
local integer unitID
local trigger tlocal real lifeset u=CreateUnit(p,'h00I',2651.1,-8998.3,132.101)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',2737.1,-8462.,222.901)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',2208.,-7950.8,240.89)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',1508.5,-7799.1,271.992)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',761.9,-7825.8,270.894)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',108.7,-7927.1,297.652)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',-341.9,-8450.2,346.764)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',-340.3,-9154.9,16.661)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',-237.5,-9776.7,2.615)call SetUnitState(u,UNIT_STATE_MANA,$2710)set gg_unit_o003_0027=CreateUnit(p,'o003',1521.1,-5441.2,222.91)
set gg_unit_o003_0028=CreateUnit(p,'o003',1033.8,-5956.6,42.425)
set u=CreateUnit(p,'h00I',1358.5,-9356.4,270.)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',1357.3,-9244.8,270.)call SetUnitState(u,UNIT_STATE_MANA,$2710)set gg_unit_h01K_0100=CreateUnit(p,'h01K',1245.4,-5377.6,270.73)
set gg_unit_n00Y_0101=CreateUnit(p,'n00Y',1589.7,-5683.3,173.645)call SetUnitState(gg_unit_n00Y_0101,UNIT_STATE_MANA,0)set gg_unit_n00Y_0102=CreateUnit(p,'n00Y',939.4,-5689.8,.69)
call SetUnitState(gg_unit_n00Y_0102,UNIT_STATE_MANA,0)set gg_unit_e002_0106=CreateUnit(p,'e002',1007.4,-5428.7,316.082)call SetUnitState(gg_unit_e002_0106,UNIT_STATE_MANA,0)set gg_unit_e002_0108=CreateUnit(p,'e002',1526.5,-5954.4,138.892)call SetUnitState(gg_unit_e002_0108,UNIT_STATE_MANA,0)set gg_unit_h01K_0109=CreateUnit(p,'h01K',1268.,-6027.5,89.41)endfunctionfunction CreatePlayerBuildings takes nothing returns nothing
endfunctionfunction CreatePlayerUnits takes nothing returns nothing
endfunctionfunction CreateAllUnits takes nothing returns nothingcall CreateNeutralPassiveBuildings()
call CreatePlayerBuildings()
call CreateNeutralPassive()call CreatePlayerUnits()
endfunctionfunction CreateRegions takes nothing returns nothing
local weathereffect weset gg_rct_Miners_Arena=Rect(-4128.,1952.,-2496.,3904.)set gg_rct_Duel_left=Rect(1216.,2784.,1472.,3040.)set gg_rct_Portal_1_down_left_Start=Rect(-1920.,-9536.,-1536.,-9184.)set gg_rct_Base=Rect(-288.,-7488.,2560.,-4128.)set gg_rct_Portal_baza=Rect(896.,-6016.,1408.,-5408.)set gg_rct_Les_2=Rect(-3616.,-8160.,-512.,320.)set gg_rct_Les_1=Rect(-320.,-10656.,2432.,-7904.)set gg_rct_Pogoda_v_bolote=Rect(3936.,-6944.,5280.,-3296.)set we=AddWeatherEffect(gg_rct_Pogoda_v_bolote,'FDgh')call EnableWeatherEffect(we,true)set gg_rct_cast_magi=Rect(832.,-6112.,1664.,-5312.)set gg_rct_Event_Bonus_Etei_arena_1=Rect(3488.,-256.,5088.,1824.)set gg_rct_Portal_3_up_Start=Rect(1024.,-1120.,1408.,-736.)set gg_rct_Portal_2_down_right_Start=Rect(3392.,-9376.,3744.,-8992.)
set gg_rct_Oblstb_Tavern=Rect(4352.,3360.,5504.,4448.)set gg_rct_Hero_Arena=Rect(1152.,2048.,2944.,3968.)set gg_rct_les_3=Rect(2592.,-7040.,3872.,-1280.)
set gg_rct_Respawn_Heroes=Rect(1056.,-6624.,1408.,-6112.)set gg_rct_Oblast_Teleporta_Arena_Bot=Rect(4224.,-32.,4416.,160.)set gg_rct_Oblast_Teleporta_Arena_Top=Rect(4224.,1408.,4416.,1600.)set gg_rct_6=Rect(-1792.,1888.,544.,3840.)set gg_rct_BaseDopVision=Rect(672.,-4160.,1664.,-3680.)set gg_rct_Center_Vision=Rect(960.,-5760.,1088.,-5632.)set gg_rct_Portal_Attack_Dummy_Left=Rect(-2112.,-9696.,-1952.,-9536.)set gg_rct_Portal_Attack_Dummy_Right=Rect(3584.,-9600.,3744.,-9440.)
set gg_rct_Portal_Attack_Dummy_Top=Rect(1120.,-576.,1280.,-416.)
set gg_rct_Duel_right=Rect(2592.,2784.,2848.,3040.)set gg_rct_PlayableAreaVisionDeBag=Rect(-3680.,-10400.,5504.,4544.)set gg_rct_MinusVision1=Rect(-3712.,800.,-2048.,4640.)set gg_rct_Les1_Dop1=Rect(2400.,-9184.,2912.,-8096.)
set gg_rct_Les1_Dop2=Rect(160.,-7936.,2208.,-7648.)set gg_rct_Beorn_Boss_Area=Rect(800.,-10368.,1952.,-9248.)set gg_rct_Beorn_Boss_Area2=Rect(992.,-10272.,1856.,-9376.)endfunctionfunction CreateCameras takes nothing returns nothing
set gg_cam_Kamera_na_taverni=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Kamera_na_taverni,4928.7,3881.5,.0)set gg_cam_Kamera_glavnoi_bazi=CreateCameraSetup()call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ROLL,.0,.0)
call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Kamera_glavnoi_bazi,1240.,-6378.1,.0)
set gg_cam_Camera_Eiti_Arena=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Eiti_Arena,4255.9,866.9,.0)set gg_cam_Camera_Eiti_Arena_Top_Portal=CreateCameraSetup()call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ZOFFSET,.0,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_FARZ,5000.,.0)
call CameraSetupSetDestPosition(gg_cam_Camera_Eiti_Arena_Top_Portal,4394.2,1237.5,.0)set gg_cam_Camera_Eiti_Arena_Bot_Portal=CreateCameraSetup()call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ZOFFSET,.0,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_FARZ,5000.,.0)
call CameraSetupSetDestPosition(gg_cam_Camera_Eiti_Arena_Bot_Portal,4465.7,342.3,.0)
set gg_cam_Camera_miners_arena=CreateCameraSetup()call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ROLL,.0,.0)
call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_miners_arena,-3311.2,2967.9,.0)set gg_cam_Camera_BossFightStart=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ROTATION,180.9,.0)call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ANGLE_OF_ATTACK,336.5,.0)
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_BossFightStart,-608.2,2881.,.0)set gg_cam_Camera_Duel_Arena=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Duel_Arena,2139.4,2853.8,.0)set gg_cam_Kamera_cast_magi=CreateCameraSetup()call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ZOFFSET,.0,.0)
call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_FARZ,5000.,.0)
call CameraSetupSetDestPosition(gg_cam_Kamera_cast_magi,1268.,-5714.3,.0)set gg_cam_Camera_Beorn_Den1=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ROTATION,233.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ANGLE_OF_ATTACK,299.3,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_TARGET_DISTANCE,1363.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den1,1384.,-9577.2,.0)set gg_cam_Camera_Beorn_Den2=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ROTATION,297.9,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ANGLE_OF_ATTACK,300.3,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_TARGET_DISTANCE,1363.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den2,1240.7,-9620.8,.0)set gg_cam_Camera_Beorn_Den3=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ROTATION,110.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ANGLE_OF_ATTACK,300.4,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_TARGET_DISTANCE,1127.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den3,562.8,-8241.1,.0)set gg_cam_Camera_Beorn_Den4=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ROTATION,110.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ANGLE_OF_ATTACK,300.4,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_TARGET_DISTANCE,1127.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den4,-15.3,-9035.4,.0)set gg_cam_Camera_Beorn_Den5=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den5,2191.,-8224.1,.0)set gg_cam_Camera_Beorn_Den6=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den6,1474.8,-9613.2,.0)endfunctionfunction CopyGroup takes group g returns groupset bj_groupAddGroupDest=CreateGroup()call ForGroup(g,function GroupAddGroupEnum)return bj_groupAddGroupDestendfunctionfunction DamageGroupOfUnit takes unit u,real x,real y,real radius,real damage,boolean dbuilds,boolean dmagicimmune,boolean dally returns nothing
local group g=CreateGroup()local unit targetcall GroupEnumUnitsInRange(g,x,y,radius,null)loop
set target=FirstOfGroup(g)exitwhen target==nullif(dally and dbuilds)or(dally and not dbuilds and not IsUnitType(u,UNIT_TYPE_STRUCTURE))or(IsUnitEnemy(target,GetOwningPlayer(u))and dbuilds)or(IsUnitEnemy(target,GetOwningPlayer(u))and not dbuilds and not IsUnitType(u,UNIT_TYPE_STRUCTURE))then
call UnitDamageTarget(u,target,damage,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
endifcall GroupRemoveUnit(g,target)endloopcall GroupClear(g)call DestroyGroup(g)
set target=nullset g=nullendfunctionfunction KillSummonsAndIllusions takes group g returns nothinglocal unit Pickedlocal integer id
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset id=GetUnitTypeId(Picked)
if((IsUnitIllusion(Picked) or IsUnitType(Picked,UNIT_TYPE_SUMMONED))or((id=='h017')or(id=='h01D')or(id=='h01E')or(id=='h01F')or(id=='h01G')or(id=='h01G')))and id!='h00C' thencall KillUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullendfunctionfunction FilterMostNearUnit takes group g,unit Unit returns nothinglocal unit ufillocal real xulocal real yulocal real duUlocal real x1Ulocal real y1Ulocal real d1UUF
local real X=GetUnitX(Unit)local real Y=GetUnitY(Unit)loop
set ufil=FirstOfGroup(g)
exitwhen ufil==nullif GetUnitState(ufil,UNIT_STATE_LIFE)>.405 and ufil!=Unit and(IsUnitType(ufil,UNIT_TYPE_STRUCTURE)==false)and GetOwningPlayer(ufil)!=GetOwningPlayer(Unit)thenset xu=GetUnitX(ufil)set yu=GetUnitY(ufil)set x1U=GetUnitX(udg_Unit_FilterMostNearUnit)set y1U=GetUnitY(udg_Unit_FilterMostNearUnit)set duU=SquareRoot((X-xu)*(X-xu)+(Y-yu)*(Y-yu))set d1UUF=SquareRoot((X-x1U)*(X-x1U)+(Y-y1U)*(Y-y1U))if udg_Unit_FilterMostNearUnit==null thenset udg_Unit_FilterMostNearUnit=ufil
else
if duU<d1UUF thenset udg_Unit_FilterMostNearUnit=ufil
endifendifendifcall GroupRemoveUnit(g,ufil)
endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullendfunctionfunction AbilityPreload takes integer id,integer level returns nothingcall UnitAddAbility(udg_preloader,id)call SetUnitAbilityLevel(udg_preloader,id,level)
call UnitRemoveAbility(udg_preloader,id)
endfunctionfunction EffectPreload takes string s returns nothingcall Preload(s)endfunctionfunction UnitPreload takes integer id returns nothingcall KillUnit(CreateUnit(Player($F),id,-3000.,-3000.,.0))endfunctionfunction ItemPreload takes integer id returns nothingcall RemoveItem(CreateItem(id,.0,.0))endfunctionfunction DestroyEffectWithWaitActions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local effect ef=LoadEffectHandle(udg_hash,h,1)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction DestroyEffectWithWait takes effect ef,real time returns nothing
local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveEffectHandle(udg_hash,h,1,ef)call TimerStart(t,time,false,function DestroyEffectWithWaitActions)set t=nullendfunctionfunction SetAttackAbilityLevel takes unit target,integer damage returns nothinglocal integer a100local integer a10local integer a1
local integer una100
local integer una10local integer una1local integer alocal integer unalocal integer itog100=0local integer itog10=0local integer itog1=0local integer itogif GetUnitAbilityLevel(target,'A07F')<=0 thencall UnitAddAbility(target,'A07F')call UnitAddAbility(target,'A07G')call UnitAddAbility(target,'A07I')call UnitAddAbility(target,'A09D')call UnitAddAbility(target,'A0E6')call UnitAddAbility(target,'A0E7')call UnitMakeAbilityPermanent(target,true,'A07F')call UnitMakeAbilityPermanent(target,true,'A07G')call UnitMakeAbilityPermanent(target,true,'A07I')call UnitMakeAbilityPermanent(target,true,'A09D')call UnitMakeAbilityPermanent(target,true,'A0E6')call UnitMakeAbilityPermanent(target,true,'A0E7')endifset a100=GetUnitAbilityLevel(target,'A07I')set a10=GetUnitAbilityLevel(target,'A07G')set a1=GetUnitAbilityLevel(target,'A07F')set una100=GetUnitAbilityLevel(target,'A0E7')set una10=GetUnitAbilityLevel(target,'A0E6')
set una1=GetUnitAbilityLevel(target,'A09D')set a=((a100-1)*'d')+((a10-1)*$A)+a1-1set una=((una100-1)*'d')+((una10-1)*$A)+una1-1set itog=a-unaif itog+damage<$3E8 and itog+damage>-$3E8 thenset itog=itog+damage
set itog100=(itog/ 'd')set itog10=(itog-(itog100*'d'))/ $Aset itog1=itog-(itog100*'d')-(itog10*$A)
if itog100>=0 thencall SetUnitAbilityLevel(target,'A07I',itog100+1)call SetUnitAbilityLevel(target,'A0E7',1)else
call SetUnitAbilityLevel(target,'A0E7',-itog100+1)call SetUnitAbilityLevel(target,'A07I',1)endifif itog10>=0 thencall SetUnitAbilityLevel(target,'A07G',itog10+1)
call SetUnitAbilityLevel(target,'A0E6',1)else
call SetUnitAbilityLevel(target,'A0E6',-itog10+1)call SetUnitAbilityLevel(target,'A07G',1)endifif itog1>=0 then
call SetUnitAbilityLevel(target,'A07F',itog1+1)call SetUnitAbilityLevel(target,'A09D',1)else
call SetUnitAbilityLevel(target,'A09D',-itog1+1)
call SetUnitAbilityLevel(target,'A07F',1)endifelse
if itog+damage>=$3E8 thencall SetUnitAbilityLevel(target,'A07I',$A)call SetUnitAbilityLevel(target,'A07G',$A)call SetUnitAbilityLevel(target,'A07F',$A)call SetUnitAbilityLevel(target,'A0E7',1)call SetUnitAbilityLevel(target,'A0E6',1)call SetUnitAbilityLevel(target,'A09D',1)endifif itog+damage<=-$3E8 thencall SetUnitAbilityLevel(target,'A07I',1)call SetUnitAbilityLevel(target,'A07G',1)call SetUnitAbilityLevel(target,'A07F',1)call SetUnitAbilityLevel(target,'A0E7',$A)call SetUnitAbilityLevel(target,'A0E6',$A)call SetUnitAbilityLevel(target,'A09D',$A)endifendifendfunctionfunction SetArmorAbilityLevel takes unit target,integer armor returns nothinglocal integer d100local integer d10local integer d1
local integer und100
local integer und10local integer und1local integer deflocal integer undeflocal integer itog100=0local integer itog10=0local integer itog1=0local integer itogif GetUnitAbilityLevel(target,'A0AG')<=0 thencall UnitAddAbility(target,'A0AG')call UnitAddAbility(target,'A0AH')call UnitAddAbility(target,'A087')call UnitAddAbility(target,'A0AS')call UnitAddAbility(target,'A0AT')call UnitAddAbility(target,'A0D8')call UnitMakeAbilityPermanent(target,true,'A0AG')call UnitMakeAbilityPermanent(target,true,'A0AH')call UnitMakeAbilityPermanent(target,true,'A087')call UnitMakeAbilityPermanent(target,true,'A0AS')call UnitMakeAbilityPermanent(target,true,'A0AT')call UnitMakeAbilityPermanent(target,true,'A0D8')endifset d100=GetUnitAbilityLevel(target,'A087')set d10=GetUnitAbilityLevel(target,'A0AH')set d1=GetUnitAbilityLevel(target,'A0AG')set und100=GetUnitAbilityLevel(target,'A0D8')set und10=GetUnitAbilityLevel(target,'A0AT')
set und1=GetUnitAbilityLevel(target,'A0AS')set def=((d100-1)*'d')+((d10-1)*$A)+d1-1
set undef=((und100-1)*'d')+((und10-1)*$A)+und1-1
set itog=def-undefif itog+armor<$3E8 and itog+armor>-$3E8 then
set itog=itog+armorset itog100=(itog/ 'd')set itog10=(itog-(itog100*'d'))/ $Aset itog1=itog-(itog100*'d')-(itog10*$A)
if itog100>=0 thencall SetUnitAbilityLevel(target,'A087',itog100+1)call SetUnitAbilityLevel(target,'A0D8',1)else
call SetUnitAbilityLevel(target,'A0D8',-itog100+1)call SetUnitAbilityLevel(target,'A087',1)endifif itog10>=0 thencall SetUnitAbilityLevel(target,'A0AH',itog10+1)
call SetUnitAbilityLevel(target,'A0AT',1)else
call SetUnitAbilityLevel(target,'A0AT',-itog10+1)call SetUnitAbilityLevel(target,'A0AH',1)endifif itog1>=0 then
call SetUnitAbilityLevel(target,'A0AG',itog1+1)call SetUnitAbilityLevel(target,'A0AS',1)else
call SetUnitAbilityLevel(target,'A0AS',-itog1+1)
call SetUnitAbilityLevel(target,'A0AG',1)endifelse
if itog+armor>=$3E8 then
call SetUnitAbilityLevel(target,'A087',$A)call SetUnitAbilityLevel(target,'A0AH',$A)call SetUnitAbilityLevel(target,'A0AG',$A)call SetUnitAbilityLevel(target,'A0D8',1)call SetUnitAbilityLevel(target,'A0AT',1)call SetUnitAbilityLevel(target,'A0AS',1)endifif itog+armor<=-$3E8 thencall SetUnitAbilityLevel(target,'A087',1)call SetUnitAbilityLevel(target,'A0AH',1)call SetUnitAbilityLevel(target,'A0AG',1)call SetUnitAbilityLevel(target,'A0D8',$A)call SetUnitAbilityLevel(target,'A0AT',$A)call SetUnitAbilityLevel(target,'A0AS',$A)endifendifendfunctionfunction SetAttackSpeedAbilityLevel takes unit target,integer attackspeed returns nothinglocal integer as100local integer as10local integer as1local integer unas100local integer unas10
local integer unas1local integer as
local integer unaslocal integer itog100=0local integer itog10=0local integer itog1=0local integer itogif GetUnitAbilityLevel(target,'A0B3')<=0 thencall UnitAddAbility(target,'A0B3')call UnitAddAbility(target,'A0B4')call UnitAddAbility(target,'A0B5')call UnitAddAbility(target,'A0E9')call UnitAddAbility(target,'A0EA')call UnitAddAbility(target,'A0EB')call UnitMakeAbilityPermanent(target,true,'A0B3')call UnitMakeAbilityPermanent(target,true,'A0B4')call UnitMakeAbilityPermanent(target,true,'A0B5')call UnitMakeAbilityPermanent(target,true,'A0E9')call UnitMakeAbilityPermanent(target,true,'A0EA')call UnitMakeAbilityPermanent(target,true,'A0EB')endifset as100=GetUnitAbilityLevel(target,'A0B5')
set as10=GetUnitAbilityLevel(target,'A0B4')set as1=GetUnitAbilityLevel(target,'A0B3')set unas100=GetUnitAbilityLevel(target,'A0EB')set unas10=GetUnitAbilityLevel(target,'A0EA')set unas1=GetUnitAbilityLevel(target,'A0E9')
set as=((as100-1)*'d')+((as10-1)*$A)+as1-1set unas=((unas100-1)*'d')+((unas10-1)*$A)+unas1-1set itog=as-unas
if itog+attackspeed<$3E8 and itog+attackspeed>-$3E8 then
set itog=itog+attackspeedset itog100=(itog/ 'd')set itog10=(itog-(itog100*'d'))/ $Aset itog1=itog-(itog100*'d')-(itog10*$A)
if itog100>=0 thencall SetUnitAbilityLevel(target,'A0B5',itog100+1)call SetUnitAbilityLevel(target,'A0EB',1)else
call SetUnitAbilityLevel(target,'A0EB',-itog100+1)call SetUnitAbilityLevel(target,'A0B5',1)endifif itog10>=0 thencall SetUnitAbilityLevel(target,'A0B4',itog10+1)
call SetUnitAbilityLevel(target,'A0EA',1)else
call SetUnitAbilityLevel(target,'A0EA',-itog10+1)call SetUnitAbilityLevel(target,'A0B4',1)endifif itog1>=0 then
call SetUnitAbilityLevel(target,'A0B3',itog1+1)call SetUnitAbilityLevel(target,'A0E9',1)else
call SetUnitAbilityLevel(target,'A0E9',-itog1+1)
call SetUnitAbilityLevel(target,'A0B3',1)endifelse
if itog+attackspeed>=$3E8 thencall SetUnitAbilityLevel(target,'A0B5',$A)call SetUnitAbilityLevel(target,'A0B4',$A)call SetUnitAbilityLevel(target,'A0B3',$A)call SetUnitAbilityLevel(target,'A0EB',1)call SetUnitAbilityLevel(target,'A0EA',1)call SetUnitAbilityLevel(target,'A0E9',1)endifif itog+attackspeed<=-$3E8 thencall SetUnitAbilityLevel(target,'A0B5',1)call SetUnitAbilityLevel(target,'A0B4',1)call SetUnitAbilityLevel(target,'A0B3',1)call SetUnitAbilityLevel(target,'A0EB',$A)call SetUnitAbilityLevel(target,'A0EA',$A)call SetUnitAbilityLevel(target,'A0E9',$A)endifendifendfunctionfunction MaxStateModifierID takes unitstate u returns integerif u==UNIT_STATE_MAX_LIFE thenreturn'A07A'
elseif u==UNIT_STATE_MAX_MANA thenreturn'A07E'
endifreturn 0
endfunctionfunction SetUnitMaxState takes unit u,unitstate us,integer val returns nothinglocal integer i=MaxStateModifierID(us)local integer c=valif i==0 then
returnendifif c>0 thenloop
exitwhen c==0call UnitAddAbility(u,i)
if c>='d' thenset c=c-'d'call SetUnitAbilityLevel(u,i,4)elseif c>=$A thenset c=c-$Acall SetUnitAbilityLevel(u,i,3)else
set c=c-1call SetUnitAbilityLevel(u,i,2)endifcall UnitRemoveAbility(u,i)endloopelseif c<0 thenset c=-c
loop
exitwhen c==0call UnitAddAbility(u,i)
if c>='d' thenset c=c-'d'call SetUnitAbilityLevel(u,i,7)elseif c>=$A thenset c=c-$Acall SetUnitAbilityLevel(u,i,6)else
set c=c-1call SetUnitAbilityLevel(u,i,5)endifcall UnitRemoveAbility(u,i)endloopendifendfunctionfunction SetUnitLifeAndManaRegenerationActions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer ht=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,ht,1)local integer life=LoadInteger(udg_hash,ht,2)local integer mana=LoadInteger(udg_hash,ht,3)local real uslife=GetUnitState(target,UNIT_STATE_LIFE)if uslife>.405 and(life!=0 or mana!=0)thencall SetUnitState(target,UNIT_STATE_LIFE,uslife+(I2R(life)/ $A))
call SetUnitState(target,UNIT_STATE_MANA,GetUnitState(target,UNIT_STATE_MANA)+(I2R(mana)/ $A))elseif IsUnitType(target,UNIT_TYPE_HERO)==false then
call FlushChildHashtable(udg_hash,ht)call DestroyTimer(t)
endifset t=nullset target=nullendfunctionfunction SetUnitLifeAndManaRegeneration takes unit target,string s,integer regen returns nothing
local integer hunit=GetHandleId(target)local timer t=LoadTimerHandle(udg_hash,hunit,50)
local integer ht
local integer life=0
local integer mana=0
if t==null thenset t=CreateTimer()set ht=GetHandleId(t)set life=0set mana=0call SaveTimerHandle(udg_hash,hunit,50,t)call SaveUnitHandle(udg_hash,ht,1,target)endifset ht=GetHandleId(t)set life=LoadInteger(udg_hash,ht,2)set mana=LoadInteger(udg_hash,ht,3)if s=="life" thenset life=life+regencall SaveInteger(udg_hash,ht,2,life)
endifif s=="mana" thenset mana=mana+regencall SaveInteger(udg_hash,ht,3,mana)
endifcall TimerStart(t,.1,true,function SetUnitLifeAndManaRegenerationActions)set t=nullendfunctionfunction RandomUnitFromGroup takes integer count,group g returns nothing
local unit array ulocal integer array irandlocal unit first=nulllocal unit random=nulllocal integer howunits=0
local integer howunits2local integer intran
local integer schetchik=0call GroupClear(udg_GroupRandomUnitFromGroup)loop
set first=FirstOfGroup(g)exitwhen first==null
if first!=null and GetUnitState(first,UNIT_STATE_LIFE)>.405 then
set howunits=howunits+1set u[howunits]=firstendifcall GroupRemoveUnit(g,first)endloopset howunits2=howunitsloop
exitwhen howunits<=0 or count<=schetchik
set intran=GetRandomInt(1,howunits)set random=u[intran]
call GroupAddUnit(udg_GroupRandomUnitFromGroup,random)set u[intran]=u[howunits]set howunits=howunits-1set schetchik=schetchik+1set random=nullendlooploop
exitwhen howunits2<=0set u[howunits2]=nullset howunits2=howunits2-1endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset first=nullendfunctionfunction MoveUnit_Timer takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)local real speed=LoadReal(udg_hash,h,2)local real speedreduction=LoadReal(udg_hash,h,3)
local real angle=LoadReal(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,7)
local integer wait2=LoadInteger(udg_hash,h,8)local boolean pause=LoadBoolean(udg_hash,h,9)local real dist=speed-(speedreduction*(wait2*2-wait))local real x=GetUnitX(u)+dist*Cos(angle*bj_DEGTORAD)
local real y=GetUnitY(u)+dist*Sin(angle*bj_DEGTORAD)
if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false and(GetUnitState(u,UNIT_STATE_LIFE)>.405 or LoadReal(udg_hash,h,5)!=.0)then
if pause thencall SetUnitPosition(u,x,y)else
call SetUnitX(u,x)call SetUnitY(u,y)endifendifif wait==wait2 and LoadReal(udg_hash,h,5)>.0 thencall SetUnitFlyHeight(u,-(LoadReal(udg_hash,h,5)),LoadReal(udg_hash,h,6))endifset wait=wait-1if wait<=0 thencall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
else
call SaveInteger(udg_hash,h,7,wait)endifset u=nullendfunctionfunction MoveUnit takes unit u,real time,real speed,real speedreduction,real angle,real height,boolean pause returns nothing
local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=R2I(time/ .03)call SaveUnitHandle(udg_hash,h,1,u)call SaveReal(udg_hash,h,2,speed/ 33.33)
if speedreduction!=.0 thencall SaveReal(udg_hash,h,3,(speedreduction/ 33.33)/ 33.33)endifcall SaveReal(udg_hash,h,4,angle)if height!=.0 thencall UnitAddAbility(u,'Amrf')call UnitRemoveAbility(u,'Amrf')
call SetUnitFlyHeight(u,height,height/(time/ 2))
call SaveReal(udg_hash,h,5,height)call SaveReal(udg_hash,h,6,height/(time/ 2))
endifcall SaveInteger(udg_hash,h,7,wait)call SaveInteger(udg_hash,h,8,wait/ 2)call SaveBoolean(udg_hash,h,9,pause)
call TimerStart(t,.03,true,function MoveUnit_Timer)set t=nullendfunctionfunction SimError takes player ForPlayer,string msg returns nothingif udg_SimError==null thenset udg_SimError=CreateSoundFromLabel("InterfaceError",false,false,false,$A,$A)endifif(GetLocalPlayer()==ForPlayer)thencall ClearTextMessages()
call DisplayTimedTextToPlayer(ForPlayer,.52,-1.,3.,"|cffffcc00"+msg+"|r")call StartSound(udg_SimError)endifendfunctionfunction CreateTexttag takes string s,real size,integer alpha,real x,real y,real offset,real velx,real vely,real lifespain returns nothinglocal texttag txt=CreateTextTag()call SetTextTagText(txt,s,size)call SetTextTagColor(txt,$FF,$FF,$FF,alpha)call SetTextTagPos(txt,x,y,offset)call SetTextTagVelocity(txt,velx,vely)call SetTextTagPermanent(txt,false)if lifespain>.0 then
call SetTextTagLifespan(txt,lifespain)call SetTextTagFadepoint(txt,lifespain/ 2)endifset txt=null
endfunctionfunction CountItemOfTypeOnUnit takes unit u,integer itemId returns integerlocal integer index=0local integer count=0local item indexItem
loop
set indexItem=UnitItemInSlot(u,index)if(indexItem!=null)and(GetItemTypeId(indexItem)==itemId)then
set count=count+1endifset index=index+1exitwhen index>=6endloopreturn count
endfunctionfunction SoundForPlayer takes player ForPlayer,integer number returns nothingif(GetLocalPlayer()==ForPlayer)thencall StartSound(udg_Game_Sound[number])endifendfunctionfunction LinkItems takes integer count1,integer id1,integer count2,integer id2,integer count3,integer id3,integer count4,integer id4,integer count5,integer id5,integer id,string sef,boolean remove returns nothing
local integer array countlocal integer array itemidlocal item array iteminslotlocal unit hero=GetTriggerUnit()
local player p=GetOwningPlayer(hero)
local item manipulateditem=GetManipulatedItem()local integer i=0local integer lopa=1
local integer indexlocal item indexItem
local integer counter=0local integer numerator=0local boolean bol=truelocal item finalitem
local integer charges=0local integer buysumm=0local integer finalcostlocal integer costdifference
local item array fastpurchaseitemlocal boolean fullinv=truelocal boolean stoppurchase=false
set count[1]=count1set count[2]=count2set count[3]=count3set count[4]=count4set count[5]=count5set itemid[1]=id1set itemid[2]=id2set itemid[3]=id3set itemid[4]=id4set itemid[5]=id5loop
exitwhen lopa>5if count[lopa]>0 thenset index=0set numerator=0loop
exitwhen index>5
set indexItem=UnitItemInSlot(hero,index)
if(indexItem!=null)and(GetItemTypeId(indexItem)==itemid[lopa])and count[lopa]>numerator then
if GetItemCharges(indexItem)>0 and GetItemCharges(indexItem)>charges thenset charges=GetItemCharges(indexItem)endifset buysumm=buysumm+LoadInteger(udg_hash,itemid[lopa],'x')set counter=counter+1set numerator=numerator+1set iteminslot[counter]=indexItemif udg_Boolean_Player_Fast_Purchase[GetPlayerId(p)+1] thenset fastpurchaseitem[counter]=indexItemendifendifset index=index+1endloopif numerator<count[lopa]then
set bol=falseendifendifset lopa=lopa+1endloopif LoadStr(udg_hash,GetUnitTypeId(hero),91)!="ranged" and GetItemTypeId(manipulateditem)=='I041' thenset bol=falseset stoppurchase=trueset udg_Show_Item_Link_Text=falsecall SimError(p,"Этот предмет предназначен только для героев дальнего боя!!!")call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+R2I(GetWidgetLife(manipulateditem)))endifif LoadStr(udg_hash,GetUnitTypeId(hero),91)!="melee" and(GetItemTypeId(manipulateditem)=='I01R' or GetItemTypeId(manipulateditem)=='I02M')thenset bol=falseset stoppurchase=trueset udg_Show_Item_Link_Text=falsecall SimError(p,"Этот предмет предназначен только для героев ближнего боя!!!")call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+R2I(GetWidgetLife(manipulateditem)))else
if(GetItemTypeId(manipulateditem)=='I01R' or GetItemTypeId(manipulateditem)=='I02M')then
if(GetItemTypeId(manipulateditem)=='I01R' and(CountItemOfTypeOnUnit(hero,'I02E')+CountItemOfTypeOnUnit(hero,'I02N'))>=1)or(GetItemTypeId(manipulateditem)=='I02M' and CountItemOfTypeOnUnit(hero,'I02N')>=1)then
set bol=falseset stoppurchase=trueset udg_Show_Item_Link_Text=falsecall SimError(p,"У вашего героя уже есть Топор Вождя Орков или Крушитель!!!")call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+R2I(GetWidgetLife(manipulateditem)))endifendifendifif bol thenloop
exitwhen counter<=0call RemoveItem(iteminslot[counter])
set iteminslot[counter]=null
set counter=counter-1endloopset finalitem=CreateItem(id,GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,finalitem)
call SetItemUserData(finalitem,GetPlayerId(GetOwningPlayer(hero))+1)
if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)and udg_System_ShowAbil_And_Items_Hint[GetPlayerId(GetLocalPlayer())+1] thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r приобрел предмет |cff99ccff"+GetItemName(finalitem)+"|r")endifif(id=='I055' or id=='I056' or id=='I057' or id=='I058')then
call SetItemCharges(finalitem,1)
endifif charges!=0 thencall SetItemCharges(finalitem,charges)endifset udg_Integer_Item_Recipe_Level=-1
set udg_Show_Item_Link_Text=falseif sef=="" thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",hero,"origin"))else
call DestroyEffect(AddSpecialEffectTarget(sef,hero,"origin"))endifelse
if udg_Boolean_Player_Fast_Purchase[GetPlayerId(p)+1] and GetItemType(manipulateditem)==ITEM_TYPE_POWERUP and stoppurchase==false and LoadInteger(udg_hash,id,'y')<=0 thenset finalcost=LoadInteger(udg_hash,id,'x')set costdifference=GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+R2I(GetWidgetLife(manipulateditem))-finalcost+buysummif costdifference>=0 thenset lopa=0loop
exitwhen lopa>5if fastpurchaseitem[lopa]!=null then
call RemoveItem(fastpurchaseitem[lopa])endifset fastpurchaseitem[lopa]=nullset iteminslot[lopa]=nullset lopa=lopa+1endloopset lopa=0loop
exitwhen lopa>5if UnitItemInSlot(hero,lopa)==null thenset fullinv=falseendifset lopa=lopa+1endloopif fullinv==false thenset finalitem=CreateItem(id,GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,finalitem)
call SetItemUserData(finalitem,GetPlayerId(GetOwningPlayer(hero))+1)
call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+R2I(GetWidgetLife(manipulateditem))-finalcost+buysumm)
if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)and udg_System_ShowAbil_And_Items_Hint[GetPlayerId(GetLocalPlayer())+1] thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r приобрел предмет |cff99ccff"+GetItemName(finalitem)+"|r")endifif(id=='I055' or id=='I056' or id=='I057' or id=='I058')then
call SetItemCharges(finalitem,1)
endifif charges!=0 thencall SetItemCharges(finalitem,charges)endifset udg_Integer_Item_Recipe_Level=-1
set udg_Show_Item_Link_Text=falseif sef=="" thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",hero,"origin"))else
call DestroyEffect(AddSpecialEffectTarget(sef,hero,"origin"))endifelse
call SoundForPlayer(p,$C)call SimError(p,"Недостаточно места в инвентаре.")endifelse
call SoundForPlayer(p,$D)call SimError(p,"Недостаточно золота для быстрой покупки!!!")
endifendifendifif GetItemType(manipulateditem)==ITEM_TYPE_POWERUP thenif bol==false thenset udg_Integer_Item_Recipe_Level=udg_Integer_Item_Recipe_Level-1endifif udg_Integer_Item_Recipe_Level<0 and udg_Show_Item_Link_Text thenif udg_Boolean_Player_Fast_Purchase[GetPlayerId(p)+1] and LoadInteger(udg_hash,id,0)<=0 then
if fullinv==false thencall SoundForPlayer(p,$D)call SimError(p,"Недостаточно золота для быстрой покупки!!!")
endifelse
call SimError(p,"Для того, чтобы собрать предмет, требуются все компоненты!!!")endifcall SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+R2I(GetWidgetLife(manipulateditem)))endifif udg_Integer_Item_Recipe_Level<0 thencall RemoveItem(manipulateditem)
endifendifset indexItem=nullset finalitem=nullset hero=nullset manipulateditem=null
set p=nullendfunctionfunction ProgressBarMove takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local texttag txt=LoadTextTagHandle(udg_hash,h,1)local unit u=LoadUnitHandle(udg_hash,h,4)local integer counter=LoadInteger(udg_hash,h,5)local string color=LoadStr(udg_hash,h,6)
local integer orderId=LoadInteger(udg_hash,h,7)local integer length=LoadInteger(udg_hash,h,8)local integer orderunitlocal boolean orderbool=falselocal boolean display=truelocal string scolorlocal string swhitelocal string sif counter>0 thenset counter=counter-1call SaveInteger(udg_hash,h,5,counter)if orderId!=0 thenset orderbool=trueendifif orderbool thenset orderunit=GetUnitCurrentOrder(u)
if orderunit==orderId thenelse
set display=falseendifendifif display thenset scolor=color+SubString("llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll",counter,length)+"|r"
set swhite=SubString("llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll",0,counter)
set s=scolor+swhitecall SetTextTagText(txt,s,.0115)
else
set counter=0call SaveInteger(udg_hash,h,5,counter)endifelse
call DestroyTextTag(txt)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset txt=null
set u=nullendfunctionfunction AddProgressBarfake takes unit u,real size,string color,string order,real time returns nothinglocal texttag txt=CreateTextTag()local timer t=CreateTimer()local integer h=GetHandleId(t)local real x=GetUnitX(u)+(125.*size)*Cos(180.*bj_DEGTORAD)local real y=GetUnitY(u)+(125.*size)*Sin(180.*bj_DEGTORAD)local integer counter=R2I('d'*size)local real periodic=time/ counterlocal integer orderIdcall SetTextTagText(txt,SubString("llllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllllll",0,R2I('d'*size)),.0115)call SetTextTagPos(txt,x,y,200.)
call SetTextTagPermanent(txt,false)call SaveTextTagHandle(udg_hash,h,1,txt)
call SaveUnitHandle(udg_hash,h,4,u)call SaveInteger(udg_hash,h,5,counter)call SaveStr(udg_hash,h,6,color)
if order!="" thenset orderId=OrderId(order)if(orderId!=0)thenelse
set orderId=UnitId(order)if(orderId!=0)thenendifendifcall SaveInteger(udg_hash,h,7,orderId)else
call SaveInteger(udg_hash,h,7,0)
endifcall SaveInteger(udg_hash,h,8,counter)call TimerStart(t,periodic,true,function ProgressBarMove)set txt=null
set t=nullendfunctionfunction IsPointInRect takes real px,real py,real cx,real cy,real ax,real ay,real bx,real by returns boolean
local real dot1=(px-cx)*(ax-cx)+(py-cy)*(ay-cy)local real dot2=(ax-cx)*(ax-cx)+(ay-cy)*(ay-cy)local real dot3=(px-cx)*(bx-cx)+(py-cy)*(by-cy)local real dot4=(bx-cx)*(bx-cx)+(by-cy)*(by-cy)return dot1>=0 and dot1<=dot2 and dot3>=0 and dot3<=dot4
endfunctionfunction UnitPeriodicPostionMovePeriodic takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
call SetUnitX(target,GetUnitX(target))call SetUnitY(target,GetUnitY(target))call IssueImmediateOrderById(target,$D0004)if wait<=0 thencall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
else
call SaveInteger(udg_hash,h,2,wait-1)endifset t=nullset target=nullendfunctionfunction UnitPeriodicPostionMove takes unit target,real periodic,real time returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,target)
call SaveInteger(udg_hash,h,2,R2I(time/ periodic))call TimerStart(t,periodic,true,function UnitPeriodicPostionMovePeriodic)set t=nullendfunctionfunction StunUnitTimed_Periodic takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit dammi=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local integer stun100=LoadInteger(udg_hash,h,3)local integer stun10=LoadInteger(udg_hash,h,4)local integer stun1=LoadInteger(udg_hash,h,5)local integer stunstage=LoadInteger(udg_hash,h,6)set stunstage=stunstage+1call SaveInteger(udg_hash,h,6,stunstage)
if stunstage==1 then
if GetUnitAbilityLevel(dammi,'A0H4')>0 thencall IssueTargetOrderById(dammi,$D007F,target)endifcall TimerStart(t,stun100*1.,false,function StunUnitTimed_Periodic)endifif stunstage==2 then
if GetUnitAbilityLevel(dammi,'A0H5')>0 thencall IssueTargetOrderById(dammi,$D0107,target)endifcall TimerStart(t,stun10*.1,false,function StunUnitTimed_Periodic)endifif stunstage==3 then
if GetUnitAbilityLevel(dammi,'A0H6')>0 thencall IssueTargetOrderById(dammi,$D011C,target)endifcall TimerStart(t,stun1*.01,false,function StunUnitTimed_Periodic)endifif stunstage>=4 then
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset dammi=nullset target=nullendfunctionfunction StunUnitTimed takes unit target,real time returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi=CreateUnit(Player($F),'h00U',GetUnitX(target),GetUnitY(target),.0)local integer stun100local integer stun10
local integer stun1local integer stunstage=0if time>=10. thenset time=9.99endifset stun100=R2I(time)set stun10=R2I((time-stun100)*$A)set stun1=R2I(time*'d')-stun100*'d'-stun10*$Aif stun100>0 thencall UnitAddAbility(dammi,'A0H4')call SetUnitAbilityLevel(dammi,'A0H4',stun100)endifif stun10>0 then
call UnitAddAbility(dammi,'A0H5')call SetUnitAbilityLevel(dammi,'A0H5',stun10)endifif stun1>0 thencall UnitAddAbility(dammi,'A0H6')call SetUnitAbilityLevel(dammi,'A0H6',stun1)
endifcall UnitApplyTimedLife(dammi,'BTLF',I2R(stun100)+2.)call SaveUnitHandle(udg_hash,h,1,dammi)call SaveUnitHandle(udg_hash,h,2,target)
call SaveInteger(udg_hash,h,3,stun100)call SaveInteger(udg_hash,h,4,stun10)call SaveInteger(udg_hash,h,5,stun1)
call SaveInteger(udg_hash,h,6,stunstage)
call TimerStart(t,.0,false,function StunUnitTimed_Periodic)set t=nullset dammi=nullendfunctionfunction RemovePotionAfterMinute takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit dammi=LoadUnitHandle(udg_hash,h,1)local effect ef=LoadEffectHandle(udg_hash,h,2)local region reg=LoadRegionHandle(udg_hash,h,3)local rect rct=LoadRectHandle(udg_hash,h,4)call KillUnit(dammi)
call DestroyEffect(ef)call FlushChildHashtable(udg_hash,GetHandleId(reg))call FlushChildHashtable(udg_hash,GetHandleId(dammi))call RemoveRect(rct)
call RemoveRegion(reg)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset dammi=nullset ef=nullset reg=null
set rct=null
endfunctionfunction CreatePotion takes real x,real y,integer potionmin,integer potionmax returns nothinglocal integer potionindex=GetRandomInt(potionmin,potionmax)local unit dammi=CreateUnit(Player($F),'h00U',x,y,GetRandomReal(.0,360.))local effect ef=AddSpecialEffectTarget(udg_Potion_Effect[potionindex],dammi,"origin")local string healtype=udg_Potion_Type[potionindex]local integer heal=udg_Potion_Heal_Amount[potionindex]local real size=udg_Potion_Size[potionindex]
local group g=CreateGroup()local unit Pickedlocal boolean destroy=falselocal texttag txtlocal real vel=.0221875local real angle=45.+GetRandomReal(.0,90.)local real xvel=vel*Cos(angle*bj_DEGTORAD)local real yvel=vel*Sin(angle*bj_DEGTORAD)local real state
local rect rctlocal region reg
local timer tlocal integer hcall SetUnitScale(dammi,size,size,size)call GroupEnumUnitsInRange(g,x,y,150.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==null or destroy
if GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetPlayerId(GetOwningPlayer(Picked))<=8 and IsUnitType(Picked,UNIT_TYPE_HERO) and GetUnitTypeId(Picked)!='h00U' thenset state=GetUnitState(Picked,UNIT_STATE_LIFE)if healtype=="life" and(state<GetUnitState(Picked,UNIT_STATE_MAX_LIFE))thencall SetUnitState(Picked,UNIT_STATE_LIFE,state+heal)
call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",Picked,"origin"),2.)set txt=CreateTextTag()call SetTextTagText(txt,"|cFF00DC00+"+I2S(heal)+"|r",.03)call SetTextTagPos(txt,x,y,.0)call SetTextTagColor(txt,0,0,0,$C8)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagLifespan(txt,3.)call SetTextTagFadepoint(txt,.0)
call SetTextTagPermanent(txt,false)set destroy=true
endifset state=GetUnitState(Picked,UNIT_STATE_MANA)if healtype=="mana" and(state<GetUnitState(Picked,UNIT_STATE_MAX_MANA))thencall SetUnitState(Picked,UNIT_STATE_MANA,state+heal)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",Picked,"origin"))
set txt=CreateTextTag()call SetTextTagText(txt,"|c000347FC+"+I2S(heal)+"|r",.03)call SetTextTagPos(txt,x,y,.0)call SetTextTagColor(txt,0,0,0,$C8)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagLifespan(txt,3.)call SetTextTagFadepoint(txt,.0)
call SetTextTagPermanent(txt,false)set destroy=true
endifendifcall GroupRemoveUnit(g,Picked)endloopif destroy thencall KillUnit(dammi)
call DestroyEffect(ef)else
set reg=CreateRegion()set rct=Rect(x-100.,y-100.,x+100.,y+100.)call RegionAddRect(reg,rct)call SaveUnitHandle(udg_hash,GetHandleId(reg),1,dammi)call SaveRectHandle(udg_hash,GetHandleId(reg),2,rct)
call SaveInteger(udg_hash,GetHandleId(dammi),1,potionindex)call SaveEffectHandle(udg_hash,GetHandleId(dammi),2,ef)call TriggerRegisterEnterRegion(gg_trg_Check_Potion_Picked_Up,reg,null)set rct=null
set reg=null
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,dammi)call SaveEffectHandle(udg_hash,h,2,ef)call SaveRegionHandle(udg_hash,h,3,reg)call SaveRectHandle(udg_hash,h,4,rct)call TimerStart(t,60.,false,function RemovePotionAfterMinute)endifset dammi=nullset ef=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset txt=null
set t=nullendfunctionfunction TimerToFunctionDestroy takes nothing returns nothinglocal timer t2=GetExpiredTimer()
local integer h2=GetHandleId(t2)
local timer t=LoadTimerHandle(udg_hash,h2,1)
local timerdialog td=LoadTimerDialogHandle(udg_hash,h2,2)call DestroyTimer(t)
call DestroyTimer(t2)call DestroyTimerDialog(td)call FlushChildHashtable(udg_hash,h2)set t=nullset t2=nullset td=nullendfunctionfunction TimerToFunction takes real time,string s,code funcname returns nothinglocal timer t=CreateTimer()local timerdialog td
local timer t2=CreateTimer()
local integer h2=GetHandleId(t2)
if s!="" thenset td=CreateTimerDialog(t)call TimerDialogSetTitle(td,s)call TimerDialogDisplay(td,true)
call TimerDialogSetTimeColor(td,$FF,45,45,20)call SaveTimerDialogHandle(udg_hash,h2,2,td)
set td=nullendifcall TimerStart(t,time,false,funcname)call TimerStart(t2,time+1.,false,function TimerToFunctionDestroy)call SaveTimerHandle(udg_hash,h2,1,t)set t=nullset t2=nullendfunctionfunction HintsToPlayerWithDelay_ShowHint takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer count=LoadInteger(udg_hash,h,$A)local player p=LoadPlayerHandle(udg_hash,h,$B)local string sif count>0 thenset s=LoadStr(udg_hash,h,count)call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cff32cd32ПОДСКАЗКА:|r")
call DisplayTimedTextToPlayer(p,.0,.0,10.,s)
call SoundForPlayer(p,1)
set count=count-1call SaveInteger(udg_hash,h,$A,count)else
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset t=nullset p=nullendfunctionfunction HintsToPlayerWithDelay takes player p returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer count=5local string array s
set s[5]="Ваша задача: защищать стражей-заклинателей, находящихся около портала на вашей базе. Если все они погибнут - вы проиграете"set s[4]="В правой части базы находятся магазины с предметами, они разделены по типу, поэтому вы можете быстро найти нужные для себя артефакты"set s[3]="Просмотреть игровые команды, а также краткую информацию о карте вы можете в меню Инфо (|Cfffed312F9|r) а также на верхней панели интерфейса"
set s[2]="Для более легкого прохождения первых волн, купите в магазинах несколько зелий лечения здоровья и маны, они помогут вам не умирать в бою."set s[1]="Приношу свои извинения, но в альфа версии карты, в лесy вокруг базы пока что никого и ничего нет. В следующих версиях там уже кое-что появится..."call TimerStart(t,15.,true,function HintsToPlayerWithDelay_ShowHint)
call SaveStr(udg_hash,h,1,s[1])call SaveStr(udg_hash,h,2,s[2])call SaveStr(udg_hash,h,3,s[3])call SaveStr(udg_hash,h,4,s[4])call SaveStr(udg_hash,h,5,s[5])call SaveInteger(udg_hash,h,$A,count)call SavePlayerHandle(udg_hash,h,$B,p)set t=nullendfunctionfunction ProgressBarAddPercentComplete_Stop_Animation takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit dammi=LoadUnitHandle(udg_hash,h,1)local real sum=LoadReal(udg_hash,GetHandleId(dammi),1)local integer count=LoadInteger(udg_hash,GetHandleId(dammi),2)local real tsum=LoadReal(udg_hash,h,2)local integer tcount=LoadInteger(udg_hash,h,3)set count=count-tcountcall SaveInteger(udg_hash,GetHandleId(dammi),2,count)set tcount=0
call SaveInteger(udg_hash,h,3,tcount)set sum=sum-tsum
call SaveReal(udg_hash,GetHandleId(dammi),1,sum)
set tsum=.0call SaveReal(udg_hash,h,2,tsum)
if count<=0 then
call SetUnitTimeScale(dammi,.0)call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
else
set tsum=sum
set tcount=count
call SaveReal(udg_hash,h,2,tsum)
call SaveInteger(udg_hash,h,3,tcount)call SaveUnitHandle(udg_hash,h,1,dammi)call SetUnitTimeScale(dammi,(.1*tsum))call TimerStart(t,.1,false,function ProgressBarAddPercentComplete_Stop_Animation)endifset t=nullset dammi=nullendfunctionfunction ProgressBarAddPercentComplete takes unit dammi,real percent returns nothing
local timer tlocal integer hlocal real sum=LoadReal(udg_hash,GetHandleId(dammi),1)local integer count=LoadInteger(udg_hash,GetHandleId(dammi),2)set sum=sum+percentset count=count+1call SaveReal(udg_hash,GetHandleId(dammi),1,sum)
call SaveInteger(udg_hash,GetHandleId(dammi),2,count)if count<=1 then
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,dammi)call SaveReal(udg_hash,h,2,percent)call SaveInteger(udg_hash,h,3,1)
call SetUnitTimeScale(dammi,(.1*percent))call TimerStart(t,.1,false,function ProgressBarAddPercentComplete_Stop_Animation)set t=nullendifendfunctionfunction AddProgressBarMovingPeriodic takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local unit dammi=LoadUnitHandle(udg_hash,h,2)local boolean deadif GetUnitState(dammi,UNIT_STATE_LIFE)>.405 and dammi!=null then
if GetUnitState(target,UNIT_STATE_LIFE)>.405 thencall SetUnitPosition(dammi,GetUnitX(target),GetUnitY(target))set dead=LoadBoolean(udg_hash,h,3)if dead then
call SetUnitVertexColor(dammi,LoadInteger(udg_hash,h,4),LoadInteger(udg_hash,h,5),LoadInteger(udg_hash,h,6),$FF)
call SaveBoolean(udg_hash,h,3,false)
endifelse
set dead=LoadBoolean(udg_hash,h,3)if dead==false thencall SetUnitVertexColor(dammi,LoadInteger(udg_hash,h,4),LoadInteger(udg_hash,h,5),LoadInteger(udg_hash,h,6),0)call SaveBoolean(udg_hash,h,3,true)endifendifelse
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset t=nullset target=nullset dammi=nullendfunctionfunction AddProgressBar takes unit target,real height,real size,real time,boolean move,boolean auto,integer hand,integer red,integer green,integer blue returns nothinglocal unit dammi=CreateUnit(GetOwningPlayer(target),'h00B',GetUnitX(target),GetUnitY(target),270.)local timer tlocal integer hcall SetUnitX(dammi,GetUnitX(target))call SetUnitY(dammi,GetUnitY(target))call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,height,.0)call SetUnitScale(dammi,size,size,size)call SetUnitVertexColor(dammi,red,green,blue,$FF)call SetUnitAnimation(dammi,"birth")
call SaveUnitHandle(udg_hash,GetHandleId(target),hand,dammi)
if auto then
call SetUnitTimeScale(dammi,(1./ time))call UnitApplyTimedLife(dammi,'BTLF',time)else
call SetUnitTimeScale(dammi,.0)endifif move then
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,target)
call SaveUnitHandle(udg_hash,h,2,dammi)call SaveBoolean(udg_hash,h,3,false)
call SaveInteger(udg_hash,h,4,red)call SaveInteger(udg_hash,h,5,green)
call SaveInteger(udg_hash,h,6,blue)call TimerStart(t,.03,true,function AddProgressBarMovingPeriodic)set t=nullendifset dammi=nullendfunctionfunction HeroStepsPeriodicSound takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local real xnew=GetUnitX(target)
local real ynew=GetUnitY(target)
local integer random=GetRandomInt(1,4)local player pif GetUnitState(target,UNIT_STATE_LIFE)>.405 and(x!=xnew and y!=ynew)thenset p=GetOwningPlayer(target)if random==1 thencall SoundForPlayer(p,8)
call BJDebugMsg("1")
endifif random==2 thencall SoundForPlayer(p,9)
call BJDebugMsg("2")
endifif random==3 thencall SoundForPlayer(p,$A)call BJDebugMsg("3")
endifif random==4 thencall SoundForPlayer(p,$B)call BJDebugMsg("4")
endifcall SaveReal(udg_hash,h,2,xnew)
call SaveReal(udg_hash,h,3,ynew)
endifset t=nullset target=nullendfunctionfunction HeroStepsSound takes unit target returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local real x=GetUnitX(target)local real y=GetUnitY(target)call SaveUnitHandle(udg_hash,h,1,target)
call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call TimerStart(t,1.,true,function HeroStepsPeriodicSound)set t=nullendfunctionfunction ShowAndFlushAllPlayerDamage takes boolean flushonly returns nothing
local string slocal real maxtakendamage=.0
local real maxreciveddamage=.0local real ptakendamage=.0local real preceiveddamage=.0local player pmaxtakedamage=Player(0)local player pmaxreceiveddamage=Player(0)local integer lopa=0
local real alltakendamage=.0
local real allreceiveddamage=.0local player plocal integer id
local real percent=.0local string spercentlocal real time=.0if flushonly==false then
loop
exitwhen lopa>8set alltakendamage=alltakendamage+udg_Player_Taken_Damage_Current[lopa]set allreceiveddamage=allreceiveddamage+udg_Player_Received_Damage_Current[lopa]
if udg_Player_Taken_Damage_Current[lopa]>maxtakendamage then
set maxtakendamage=udg_Player_Taken_Damage_Current[lopa]
set pmaxtakedamage=Player(lopa)endifif udg_Player_Received_Damage_Current[lopa]>maxreciveddamage thenset maxreciveddamage=udg_Player_Received_Damage_Current[lopa]set pmaxreceiveddamage=Player(lopa)endifset time=(10000.-TimerGetRemaining(udg_TimerShowAndFlushAllPlayerDmg))call PauseTimer(udg_TimerShowAndFlushAllPlayerDmg)set lopa=lopa+1endloopif(IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS))thenset p=GetLocalPlayer()call DisplayTimedTextToPlayer(p,.0,.0,20.," ")call DisplayTimedTextToPlayer(p,.0,.0,20.,"Затраченное Время: |cff00CD00"+(SubString(R2S(time),0,StringLength(R2S(time))-2))+"|r секунд")call DisplayTimedTextToPlayer(p,.0,.0,20.,"Всего урона нанесено: |cff99ccff"+I2S(R2I(alltakendamage))+"|r урона")
call DisplayTimedTextToPlayer(p,.0,.0,20.,"Всего урона получено: |cff99ccff"+I2S(R2I(allreceiveddamage))+"|r урона")set percent=((maxtakendamage/ alltakendamage)*'d')call DisplayTimedTextToPlayer(p,.0,.0,20.,"Больше всего нанесено урона: "+udg_ColorString[GetPlayerId(pmaxtakedamage)+1]+GetPlayerName(pmaxtakedamage)+"|r (|cff99ccff"+I2S(R2I(maxtakendamage))+"|r урона - |cff99ccff"+(SubString(R2S(percent),0,StringLength(R2S(percent))-2))+"%|r )")set percent=((maxreciveddamage/ allreceiveddamage)*'d')call DisplayTimedTextToPlayer(p,.0,.0,20.,"Больше всего урона получено: "+udg_ColorString[GetPlayerId(pmaxreceiveddamage)+1]+GetPlayerName(pmaxreceiveddamage)+"|r (|cff99ccff"+I2S(R2I(maxreciveddamage))+"|r урона - |cff99ccff"+(SubString(R2S(percent),0,StringLength(R2S(percent))-2))+"%|r )")if p!=pmaxtakedamage thenset percent=((udg_Player_Taken_Damage_Current[GetPlayerId(p)]/ alltakendamage)*'d')call DisplayTimedTextToPlayer(p,.0,.0,20.,"Ваш нанесенный урон: ( |cff99ccff"+I2S(R2I(udg_Player_Taken_Damage_Current[GetPlayerId(p)]))+"|r урона - |cff99ccff"+(SubString(R2S(percent),0,StringLength(R2S(percent))-2))+"%|r )")endifif p!=pmaxreceiveddamage thenset percent=((udg_Player_Received_Damage_Current[GetPlayerId(p)]/ allreceiveddamage)*'d')call DisplayTimedTextToPlayer(p,.0,.0,20.,"Ваш полученный урон: ( |cff99ccff"+I2S(R2I(udg_Player_Received_Damage_Current[GetPlayerId(p)]))+"|r урона - |cff99ccff"+(SubString(R2S(percent),0,StringLength(R2S(percent))-2))+"%|r )")endifset p=nullendifset lopa=0endifloop
exitwhen lopa>8set udg_Player_Taken_Damage_Current[lopa]=.0
set udg_Player_Received_Damage_Current[lopa]=.0set lopa=lopa+1endloopendfunctionfunction MoveDammiReferencePanel_Timer takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local unit dammi=LoadUnitHandle(udg_hash,h,2)local real x=GetUnitX(hero)local real y=GetUnitY(hero)local boolean alife=LoadBoolean(udg_hash,h,3)if(GetUnitState(hero,UNIT_STATE_LIFE)<.405 and alife)thencall ShowUnit(dammi,false)set alife=falsecall SaveBoolean(udg_hash,h,3,alife)
else
if(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife==false)then
call ShowUnit(dammi,true)set alife=truecall SaveBoolean(udg_hash,h,3,alife)
endifcall SetUnitX(dammi,x)call SetUnitY(dammi,y)endifset t=nullset hero=nullset dammi=nullendfunctionfunction MoveDammiReferencePanel takes unit hero returns nothing
local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi=CreateUnit(GetOwningPlayer(hero),'h00C',GetUnitX(hero),GetUnitY(hero),.0)call SaveUnitHandle(udg_hash,h,1,hero)call SaveUnitHandle(udg_hash,h,2,dammi)call SaveBoolean(udg_hash,h,3,true)call IssueImmediateOrderById(dammi,$D0057)call TimerStart(t,1.,true,function MoveDammiReferencePanel_Timer)set t=nullset dammi=nullendfunctionfunction IsUnitInvulnerable takes unit Unit returns booleanlocal real Health_Current=GetWidgetLife(Unit)local real Mana_Current=GetUnitState(Unit,UNIT_STATE_MANA)local boolean Check_Healthcall SetWidgetLife(Unit,Health_Current+.001)
if Health_Current!=GetWidgetLife(Unit)thencall UnitDamageTarget(Unit,Unit,.001,false,true,null,null,null)set Check_Health=(GetWidgetLife(Unit)==Health_Current+.001)else
call UnitDamageTarget(Unit,Unit,.001,false,true,null,null,null)set Check_Health=(GetWidgetLife(Unit)==Health_Current)call SetWidgetLife(Unit,Health_Current)endifif Check_Health then
return not(GetUnitState(Unit,UNIT_STATE_MANA)!=Mana_Current)
endifreturn Check_Healthendfunctionfunction GroupToGroupUnitMoving takes nothing returns nothingcall GroupAddUnit(udg_Temp_Group[1],GetEnumUnit())endfunctionfunction GroupToGroup takes group gold,group gnew returns nothingset udg_Temp_Group[1]=gnewcall ForGroup(gold,function GroupToGroupUnitMoving)set udg_Temp_Group[1]=nullendfunctionfunction CreateEnergyWall takes integer start,integer end returns nothinglocal integer lopa=start
local integer lopbloop
exitwhen lopa>endset udg_EnergyWallUnit[lopa]=CreateUnit(Player($F),'h00I',udg_EnergyWallX[lopa],udg_EnergyWallY[lopa],udg_EnergyWallAngle[lopa])
set lopb=1loop
exitwhen lopb>7set udg_EnergyWallBlock[(lopa-1)*7+lopb]=CreateDestructable('YTpc',udg_EnergyWallX[lopa]-((4-lopb)*128.-64.)*Cos((udg_EnergyWallAngle[lopa]-90.)*bj_DEGTORAD),udg_EnergyWallY[lopa]-((4-lopb)*128.-64.)*Sin((udg_EnergyWallAngle[lopa]-90.)*bj_DEGTORAD),udg_EnergyWallAngle[lopa],1.,0)
set lopb=lopb+1endloopset lopa=lopa+1endloopendfunctionfunction ConvertMagicAndChaosDamageInClear takes unit target,real magicdamage,real chaosdamage returns reallocal real itog=magicdamageif IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false then
if IsUnitType(target,UNIT_TYPE_HERO) thenset magicdamage=magicdamage*.75endifif GetUnitAbilityLevel(target,'A0HD')>0 then
set magicdamage=magicdamage*1.5endifif GetUnitAbilityLevel(target,'A0CZ')>0 then
set magicdamage=magicdamage*.75endifif GetUnitAbilityLevel(target,'A017')>0 then
set magicdamage=magicdamage*.85endifif GetUnitAbilityLevel(target,'A01C')>0 then
set magicdamage=magicdamage*.7endifif GetUnitAbilityLevel(target,'A09T')>0 then
set magicdamage=magicdamage*.7endifelse
set magicdamage=.0endifset itog=magicdamage+chaosdamage
return itogendfunctionfunction RemoveUnitAttack_End takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local effect ef=LoadEffectHandle(udg_hash,h,2)call UnitRemoveAbility(target,'A0PL')call DestroyEffect(ef)call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset ef=nullset target=nullendfunctionfunction RemoveUnitAttack takes unit target,real time returns nothinglocal timer tlocal integer hlocal effect eflocal real newtimeif LoadTimerHandle(udg_hash,GetHandleId(target),$A4)==null thenset t=CreateTimer()set h=GetHandleId(t)
set ef=AddSpecialEffectTarget("Effects\\NoAttack.mdx",target,"overhead")
call UnitAddAbility(target,'A0PL')call SaveUnitHandle(udg_hash,h,1,target)
call SaveEffectHandle(udg_hash,h,2,ef)call SaveTimerHandle(udg_hash,GetHandleId(target),$A4,t)
set ef=nullset newtime=time
else
set t=LoadTimerHandle(udg_hash,GetHandleId(target),$A4)if time>TimerGetRemaining(t)then
set newtime=time
else
set newtime=TimerGetRemaining(t)
endifendifcall TimerStart(t,newtime,false,function RemoveUnitAttack_End)set t=nullendfunctionfunction HaveAnyTimeTalisman takes nothing returns reallocal real respawn=.0local group grp=CreateGroup()local unit Pickedcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,grp)
loop
set Picked=FirstOfGroup(grp)
exitwhen Picked==nullif IsUnitType(Picked,UNIT_TYPE_HERO) and GetPlayerId(GetOwningPlayer(Picked))<=8 thenif CountItemOfTypeOnUnit(Picked,'I02R')>0 and(.1>respawn)thenset respawn=.1endifif CountItemOfTypeOnUnit(Picked,'I02S')>0 and(.15>respawn)thenset respawn=.15endifif CountItemOfTypeOnUnit(Picked,'I02W')>0 and(.2>respawn)thenset respawn=.2endifif CountItemOfTypeOnUnit(Picked,'I02X')>0 and(.25>respawn)thenset respawn=.25endifif CountItemOfTypeOnUnit(Picked,'I02Y')>0 and(.3>respawn)thenset respawn=.3endifendifcall GroupRemoveUnit(grp,Picked)
endloopset Picked=nullcall GroupClear(grp)
call DestroyGroup(grp)set grp=null
return respawnendfunctionfunction Trig_Players_Start_Script_Func034A takes nothing returns nothingcall SetPlayerFlagBJ(PLAYER_STATE_GIVES_BOUNTY,true,GetEnumPlayer())
call SetPlayerColorBJ(GetEnumPlayer(),PLAYER_COLOR_BROWN,true)endfunctionfunction Trig_Players_Start_Script_Actions takes nothing returns nothing
call AbilityPreload('A0J2',30)call AbilityPreload('A0J4',25)set udg_CountGuardsExorcist=8set udg_ColorString[1]="|cffff0000"set udg_ColorString[2]="|cff0000ff"set udg_ColorString[3]="|cff00f5ff"set udg_ColorString[4]="|cff551A8B"set udg_ColorString[5]="|cffffff00"set udg_ColorString[6]="|cffEE9A00"set udg_ColorString[7]="|cff00CD00"set udg_ColorString[8]="|cffFF69B4"set udg_ColorString[9]="|cffC0C0C0"set udg_ColorString[$A]="|cffB0E2FF"
set udg_ColorString[$B]="|cff006400"
set udg_ColorString[$C]="|cff8B4513"
set udg_ColorString[20]="|cffff0000"
set udg_ColorString[21]="|cff0000ff"
set udg_ColorString[22]="|c00959697"
set udg_ColorString[23]="|cFFFFDC00"
set udg_ColorString[24]="|cFFDCDCDC"
call SetPlayerName(Player(9),"TRIGSTR_858")call SetPlayerName(Player($A),"Армия Тьмы")
call SetPlayerName(Player($B),"Армия Тьмы")
call SetPlayerColorBJ(Player($F),PLAYER_COLOR_LIGHT_BLUE,false)call ForceAddPlayer(udg_Players_Enemy_Group,Player(9))call ForceAddPlayer(udg_Players_Enemy_Group,Player($A))call ForceAddPlayer(udg_Players_Enemy_Group,Player($B))call SetForceAllianceStateBJ(udg_Players_Enemy_Group,udg_Players_Enemy_Group,3)call SetForceAllianceStateBJ(udg_Players_Enemy_Group,bj_FORCE_PLAYER[$C],3)call SetForceAllianceStateBJ(bj_FORCE_PLAYER[$C],udg_Players_Enemy_Group,3)call SetForceAllianceStateBJ(udg_Players_Enemy_Group,bj_FORCE_PLAYER[$F],0)call SetForceAllianceStateBJ(bj_FORCE_PLAYER[$F],udg_Players_Enemy_Group,0)call ForForce(udg_Players_Enemy_Group,function Trig_Players_Start_Script_Func034A)endfunctionfunction InitTrig_Players_Start_Script takes nothing returns nothing
set gg_trg_Players_Start_Script=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Players_Start_Script,2.)
call TriggerAddAction(gg_trg_Players_Start_Script,function Trig_Players_Start_Script_Actions)endfunctionfunction Trig_InitMap_Func009A takes nothing returns nothing
call CreateFogModifierRectBJ(true,GetEnumPlayer(),FOG_OF_WAR_VISIBLE,gg_rct_PlayableAreaVisionDeBag)
call FogModifierStart(bj_lastCreatedFogModifier)
call DestroyFogModifier(bj_lastCreatedFogModifier)call CreateFogModifierRectBJ(true,GetEnumPlayer(),FOG_OF_WAR_MASKED,gg_rct_MinusVision1)
call FogModifierStart(bj_lastCreatedFogModifier)
call CameraSetupApplyForPlayer(true,gg_cam_Kamera_na_taverni,GetEnumPlayer(),0)call CinematicFadeBJ(1,.0,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)endfunctionfunction Trig_InitMap_Actions takes nothing returns nothingcall SetTimeOfDay(5.45)call SetMapFlag(MAP_RESOURCE_TRADING_ALLIES_ONLY,true)call ShowInterfaceForceOff(bj_FORCE_ALL_PLAYERS,.0)call StartTimerBJ(udg_InitMapTimer,false,10.)call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,12.,"|cff99ccffДобро пожаловать на альфа версию карты|r |Cfffed312Последние Стражи|r (|Cfffed312Last Guards|r)|cff99ccff!|r")call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,12.,"|cff99ccffЦель игры: выстоять против 10 разнообразнейших волн врагов, защищая стражей-заклинателей. По ходу прохождения вы также поучавствуете во множестве различных игровых событий, сражений, битв с боссами и многое другое...|r")call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,12.,"|cff99ccffА теперь - выберете своего героя, и отправляйтесь в бой!|r")call ForForce(bj_FORCE_ALL_PLAYERS,function Trig_InitMap_Func009A)endfunctionfunction InitTrig_InitMap takes nothing returns nothingset gg_trg_InitMap=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_InitMap,.0)call TriggerAddAction(gg_trg_InitMap,function Trig_InitMap_Actions)endfunctionfunction Trig_InitMapStage2_Func002A takes nothing returns nothingcall CameraSetupApplyForPlayer(true,gg_cam_Kamera_na_taverni,GetEnumPlayer(),0)call CinematicFadeBJ(0,5.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)endfunctionfunction Trig_InitMapStage2_Actions takes nothing returns nothingcall ShowInterfaceForceOn(bj_FORCE_ALL_PLAYERS,5.)call ForForce(bj_FORCE_ALL_PLAYERS,function Trig_InitMapStage2_Func002A)
endfunctionfunction InitTrig_InitMapStage2 takes nothing returns nothingset gg_trg_InitMapStage2=CreateTrigger()
call TriggerRegisterTimerExpireEvent(gg_trg_InitMapStage2,udg_InitMapTimer)call TriggerAddAction(gg_trg_InitMapStage2,function Trig_InitMapStage2_Actions)endfunctionfunction Trig_System_Spells_Load_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer i=LoadInteger(udg_hash,h,0)if LoadInteger(udg_hash,h,i)!=0 then
call AbilityPreload(LoadInteger(udg_hash,h,i),LoadInteger(udg_hash,h,i+1))set i=i+2call SaveInteger(udg_hash,h,0,i)
else
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullendfunctionfunction Trig_System_Spells_Load_Actions takes nothing returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer i=1call SaveInteger(udg_hash,h,0,i)
call SaveInteger(udg_hash,h,1,'A07F')call SaveInteger(udg_hash,h,2,$A)call SaveInteger(udg_hash,h,3,'A07G')call SaveInteger(udg_hash,h,4,$A)call SaveInteger(udg_hash,h,5,'A07I')call SaveInteger(udg_hash,h,6,$A)call SaveInteger(udg_hash,h,7,'A09D')call SaveInteger(udg_hash,h,8,$A)call SaveInteger(udg_hash,h,9,'A0E6')call SaveInteger(udg_hash,h,$A,$A)call SaveInteger(udg_hash,h,$B,'A0E7')call SaveInteger(udg_hash,h,$C,$A)call SaveInteger(udg_hash,h,$D,'A0B3')call SaveInteger(udg_hash,h,$E,$A)call SaveInteger(udg_hash,h,$F,'A0B4')call SaveInteger(udg_hash,h,16,$A)call SaveInteger(udg_hash,h,17,'A0B5')call SaveInteger(udg_hash,h,18,$A)call SaveInteger(udg_hash,h,19,'A0E9')call SaveInteger(udg_hash,h,20,$A)call SaveInteger(udg_hash,h,21,'A0EA')call SaveInteger(udg_hash,h,22,$A)call SaveInteger(udg_hash,h,23,'A0EB')call SaveInteger(udg_hash,h,24,$A)call SaveInteger(udg_hash,h,25,'A0AG')call SaveInteger(udg_hash,h,26,$A)call SaveInteger(udg_hash,h,27,'A0AH')call SaveInteger(udg_hash,h,28,$A)call SaveInteger(udg_hash,h,29,'A087')call SaveInteger(udg_hash,h,30,$A)call SaveInteger(udg_hash,h,31,'A0AS')call SaveInteger(udg_hash,h,32,$A)call SaveInteger(udg_hash,h,33,'A0AT')call SaveInteger(udg_hash,h,34,$A)call SaveInteger(udg_hash,h,35,'A0D8')call SaveInteger(udg_hash,h,36,$A)call SaveInteger(udg_hash,h,37,'A07A')call SaveInteger(udg_hash,h,38,7)call SaveInteger(udg_hash,h,39,'A07E')call SaveInteger(udg_hash,h,40,7)call SaveInteger(udg_hash,h,41,'A0H6')call SaveInteger(udg_hash,h,42,$A)call SaveInteger(udg_hash,h,43,'A0H5')call SaveInteger(udg_hash,h,44,$A)call SaveInteger(udg_hash,h,45,'A0H4')call SaveInteger(udg_hash,h,46,$A)call TimerStart(t,.2,true,function Trig_System_Spells_Load_Periodic_Actions)
endfunctionfunction InitTrig_System_Spells_Load takes nothing returns nothingset gg_trg_System_Spells_Load=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_System_Spells_Load,2.,false)call TriggerAddAction(gg_trg_System_Spells_Load,function Trig_System_Spells_Load_Actions)endfunctionfunction Trig_Items_Preload_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer i=LoadInteger(udg_hash,h,0)if LoadInteger(udg_hash,h,i)!=0 then
call ItemPreload(LoadInteger(udg_hash,h,i))set i=i+1call SaveInteger(udg_hash,h,0,i)
else
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullendfunctionfunction Trig_Items_Preload_Actions takes nothing returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer i=1call SaveInteger(udg_hash,h,0,i)
call SaveInteger(udg_hash,h,1,'I00I')call SaveInteger(udg_hash,h,2,'I01G')call SaveInteger(udg_hash,h,3,'I03W')call SaveInteger(udg_hash,h,4,'I036')call SaveInteger(udg_hash,h,5,'I05A')call SaveInteger(udg_hash,h,6,'I04Z')call SaveInteger(udg_hash,h,7,'I01U')call SaveInteger(udg_hash,h,8,'I03U')call SaveInteger(udg_hash,h,9,'I02J')call SaveInteger(udg_hash,h,$A,'I01B')call SaveInteger(udg_hash,h,$B,'I01X')call SaveInteger(udg_hash,h,$C,'I052')call SaveInteger(udg_hash,h,$D,'I053')call SaveInteger(udg_hash,h,$E,'I051')call SaveInteger(udg_hash,h,$F,'I03Q')call SaveInteger(udg_hash,h,16,'I048')call SaveInteger(udg_hash,h,17,'I01P')call SaveInteger(udg_hash,h,18,'I00G')call SaveInteger(udg_hash,h,19,'I01Q')call SaveInteger(udg_hash,h,20,'I01V')call SaveInteger(udg_hash,h,21,'I02N')call SaveInteger(udg_hash,h,22,'I03N')call SaveInteger(udg_hash,h,23,'I042')call SaveInteger(udg_hash,h,24,'I03S')call SaveInteger(udg_hash,h,25,'I02U')call SaveInteger(udg_hash,h,26,'I00C')call SaveInteger(udg_hash,h,27,'I00A')call SaveInteger(udg_hash,h,28,'I04V')call SaveInteger(udg_hash,h,29,'I044')call SaveInteger(udg_hash,h,30,'I00J')call SaveInteger(udg_hash,h,31,'I03G')call SaveInteger(udg_hash,h,32,'I04L')call SaveInteger(udg_hash,h,33,'I02I')call SaveInteger(udg_hash,h,34,'I02T')call SaveInteger(udg_hash,h,35,'I04U')call SaveInteger(udg_hash,h,36,'I03K')call SaveInteger(udg_hash,h,37,'I03L')call SaveInteger(udg_hash,h,38,'I03M')call SaveInteger(udg_hash,h,39,'I04X')call SaveInteger(udg_hash,h,40,'I055')call SaveInteger(udg_hash,h,41,'I056')call SaveInteger(udg_hash,h,42,'I057')call SaveInteger(udg_hash,h,43,'I058')call SaveInteger(udg_hash,h,44,'I02E')call SaveInteger(udg_hash,h,45,'I02F')call SaveInteger(udg_hash,h,46,'I01S')call SaveInteger(udg_hash,h,47,'I03Y')call SaveInteger(udg_hash,h,48,'I02G')call SaveInteger(udg_hash,h,49,'I00S')call SaveInteger(udg_hash,h,50,'I00T')call SaveInteger(udg_hash,h,51,'I00V')call SaveInteger(udg_hash,h,52,'I00X')call SaveInteger(udg_hash,h,53,'I012')call SaveInteger(udg_hash,h,54,'I01W')call TimerStart(t,.05,true,function Trig_Items_Preload_Periodic_Actions)
endfunctionfunction InitTrig_Items_Preload takes nothing returns nothingset gg_trg_Items_Preload=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Items_Preload,17.,false)call TriggerAddAction(gg_trg_Items_Preload,function Trig_Items_Preload_Actions)endfunctionfunction Trig_Igrok_Massiv_Save_Func005Func001C takes nothing returns booleanreturn(GetPlayerSlotState(Player(-1+(bj_forLoopAIndex)))==PLAYER_SLOT_STATE_PLAYING)and(GetPlayerController(Player(-1+(bj_forLoopAIndex)))!=MAP_CONTROL_COMPUTER)endfunctionfunction Trig_Igrok_Massiv_Save_Func006002 takes nothing returns nothing
call SetPlayerStateBJ(GetEnumPlayer(),PLAYER_STATE_RESOURCE_FOOD_CAP,1)endfunctionfunction Trig_Igrok_Massiv_Save_Func007C takes nothing returns booleanreturn(CountPlayersInForceBJ(udg_IGRAET)<=0)
endfunctionfunction Trig_Igrok_Massiv_Save_Actions takes nothing returns nothingcall RemoveAllGuardPositions(Player(9))call RemoveAllGuardPositions(Player($A))
call RemoveAllGuardPositions(Player($B))
set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=9loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndif(Trig_Igrok_Massiv_Save_Func005Func001C())then
set udg_Igraet_Igrok[bj_forLoopAIndex]=truecall ForceAddPlayer(udg_IGRAET,Player(-1+(bj_forLoopAIndex)))else
set udg_Igraet_Igrok[bj_forLoopAIndex]=false
endifset bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall ForForce(udg_IGRAET,function Trig_Igrok_Massiv_Save_Func006002)
if(Trig_Igrok_Massiv_Save_Func007C())thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"Игра одному пока что запрещена!!!")
call CustomVictoryBJ(ForcePickRandomPlayer(udg_IGRAET),true,false)endifendfunctionfunction InitTrig_Igrok_Massiv_Save takes nothing returns nothingset gg_trg_Igrok_Massiv_Save=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Igrok_Massiv_Save,.0)call TriggerAddAction(gg_trg_Igrok_Massiv_Save,function Trig_Igrok_Massiv_Save_Actions)endfunctionfunction Trig_Load_Vsiakoe_Func004Func001Func003C takes nothing returns booleanreturn(GetUnitTypeId(GetEnumUnit())=='e002')or(GetUnitTypeId(GetEnumUnit())=='h01K')or(GetUnitTypeId(GetEnumUnit())=='n00Y')or(GetUnitTypeId(GetEnumUnit())=='o003')
endfunctionfunction Trig_Load_Vsiakoe_Func004Func001C takes nothing returns boolean
return(Trig_Load_Vsiakoe_Func004Func001Func003C())endfunctionfunction Trig_Load_Vsiakoe_Func004A takes nothing returns nothingif(Trig_Load_Vsiakoe_Func004Func001C())thencall UnitAddType(GetEnumUnit(),UNIT_TYPE_PEON)call GroupAddUnit(udg_PortalCastersMagi,GetEnumUnit())endifendfunctionfunction Trig_Load_Vsiakoe_Func007A takes nothing returns nothingcall SetPlayerStateBJ(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD,500)call SetPlayerStateBJ(GetEnumPlayer(),PLAYER_STATE_RESOURCE_LUMBER,8)call SetPlayerAbilityAvailableBJ(false,'A04F',GetEnumPlayer())call SetPlayerAbilityAvailableBJ(false,'A0EF',GetEnumPlayer())endfunctionfunction Trig_Load_Vsiakoe_Actions takes nothing returns nothing
call CreateNUnitsAtLoc(1,'h00U',Player($F),GetRectCenter(bj_mapInitialPlayableArea),bj_UNIT_FACING)set udg_preloader=bj_lastCreatedUnit
call ForGroupBJ(GetUnitsInRectAll(gg_rct_cast_magi),function Trig_Load_Vsiakoe_Func004A)
call CreateQuestBJ(0,"Авторы","Создатели Карты (|Cfffed312Последние Стражи|r/|Cfffed312Last Guards|r)|n|cff99ccfflluo_OHEP (Derarius/Sladkoegka)|nCosonic5|r","CommandButton\\Map_Autor's.blp")
call CreateQuestBJ(2,"Игровые Команды","TRIGSTR_5336","CommandButton\\Game_Commands.blp")call ForForce(bj_FORCE_ALL_PLAYERS,function Trig_Load_Vsiakoe_Func007A)endfunctionfunction InitTrig_Load_Vsiakoe takes nothing returns nothing
set gg_trg_Load_Vsiakoe=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Load_Vsiakoe,2.)
call TriggerAddAction(gg_trg_Load_Vsiakoe,function Trig_Load_Vsiakoe_Actions)endfunctionfunction Trig_Igrok_Massiv_Liver_Func004Func001C takes nothing returns booleanreturn(IsUnitType(GetEnumUnit(),UNIT_TYPE_HERO))!=nullendfunctionfunction Trig_Igrok_Massiv_Liver_Func004A takes nothing returns nothingif(Trig_Igrok_Massiv_Liver_Func004Func001C())thenset bj_forLoopAIndex=1set bj_forLoopAIndexEnd=6loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall RemoveItem(UnitItemInSlotBJ(GetEnumUnit(),bj_forLoopAIndex))set bj_forLoopAIndex=bj_forLoopAIndex+1endloopendifcall KillUnit(GetEnumUnit())
call RemoveUnit(GetEnumUnit())endfunctionfunction Trig_Igrok_Massiv_Liver_Func012Func001C takes nothing returns booleanreturn(udg_Is_Player_Fast_Wave_Start[(1+GetPlayerId(GetTriggerPlayer()))])endfunctionfunction Trig_Igrok_Massiv_Liver_Func012Func002C takes nothing returns booleanreturn(udg_Count_Players_Fast_Wave_Start>=CountPlayersInForceBJ(udg_IGRAET))
endfunctionfunction Trig_Igrok_Massiv_Liver_Func012C takes nothing returns booleanreturn(udg_Is_Fast_Wave_Start_On_Off)endfunctionfunction Trig_Igrok_Massiv_Liver_Func013Func001C takes nothing returns booleanreturn(GetRandomInt(1,2)==1)
endfunctionfunction Trig_Igrok_Massiv_Liver_Func013Func002C takes nothing returns booleanreturn(GetRandomInt(1,2)==1)
endfunctionfunction Trig_Igrok_Massiv_Liver_Func013C takes nothing returns booleanreturn(GetRandomInt(1,2)==1)
endfunctionfunction Trig_Igrok_Massiv_Liver_Actions takes nothing returns nothingset udg_Igraet_Igrok[(1+GetPlayerId(GetTriggerPlayer()))]=falsecall ForceRemovePlayer(udg_IGRAET,GetTriggerPlayer())call ForGroupBJ(GetUnitsOfPlayerAll(GetTriggerPlayer()),function Trig_Igrok_Massiv_Liver_Func004A)set udg_herounit[(1+GetPlayerId(GetTriggerPlayer()))]=nullcall DestroyEffect(udg_Rune_On_Base_Effect[(CountPlayersInForceBJ(udg_IGRAET)+1)])call RemoveUnit(udg_Rune_On_Base_Dummy[(CountPlayersInForceBJ(udg_IGRAET)+1)])set udg_Rune_On_Base_Dummy[(CountPlayersInForceBJ(udg_IGRAET)+1)]=nullset udg_ColorString[(1+GetPlayerId(GetTriggerPlayer()))]="|cFF969696"call MultiboardSetItemValueBJ(udg_MultiBoard,2,udg_PlayerNumberInMB[(1+GetPlayerId(GetTriggerPlayer()))],("|cFF969696"+(GetPlayerName(GetTriggerPlayer())+"|r")))if(Trig_Igrok_Massiv_Liver_Func012C())thenif(Trig_Igrok_Massiv_Liver_Func012Func001C())thenset udg_Count_Players_Fast_Wave_Start=(udg_Count_Players_Fast_Wave_Start-1)set udg_Is_Player_Fast_Wave_Start[(1+GetPlayerId(GetTriggerPlayer()))]=false
endifif(Trig_Igrok_Massiv_Liver_Func012Func002C())thencall StartTimerBJ(udg_Timer_Nomera_Volni,false,1.)endifendifif(Trig_Igrok_Massiv_Liver_Func013C())thenif(Trig_Igrok_Massiv_Liver_Func013Func002C())thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,(udg_ColorString[(1+GetPlayerId(GetTriggerPlayer()))]+(GetPlayerName(GetTriggerPlayer())+"|r по непонятным причинам решил ливнуть!")))else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,(udg_ColorString[(1+GetPlayerId(GetTriggerPlayer()))]+(GetPlayerName(GetTriggerPlayer())+"|r вышел из игры! Ну почему всегда найдется тот, кто запорет всю игру?!")))endifelse
if(Trig_Igrok_Massiv_Liver_Func013Func001C())thencall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,(udg_ColorString[(1+GetPlayerId(GetTriggerPlayer()))]+(GetPlayerName(GetTriggerPlayer())+"|r сбежал с поля боя...Чтож‚ придется подолжать без него!")))
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,(udg_ColorString[(1+GetPlayerId(GetTriggerPlayer()))]+(GetPlayerName(GetTriggerPlayer())+"|r специально (а может случайно?) покинул игру!")))endifendifendfunctionfunction InitTrig_Igrok_Massiv_Liver takes nothing returns nothingset gg_trg_Igrok_Massiv_Liver=CreateTrigger()call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(0))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(1))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(2))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(3))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(4))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(5))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(6))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(7))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(8))call TriggerAddAction(gg_trg_Igrok_Massiv_Liver,function Trig_Igrok_Massiv_Liver_Actions)endfunctionfunction Trig_Messager_Actions takes nothing returns nothing
call ConditionalTriggerExecute(gg_trg_Start_game)call CreateNUnitsAtLoc(1,'h009',Player($B),GetRectCenter(gg_rct_Portal_Attack_Dummy_Left),bj_UNIT_FACING)set udg_Dammy_Portal[1]=bj_lastCreatedUnitcall SetUnitFlyHeight(udg_Dammy_Portal[1],150.,1200.)call CreateNUnitsAtLoc(1,'h009',Player($B),GetRectCenter(gg_rct_Portal_Attack_Dummy_Right),bj_UNIT_FACING)set udg_Dammy_Portal[2]=bj_lastCreatedUnitcall SetUnitFlyHeight(udg_Dammy_Portal[2],150.,1200.)call CreateNUnitsAtLoc(1,'h009',Player($B),GetRectCenter(gg_rct_Portal_Attack_Dummy_Top),bj_UNIT_FACING)
set udg_Dammy_Portal[3]=bj_lastCreatedUnitcall SetUnitFlyHeight(udg_Dammy_Portal[3],150.,1200.)set udg_Rune_On_Base_Dummy_X[1]=1220.set udg_Rune_On_Base_Dummy_Y[1]=-4740.set udg_Rune_On_Base_Effect_String[1]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes0.mdl"set udg_Rune_On_Base_Dummy_X[2]=1745.set udg_Rune_On_Base_Dummy_Y[2]=-6380.set udg_Rune_On_Base_Effect_String[2]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes1.mdl"set udg_Rune_On_Base_Dummy_X[3]=1100.set udg_Rune_On_Base_Dummy_Y[3]=-5000.set udg_Rune_On_Base_Effect_String[3]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes2.mdl"set udg_Rune_On_Base_Dummy_X[4]=1735.set udg_Rune_On_Base_Dummy_Y[4]=-6160.set udg_Rune_On_Base_Effect_String[4]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes3.mdl"set udg_Rune_On_Base_Dummy_X[5]=1400.set udg_Rune_On_Base_Dummy_Y[5]=-4990.set udg_Rune_On_Base_Effect_String[5]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes4.mdl"set udg_Rune_On_Base_Dummy_X[6]=1600.set udg_Rune_On_Base_Dummy_Y[6]=-6310.set udg_Rune_On_Base_Effect_String[6]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes5.mdl"set udg_Rune_On_Base_Dummy_X[7]=800.
set udg_Rune_On_Base_Dummy_Y[7]=-6420.set udg_Rune_On_Base_Effect_String[7]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes6.mdl"set udg_Rune_On_Base_Dummy_X[8]=800.
set udg_Rune_On_Base_Dummy_Y[8]=-6200.set udg_Rune_On_Base_Effect_String[8]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes7.mdl"set udg_Rune_On_Base_Dummy_X[9]=1000.set udg_Rune_On_Base_Dummy_Y[9]=-6400.set udg_Rune_On_Base_Effect_String[9]="Doodads\\Cinematic\\GlowingRunes\\GlowingRunes8.mdl"set udg_Rune_Position_X[1]=$58Cset udg_Rune_Position_Y[1]=-$AF0
set udg_Rune_Position_X[2]=$BE5set udg_Rune_Position_Y[2]=-7523
set udg_Rune_Position_X[3]=-390set udg_Rune_Position_Y[3]=-8275
set udg_Arrow_Pointer_Guide_X[1]=$4CEset udg_Arrow_Pointer_Guide_Y[1]=-5065set udg_Arrow_Pointer_Guide_Angle[1]=$B4
set udg_Arrow_Pointer_Guide_X[2]=$62Cset udg_Arrow_Pointer_Guide_Y[2]=-6220set udg_Arrow_Pointer_Guide_Angle[2]=45set udg_Arrow_Pointer_Guide_X[3]=$53Aset udg_Arrow_Pointer_Guide_Y[3]=-5220set udg_Arrow_Pointer_Guide_Angle[3]=$B4
set udg_Arrow_Pointer_Guide_X[4]=$65Cset udg_Arrow_Pointer_Guide_Y[4]=-6130set udg_Arrow_Pointer_Guide_Angle[4]=45set udg_Arrow_Pointer_Guide_X[5]=$461set udg_Arrow_Pointer_Guide_Y[5]=-5223set udg_Arrow_Pointer_Guide_Angle[5]=$B4
set udg_Arrow_Pointer_Guide_X[6]=$591set udg_Arrow_Pointer_Guide_Y[6]=-6215set udg_Arrow_Pointer_Guide_Angle[6]=45set udg_Arrow_Pointer_Guide_X[7]=822
set udg_Arrow_Pointer_Guide_Y[7]=-6227set udg_Arrow_Pointer_Guide_Angle[7]=315
set udg_Arrow_Pointer_Guide_X[8]=$40Cset udg_Arrow_Pointer_Guide_Y[8]=-6216set udg_Arrow_Pointer_Guide_Angle[8]=315
set udg_Arrow_Pointer_Guide_X[9]=790
set udg_Arrow_Pointer_Guide_Y[9]=-6050set udg_Arrow_Pointer_Guide_Angle[9]=315
set udg_Arrow_Pointer_Guide_Count=CountPlayersInForceBJ(udg_IGRAET)set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=CountPlayersInForceBJ(udg_IGRAET)loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall CreateNUnitsAtLoc(1,'h00U',Player($F),Location(I2R(udg_Arrow_Pointer_Guide_X[bj_forLoopAIndex]),I2R(udg_Arrow_Pointer_Guide_Y[bj_forLoopAIndex])),I2R(udg_Arrow_Pointer_Guide_Angle[bj_forLoopAIndex]))
set udg_Arrow_Pointer_Guide_Unit[bj_forLoopAIndex]=bj_lastCreatedUnitcall AddSpecialEffectTargetUnitBJ("origin",bj_lastCreatedUnit,"Effects\\Arrow - Chapter Browse - Rotated.mdx")set udg_Arrow_Pointer_Guide_Effect[bj_forLoopAIndex]=bj_lastCreatedEffectset bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall AddSpecialEffectLocBJ(Location(I2R(udg_Rune_Position_X[1]),I2R(udg_Rune_Position_Y[1])),"Effects\\MistAura.mdx")call AddSpecialEffectLocBJ(Location(I2R(udg_Rune_Position_X[2]),I2R(udg_Rune_Position_Y[2])),"Effects\\MistAura.mdx")call AddSpecialEffectLocBJ(Location(I2R(udg_Rune_Position_X[3]),I2R(udg_Rune_Position_Y[3])),"Effects\\MistAura.mdx")call AddSpecialEffectLocBJ(Location(I2R(udg_Rune_Position_X[1]),I2R(udg_Rune_Position_Y[1])),"Effects\\GreenRing.mdx")set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=CountPlayersInForceBJ(udg_IGRAET)loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall CreateNUnitsAtLoc(1,'h00E',Player($F),Location(udg_Rune_On_Base_Dummy_X[bj_forLoopAIndex],udg_Rune_On_Base_Dummy_Y[bj_forLoopAIndex]),bj_UNIT_FACING)call AddSpecialEffectTargetUnitBJ("origin",bj_lastCreatedUnit,udg_Rune_On_Base_Effect_String[bj_forLoopAIndex])call SetUnitFlyHeight(bj_lastCreatedUnit,-50.,.0)set udg_Rune_On_Base_Effect[bj_forLoopAIndex]=bj_lastCreatedEffectset udg_Rune_On_Base_Dummy[bj_forLoopAIndex]=bj_lastCreatedUnitset bj_forLoopAIndex=bj_forLoopAIndex+1endloopendfunctionfunction InitTrig_Messager takes nothing returns nothing
set gg_trg_Messager=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Messager,8.)
call TriggerAddAction(gg_trg_Messager,function Trig_Messager_Actions)endfunctionfunction Trig_Create_TExttags_about_Shops_Actions takes nothing returns nothingcall CreateTexttag("|cFF00C850Барахолка|r",.03,$FF,2050.,-5100.,.0,.0,.0,9999999.)call CreateTexttag("|cFF00C850Экипировка|r",.03,$FF,2050.,-5250.,.0,.0,.0,99999999.)call CreateTexttag("|cFFFF8C00Броня и Доспехи|r",.03,$FF,2050.,-5400.,.0,.0,.0,99999999.)call CreateTexttag("|cFF9600FFВооружение|r",.03,$FF,2050.,-5660.,.0,.0,.0,99999999.)call CreateTexttag("|cFF6464FAТайник Странника|r",.03,$FF,2050.,-5900.,.0,.0,.0,9999999.)
call CreateTexttag("|cFF6464FAМагические Артефакты|r",.03,$FF,2050.,-6130.,.0,.0,.0,999999.)endfunctionfunction InitTrig_Create_TExttags_about_Shops takes nothing returns nothingset gg_trg_Create_TExttags_about_Shops=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Create_TExttags_about_Shops,9.)call TriggerAddAction(gg_trg_Create_TExttags_about_Shops,function Trig_Create_TExttags_about_Shops_Actions)endfunctionfunction Trig_InitHashtable_Actions takes nothing returns nothingset udg_hash=InitHashtable()
endfunctionfunction InitTrig_InitHashtable takes nothing returns nothingset gg_trg_InitHashtable=CreateTrigger()
call TriggerAddAction(gg_trg_InitHashtable,function Trig_InitHashtable_Actions)endfunctionfunction Trig_Save_Sounds_Actions takes nothing returns nothingset udg_Game_Sound[1]=CreateSoundFromLabel("Hint",false,false,false,$A,$A)set udg_Game_Sound[2]=CreateSoundFromLabel("GoodJob",false,false,false,$A,$A)set udg_Game_Sound[3]=CreateSoundFromLabel("Warning",false,false,false,$A,$A)set udg_Game_Sound[4]=CreateSoundFromLabel("ClanInvitation",false,false,false,$A,$A)
set udg_Game_Sound[5]=CreateSoundFromLabel("NewTournament",false,false,false,$A,$A)set udg_Game_Sound[6]=CreateSoundFromLabel("ArrangedTeamInvitation",false,false,false,$A,$A)
set udg_Game_Sound[7]=CreateSoundFromLabel("GameFound",false,false,false,$A,$A)set udg_Game_Sound[8]=gg_snd_HeroStep1set udg_Game_Sound[$B]=gg_snd_HeroStep2set udg_Game_Sound[$A]=gg_snd_HeroStep3set udg_Game_Sound[$B]=gg_snd_HeroStep4set udg_Game_Sound[$C]=gg_snd_KnightInventoryFull1set udg_Game_Sound[$D]=gg_snd_KnightNoGold1set udg_Game_Sound[$E]=CreateSoundFromLabel("ShimmeringPortalBirth",false,false,false,$A,$A)
set udg_Game_Sound[$F]=CreateSoundFromLabel("ShimmeringPortalDeath",false,false,false,$A,$A)
set udg_Game_Sound[16]=CreateSoundFromLabel("ShimmeringPortalEntrance",false,false,false,$A,$A)set udg_Game_Sound[18]=CreateSoundFromLabel("Tranquility",false,false,false,$A,$A)set udg_Game_Sound[19]=CreateSoundFromLabel("AlchemistChemicalBurst1",false,false,false,$A,$A)set udg_Game_Sound[20]=CreateSoundFromLabel("AlchemistMorph1",false,false,false,$A,$A)endfunctionfunction InitTrig_Save_Sounds takes nothing returns nothingset gg_trg_Save_Sounds=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Save_Sounds,5.,false)call TriggerAddAction(gg_trg_Save_Sounds,function Trig_Save_Sounds_Actions)endfunctionfunction HandleCounter_Update takes nothing returns nothinglocal integer i=0local integer id
local location array Plocal real result=0loop
exitwhen i>=50set i=i+1set P[i]=Location(0,0)set id=GetHandleId(P[i])
set result=result+(id-$100000)endloopset result=result/ i-i/ 2loop
call RemoveLocation(P[i])set P[i]=nullexitwhen i<=1set i=i-1endloopcall LeaderboardSetItemValue(udg_HandleBoard,0,R2I(result))endfunctionfunction HandleCounter_Actions takes nothing returns nothing
set udg_HandleBoard=CreateLeaderboard()call LeaderboardSetLabel(udg_HandleBoard,"Handle Counter")call PlayerSetLeaderboard(GetLocalPlayer(),udg_HandleBoard)call LeaderboardDisplay(udg_HandleBoard,false)if GetPlayerName(GetLocalPlayer())=="Derarius" or GetPlayerName(GetLocalPlayer())=="WorldEdit" thencall LeaderboardDisplay(udg_HandleBoard,true)endifcall LeaderboardAddItem(udg_HandleBoard,"Handles",0,Player(0))call LeaderboardSetSizeByItemCount(udg_HandleBoard,1)call HandleCounter_Update()call TimerStart(GetExpiredTimer(),.05,true,function HandleCounter_Update)endfunctionfunction InitTrig_HandleCounter takes nothing returns nothingcall TimerStart(CreateTimer(),0,false,function HandleCounter_Actions)endfunctionfunction Trig_Set_Chlenix_Actions takes nothing returns nothingset udg_Integer_Creep_On_Line_Spawn[1]=S2I(SubStringBJ(GetEventPlayerChatString(),$A,$A))set udg_Integer_Creep_On_Line_Spawn[2]=S2I(SubStringBJ(GetEventPlayerChatString(),$B,$B))set udg_Integer_Creep_On_Line_Spawn[3]=S2I(SubStringBJ(GetEventPlayerChatString(),$C,$C))call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cFFFF0000CHLENIX|r АКТИВИРОВАН")
endfunctionfunction InitTrig_Set_Chlenix takes nothing returns nothingset gg_trg_Set_Chlenix=CreateTrigger()call TriggerRegisterPlayerChatEvent(gg_trg_Set_Chlenix,Player(0),"-chlenix",false)call TriggerAddAction(gg_trg_Set_Chlenix,function Trig_Set_Chlenix_Actions)endfunctionfunction Trig_Set_Energy_Walls_Func003A takes nothing returns nothingset udg_EnergyWallX[udg_Temp_Integer[1]]=R2I(GetUnitX(GetEnumUnit()))set udg_EnergyWallY[udg_Temp_Integer[1]]=R2I(GetUnitY(GetEnumUnit()))set udg_EnergyWallAngle[udg_Temp_Integer[1]]=R2I(GetUnitFacing(GetEnumUnit()))call RemoveUnit(GetEnumUnit())set udg_Temp_Integer[1]=(udg_Temp_Integer[1]+1)endfunctionfunction Trig_Set_Energy_Walls_Actions takes nothing returns nothing
set udg_Temp_Integer[1]=1set udg_EnergyWallCount[1]=$Bcall ForGroupBJ(GetUnitsOfPlayerAndTypeId(Player($F),'h00I'),function Trig_Set_Energy_Walls_Func003A)endfunctionfunction InitTrig_Set_Energy_Walls takes nothing returns nothing
set gg_trg_Set_Energy_Walls=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Set_Energy_Walls,5.)
call TriggerAddAction(gg_trg_Set_Energy_Walls,function Trig_Set_Energy_Walls_Actions)endfunctionfunction Trig_EitiArenaRemovesAllItems_Actions takes nothing returns nothing
call RemoveItem(GetEnumItem())endfunctionfunction Trig_TimerEitiAreniTheEnd3_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local timerdialog td=LoadTimerDialogHandle(udg_hash,GetHandleId(gg_rct_Event_Bonus_Etei_arena_1),$B)
local group gruppa=CreateGroup()
local unit Pickedlocal real xc=GetRectCenterX(gg_rct_Respawn_Heroes)local real yc=GetRectCenterY(gg_rct_Respawn_Heroes)local real perekluchatel=.0call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall DestroyFogModifier(LoadFogModifierHandle(udg_hash,GetHandleId(Picked),$AB))
if perekluchatel>=0 then
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel-50.else
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel+50.endifset xc=GetRectCenterX(gg_rct_Respawn_Heroes)+perekluchatelset yc=GetRectCenterY(gg_rct_Respawn_Heroes)
call SetUnitPosition(Picked,xc,yc)call SetUnitFacing(Picked,270.)call SetUnitState(Picked,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(Picked,UNIT_STATE_MANA,$540BE3FF)call ShowUnit(Picked,true)call PauseUnit(Picked,false)
if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ResetToGameCamera(.0)call PanCameraToTimed(xc,yc,.0)call ClearSelection()call SelectUnit(Picked,true)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall EnumItemsInRect(gg_rct_Event_Bonus_Etei_arena_1,null,function Trig_EitiArenaRemovesAllItems_Actions)call StartTimerBJ(udg_Timer_Nomera_Volni,false,75.)call CreateTimerDialogBJ(udg_Timer_Nomera_Volni,("Волна № |cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+"|r")))
set udg_TimerDialog_Nomera_Volni=bj_lastCreatedTimerDialogcall TimerDialogSetTimeColorBJ(udg_TimerDialog_Nomera_Volni,'d',90.,30.,20.)
set udg_Is_Fast_Wave_Start_On_Off=trueset udg_Is_Eiti_Arena_Already_Go=falsecall KillUnit(LoadUnitHandle(udg_hash,GetHandleId(gg_rct_Event_Bonus_Etei_arena_1),$C))call KillUnit(LoadUnitHandle(udg_hash,GetHandleId(gg_rct_Event_Bonus_Etei_arena_1),$D))call EnableTrigger(gg_trg_Hero_Dead)
call DestroyTimerDialog(td)call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset td=nullset gruppa=nullset Picked=nullendfunctionfunction Trig_TimerEitiAreniTheEnd2_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local timer t2=CreateTimer()
local integer h2=GetHandleId(t2)
call TimerStart(t2,1.25,false,function Trig_TimerEitiAreniTheEnd3_Actions)set t=nullset t2=nullendfunctionfunction Trig_TimerEitiAreniTheEnd_ForForce takes nothing returns nothingset bj_forLoopAIndex=1loop
exitwhen bj_forLoopAIndex>9call SetPlayerAllianceStateBJ(GetEnumPlayer(),Player(bj_forLoopAIndex-1),3)set bj_forLoopAIndex=bj_forLoopAIndex+1endloopendfunctionfunction Trig_TimerEitiAreniTheEnd_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit Pickedlocal group gruppa=CreateGroup()
local real angle=0local real x=GetRectCenterX(gg_rct_Event_Bonus_Etei_arena_1)
local real y=GetRectCenterY(gg_rct_Event_Bonus_Etei_arena_1)
local real xc=GetRectCenterX(gg_rct_Respawn_Heroes)local real yc=GetRectCenterY(gg_rct_Respawn_Heroes)local real xulocal real yulocal integer play=0
local integer hhero=0local texttag txt=CreateTextTag()local real vel=.0221875local real angletxt=45.+GetRandomReal(.0,90.)local real xvel=vel*Cos(angle*bj_DEGTORAD)local real yvel=vel*Sin(angle*bj_DEGTORAD)local timer t2=CreateTimer()
local integer h2=GetHandleId(t2)
local real timeRemaining=0local real anglestep=(360./ CountPlayersInForceBJ(udg_IGRAET))call ForForce(udg_IGRAET,function Trig_TimerEitiAreniTheEnd_ForForce)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call TimerStart(t2,4.,false,function Trig_TimerEitiAreniTheEnd2_Actions)
loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullset angle=angle+anglestepcall SetUnitPosition(Picked,(x+400*Cos(angle*bj_DEGTORAD)),(y+400*Sin(angle*bj_DEGTORAD)))call ReviveHero(Picked,(x+400*Cos(angle*bj_DEGTORAD)),(y+400*Sin(angle*bj_DEGTORAD)),true)call SetUnitFacing(Picked,bj_RADTODEG*Atan2(y-GetUnitY(Picked),x-GetUnitX(Picked)))call SetUnitState(Picked,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(Picked,UNIT_STATE_MANA,$540BE3FF)if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall PanCameraToTimed(x,y,.0)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall GroupEnumUnitsInRect(gruppa,gg_rct_Event_Bonus_Etei_arena_1,null)call KillSummonsAndIllusions(gruppa)
set gruppa=CreateGroup()
call GroupEnumUnitsInRect(gruppa,gg_rct_Event_Bonus_Etei_arena_1,null)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif GetUnitTypeId(Picked)!='h00C' and GetUnitTypeId(Picked)!='h00B' thencall PauseUnit(Picked,true)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullset hhero=GetHandleId(Picked)set play=LoadInteger(udg_hash,hhero,1)if play==2 or play==1 or play==0 thenset xu=GetUnitX(Picked)set yu=GetUnitY(Picked)call SetTextTagText(txt,"|cFFFFFF00+650|r",.045)
call SetTextTagPos(txt,xu,yu,.0)
call SetTextTagColor(txt,0,0,0,50)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,4.)call SetTextTagFadepoint(txt,.0)
set txt=CreateTextTag()call SetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD)+650)if GetLocalPlayer()==GetOwningPlayer(Picked)then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Вы получили "+udg_ColorString[23]+I2S(650)+" золота|r!!!")endifendifcall GroupRemoveUnit(gruppa,Picked)endloopset t=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset txt=null
set t2=nullset Picked=nullset gruppa=nullset txt=null
set t2=nullendfunctionfunction Trig_Nachalo_Eiti_aren_Actions_Periodic takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer timeout=LoadInteger(udg_hash,h,3)local integer lvl=LoadInteger(udg_hash,h,4)local integer I=LoadInteger(udg_hash,h,5)local rect rct=gg_rct_Event_Bonus_Etei_arena_1local real minx=GetRectMinX(rct)
local real maxx=GetRectMaxX(rct)
local real miny=GetRectMinY(rct)
local real maxy=GetRectMaxY(rct)
local real x=GetRandomReal(minx,maxx)local real y=GetRandomReal(miny,maxy)local player p=Player($C)local integer random=R2I($F+5*CountPlayersInForceBJ(udg_IGRAET))
local integer randomgold=GetRandomInt(1,R2I(30-3*CountPlayersInForceBJ(udg_IGRAET)))
local integer o=GetHandleId(udg_Gruppa_HeroUnitov_Geroev)local integer ff=0local timer t2=LoadTimerHandle(udg_hash,h,8)
local group gruppa=CreateGroup()
local unit Pickedlocal real xtlocal real ytcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullset xt=GetUnitX(Picked)set yt=GetUnitY(Picked)if not((GetRectMinX(gg_rct_Event_Bonus_Etei_arena_1)<=xt)and(xt<=GetRectMaxX(gg_rct_Event_Bonus_Etei_arena_1))and(GetRectMinY(gg_rct_Event_Bonus_Etei_arena_1)<=yt)and(yt<=GetRectMaxY(gg_rct_Event_Bonus_Etei_arena_1)))thencall SetUnitPosition(Picked,4250.,800.)if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall PanCameraToTimed(4250.,800.,.0)
endifcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",4250.,800.))endifcall GroupRemoveUnit(gruppa,Picked)endloopset ff=LoadInteger(udg_hash,o,2)
set I=I+1if randomgold<=3 thencall CreateItem('I03B',x,y)endifif randomgold==4 thencall CreateItem('I03A',x,y)endifcall SaveInteger(udg_hash,h,3,timeout-1)
set x=GetRandomReal(minx+200.,maxx-200.)
set y=GetRandomReal(miny+200.,maxy-200.)
if GetRandomInt(1,'d')<=random thencall CreatePotion(x,y,1,6)endifif timeout<=0 thencall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifif ff==1 thencall TimerStart(t2,.05,false,function Trig_TimerEitiAreniTheEnd_Actions)
endifcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset Picked=nullset t=nullset t2=nullset p=nullset rct=null
endfunctionfunction Trig_Nachalo_Eiti_aren2_Actions takes nothing returns nothinglocal timer t3=GetExpiredTimer()
local integer h=GetHandleId(t3)local unit Pickedlocal group gruppa=CreateGroup()
local real xtop=GetRectCenterX(gg_rct_Oblast_Teleporta_Arena_Top)local real ytop=GetRectCenterY(gg_rct_Oblast_Teleporta_Arena_Top)local real xbot=GetRectCenterX(gg_rct_Oblast_Teleporta_Arena_Bot)local real ybot=GetRectCenterY(gg_rct_Oblast_Teleporta_Arena_Bot)local timer t=LoadTimerHandle(udg_hash,h,1)local timer t2=LoadTimerHandle(udg_hash,h,2)
local timerdialog td=LoadTimerDialogHandle(udg_hash,h,3)
local unit portalcall GroupEnumUnitsInRect(gruppa,gg_rct_Event_Bonus_Etei_arena_1,null)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall PauseUnit(Picked,false)
call GroupRemoveUnit(gruppa,Picked)endloopset portal=CreateUnit(Player($F),'h012',xtop,ytop,.0)call SaveUnitHandle(udg_hash,GetHandleId(gg_rct_Event_Bonus_Etei_arena_1),$C,portal)
set portal=CreateUnit(Player($F),'h012',xbot,ybot,.0)call SaveUnitHandle(udg_hash,GetHandleId(gg_rct_Event_Bonus_Etei_arena_1),$D,portal)
call TimerStart(t2,90.,false,function Trig_TimerEitiAreniTheEnd_Actions)
call TimerDialogSetTitle(td,"Time Remaining:")call TimerDialogDisplay(td,true)
call TimerDialogSetTimeColor(td,$FF,30,30,$A)call SaveTimerDialogHandle(udg_hash,GetHandleId(gg_rct_Event_Bonus_Etei_arena_1),$B,td)call TimerStart(t,.5,true,function Trig_Nachalo_Eiti_aren_Actions_Periodic)set Picked=nullset t=nullset t2=nullset td=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullendfunctionfunction Trig_Nachalo_Eiti_aren_FuncForGroup takes nothing returns nothingset bj_forLoopAIndex=1loop
exitwhen bj_forLoopAIndex>9if GetEnumPlayer()!=Player(bj_forLoopAIndex-1)thencall SetPlayerAllianceStateBJ(GetEnumPlayer(),Player(bj_forLoopAIndex-1),0)endifset bj_forLoopAIndex=bj_forLoopAIndex+1endloopendfunctionfunction Trig_Nachalo_Eiti_aren_Actions takes nothing returns nothinglocal real angle=0local real x=GetRectCenterX(gg_rct_Event_Bonus_Etei_arena_1)
local real y=GetRectCenterY(gg_rct_Event_Bonus_Etei_arena_1)
local real xtop=GetRectCenterX(gg_rct_Oblast_Teleporta_Arena_Top)local real ytop=GetRectCenterY(gg_rct_Oblast_Teleporta_Arena_Top)local real xbot=GetRectCenterX(gg_rct_Oblast_Teleporta_Arena_Bot)local real ybot=GetRectCenterY(gg_rct_Oblast_Teleporta_Arena_Bot)local unit Pickedlocal timer t2=CreateTimer()
local timerdialog td=CreateTimerDialog(t2)local integer h2=GetHandleId(t2)
local timer t=CreateTimer()local integer h=GetHandleId(t)local timer t3=CreateTimer()
local integer h3=GetHandleId(t3)
local group gruppa=CreateGroup()
local group grupa=CreateGroup()local integer I=0local integer lvl=0local integer hherolocal real anglestep=(360./ CountPlayersInForceBJ(udg_IGRAET))local integer o=GetHandleId(udg_Gruppa_HeroUnitov_Geroev)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,grupa)call SaveInteger(udg_hash,h,3,$B4)call SaveInteger(udg_hash,h,4,lvl)call SaveInteger(udg_hash,h,5,I)
call SaveReal(udg_hash,h,6,x)call SaveReal(udg_hash,h,7,y)call SaveTimerHandle(udg_hash,h,8,t)
call SaveGroupHandle(udg_hash,o,1,grupa)
call DisableTrigger(gg_trg_Hero_Dead)call ForForce(udg_IGRAET,function Trig_Nachalo_Eiti_aren_FuncForGroup)if(IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS))thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,"Добро Пожаловать на |cFFFFDC00Золотую Поляну|r!!!")
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Здесь каждый играет сам за себя. Постарайтесь выжить указанное время и собрать как можно больше золотых монеток. Удачи!")endifloop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullset hhero=GetHandleId(Picked)call SaveInteger(udg_hash,hhero,1,0)
set angle=angle+anglestepcall SetUnitPosition(Picked,(x+400*Cos(angle*bj_DEGTORAD)),(y+400*Sin(angle*bj_DEGTORAD)))call SetUnitFacing(Picked,bj_RADTODEG*Atan2(y-GetUnitY(Picked),x-GetUnitX(Picked)))set bj_lastCreatedFogModifier=CreateFogModifierRect(GetOwningPlayer(Picked),FOG_OF_WAR_VISIBLE,gg_rct_Event_Bonus_Etei_arena_1,true,false)call FogModifierStart(bj_lastCreatedFogModifier)
call SaveFogModifierHandle(udg_hash,GetHandleId(Picked),$AB,bj_lastCreatedFogModifier)if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall SoundForPlayer(GetOwningPlayer(Picked),7)call ClearSelection()call SelectUnit(Picked,true)
call PanCameraToTimed(x,y,.0)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall GroupEnumUnitsInRange(gruppa,0,0,99999,null)call KillSummonsAndIllusions(gruppa)
set gruppa=CreateGroup()
call GroupEnumUnitsInRect(gruppa,gg_rct_Event_Bonus_Etei_arena_1,null)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall PauseUnit(Picked,true)call GroupRemoveUnit(gruppa,Picked)endloopcall SaveTimerHandle(udg_hash,h3,1,t)call SaveTimerHandle(udg_hash,h3,2,t2)call SaveTimerDialogHandle(udg_hash,h3,3,td)
set udg_Is_Eiti_Arena_Already_Go=truecall TimerStart(t3,5.,false,function Trig_Nachalo_Eiti_aren2_Actions)set Picked=nullset t=nullset t2=nullset t3=nullset td=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset grupa=nullendfunctionfunction InitTrig_Nachalo_Eiti_aren takes nothing returns nothingset gg_trg_Nachalo_Eiti_aren=CreateTrigger()
call TriggerAddAction(gg_trg_Nachalo_Eiti_aren,function Trig_Nachalo_Eiti_aren_Actions)endfunctionfunction Trig_Hero_Deadd_Timer2_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)local effect ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)call UnitRemoveAbility(u,'Avul')
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset u=nullendfunctionfunction Trig_Hero_Deadd_Timer_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl",u,"origin")call SaveEffectHandle(udg_hash,h,4,ef)call TimerStart(t,3.,false,function Trig_Hero_Deadd_Timer2_Actions)call ReviveHero(u,x,y,true)call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MAX_MANA))
call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_MAX_LIFE))
call UnitAddAbility(u,'Avul')if(GetLocalPlayer()==GetOwningPlayer(u))then
call DisplayTextToPlayer(GetOwningPlayer(u),0,0,"|cFFFFFF00Ваш Герой Получил Второй Шанс!!!|r")
call PanCameraToTimed(x,y,.0)call ClearSelection()call SelectUnit(u,true)endifset t=nullset u=nullendfunctionfunction Trig_HeroDeadonEitiArena_Actions takes nothing returns nothinglocal unit u=GetDyingUnit()local integer hhero=GetHandleId(u)local player p=GetOwningPlayer(u)local integer play=GetPlayerId(p)+1local integer array herointlocal unit killer=GetKillingUnit()local player pk=GetOwningPlayer(killer)local integer random=GetRandomInt(1,3)local integer o=GetHandleId(udg_Gruppa_HeroUnitov_Geroev)local group g=LoadGroupHandle(udg_hash,o,1)local timer t=CreateTimer()local integer h=GetHandleId(t)local real xu=GetUnitX(u)local real yu=GetUnitY(u)local string stext=""local integer ff=0local integer gold=0
local integer xp=0set heroint[play]=0set heroint[play]=LoadInteger(udg_hash,hhero,1)call SaveUnitHandle(udg_hash,h,1,u)call SaveReal(udg_hash,h,2,xu)call SaveReal(udg_hash,h,3,yu)set heroint[play]=heroint[play]+1call SaveInteger(udg_hash,hhero,1,heroint[play])
if heroint[play]==1 then
call TimerStart(t,4.,false,function Trig_Hero_Deadd_Timer_Actions)set gold=350
set xp=500endifif heroint[play]==2 then
call TimerStart(t,4.,false,function Trig_Hero_Deadd_Timer_Actions)set gold=$FA
set xp=300endifif heroint[play]==3 then
set gold=$96
set xp='d'endifif GetPlayerId(pk)<=8 and heroint[play]<=3 thenif random==1 thenset stext=udg_ColorString[GetPlayerId(pk)+1]+GetPlayerName(pk)+"|r убил "+udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r и получает за это "+udg_ColorString[23]+I2S(gold)+" золота|r и "+udg_ColorString[23]+I2S(xp)+" опыта|r!!!"endifif random==2 thenset stext=udg_ColorString[GetPlayerId(pk)+1]+GetPlayerName(pk)+"|r скукожил "+udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r и получает за это "+udg_ColorString[23]+I2S(gold)+" золота|r и "+udg_ColorString[23]+I2S(xp)+" опыта|r!!!"endifif random==3 thenset stext=udg_ColorString[GetPlayerId(pk)+1]+GetPlayerName(pk)+"|r распотрошил "+udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r и получает за это "+udg_ColorString[23]+I2S(gold)+" золота|r и "+udg_ColorString[23]+I2S(xp)+" опыта|r!!!"endifcall SetPlayerState(pk,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(pk,PLAYER_STATE_RESOURCE_GOLD)+gold)call AddHeroXP(killer,xp,true)endifif stext!=null and stext!="" thenif IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)thencall DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,7.,stext)
endifendifif heroint[play]==3 then
call GroupRemoveUnit(g,u)endifif CountUnitsInGroup(g)<=0 thenset ff=1
call SaveInteger(udg_hash,o,2,ff)endifcall SaveGroupHandle(udg_hash,o,1,g)
set u=nullset p=nullset killer=nullset pk=nullset g=nullset t=nullendfunctionfunction Trig_HeroDeadonEitiArena_Conditions takes nothing returns booleanreturn(IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetDyingUnit())==false and GetPlayerId(GetOwningPlayer(GetDyingUnit()))<=8 and(udg_Is_Eiti_Arena_Already_Go))!=nullendfunctionfunction InitTrig_HeroDeadonEitiArena takes nothing returns nothinglocal integer index=0set gg_trg_HeroDeadonEitiArena=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_HeroDeadonEitiArena,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_HeroDeadonEitiArena,Condition(function Trig_HeroDeadonEitiArena_Conditions))
call TriggerAddAction(gg_trg_HeroDeadonEitiArena,function Trig_HeroDeadonEitiArena_Actions)endfunctionfunction Trig__PortalCheckTop_Conditions takes nothing returns booleanreturn(IsUnitType(GetEnteringUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetTriggerUnit())==false)!=nullendfunctionfunction Trig__PortalCheckTop_Actions takes nothing returns nothinglocal unit u=GetEnteringUnit()local real x=GetRectCenterX(gg_rct_Oblast_Teleporta_Arena_Bot)local real y=GetRectCenterY(gg_rct_Oblast_Teleporta_Arena_Bot)if IsUnitInGroup(u,udg_OtriadPortalUnitsEitiArena) thencall GroupRemoveUnit(udg_OtriadPortalUnitsEitiArena,u)else
call GroupAddUnit(udg_OtriadPortalUnitsEitiArena,u)call SetUnitPosition(u,x,y)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",x,y))if GetLocalPlayer()==GetOwningPlayer(u)thencall CameraSetupApplyForceDuration(gg_cam_Camera_Eiti_Arena_Bot_Portal,true,.0)endifendifset u=nullendfunctionfunction InitTrig__PortalCheckTop takes nothing returns nothinglocal region rectRegion=CreateRegion()set gg_trg__PortalCheckTop=CreateTrigger()call RegionAddRect(rectRegion,gg_rct_Oblast_Teleporta_Arena_Top)
call TriggerRegisterEnterRegion(gg_trg__PortalCheckTop,rectRegion,null)call TriggerAddCondition(gg_trg__PortalCheckTop,Condition(function Trig__PortalCheckTop_Conditions))
call TriggerAddAction(gg_trg__PortalCheckTop,function Trig__PortalCheckTop_Actions)endfunctionfunction Trig__PortalCheckBot_Conditions takes nothing returns booleanreturn(IsUnitType(GetEnteringUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetTriggerUnit())==false)!=nullendfunctionfunction Trig__PortalCheckBot_Actions takes nothing returns nothinglocal unit u=GetEnteringUnit()local real x=GetRectCenterX(gg_rct_Oblast_Teleporta_Arena_Top)local real y=GetRectCenterY(gg_rct_Oblast_Teleporta_Arena_Top)if IsUnitInGroup(u,udg_OtriadPortalUnitsEitiArena) thencall GroupRemoveUnit(udg_OtriadPortalUnitsEitiArena,u)else
call GroupAddUnit(udg_OtriadPortalUnitsEitiArena,u)call SetUnitPosition(u,x,y)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",x,y))if GetLocalPlayer()==GetOwningPlayer(u)thencall CameraSetupApplyForceDuration(gg_cam_Camera_Eiti_Arena_Top_Portal,true,.0)endifendifset u=nullendfunctionfunction InitTrig__PortalCheckBot takes nothing returns nothinglocal region rectRegion=CreateRegion()set gg_trg__PortalCheckBot=CreateTrigger()call RegionAddRect(rectRegion,gg_rct_Oblast_Teleporta_Arena_Bot)
call TriggerRegisterEnterRegion(gg_trg__PortalCheckBot,rectRegion,null)call TriggerAddCondition(gg_trg__PortalCheckBot,Condition(function Trig__PortalCheckBot_Conditions))
call TriggerAddAction(gg_trg__PortalCheckBot,function Trig__PortalCheckBot_Actions)endfunctionfunction Trig_LinkItemsInitAddItemToSystem_Actions takes integer count1,integer id1,integer count2,integer id2,integer count3,integer id3,integer count4,integer id4,integer count5,integer id5,integer itemlevel,integer idfinal,integer idrecipe,string sef returns nothinglocal integer h=($C*itemlevel)call SaveInteger(udg_hash,idrecipe,h+1,count1)call SaveInteger(udg_hash,idrecipe,h+2,id1)call SaveInteger(udg_hash,idrecipe,h+3,count2)call SaveInteger(udg_hash,idrecipe,h+4,id2)call SaveInteger(udg_hash,idrecipe,h+5,count3)call SaveInteger(udg_hash,idrecipe,h+6,id3)call SaveInteger(udg_hash,idrecipe,h+7,count4)call SaveInteger(udg_hash,idrecipe,h+8,id4)call SaveInteger(udg_hash,idrecipe,h+9,count5)call SaveInteger(udg_hash,idrecipe,h+$A,id5)
call SaveInteger(udg_hash,idrecipe,h+$B,idfinal)
call SaveStr(udg_hash,idrecipe,h+$C,sef)
call SaveInteger(udg_hash,idfinal,'y',itemlevel)
endfunctionfunction Trig_LinkItemsInit_Actions takes nothing returns nothingcall Trig_LinkItemsInitAddItemToSystem_Actions(1,'I004',1,'I00D',0,0,0,0,0,0,0,'I027','I02T',"Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00M',0,0,0,0,0,0,0,0,0,'I02Y','I030',"Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02Y',0,0,0,0,0,0,0,0,1,'I02Z','I030',"Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl")call SaveInteger(udg_hash,'I030',0,1)call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I01T',1,'I021',0,0,0,0,0,0,0,'I036','I037',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I003',1,'I004',1,'I01T',0,0,0,0,0,'I02J','I01D',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02J',0,0,0,0,0,0,0,0,1,'I01B','I01D',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01B',0,0,0,0,0,0,0,0,2,'I01X','I01D',"")call SaveInteger(udg_hash,'I01D',0,2)call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I01T',1,'I001',0,0,0,0,0,0,0,'I01U','I01M',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I003',1,'I01U',0,0,0,0,0,0,0,'I01G','I018',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00Z',1,'I00D',0,0,0,0,0,0,0,'I00A','I000',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00D',1,'I00E',0,0,0,0,0,0,0,'I00I','I01N',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00A',1,'I00I',0,0,0,0,0,0,0,'I00C','I00O',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00J',1,'I00E',1,'I00N',0,0,0,0,0,'I00G','I00K',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00G',0,0,0,0,0,0,0,0,1,'I01Q','I00K',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01Q',0,0,0,0,0,0,0,0,2,'I01V','I00K',"")call SaveInteger(udg_hash,'I00K',0,2)call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00Z',2,'I027',0,0,0,0,0,0,0,'I03G','I02K',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I027',1,'I022',1,'I021',1,'I026',0,0,0,'I03K','I03J',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I03K',0,0,0,0,0,0,0,0,1,'I03L','I03J',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I03L',0,0,0,0,0,0,0,0,2,'I03M','I03J',"")call SaveInteger(udg_hash,'I03J',0,2)call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00Z',2,'I026',0,0,0,0,0,0,0,'I02U','I03I',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I00N',1,'I00Y',0,0,0,0,0,0,0,'I03Q','I02V',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I015',1,'I00D',0,0,0,0,0,0,0,'I03S','I03R',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00F',1,'I001',2,'I00E',0,0,0,0,0,'I03U','I03T',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00J',1,'I021',1,'I026',1,'I00F',0,0,0,'I03W','I03V',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02C',1,'I001',1,'I004',0,0,0,0,0,'I03Y','I03X',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01X',1,'I01S',0,0,0,0,0,0,0,'I02G','I03Z',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I023',1,'I001',0,0,0,0,0,0,0,'I02I','I02O',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I036',1,'I00B',1,'I02A',0,0,0,0,0,'I02F','I040',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I022',1,'I00Z',1,'I026',1,'I00F',0,0,0,'I042','I041',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00J',1,'I01A',1,'I015',0,0,0,0,0,'I044','I043',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02G',1,'I01X',1,'I01U',0,0,0,0,0,'I048','I047',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I023',1,'I00Z',0,0,0,0,0,0,0,'I04L','I04K',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I03U',1,'I00I',1,'I00J',0,0,0,0,0,'I04U','I04M',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00J',1,'I00I',1,'I006',0,0,0,0,0,'I04V','I00Q',"")call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I01K',0,0,0,0,0,0,0,0,0,'I04X','I04W',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01G',1,'I01S',1,'I04X',0,0,0,0,0,'I04Z','I04Y',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00B',1,'I02A',2,'I001',0,0,0,0,0,'I02E','I01R',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02E',1,'I03N',1,'I02A',0,0,0,0,0,'I02N','I02M',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I03M',1,'I02U',1,'I03G',0,0,0,0,0,'I051','I050',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02F',1,'I03Q',1,'I00B',0,0,0,0,0,'I02T','I02D',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01T',2,'I00N',1,'I015',0,0,0,0,0,'I052','I03H',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I052',0,0,0,0,0,0,0,0,1,'I053','I03H',"")call SaveInteger(udg_hash,'I03H',0,1)call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I015',1,'I001',1,'I00E',0,0,0,0,0,'I055','I054',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I055',0,0,0,0,0,0,0,0,1,'I056','I054',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I056',0,0,0,0,0,0,0,0,2,'I057','I054',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I057',0,0,0,0,0,0,0,0,3,'I058','I054',"")call SaveInteger(udg_hash,'I054',0,3)call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I04X',1,'I03S',1,'I00I',0,0,0,0,0,'I05A','I059',"")call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I00D',1,'I00F',0,0,0,0,0,0,0,'I006','I005',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I036',1,'I006',1,'I026',0,0,0,0,0,'I008','I007',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I008',0,0,0,0,0,0,0,0,1,'I009','I007',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I009',0,0,0,0,0,0,0,0,2,'I00L','I007',"")call SaveInteger(udg_hash,'I007',0,2)call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I022',1,'I00F',0,0,0,0,0,0,0,'I00S','I00R',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I044',1,'I00S',1,'I01A',0,0,0,0,0,'I00T','I00M',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I004',0,0,0,0,0,0,0,0,0,'I00V','I00U',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01T',1,'I00D',1,'I001',1,'I00E',0,0,0,'I00X','I00W',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I042',1,'I03Q',1,'I022',0,0,0,0,0,'I012','I011',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I003',1,'I001',0,0,0,0,0,0,0,'I01C','I019',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I00S',1,'I03G',1,'I006',0,0,0,0,0,'I01W','I01P',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02U',1,'I03Y',0,0,0,0,0,0,0,'I02H','I029',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I01G',1,'I03U',0,0,0,0,0,0,0,'I02P','I02L',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(2,'I00E',1,'I01T',0,0,0,0,0,0,0,'I02R','I02Q',"")
call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02R',0,0,0,0,0,0,0,0,1,'I02S','I02Q',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02S',0,0,0,0,0,0,0,0,2,'I02W','I02Q',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02W',0,0,0,0,0,0,0,0,3,'I02X','I02Q',"")call Trig_LinkItemsInitAddItemToSystem_Actions(1,'I02X',0,0,0,0,0,0,0,0,4,'I02Y','I02Q',"")call SaveInteger(udg_hash,'I02Q',0,4)endfunctionfunction InitTrig_LinkItemsInit takes nothing returns nothingset gg_trg_LinkItemsInit=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_LinkItemsInit,6.,false)call TriggerAddAction(gg_trg_LinkItemsInit,function Trig_LinkItemsInit_Actions)endfunctionfunction Trig_ItemPickedUp_Actions takes nothing returns nothing
local item it=GetManipulatedItem()local integer id=GetItemTypeId(it)local integer itemlevellocal integer hlocal integer lopaif GetItemType(it)==ITEM_TYPE_POWERUP and id!='I03A' and id!='I03B' and id!='I013' and id!='I014' and id!='I016' and id!='I017' then
if(id=='I035')or(id=='I00P')or(id=='I03O')thencall RemoveItem(it)call SimError(GetOwningPlayer(GetTriggerUnit()),"Для покупки это предмета не нужен рецепт!")else
set itemlevel=LoadInteger(udg_hash,id,0)
set lopa=0set udg_Show_Item_Link_Text=true
set udg_Integer_Item_Recipe_Level=itemlevelloop
exitwhen(itemlevel<lopa)or(udg_Integer_Item_Recipe_Level<0)set h=itemlevel*$Ccall LinkItems(LoadInteger(udg_hash,id,h+1),LoadInteger(udg_hash,id,h+2),LoadInteger(udg_hash,id,h+3),LoadInteger(udg_hash,id,h+4),LoadInteger(udg_hash,id,h+5),LoadInteger(udg_hash,id,h+6),LoadInteger(udg_hash,id,h+7),LoadInteger(udg_hash,id,h+8),LoadInteger(udg_hash,id,h+9),LoadInteger(udg_hash,id,h+$A),LoadInteger(udg_hash,id,h+$B),LoadStr(udg_hash,id,h+$C),true)set itemlevel=itemlevel-1endloopset itemlevel=0set h=0endifelse
if id!='I03A' and id!='I03B' and id!='I013' and id!='I014' and id!='I016' and id!='I017' and id!='I01Y' then
call LinkItems(1,'I01U',1,'I01K',1,'I004',0,0,0,0,'I01S',"",false)call LinkItems(2,'I00F',1,'I00E',0,0,0,0,0,0,'I00J',"",false)call LinkItems(1,'I02A',1,'I00H',1,'I021',0,0,0,0,'I03N',"",false)endifendifset it=nullendfunctionfunction InitTrig_ItemPickedUp takes nothing returns nothing
local integer index=0set gg_trg_ItemPickedUp=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ItemPickedUp,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_ItemPickedUp,function Trig_ItemPickedUp_Actions)endfunctionfunction Trig_ChargesConnecting_Func002C takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())!='I055')and(GetItemTypeId(GetManipulatedItem())!='I056')and(GetItemTypeId(GetManipulatedItem())!='I057')and(GetItemTypeId(GetManipulatedItem())!='I058')endfunctionfunction Trig_ChargesConnecting_Conditions takes nothing returns boolean
return(GetItemCharges(GetManipulatedItem())>0)and(Trig_ChargesConnecting_Func002C())
endfunctionfunction Trig_ChargesConnecting_Func005C takes nothing returns booleanreturn(UnitHasItemOfTypeBJ(GetManipulatingUnit(),GetItemTypeId(GetManipulatedItem()))==false)endfunctionfunction Trig_ChargesConnecting_Actions takes nothing returns nothingcall UnitRemoveItemSwapped(GetManipulatedItem(),GetManipulatingUnit())if(Trig_ChargesConnecting_Func005C())thencall CreateItemLoc(GetItemTypeId(GetManipulatedItem()),GetUnitLoc(GetManipulatingUnit()))call DisableTrigger(GetTriggeringTrigger())call UnitAddItem(GetManipulatingUnit(),bj_lastCreatedItem)call EnableTrigger(GetTriggeringTrigger())call SetItemCharges(bj_lastCreatedItem,GetItemCharges(GetManipulatedItem()))
else
call SetItemCharges(GetItemOfTypeFromUnitBJ(GetManipulatingUnit(),GetItemTypeId(GetManipulatedItem())),(GetItemCharges(GetItemOfTypeFromUnitBJ(GetManipulatingUnit(),GetItemTypeId(GetManipulatedItem())))+GetItemCharges(GetManipulatedItem())))endifcall RemoveItem(GetManipulatedItem())endfunctionfunction InitTrig_ChargesConnecting takes nothing returns nothingset gg_trg_ChargesConnecting=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_ChargesConnecting,EVENT_PLAYER_UNIT_PICKUP_ITEM)call TriggerAddCondition(gg_trg_ChargesConnecting,Condition(function Trig_ChargesConnecting_Conditions))
call TriggerAddAction(gg_trg_ChargesConnecting,function Trig_ChargesConnecting_Actions)endfunctionfunction Trig_Remove_Dammi_Items_Func003C takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())=='I035')endfunctionfunction Trig_Remove_Dammi_Items_Conditions takes nothing returns booleanreturn(Trig_Remove_Dammi_Items_Func003C())endfunctionfunction Trig_Remove_Dammi_Items_Actions takes nothing returns nothingcall RemoveItem(GetManipulatedItem())call SimError(GetOwningPlayer(GetTriggerUnit()),"Для покупки это предмета не нужен рецепт!")endfunctionfunction InitTrig_Remove_Dammi_Items takes nothing returns nothingset gg_trg_Remove_Dammi_Items=CreateTrigger()call DisableTrigger(gg_trg_Remove_Dammi_Items)call TriggerRegisterAnyUnitEventBJ(gg_trg_Remove_Dammi_Items,EVENT_PLAYER_UNIT_PICKUP_ITEM)call TriggerAddCondition(gg_trg_Remove_Dammi_Items,Condition(function Trig_Remove_Dammi_Items_Conditions))call TriggerAddAction(gg_trg_Remove_Dammi_Items,function Trig_Remove_Dammi_Items_Actions)endfunctionfunction Trig_Save_Items_Cost_Actions takes nothing returns nothingcall SaveInteger(udg_hash,'I00I','x',$3ED)call SaveInteger(udg_hash,'I01G','x',$D0C)call SaveInteger(udg_hash,'I03W','x',$D70)call SaveInteger(udg_hash,'I036','x',$546)call SaveInteger(udg_hash,'I05A','x',5150)call SaveInteger(udg_hash,'I04Z','x',8100)call SaveInteger(udg_hash,'I01U','x',$67C)call SaveInteger(udg_hash,'I03U','x',$7DF)call SaveInteger(udg_hash,'I02J','x',$4E2)call SaveInteger(udg_hash,'I01B','x',$60E)call SaveInteger(udg_hash,'I01X','x',$73A)call SaveInteger(udg_hash,'I052','x',$596)call SaveInteger(udg_hash,'I053','x',$6C2)call SaveInteger(udg_hash,'I051','x',8710)call SaveInteger(udg_hash,'I03Q','x',$654)call SaveInteger(udg_hash,'I048','x',9815)call SaveInteger(udg_hash,'I00G','x',$7A8)call SaveInteger(udg_hash,'I01Q','x',$9CE)call SaveInteger(udg_hash,'I01V','x',$BF4)call SaveInteger(udg_hash,'I02N','x',4900)call SaveInteger(udg_hash,'I03N','x',$465)call SaveInteger(udg_hash,'I042','x',$979)call SaveInteger(udg_hash,'I03S','x',$712)call SaveInteger(udg_hash,'I02U','x',$6AE)call SaveInteger(udg_hash,'I00C','x',$D5C)call SaveInteger(udg_hash,'I00A','x',$5C3)call SaveInteger(udg_hash,'I04V','x',4100)call SaveInteger(udg_hash,'I044','x',$AB4)call SaveInteger(udg_hash,'I00J','x',980)call SaveInteger(udg_hash,'I03G','x',$5AA)call SaveInteger(udg_hash,'I04L','x',925)call SaveInteger(udg_hash,'I02I','x',765)call SaveInteger(udg_hash,'I02T','x',7000)call SaveInteger(udg_hash,'I04U','x',5250)call SaveInteger(udg_hash,'I03K','x',$A2D)call SaveInteger(udg_hash,'I03L','x',$E01)call SaveInteger(udg_hash,'I03M','x',$4FB)call SaveInteger(udg_hash,'I04X','x',$4FB)call SaveInteger(udg_hash,'I055','x',$4F6)call SaveInteger(udg_hash,'I056','x',$686)call SaveInteger(udg_hash,'I057','x',$816)call SaveInteger(udg_hash,'I058','x',$9A6)call SaveInteger(udg_hash,'I02E','x',$834)call SaveInteger(udg_hash,'I02F','x',$AB9)call SaveInteger(udg_hash,'I01S','x',$875)call SaveInteger(udg_hash,'I03Y','x',955)call SaveInteger(udg_hash,'I02G','x',4805)call SaveInteger(udg_hash,'I00D','x',275)call SaveInteger(udg_hash,'I022','x',350)call SaveInteger(udg_hash,'I00N','x',$C8)call SaveInteger(udg_hash,'I027','x',450)call SaveInteger(udg_hash,'I003','x',475)call SaveInteger(udg_hash,'I026','x',425)call SaveInteger(udg_hash,'I004','x','}')call SaveInteger(udg_hash,'I001','x',260)call SaveInteger(udg_hash,'I01K','x',380)call SaveInteger(udg_hash,'I00H','x',375)call SaveInteger(udg_hash,'I00Y','x',650)call SaveInteger(udg_hash,'I00E','x',$E6)call SaveInteger(udg_hash,'I02C','x',360)call SaveInteger(udg_hash,'I01A','x',500)call SaveInteger(udg_hash,'I02A','x',350)call SaveInteger(udg_hash,'I015','x',380)call SaveInteger(udg_hash,'I00Z','x',300)call SaveInteger(udg_hash,'I00F','x',375)call SaveInteger(udg_hash,'I021','x',400)call SaveInteger(udg_hash,'I023','x',$E1)call SaveInteger(udg_hash,'I00B','x',600)call SaveInteger(udg_hash,'I01T','x',350)call SaveInteger(udg_hash,'I006','x',$465)call SaveInteger(udg_hash,'I008','x',$ED8)call SaveInteger(udg_hash,'I009','x',4700)call SaveInteger(udg_hash,'I00L','x',5600)call SaveInteger(udg_hash,'I00S','x',$555)call SaveInteger(udg_hash,'I00T','x',5655)call SaveInteger(udg_hash,'I00V','x',475)call SaveInteger(udg_hash,'I00X','x',$514)call SaveInteger(udg_hash,'I012','x',5595)call SaveInteger(udg_hash,'I01C','x',860)call SaveInteger(udg_hash,'I01W','x',4500)call SaveInteger(udg_hash,'I02H','x',$C1C)call SaveInteger(udg_hash,'I02P','x',6300)call SaveInteger(udg_hash,'I02R','x',$51E)call SaveInteger(udg_hash,'I02S','x',$712)call SaveInteger(udg_hash,'I02W','x',$906)call SaveInteger(udg_hash,'I02X','x',$AFA)call SaveInteger(udg_hash,'I02Y','x',$CEE)call SaveInteger(udg_hash,'I030','x',$708)endfunctionfunction InitTrig_Save_Items_Cost takes nothing returns nothingset gg_trg_Save_Items_Cost=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Save_Items_Cost,10.,false)
call TriggerAddAction(gg_trg_Save_Items_Cost,function Trig_Save_Items_Cost_Actions)endfunctionfunction Trig_IceBoss_onbase_Actions takes nothing returns nothinglocal timer tonbase=GetExpiredTimer()local integer honbase=GetHandleId(tonbase)local integer ishod=LoadInteger(udg_hash,honbase,3)local unit boss=LoadUnitHandle(udg_hash,honbase,1)local group gruppa=CreateGroup()
local unit Pickedlocal real xc=GetRectCenterX(gg_rct_Respawn_Heroes)local real yc=GetRectCenterY(gg_rct_Respawn_Heroes)local fogmodifier fm=LoadFogModifierHandle(udg_hash,honbase,2)local texttag txtlocal real vel=.0221875local real angle=45.+GetRandomReal(.0,90.)local real xvel=vel*Cos(angle*bj_DEGTORAD)local real yvel=vel*Sin(angle*bj_DEGTORAD)local integer dead=0
local real perekluchatel=.1call ShowAndFlushAllPlayerDamage(false)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(false,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)
call CinematicFadeBJ(0,5.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif perekluchatel>=0 then
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel-50.else
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel+50.endifset xc=GetRectCenterX(gg_rct_Respawn_Heroes)+perekluchatelset yc=GetRectCenterY(gg_rct_Respawn_Heroes)
call ReviveHero(Picked,xc,yc,true)call SetUnitPosition(Picked,xc,yc)call SetUnitFacing(Picked,270.)call SetUnitState(Picked,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(Picked,UNIT_STATE_MANA,$540BE3FF)if ishod==0 then
set txt=CreateTextTag()set dead=LoadInteger(udg_hash,GetHandleId(Picked),1)
if dead==1 thencall SetTextTagText(txt,"|cFFFFFF00+850|r",.035)
call AddHeroXP(Picked,$6A4,true)
call SetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD)+750))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",Picked,"overhead"))if GetLocalPlayer()==GetOwningPlayer(Picked)then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Вы получили "+udg_ColorString[23]+I2S(850)+" золота|r!!!")endifelse
call SetTextTagText(txt,"|cFFFFFF00+2600|r",.045)call AddHeroXP(Picked,5500,true)
call SetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD)+$708))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",Picked,"overhead"))if GetLocalPlayer()==GetOwningPlayer(Picked)then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Вы получили "+udg_ColorString[23]+I2S($A28)+" золота|r!!!")endifendifcall SetTextTagPos(txt,GetUnitX(Picked),GetUnitY(Picked),.0)
call SetTextTagColor(txt,0,0,0,50)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,4.)call SetTextTagFadepoint(txt,.0)
set txt=null
endifif(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ResetToGameCamera(.0)if ishod==1 then
call DisplayTextToPlayer(GetOwningPlayer(Picked),0,0,"|cFFFF0000ВЫ ПРОИГРАЛИ БИТВУ С БОССОМ!!!|r")else
call DisplayTextToPlayer(GetOwningPlayer(Picked),0,0,"|cFFFFFF00ВЫ ПОБЕДИЛИ В БИТВЕ С БОССОМ!!!|r")endifcall ResetToGameCamera(.0)call PanCameraToTimed(xc,yc,.0)call SelectUnit(Picked,true)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall EnableTrigger(gg_trg_Hero_Dead)
set Picked=nullcall GroupEnumUnitsInRect(gruppa,gg_rct_6,null)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif GetUnitTypeId(Picked)!='h00C' and GetUnitTypeId(Picked)!='h00B' and GetUnitTypeId(Picked)!='h00U' thencall RemoveUnit(Picked)endifcall GroupRemoveUnit(gruppa,Picked)endloopif TriggerEvaluate(gg_trg_GameEndWin)thencall TriggerExecute(gg_trg_GameEndWin)endifset Picked=nullcall RemoveWeatherEffect(udg_BossFightWeather)set udg_BossFightWeather=nullcall FlushChildHashtable(udg_hash,GetHandleId(boss))
call RemoveUnit(boss)set boss=nullcall DestroyFogModifier(fm)set fm=nullcall DestroyGroup(gruppa)set gruppa=nullcall FlushChildHashtable(udg_hash,honbase)call DestroyTimer(tonbase)set tonbase=null
endfunctionfunction Trig_IceBoss_end_Actions takes nothing returns nothinglocal timer tend=GetExpiredTimer()local integer hend=GetHandleId(tend)
local unit boss=LoadUnitHandle(udg_hash,hend,1)local fogmodifier fm=CreateFogModifierRect(Player(0),FOG_OF_WAR_VISIBLE,gg_rct_6,true,true)local integer lop=0local integer ishod=LoadInteger(udg_hash,hend,2)
local timer tonbase=CreateTimer()local integer honbase=GetHandleId(tonbase)local group g=CreateGroup()local unit Pickedcall SaveUnitHandle(udg_hash,honbase,1,boss)
call SaveFogModifierHandle(udg_hash,honbase,2,fm)call SaveInteger(udg_hash,honbase,3,ishod)call GroupEnumUnitsInRect(g,gg_rct_6,null)loop
exitwhen lop>9if(GetLocalPlayer()==Player(lop))thencall CameraSetupApplyForceDuration(gg_cam_Camera_BossFightStart,true,.0)
call SetCameraRotateMode(GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6),bj_DEGTORAD*360.,6.)endifset lop=lop+1endloopcall TimerStart(tonbase,6.,false,function Trig_IceBoss_onbase_Actions)if ishod==1 then
call IssuePointOrderById(boss,$D0012,GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6))else
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetOwningPlayer(Picked)==Player($B)thencall KillUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifcall CinematicModeExBJ(true,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)call CinematicFadeBJ(1,6.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call FlushChildHashtable(udg_hash,hend)call DestroyTimer(tend)set tend=nullset boss=nullset fm=nullset tonbase=null
call DestroyGroup(g)
set g=nullendfunctionfunction Trig_IceBoss_ActionWithWait_Actions takes nothing returns nothinglocal timer twact=GetExpiredTimer()local integer hwact=GetHandleId(twact)local unit boss=LoadUnitHandle(udg_hash,hwact,1)
call IssueImmediateOrderById(boss,$D00FC)call DestroyTimer(twact)
set twact=nullcall FlushChildHashtable(udg_hash,hwact)
set boss=nullendfunctionfunction Trig_IceBoss_No_zaniat_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local unit boss=LoadUnitHandle(udg_hash,GetHandleId(t),1)local boolean zaniat=LoadBoolean(udg_hash,GetHandleId(boss),$A)set zaniat=false
call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call FlushChildHashtable(udg_hash,GetHandleId(t))endfunctionfunction Trig_IceBoss_hpcheck_Actions takes nothing returns nothinglocal real xc=GetRectCenterX(gg_rct_6)local real yc=GetRectCenterY(gg_rct_6)local timer thpcheck=GetExpiredTimer()local integer hhpcheck=GetHandleId(thpcheck)
local unit boss=LoadUnitHandle(udg_hash,hhpcheck,1)local integer stage=LoadInteger(udg_hash,hhpcheck,2)
local integer dammicheck=LoadInteger(udg_hash,hhpcheck,4)local real dx=GetUnitX(boss)-xclocal real dy=GetUnitY(boss)-yclocal timer twact=CreateTimer()local integer hwact=GetHandleId(twact)local timer taltarslocal boolean zaniat=LoadBoolean(udg_hash,GetHandleId(boss),$A)local integer cdwall=LoadInteger(udg_hash,GetHandleId(boss),41)local integer cdstorm=LoadInteger(udg_hash,GetHandleId(boss),42)
local integer cdrain=LoadInteger(udg_hash,GetHandleId(boss),43)local integer cdpunishment=LoadInteger(udg_hash,GetHandleId(boss),44)local integer cdblink=LoadInteger(udg_hash,GetHandleId(boss),45)
local group grp=CreateGroup()local timer tcdlocal timer tgol
local group heroes=CreateGroup()
local unit Pickedlocal integer kolvo=0local integer random=GetRandomInt(1,4)local real distlocal timer tend
local integer hendlocal integer ishod=0local effect eflocal player p=Player($C)local integer itemrand=R2I($F+5*CountPlayersInForceBJ(udg_IGRAET))local real itemx=(GetRandomReal(-1350.,100.))local real itemy=(GetRandomReal(1900.,3450.))local unit dammi
local group geroi=CreateGroup()if GetRandomInt(1,'d')<=itemrand thencall CreatePotion(itemx,itemy,3,6)endifif(zaniat==false and stage==0 and GetUnitState(boss,UNIT_STATE_LIFE)>140000. and GetUnitState(boss,UNIT_STATE_LIFE)<120000.)or(stage==1 and GetUnitState(boss,UNIT_STATE_LIFE)>100000. and GetUnitState(boss,UNIT_STATE_LIFE)<75000.)or(stage==2 and GetUnitState(boss,UNIT_STATE_LIFE)>30000. and GetUnitState(boss,UNIT_STATE_LIFE)<5000.)then
set stage=stage+1set zaniat=truecall SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,hhpcheck,2,stage)call SaveUnitHandle(udg_hash,hwact,1,boss)if SquareRoot(dx*dx+dy*dy)>500 thencall IssuePointOrderById(boss,$D0012,xc+GetRandomReal(-250.,250.),yc+GetRandomReal(-250.,250.))call SetUnitPathing(boss,false)call TimerStart(twact,4.,false,function Trig_IceBoss_ActionWithWait_Actions)
else
call TimerStart(twact,.25,false,function Trig_IceBoss_ActionWithWait_Actions)endifendifif cdwall>0 then
call SaveInteger(udg_hash,GetHandleId(boss),41,cdwall-1)
endifif cdstorm>0 thencall SaveInteger(udg_hash,GetHandleId(boss),42,cdstorm-1)endifif cdrain>0 then
call SaveInteger(udg_hash,GetHandleId(boss),43,cdrain-1)
endifif cdpunishment>0 thencall SaveInteger(udg_hash,GetHandleId(boss),44,cdpunishment-1)endifif cdblink>0 thencall SaveInteger(udg_hash,GetHandleId(boss),45,cdblink-1)endifcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,geroi)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,grp)
loop
set Picked=FirstOfGroup(grp)
exitwhen Picked==nullif IsUnitType(Picked,UNIT_TYPE_HERO) and Picked!=boss and GetUnitState(Picked,UNIT_STATE_LIFE)>.405 then
call GroupAddUnit(heroes,Picked)
endifcall GroupRemoveUnit(grp,Picked)
endloopcall FilterMostNearUnit(heroes,boss)
set Picked=nullcall AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodSorceress.mdl",udg_Unit_FilterMostNearUnit,"chest")set dammicheck=dammicheck+1if dammicheck==8 or dammicheck==16 thenset dammi=CreateUnit(Player($B),'h00U',GetUnitX(boss),GetUnitY(boss),.0)
call UnitApplyTimedLife(dammi,'BTLF',7.)
call UnitAddAbility(dammi,'A04H')call IssuePointOrderById(dammi,$D0079,GetUnitX(udg_Unit_FilterMostNearUnit),GetUnitY(udg_Unit_FilterMostNearUnit))endifif dammicheck==18 thenset dammicheck=0
endifcall SaveInteger(udg_hash,hhpcheck,4,dammicheck)
if zaniat==false thenif random==1 and cdwall<=0 and udg_Unit_FilterMostNearUnit!=null thencall IssuePointOrderById(boss,$D027A,GetUnitX(udg_Unit_FilterMostNearUnit),GetUnitY(udg_Unit_FilterMostNearUnit))call SaveInteger(udg_hash,GetHandleId(boss),41,16)endifif random==2 and SquareRoot(dx*dx+dy*dy)<700 and cdstorm<=0 then
call IssueImmediateOrderById(boss,$D0278)call SaveInteger(udg_hash,GetHandleId(boss),42,19)set zaniat=trueset tcd=CreateTimer()call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,GetHandleId(boss),$C,20)call SaveUnitHandle(udg_hash,GetHandleId(tcd),1,boss)call TimerStart(tcd,3.5,false,function Trig_IceBoss_No_zaniat_Actions)set tcd=null
endifif random==3 and SquareRoot(dx*dx+dy*dy)<700 and cdrain<=0 thencall IssuePointOrderById(boss,$D010D,GetUnitX(boss)+$A*Cos(GetUnitFacing(boss)*bj_DEGTORAD),GetUnitY(boss)+$A*Sin(GetUnitFacing(boss)*bj_DEGTORAD))set zaniat=truecall SaveInteger(udg_hash,GetHandleId(boss),43,22)set tcd=CreateTimer()call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,GetHandleId(boss),$C,20)call SaveUnitHandle(udg_hash,GetHandleId(tcd),1,boss)call TimerStart(tcd,6.,false,function Trig_IceBoss_No_zaniat_Actions)set tcd=null
endifif random==4 and cdpunishment<=0 and udg_Unit_FilterMostNearUnit!=null thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"FrostLich the Freezing in Ice",gg_snd_HeroLichYesAttack1,udg_ColorString[GetPlayerId(GetOwningPlayer(udg_Unit_FilterMostNearUnit))+1]+GetPlayerName(GetOwningPlayer(udg_Unit_FilterMostNearUnit))+"|r, |cFFAFE6FFПочувствуй Зов Могилы!!!...|r",0,2.2,false)call SaveInteger(udg_hash,GetHandleId(boss),44,$C)call IssueTargetOrderById(boss,$D00DD,udg_Unit_FilterMostNearUnit)endifendifif cdblink<=0 and zaniat==false then
set dist=GetRandomReal(-800.,-400.)call SaveInteger(udg_hash,GetHandleId(boss),45,25)call IssuePointOrderById(boss,$D022D,GetUnitX(boss)+dist*Cos(bj_RADTODEG*Atan2(dx,dy)*bj_DEGTORAD),GetUnitY(boss)+dist*Sin(bj_RADTODEG*Atan2(dx,dy)*bj_DEGTORAD))call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Shiva'sWrath.mdl",boss,"origin"))endifif SquareRoot(dx*dx+dy*dy)>$4B0 and zaniat==false thencall SetUnitPosition(boss,xc,yc)
endifcall GroupClear(heroes)if GetUnitState(boss,UNIT_STATE_LIFE)<.405 thenset tend=CreateTimer()set hend=GetHandleId(tend)call SaveInteger(udg_hash,hend,2,ishod)call SaveUnitHandle(udg_hash,hend,1,boss)call TimerStart(tend,3.,false,function Trig_IceBoss_end_Actions)
set taltars=LoadTimerHandle(udg_hash,hhpcheck,3)
call FlushChildHashtable(udg_hash,GetHandleId(taltars))call DestroyTimer(taltars)call GroupEnumUnitsInRect(heroes,gg_rct_6,null)call DestroyTimer(thpcheck)set tend=nullcall FlushChildHashtable(udg_hash,hhpcheck)endifcall GroupClear(heroes)loop
set Picked=FirstOfGroup(geroi)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)<.405 thenset kolvo=kolvo+1call SaveInteger(udg_hash,GetHandleId(Picked),1,1)endifcall GroupRemoveUnit(geroi,Picked)endloopset Picked=nullif kolvo>=CountUnitsInGroup(udg_Gruppa_HeroUnitov_Geroev)thenset tend=CreateTimer()set hend=GetHandleId(tend)call SaveInteger(udg_hash,hend,2,ishod+1)call SaveUnitHandle(udg_hash,hend,1,boss)set taltars=LoadTimerHandle(udg_hash,hhpcheck,3)
call FlushChildHashtable(udg_hash,GetHandleId(taltars))call DestroyTimer(taltars)call TimerStart(tend,3.,false,function Trig_IceBoss_end_Actions)
call DestroyTimer(thpcheck)set tend=nullcall FlushChildHashtable(udg_hash,hhpcheck)endifset thpcheck=nullset boss=nullset twact=nullcall GroupClear(grp)
call DestroyGroup(grp)set grp=null
call GroupClear(heroes)call DestroyGroup(heroes)call GroupClear(geroi)call DestroyGroup(geroi)
set geroi=nullset heroes=nullset p=nullset dammi=nullendfunctionfunction Trig_IceBoss_frasa_Actions takes nothing returns nothinglocal timer tfrasa=GetExpiredTimer()
local integer hfrasa=GetHandleId(tfrasa)
local unit boss=LoadUnitHandle(udg_hash,hfrasa,1)local integer random=GetRandomInt(1,3)if GetUnitState(boss,UNIT_STATE_LIFE)>.405 thenif random==1 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"FrostLich the Freezing in Ice",gg_snd_HeroLichReady1,"|cFFAFE6FFДревнее Зло... Непобедимо!!!|r",0,4.37,false)
endifif random==2 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"FrostLich the Freezing in Ice",gg_snd_HeroLichYesAttack2,"|cFFAFE6FFВо Славу Тьмы!!!..|r",0,2.7,false)
endifif random==3 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"FrostLich the Freezing in Ice",gg_snd_HeroLichYesAttack3,"|cFFAFE6FFИх Ждет Смерть!!!...|r",0,2.4,false)endifelse
call FlushChildHashtable(udg_hash,hfrasa)call DestroyTimer(tfrasa)endifset tfrasa=nullset boss=nullendfunctionfunction Trig_IceBoss_5sec_Actions takes nothing returns nothing
local timer t5sec=GetExpiredTimer()local integer h5sec=GetHandleId(t5sec)local unit boss=LoadUnitHandle(udg_hash,h5sec,1)
local group gruppa=CreateGroup()
local unit Pickedlocal timer tfrasa=CreateTimer()
local integer hfrasa=GetHandleId(tfrasa)
local timer thpcheck=CreateTimer()local integer hhpcheck=GetHandleId(thpcheck)
local integer stage=0local timer taltars=CreateTimer()local boolean zaniat=falsecall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(false,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)
loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall PauseUnit(Picked,false)
call IssueTargetOrderById(Picked,$D000F,boss)if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ClearSelection()call SelectUnit(Picked,true)
call ResetToGameCamera(.0)call PanCameraToTimed(GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6),.0)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall PauseUnit(boss,false)call IssuePointOrderById(boss,$D0012,GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6))call SaveUnitHandle(udg_hash,hfrasa,1,boss)call TimerStart(tfrasa,13.,true,function Trig_IceBoss_frasa_Actions)
call SaveUnitHandle(udg_hash,hhpcheck,1,boss)call SaveInteger(udg_hash,hhpcheck,2,stage)call SaveTimerHandle(udg_hash,hhpcheck,3,taltars)call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,GetHandleId(boss),41,0)call SaveInteger(udg_hash,GetHandleId(boss),42,0)call SaveInteger(udg_hash,GetHandleId(boss),43,0)call SaveInteger(udg_hash,GetHandleId(boss),44,0)call SaveInteger(udg_hash,GetHandleId(boss),45,20)call SaveInteger(udg_hash,hhpcheck,4,0)call TimerStart(thpcheck,1.,true,function Trig_IceBoss_hpcheck_Actions)call DestroyTimer(t5sec)
call FlushChildHashtable(udg_hash,h5sec)
set t5sec=nullset boss=nullset Picked=nullset tfrasa=nullset thpcheck=nullset taltars=null
call GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullendfunctionfunction Trig_IceBoss_3sec_Actions takes nothing returns nothing
local timer t3sec=GetExpiredTimer()local integer h3sec=GetHandleId(t3sec)local timer t5sec=CreateTimer()local integer h5sec=GetHandleId(t5sec)local unit boss=LoadUnitHandle(udg_hash,h3sec,1)
call SaveUnitHandle(udg_hash,h5sec,1,boss)call TimerStart(t5sec,5.,false,function Trig_IceBoss_5sec_Actions)call ForceCinematicSubtitles(true)call TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"FrostLich the Freezing in Ice",gg_snd_HeroLichReady1,"|cFFAFE6FFДревнее Зло... Непобедимо!!!|r",0,4.75,false)
call DestroyTimer(t3sec)
call FlushChildHashtable(udg_hash,h3sec)
set t3sec=nullset t5sec=nullset boss=nullendfunctionfunction Trig_IceBoss_Actions takes nothing returns nothinglocal real xc=GetRectCenterX(gg_rct_6)local real yc=GetRectCenterY(gg_rct_6)local real xp=xc-1216.local real yp=yc+1088.local integer random
local integer end=1local group gruppa=CreateGroup()
local unit Pickedlocal real dist=-350
local unit boss=CreateUnit(Player($B),'N000',(xc-500),yc,.0)
local timer t3sec=CreateTimer()local integer h3sec=GetHandleId(t3sec)set udg_BossFightWeather=AddWeatherEffect(gg_rct_6,'SNhs')set udg_BossFightWeather2=AddWeatherEffect(gg_rct_6,'FDbh')call EnableWeatherEffect(udg_BossFightWeather,true)call EnableWeatherEffect(udg_BossFightWeather2,true)
call DisableTrigger(gg_trg_Hero_Dead)call EnableTrigger(gg_trg_Ice_Wall)call EnableTrigger(gg_trg_Ice_Storm)
call EnableTrigger(gg_trg_Ice_Rain)call EnableTrigger(gg_trg_Ice_Restoration)call EnableTrigger(gg_trg_Cold_Punishment)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call SetAttackSpeedAbilityLevel(boss,20*CountPlayersInForceBJ(udg_IGRAET))call SetAttackAbilityLevel(boss,'d'*CountPlayersInForceBJ(udg_IGRAET))call SetArmorAbilityLevel(boss,$A*CountPlayersInForceBJ(udg_IGRAET))
call CinematicModeExBJ(true,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)call CinematicFadeBJ(1,.0,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call CinematicFadeBJ(0,8.25,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall SetUnitPosition(Picked,(xc+500),(yc+dist))call SetUnitFacing(Picked,bj_RADTODEG*Atan2(yc-GetUnitY(Picked),xc-GetUnitX(Picked)))call PauseUnit(Picked,true)call ClearSelection()set dist=dist+'d'if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall CameraSetupApplyForceDuration(gg_cam_Camera_BossFightStart,true,.0)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall SetHeroLevel(boss,50,false)
call UnitAddAbility(boss,'A00K')
call UnitAddAbility(boss,'A03K')
call UnitAddAbility(boss,'A03P')
call UnitAddAbility(boss,'A043')
call UnitAddAbility(boss,'A04B')
call UnitAddAbility(boss,'A04D')
call PauseUnit(boss,true)call SaveUnitHandle(udg_hash,h3sec,1,boss)call TimerStart(t3sec,3.,false,function Trig_IceBoss_3sec_Actions)call ShowAndFlushAllPlayerDamage(true)call TimerStart(udg_TimerShowAndFlushAllPlayerDmg,10000.,false,null)
loop
exitwhen end>16set yp=yp-$80set bj_forLoopAIndex=1loop
exitwhen bj_forLoopAIndex>20
set random=GetRandomInt(1,$A)if random>=1 and random<=3 thencall SetTerrainType(xp,yp,'Idki',-1,2,1)
else
if random>=4 and random<=7 thencall SetTerrainType(xp,yp,'Iice',-1,2,1)
else
call SetTerrainType(xp,yp,'Nice',-1,2,1)
endifendifset xp=xp+$80set bj_forLoopAIndex=bj_forLoopAIndex+1endloopset end=end+1set xp=xc-1216.endloopset Picked=nullset boss=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset t3sec=nullendfunctionfunction InitTrig_Ice_Boss takes nothing returns nothing
set gg_trg_Ice_Boss=CreateTrigger()call TriggerAddAction(gg_trg_Ice_Boss,function Trig_IceBoss_Actions)
endfunctionfunction Trig_Ice_Wall_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local real damage=LoadReal(udg_hash,h,3)
local group gdamage=CreateGroup()local group gdamage2=CreateGroup()local unit Pickedlocal player p=GetOwningPlayer(caster)local effect eflocal integer lopa=1
local unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,2,wait)loop
exitwhen lopa>20
set dammi=LoadUnitHandle(udg_hash,h,$A+lopa)
call GroupEnumUnitsInRange(gdamage,GetUnitX(dammi),GetUnitY(dammi),140.,null)call GroupAddGroup(gdamage,gdamage2)
set dammi=nullset lopa=lopa+1endlooploop
set Picked=FirstOfGroup(gdamage2)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,(damage/ 10.),false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)if(wait-(wait/ $A)*$A)==0 thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIob\\AIobSpecialArt.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl",Picked,"chest"))endifif GetUnitAbilityLevel(Picked,'B008')<=0 thenset dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A03M')call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullendifendifif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitType(Picked,UNIT_TYPE_HERO)==false and IsUnitAlly(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
if GetUnitAbilityLevel(Picked,'B009')<=0 thenset dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A03I')call SetUnitAbilityLevel(dammi,'A03I',1)
call IssueTargetOrderById(dammi,$D0101,Picked)set dammi=nullendifendifcall GroupRemoveUnit(gdamage2,Picked)endloopelse
set lopa=1loop
exitwhen lopa>20
set dammi=LoadUnitHandle(udg_hash,h,$A+lopa)
call KillUnit(dammi)
set ef=LoadEffectHandle(udg_hash,h,40+lopa)call DestroyEffect(ef)set dammi=nullset ef=nullset lopa=lopa+1endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset ef=nullset Picked=nullset p=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call GroupClear(gdamage2)call DestroyGroup(gdamage2)set gdamage2=nullset dammi=nullset ef=nullendfunctionfunction Trig_Ice_Wall_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local location loclocal real xtlocal real ytlocal unit target=GetSpellTargetUnit()local real angle
local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait='x'local real damage=150.local integer lopa=1
local integer lopb=1
local unit dammi
local effect eflocal player p=GetOwningPlayer(caster)local real randomif target!=null then
set xt=GetUnitX(target)set yt=GetUnitY(target)else
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
endifset angle=bj_RADTODEG*Atan2(yt-GetUnitY(caster),xt-GetUnitX(caster))
set xt=xt+75.*Cos(angle*bj_DEGTORAD)
set yt=yt+75.*Sin(angle*bj_DEGTORAD)
set angle=angle-90.set xt=xt+500.*Cos(angle*bj_DEGTORAD)set yt=yt+500.*Sin(angle*bj_DEGTORAD)loop
exitwhen lopb>2loop
exitwhen lopa>$A
set random=GetRandomReal(.8,1.25)set dammi=CreateUnit(p,'h00U',xt-((lopa-1)*100.)*Cos(angle*bj_DEGTORAD),yt-((lopa-1)*100.)*Sin(angle*bj_DEGTORAD),GetRandomReal(.0,360.))call SetUnitScale(dammi,random,random,random)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathTargetArt.mdl",dammi,"origin")call SaveUnitHandle(udg_hash,h,$A+lopa+($A*(lopb-1)),dammi)call SaveEffectHandle(udg_hash,h,40+lopa+($A*(lopb-1)),ef)set dammi=nullset ef=nullset lopa=lopa+1endloopset xt=xt-150.*Cos((angle+90.)*bj_DEGTORAD)set yt=yt-150.*Sin((angle+90.)*bj_DEGTORAD)set lopb=lopb+1set lopa=1endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,wait)call SaveReal(udg_hash,h,3,damage)call TimerStart(t,.1,true,function Trig_Ice_Wall_Periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set target=nullset t=nullset p=nullendfunctionfunction Trig_Ice_Wall_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A03K'endfunctionfunction InitTrig_Ice_Wall takes nothing returns nothing
local integer index=0set gg_trg_Ice_Wall=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Wall,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Wall,Condition(function Trig_Ice_Wall_Conditions))call TriggerAddAction(gg_trg_Ice_Wall,function Trig_Ice_Wall_Actions)endfunctionfunction Trig_Ice_Storm_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local integer wait=LoadInteger(udg_hash,h,4)
local real damage=LoadReal(udg_hash,h,5)
local real angle=LoadReal(udg_hash,h,6)local group gdamage=CreateGroup()local unit Pickedlocal player p=GetOwningPlayer(caster)local unit dammi
local integer order=GetUnitCurrentOrder(caster)local integer orderIdlocal real distlocal real xtlocal real ytset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId and wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,4,wait)set dist=GetRandomReal(250.,600.)set angle=angle+GetRandomReal(-60.,60.)set xt=x+dist*Cos(angle*bj_DEGTORAD)
set yt=y+dist*Sin(angle*bj_DEGTORAD)
set angle=angle+120.
call SaveReal(udg_hash,h,6,angle)call GroupEnumUnitsInRange(gdamage,xt,yt,200.,null)call DestroyEffect(AddSpecialEffect("war3mapImported\\Shiva'sWrath.mdl",xt,yt))set dammi=CreateUnit(p,'n00A',xt,yt,GetRandomReal(.0,360.))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",dammi,"origin"))set dammi=nullloop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A039')call SetUnitAbilityLevel(dammi,'A039',1)
call IssueTargetOrderById(dammi,$D00CB,Picked)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIob\\AIobSpecialArt.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl",Picked,"chest"))endifcall GroupRemoveUnit(gdamage,Picked)
endloopelse
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset Picked=nullset p=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
set dammi=nullendfunctionfunction Trig_Ice_Storm_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=6
local real damage=350call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SaveInteger(udg_hash,h,4,wait)call SaveReal(udg_hash,h,5,damage)call SaveReal(udg_hash,h,6,GetUnitFacing(caster))call TimerStart(t,.5,true,function Trig_Ice_Storm_Periodic_Actions)set caster=nullset t=nullendfunctionfunction Trig_Ice_Storm_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A03P'endfunctionfunction InitTrig_Ice_Storm takes nothing returns nothinglocal integer index=0set gg_trg_Ice_Storm=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Storm,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Storm,Condition(function Trig_Ice_Storm_Conditions))
call TriggerAddAction(gg_trg_Ice_Storm,function Trig_Ice_Storm_Actions)endfunctionfunction Trig_Ice_Rain_Filter_Actions takes nothing returns booleanreturn(GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405 and IsUnitEnemy(GetFilterUnit(),udg_Temp_Player[1]) and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(GetFilterUnit())!='h00U')!=null
endfunctionfunction Trig_Ice_Rain_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local real damage=LoadReal(udg_hash,h,3)
local real xt=LoadReal(udg_hash,h,4)
local real yt=LoadReal(udg_hash,h,5)
local real angle=LoadReal(udg_hash,h,6)local group gmissile=LoadGroupHandle(udg_hash,h,7)local integer waitcreate=LoadInteger(udg_hash,h,8)local group gmissile2=CreateGroup()local group gdamagelocal group gdamage2=CreateGroup()local unit Pickedlocal unit Picked2local unit missilelocal real xmissilelocal real ymissilelocal integer hmissilelocal integer missileflywait
local real anglemissilelocal player p=GetOwningPlayer(caster)local effect eflocal boolean stoplocal integer order=GetUnitCurrentOrder(caster)local integer orderIdset orderId=$D010Dif(orderId!=0)thenelse
set orderId=UnitId("rainofchaos")if(orderId!=0)thenendifendifif order==orderId and wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,2,wait)set udg_Temp_Player[1]=p
if waitcreate>0 then
set waitcreate=waitcreate-1call SaveInteger(udg_hash,h,8,waitcreate)set xmissile=xt+GetRandomReal(-300.,300.)*Cos((angle-90.)*bj_DEGTORAD)set ymissile=yt+GetRandomReal(-300.,300.)*Sin((angle-90.)*bj_DEGTORAD)set anglemissile=angle+GetRandomReal(-30.,30.)set missile=CreateUnit(p,'h00U',xmissile,ymissile,anglemissile)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\FrostBolt\\FrostBoltMissile.mdl",missile,"chest")call UnitAddAbility(missile,'Amrf')call UnitRemoveAbility(missile,'Amrf')call SetUnitFlyHeight(missile,50.,.0)set hmissile=GetHandleId(missile)call SaveInteger(udg_hash,hmissile,1,0)call SaveEffectHandle(udg_hash,hmissile,2,ef)call SaveStr(udg_hash,hmissile,3,"Im missile")call GroupAddUnit(gmissile,missile)call SaveGroupHandle(udg_hash,h,7,gmissile)set missile=null
set ef=nullendifcall GroupAddGroup(gmissile,gmissile2)loop
set missile=FirstOfGroup(gmissile2)exitwhen missile==nullset anglemissile=GetUnitFacing(missile)set xmissile=GetUnitX(missile)+36.*Cos(anglemissile*bj_DEGTORAD)
set ymissile=GetUnitY(missile)+36.*Sin(anglemissile*bj_DEGTORAD)
set gdamage=CreateGroup()call GroupEnumUnitsInRange(gdamage,xmissile,ymissile,100.,Filter(function Trig_Ice_Rain_Filter_Actions))
call GroupAddGroup(gdamage,gdamage2)
call GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
if IsTerrainPathable(xmissile,ymissile,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(missile,xmissile,ymissile)endifset hmissile=GetHandleId(missile)set missileflywait=LoadInteger(udg_hash,hmissile,1)if missileflywait>=30 thencall KillUnit(missile)call GroupRemoveUnit(gmissile,missile)call SaveGroupHandle(udg_hash,h,7,gmissile)set ef=LoadEffectHandle(udg_hash,hmissile,2)
call DestroyEffect(ef)call FlushChildHashtable(udg_hash,hmissile)set ef=nullset missile=null
else
call SaveInteger(udg_hash,hmissile,1,missileflywait+1)endifcall GroupRemoveUnit(gmissile2,missile)endlooploop
set Picked=FirstOfGroup(gdamage2)exitwhen Picked==nullset gdamage=CreateGroup()call GroupEnumUnitsInRange(gdamage,GetUnitX(Picked),GetUnitY(Picked),100.,null)set stop=falseloop
set Picked2=FirstOfGroup(gdamage)exitwhen Picked2==null or stopif GetUnitState(Picked2,UNIT_STATE_LIFE)>.405 and GetOwningPlayer(Picked2)==p and GetUnitTypeId(Picked2)=='h00U' and LoadStr(udg_hash,GetHandleId(Picked2),3)=="Im missile" then
set hmissile=GetHandleId(Picked2)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIob\\AIobSpecialArt.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl",Picked,"chest"))call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,.66)set missile=Picked2call KillUnit(missile)call GroupRemoveUnit(gmissile,missile)call SaveGroupHandle(udg_hash,h,7,gmissile)set ef=LoadEffectHandle(udg_hash,hmissile,2)
call DestroyEffect(ef)call FlushChildHashtable(udg_hash,hmissile)set ef=nullset missile=null
set stop=trueendifcall GroupRemoveUnit(gdamage,Picked2)endloopcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call GroupRemoveUnit(gdamage2,Picked)endloopelse
if wait>0 thenloop
set missile=FirstOfGroup(gmissile)exitwhen missile==nullcall KillUnit(missile)set hmissile=GetHandleId(missile)set ef=LoadEffectHandle(udg_hash,hmissile,2)
call DestroyEffect(ef)call FlushChildHashtable(udg_hash,hmissile)set ef=nullcall GroupRemoveUnit(gmissile,missile)set missile=null
endloopendifcall GroupClear(gmissile)call DestroyGroup(gmissile)set gmissile=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset ef=nullset Picked=nullset Picked2=null
set missile=null
set p=nullcall GroupClear(gmissile2)call DestroyGroup(gmissile2)
set gmissile2=nullcall GroupClear(gdamage2)call DestroyGroup(gdamage2)set gdamage2=nullendfunctionfunction Trig_Ice_Rain_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loclocal real xtlocal real ytlocal real xpointlocal real ypointlocal unit target=GetSpellTargetUnit()local real angle
local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=$AFlocal integer waitcreate=$91
local real damage=150.local group gmissile=CreateGroup()if target!=null then
set xt=GetUnitX(target)set yt=GetUnitY(target)else
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
endifset angle=bj_RADTODEG*Atan2(yt-GetUnitY(caster),xt-GetUnitX(caster))
set xpoint=x-300.*Cos(angle*bj_DEGTORAD)
set ypoint=y-300.*Sin(angle*bj_DEGTORAD)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,wait)call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,xpoint)call SaveReal(udg_hash,h,5,ypoint)call SaveReal(udg_hash,h,6,angle)call SaveGroupHandle(udg_hash,h,7,gmissile)call SaveInteger(udg_hash,h,8,waitcreate)call TimerStart(t,.04,true,function Trig_Ice_Rain_Periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set target=nullset t=nullset gmissile=nullendfunctionfunction Trig_Ice_Rain_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A043'endfunctionfunction InitTrig_Ice_Rain takes nothing returns nothing
local integer index=0set gg_trg_Ice_Rain=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Rain,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Rain,Condition(function Trig_Ice_Rain_Conditions))call TriggerAddAction(gg_trg_Ice_Rain,function Trig_Ice_Rain_Actions)endfunctionfunction Trig_Cold_Punishment_RefreshGroup_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit Picked=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)call GroupRemoveUnit(gdamage,Picked)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset Picked=nullset gdamage=null
endfunctionfunction Trig_Cold_Punishment_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local integer wait=LoadInteger(udg_hash,h,3)
local real damage=LoadReal(udg_hash,h,4)
local real x=LoadReal(udg_hash,h,5)local real y=LoadReal(udg_hash,h,6)local group gdamage=LoadGroupHandle(udg_hash,h,7)local real xtlocal real ytlocal real angle
local group glocal unit Pickedlocal player plocal integer lopa=1
local unit dammi
local effect eflocal boolean destroy=falselocal integer abilitylevellocal timer tPickedlocal integer htPickedlocal real timeif GetUnitState(target,UNIT_STATE_LIFE)>.405 and wait>0 then
set wait=wait-1call SaveInteger(udg_hash,h,3,wait)set g=CreateGroup()set p=GetOwningPlayer(caster)set xt=GetUnitX(target)set yt=GetUnitY(target)set angle=bj_RADTODEG*Atan2(yt-y,xt-x)set x=x+6.*Cos(angle*bj_DEGTORAD)set y=y+6.*Sin(angle*bj_DEGTORAD)call SaveReal(udg_hash,h,5,x)call SaveReal(udg_hash,h,6,y)loop
exitwhen lopa>5set dammi=LoadUnitHandle(udg_hash,h,9+lopa)call SetUnitPosition(dammi,x+75.*Cos((lopa*72)*bj_DEGTORAD),y+75.*Sin((lopa*72)*bj_DEGTORAD))set dammi=nullset lopa=lopa+1endloopcall GroupEnumUnitsInRange(g,x,y,150.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' and IsUnitInGroup(Picked,gdamage)==false thenset abilitylevel=2if Picked==target thenset abilitylevel=4call UnitDamageTarget(caster,Picked,GetUnitState(target,UNIT_STATE_MAX_LIFE)/ 2.5+damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set destroy=true
endifif GetUnitAbilityLevel(Picked,'B005')<=0 or Picked==target thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A039')call SetUnitAbilityLevel(dammi,'A039',abilitylevel)call IssueTargetOrderById(dammi,$D00CB,Picked)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIob\\AIobSpecialArt.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",Picked,"chest"))call GroupAddUnit(gdamage,Picked)set tPicked=CreateTimer()set htPicked=GetHandleId(tPicked)call SaveUnitHandle(udg_hash,htPicked,1,Picked)call SaveGroupHandle(udg_hash,htPicked,2,gdamage)set time=2.5
if IsUnitType(Picked,UNIT_TYPE_HERO)==false then
set time=time*2endifcall TimerStart(tPicked,time,false,function Trig_Cold_Punishment_RefreshGroup_Actions)set tPicked=null
endifendifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,7,gdamage)else
set destroy=true
endifif destroy thenset lopa=1loop
exitwhen lopa>5set dammi=LoadUnitHandle(udg_hash,h,9+lopa)set ef=LoadEffectHandle(udg_hash,h,$E+lopa)call KillUnit(dammi)
call DestroyEffect(ef)set dammi=nullset ef=nullset lopa=lopa+1endloopcall GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset Picked=nullset target=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gdamage=null
set dammi=nullendfunctionfunction Trig_Cold_Punishment_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-GetUnitY(caster),xt-GetUnitX(caster))local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=500local real damage=300.local integer lopa=1
local unit dammi
local effect eflocal player p=GetOwningPlayer(caster)local real xnew=x+200.*Cos(angle*bj_DEGTORAD)local real ynew=y+200.*Sin(angle*bj_DEGTORAD)local group gdamage=CreateGroup()loop
exitwhen lopa>5set dammi=CreateUnit(p,'h00U',xnew+75.*Cos((lopa*72)*bj_DEGTORAD),ynew+75.*Sin((lopa*72)*bj_DEGTORAD),angle)
call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,100.,.0)
set ef=AddSpecialEffectTarget("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl",dammi,"origin")call SaveUnitHandle(udg_hash,h,9+lopa,dammi)
call SaveEffectHandle(udg_hash,h,$E+lopa,ef)
set dammi=nullset ef=nullset lopa=lopa+1endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveInteger(udg_hash,h,3,wait)call SaveReal(udg_hash,h,4,damage)call SaveReal(udg_hash,h,5,xnew)
call SaveReal(udg_hash,h,6,ynew)
call SaveGroupHandle(udg_hash,h,7,gdamage)call TimerStart(t,.03,true,function Trig_Cold_Punishment_Periodic_Actions)set caster=nullset target=nullset t=nullset p=nullset gdamage=null
endfunctionfunction Trig_Cold_Punishment_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A04B'endfunctionfunction InitTrig_Cold_Punishment takes nothing returns nothinglocal integer index=0set gg_trg_Cold_Punishment=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Cold_Punishment,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Cold_Punishment,Condition(function Trig_Cold_Punishment_Conditions))
call TriggerAddAction(gg_trg_Cold_Punishment,function Trig_Cold_Punishment_Actions)endfunctionfunction Trig_Ice_Restoration_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,$D)local integer wait=LoadInteger(udg_hash,h,$E)local real xprestore=LoadReal(udg_hash,h,$F)
local texttag txtxp=LoadTextTagHandle(udg_hash,h,16)
local texttag txtlocal texttag txttime=LoadTextTagHandle(udg_hash,h,17)local integer lop=0local unit dammi
local lightning llocal integer schetchik=0local effect eflocal real angle
local unit Pickedlocal unit dammi2local group gdamagelocal real xtlocal real ytlocal player p=GetOwningPlayer(caster)set wait=wait-1call SaveInteger(udg_hash,h,$E,wait)
call SetTextTagText(txttime,"|cFFAFE6FF "+I2S(R2I(wait/ 5))+"|r",.065)loop
exitwhen lop>3set lop=lop+1set dammi=LoadUnitHandle(udg_hash,h,lop)
if GetUnitState(dammi,UNIT_STATE_LIFE)>.405 and wait>0 thenset schetchik=schetchik+1else
if dammi!=null thenset xt=GetUnitX(dammi)set yt=GetUnitY(dammi)set dammi2=CreateUnit(p,'h00U',xt,yt,.0)
call UnitApplyTimedLife(dammi2,'BTLF',2.)call SetUnitScale(dammi2,2.,2.,2.)call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Shiva'sWrath.mdl",dammi2,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",dammi2,"origin"))set dammi2=nullset gdamage=CreateGroup()call GroupEnumUnitsInRange(gdamage,GetUnitX(dammi),GetUnitY(dammi),250.,null)loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,100.,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi2=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)
call UnitApplyTimedLife(dammi2,'BTLF',2.)call UnitAddAbility(dammi2,'A039')call SetUnitAbilityLevel(dammi2,'A039',2)call IssueTargetOrderById(dammi2,$D00CB,Picked)set dammi2=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIob\\AIobSpecialArt.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl",Picked,"chest"))endifcall GroupRemoveUnit(gdamage,Picked)
endloopset Picked=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call RemoveUnit(dammi)set l=LoadLightningHandle(udg_hash,GetHandleId(dammi),1)
call DestroyLightning(l)
call FlushChildHashtable(udg_hash,GetHandleId(dammi))set l=nullendifendifset dammi=nullendloopif schetchik<=0 or wait<=0 thenif wait<=0 thencall SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)+$3A98)
endifset xprestore=xprestore+$3A98set txt=CreateTextTag()call SetTextTagText(txt,"|cFFAFE6FF +"+I2S(R2I(xprestore))+"!|r",.045)set xt=GetUnitX(caster)+'d'*Cos(180.*bj_DEGTORAD)set yt=GetUnitY(caster)+'d'*Sin(180.*bj_DEGTORAD)call SetTextTagPos(txt,xt+$96*Cos(90.*bj_DEGTORAD),yt+$96*Sin(90.*bj_DEGTORAD),.0)set angle=GetRandomReal(45.,135.)call SetTextTagVelocity(txt,.0101875*Cos(angle*bj_DEGTORAD),.0301875*Sin(angle*bj_DEGTORAD))
call SetTextTagPermanent(txt,false)call SetTextTagColor(txt,$FF,$FF,$FF,$C8)call SetTextTagLifespan(txt,4.)call SetTextTagFadepoint(txt,2.)
set txt=null
call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Shiva'sWrath.mdl",caster,"origin"))call DestroyTextTag(txtxp)call DestroyTextTag(txttime)
call UnitRemoveAbility(caster,'Avul')call PauseUnit(caster,false)
call SetUnitAnimation(caster,"stand")set ef=LoadEffectHandle(udg_hash,h,18)call DestroyEffect(ef)set ef=nullcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
call SaveBoolean(udg_hash,GetHandleId(caster),$A,false)else
set xprestore=xprestore+schetchik*50
call SetTextTagText(txtxp,"|cFFAFE6FF +"+I2S(R2I(xprestore))+"|r",.045)call SaveReal(udg_hash,h,$F,xprestore)call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)+schetchik*50)endifset t=nullset caster=nullset txtxp=nullset txttime=null
set p=nullendfunctionfunction Trig_Ice_Restoration_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real angle=45.
local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait='}'local integer lop=0local unit dammi
local effect eflocal player p=GetOwningPlayer(caster)local real xc=GetRectCenterX(gg_rct_6)local real yc=GetRectCenterY(gg_rct_6)local lightning llocal real xprestore=.0local texttag txtxp=CreateTextTag()local texttag txttime=CreateTextTag()local real xnewlocal real ynewlocal unit dammi2call SetTextTagText(txtxp,"|cFFAFE6FF +"+I2S(R2I(.0))+"|r",.045)
set xnew=x+'d'*Cos(180.*bj_DEGTORAD)
set ynew=y+'d'*Sin(180.*bj_DEGTORAD)
call SetTextTagPos(txtxp,xnew,ynew,.0)call SetTextTagPos(txtxp,xnew+$96*Cos(90.*bj_DEGTORAD),ynew+$96*Sin(90.*bj_DEGTORAD),.0)
call SetTextTagPermanent(txtxp,false)call SetTextTagColor(txtxp,$FF,$FF,$FF,$C8)call SetTextTagText(txttime,"|cFFAFE6FF "+I2S(R2I(wait/ 25))+"|r",.065)set xnew=x+75*Cos(180.*bj_DEGTORAD)set ynew=y+75*Sin(180.*bj_DEGTORAD)call SetTextTagPos(txttime,xnew,ynew,.0)
call SetTextTagPos(txttime,xnew+50*Cos(90.*bj_DEGTORAD),ynew+50*Sin(90.*bj_DEGTORAD),.0)
call SetTextTagPermanent(txttime,false)call SetTextTagColor(txttime,$FF,$FF,$FF,$C8)call UnitAddAbility(caster,'Avul')set ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostArmor\\FrostArmorTarget.mdl",caster,"chest")call SaveEffectHandle(udg_hash,h,18,ef)set ef=nullcall PauseUnit(caster,true)call SetUnitAnimation(caster,"Stand Channel")call SetUnitFacing(caster,270.)loop
exitwhen lop>3set lop=lop+1set dammi=CreateUnit(p,'n007',xc+$41A*Cos(angle*bj_DEGTORAD),yc+$41A*Sin(angle*bj_DEGTORAD),angle+$87)set dammi2=CreateUnit(p,'h00U',GetUnitX(dammi),GetUnitY(dammi),.0)call UnitApplyTimedLife(dammi2,'BTLF',2.)call SetUnitScale(dammi2,2.,2.,2.)call DestroyEffect(AddSpecialEffectTarget("war3mapImported\\Shiva'sWrath.mdl",dammi2,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl",dammi2,"origin"))set dammi2=nullcall SetUnitAnimation(dammi,"Stand Work")call SaveUnitHandle(udg_hash,h,lop,dammi)set ef=AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl",dammi,"overhead")
set l=AddLightningEx("DRAM",true,x,y,100.,GetUnitX(dammi),GetUnitY(dammi),260.)call SaveEffectHandle(udg_hash,h,lop+4,ef)call SaveLightningHandle(udg_hash,GetHandleId(dammi),1,l)set angle=angle+90.set dammi=nullset ef=nullset l=nullendloopcall SaveUnitHandle(udg_hash,h,$D,caster)call SaveInteger(udg_hash,h,$E,wait)
call SaveReal(udg_hash,h,$F,xprestore)call SaveTextTagHandle(udg_hash,h,16,txtxp)call SaveTextTagHandle(udg_hash,h,17,txttime)call TimerStart(t,.2,true,function Trig_Ice_Restoration_Periodic_Actions)set t=nullset caster=nullset p=nullset txtxp=nullset txttime=null
endfunctionfunction Trig_Ice_Restoration_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A04D'endfunctionfunction InitTrig_Ice_Restoration takes nothing returns nothinglocal integer index=0set gg_trg_Ice_Restoration=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Restoration,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Restoration,Condition(function Trig_Ice_Restoration_Conditions))
call TriggerAddAction(gg_trg_Ice_Restoration,function Trig_Ice_Restoration_Actions)endfunctionfunction Trig_BossStart_onbase_Actions takes nothing returns nothing
local timer tonbase=GetExpiredTimer()local integer honbase=GetHandleId(tonbase)local integer ishod=LoadInteger(udg_hash,honbase,3)local unit boss=LoadUnitHandle(udg_hash,honbase,1)local group gruppa=CreateGroup()
local unit Pickedlocal real xc=GetRectCenterX(gg_rct_Respawn_Heroes)local real yc=GetRectCenterY(gg_rct_Respawn_Heroes)local fogmodifier fm=LoadFogModifierHandle(udg_hash,honbase,2)local texttag txtlocal real vel=.0221875local real angle=45.+GetRandomReal(.0,90.)local real xvel=vel*Cos(angle*bj_DEGTORAD)local real yvel=vel*Sin(angle*bj_DEGTORAD)local integer dead=0
local real perekluchatel=.1call ShowAndFlushAllPlayerDamage(false)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(false,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)
call CinematicFadeBJ(0,5.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif perekluchatel>=0 then
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel-50.else
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel+50.endifset xc=GetRectCenterX(gg_rct_Respawn_Heroes)+perekluchatelset yc=GetRectCenterY(gg_rct_Respawn_Heroes)
call ReviveHero(Picked,xc,yc,true)call SetUnitPosition(Picked,xc,yc)call SetUnitFacing(Picked,270.)call SetUnitState(Picked,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(Picked,UNIT_STATE_MANA,$540BE3FF)if ishod==0 then
set txt=CreateTextTag()set dead=LoadInteger(udg_hash,GetHandleId(Picked),1)
if dead==1 thencall SetTextTagText(txt,"|cFFFFFF00+500|r",.035)
call AddHeroXP(Picked,$3E8,true)
call SetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD)+500))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",Picked,"overhead"))if GetLocalPlayer()==GetOwningPlayer(Picked)then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Вы получили "+udg_ColorString[23]+I2S(500)+" золота|r!!!")endifelse
call SetTextTagText(txt,"|cFFFFFF00+1200|r",.045)call AddHeroXP(Picked,$BB8,true)
call SetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD)+$4B0))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",Picked,"overhead"))if GetLocalPlayer()==GetOwningPlayer(Picked)then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Вы получили "+udg_ColorString[23]+I2S($4B0)+" золота|r!!!")endifendifcall SetTextTagPos(txt,GetUnitX(Picked),GetUnitY(Picked),.0)
call SetTextTagColor(txt,0,0,0,50)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,4.)call SetTextTagFadepoint(txt,.0)
set txt=null
endifif(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ResetToGameCamera(.0)if ishod==1 then
call DisplayTextToPlayer(GetOwningPlayer(Picked),0,0,"|cFFFF0000ВЫ ПРОИГРАЛИ БИТВУ С БОССОМ!!!|r")else
call DisplayTextToPlayer(GetOwningPlayer(Picked),0,0,"|cFFFFFF00ВЫ ПОБЕДИЛИ В БИТВЕ С БОССОМ!!!|r")endifcall ResetToGameCamera(.0)call PanCameraToTimed(xc,yc,.0)call SelectUnit(Picked,true)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall EnableTrigger(gg_trg_Hero_Dead)
call DisableTrigger(gg_trg_FlameSpells)call DisableTrigger(gg_trg_Upgrade_Summons)set Picked=nullcall GroupEnumUnitsInRect(gruppa,gg_rct_6,null)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif GetUnitTypeId(Picked)!='h00C' and GetUnitTypeId(Picked)!='h00B' and GetUnitTypeId(Picked)!='h00U' thencall RemoveUnit(Picked)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall StartTimerBJ(udg_Timer_Nomera_Volni,false,75.)call CreateTimerDialogBJ(udg_Timer_Nomera_Volni,("Волна № |cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+"|r")))
set udg_TimerDialog_Nomera_Volni=bj_lastCreatedTimerDialogcall TimerDialogSetTimeColorBJ(udg_TimerDialog_Nomera_Volni,'d',90.,30.,20.)
set udg_Is_Fast_Wave_Start_On_Off=trueset Picked=nullcall RemoveWeatherEffect(udg_BossFightWeather)set udg_BossFightWeather=nullcall FlushChildHashtable(udg_hash,GetHandleId(boss))
call RemoveUnit(boss)set boss=nullcall DestroyFogModifier(fm)set fm=nullcall DestroyGroup(gruppa)set gruppa=nullcall FlushChildHashtable(udg_hash,honbase)call DestroyTimer(tonbase)set tonbase=null
endfunctionfunction Trig_BossStart_end_Actions takes nothing returns nothinglocal timer tend=GetExpiredTimer()local integer hend=GetHandleId(tend)
local unit boss=LoadUnitHandle(udg_hash,hend,1)local fogmodifier fm=CreateFogModifierRect(Player(0),FOG_OF_WAR_VISIBLE,gg_rct_6,true,true)local integer lop=0local integer ishod=LoadInteger(udg_hash,hend,2)
local timer tonbase=CreateTimer()local integer honbase=GetHandleId(tonbase)local group g=CreateGroup()local unit Pickedcall SaveUnitHandle(udg_hash,honbase,1,boss)
call SaveFogModifierHandle(udg_hash,honbase,2,fm)call SaveInteger(udg_hash,honbase,3,ishod)call GroupEnumUnitsInRect(g,gg_rct_6,null)loop
exitwhen lop>9if(GetLocalPlayer()==Player(lop))thencall CameraSetupApplyForceDuration(gg_cam_Camera_BossFightStart,true,.0)
call SetCameraRotateMode(GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6),bj_DEGTORAD*360.,6.)endifset lop=lop+1endloopcall TimerStart(tonbase,6.,false,function Trig_BossStart_onbase_Actions)
if ishod==1 then
call IssuePointOrderById(boss,$D0012,GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6))else
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetOwningPlayer(Picked)==Player($B)thencall KillUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifcall CinematicModeExBJ(true,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)call CinematicFadeBJ(1,6.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call FlushChildHashtable(udg_hash,hend)call DestroyTimer(tend)set tend=nullset boss=nullset fm=nullset tonbase=null
call DestroyGroup(g)
set g=nullendfunctionfunction Trig_BossStart_altars_periodic_Actions takes nothing returns nothinglocal timer taltarsper=GetExpiredTimer()
local integer haltarsper=GetHandleId(taltarsper)
local real x=GetRectCenterX(gg_rct_6)+GetRandomReal(-1000.,1000.)local real y=GetRectCenterY(gg_rct_6)+GetRandomReal(-800.,800.)local integer number=LoadInteger(udg_hash,haltarsper,5)local integer end=LoadInteger(udg_hash,haltarsper,6)
local unit altar=LoadUnitHandle(udg_hash,haltarsper,number)local integer lop=0local effect efset number=number+1if number>=5 thenset number=1
endifcall SaveInteger(udg_hash,haltarsper,5,number)if GetUnitState(altar,UNIT_STATE_LIFE)>.405 then
call IssuePointOrderById(altar,$D0208,x,y)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",GetUnitX(altar),GetUnitY(altar)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",GetUnitX(altar),GetUnitY(altar)))
else
set ef=LoadEffectHandle(udg_hash,GetHandleId(altar),1)call DestroyEffect(ef)call FlushChildHashtable(udg_hash,GetHandleId(altar))set ef=nullendifset altar=nullset end=end-1call SaveInteger(udg_hash,haltarsper,6,end)if end<=0 thenloop
set lop=lop+1exitwhen lop>4set altar=LoadUnitHandle(udg_hash,haltarsper,lop)call KillUnit(altar)
set altar=nullcall FlushChildHashtable(udg_hash,GetHandleId(altar))endloopcall DestroyTimer(taltarsper)call FlushChildHashtable(udg_hash,haltarsper)endifset taltarsper=nullendfunctionfunction Trig_BossStart_altars_Actions takes nothing returns nothing
local timer taltars=GetExpiredTimer()local real xc=GetRectCenterX(gg_rct_6)local real yc=GetRectCenterY(gg_rct_6)local unit Pickedlocal integer number=0local integer end=40
local integer lop=0local real angle=45.
local timer taltarsper=CreateTimer()
local integer haltarsper=GetHandleId(taltarsper)
local effect efloop
exitwhen lop>3set lop=lop+1set Picked=CreateUnit(Player($B),'n00Q',xc+$41A*Cos(angle*bj_DEGTORAD),yc+$41A*Sin(angle*bj_DEGTORAD),angle+$87)
call UnitApplyTimedLife(Picked,'BTLF',60.01)
call SaveUnitHandle(udg_hash,haltarsper,lop,Picked)set ef=AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",Picked,"origin")call SaveEffectHandle(udg_hash,GetHandleId(Picked),1,ef)
set angle=angle+90.set Picked=nullset ef=nullendloopcall SaveInteger(udg_hash,haltarsper,5,number)call SaveInteger(udg_hash,haltarsper,6,end)call TimerStart(taltarsper,1.5,true,function Trig_BossStart_altars_periodic_Actions)
set taltarsper=nullset taltars=null
endfunctionfunction Trig_BossStart_hprestore_Actions takes nothing returns nothinglocal timer thprestore=GetExpiredTimer()
local integer hhprestore=GetHandleId(thprestore)
local unit boss=LoadUnitHandle(udg_hash,hhprestore,1)local integer lop=0local unit array ulocal lightning llocal integer schetchik=0local integer end=LoadInteger(udg_hash,hhprestore,$A)local texttag txtlocal integer endtxt=end-(end/ 5)*5local boolean zaniat=LoadBoolean(udg_hash,GetHandleId(boss),$A)local effect eflocal real angle
local real hpforsolo=(GetUnitState(boss,UNIT_STATE_MAX_LIFE)/ $BB8)local integer hpforall=R2I((GetUnitState(boss,UNIT_STATE_MAX_LIFE)/ $A))
if(endtxt<0)then
set endtxt=endtxt+5endifset end=end+1call SaveInteger(udg_hash,hhprestore,$A,end)
if endtxt==0 thenset txt=CreateTextTag()set angle=GetRandomReal(.0,360.)
call SetTextTagText(txt,"|cFFFF0000"+I2S(20-(end/ 5))+"|r",.055)
call SetTextTagPos(txt,GetUnitX(boss),GetUnitY(boss),.0)
call SetTextTagPermanent(txt,false)call SetTextTagColor(txt,0,0,0,$C8)call SetTextTagVelocity(txt,.0501875*Cos(angle*bj_DEGTORAD),.0501875*Cos(angle*bj_DEGTORAD))
call SetTextTagLifespan(txt,3.5)
call SetTextTagFadepoint(txt,.0)
set txt=null
endifloop
exitwhen lop>4set lop=lop+1set u[lop]=LoadUnitHandle(udg_hash,hhprestore,1+lop)
set l=LoadLightningHandle(udg_hash,GetHandleId(u[lop]),1+lop)if GetUnitState(u[lop],UNIT_STATE_LIFE)>.405 and end<'d' thenset schetchik=schetchik+1call MoveLightningEx(l,true,GetUnitX(boss),GetUnitY(boss),100.,GetUnitX(u[lop]),GetUnitY(u[lop]),5.)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl",GetUnitX(u[lop]),GetUnitY(u[lop])))
else
if end>='d' then
call KillUnit(u[lop])endifif GetUnitState(u[lop],UNIT_STATE_LIFE)<.405 thenendifcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",GetUnitX(u[lop]),GetUnitY(u[lop])))call DestroyLightning(l)
call FlushChildHashtable(udg_hash,GetHandleId(u[lop]))set u[lop]=nullset l=nullendifendloopif schetchik<=0 or end>='d' then
if end>='d' then
call SetUnitState(boss,UNIT_STATE_LIFE,GetUnitState(boss,UNIT_STATE_LIFE)+hpforall)set txt=CreateTextTag()call SetTextTagText(txt,"|cFFFF0000 +"+I2S(hpforall)+"!|r",.055)
call SetTextTagPos(txt,GetUnitX(boss),GetUnitY(boss),.0)
call SetTextTagPermanent(txt,false)call SetTextTagColor(txt,0,0,0,$C8)call SetTextTagVelocity(txt,.0101875*Cos(GetRandomReal(.0,360.)*bj_DEGTORAD),.0301875*Sin(GetRandomReal(.0,360.)*bj_DEGTORAD))call SetTextTagLifespan(txt,3.5)
call SetTextTagFadepoint(txt,.0)
set txt=null
endifcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",GetUnitX(boss),GetUnitY(boss)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",GetUnitX(boss),GetUnitY(boss)))call UnitRemoveAbility(boss,'Avul')set ef=LoadEffectHandle(udg_hash,GetHandleId(boss),$F)call DestroyEffect(ef)set ef=nullcall DestroyTimer(thprestore)call FlushChildHashtable(udg_hash,hhprestore)call PauseUnit(boss,false)call SetUnitAnimation(boss,"stand")set zaniat=false
call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)else
call SetUnitState(boss,UNIT_STATE_LIFE,GetUnitState(boss,UNIT_STATE_LIFE)+(schetchik*hpforsolo))
endifset thprestore=nullset boss=nullendfunctionfunction Trig_BossStart_ActionWithWait_Actions takes nothing returns nothing
local timer twact=GetExpiredTimer()local integer hwact=GetHandleId(twact)local unit boss=LoadUnitHandle(udg_hash,hwact,1)
local effect ef=LoadEffectHandle(udg_hash,hwact,2)local integer lop=0local real xboss=GetUnitX(boss)local real yboss=GetUnitY(boss)local real angle=0local unit array ulocal timer thprestore=CreateTimer()
local integer hhprestore=GetHandleId(thprestore)
local integer end=0call TimerStart(thprestore,.2,true,function Trig_BossStart_hprestore_Actions)call PauseUnit(boss,true)call SetUnitPathing(boss,true)call SetUnitAnimationByIndex(boss,7)
call SaveUnitHandle(udg_hash,hhprestore,1,boss)call SaveInteger(udg_hash,hhprestore,$A,end)
loop
exitwhen lop>4set lop=lop+1set u[lop]=CreateUnit(Player($B),'n00L',xboss+500*Cos(angle*bj_DEGTORAD),yboss+500*Sin(angle*bj_DEGTORAD),angle+$B4)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",xboss+500*Cos(angle*bj_DEGTORAD),yboss+500*Sin(angle*bj_DEGTORAD)))call UnitApplyTimedLife(u[lop],'BTLF',20.)call UnitAddAbility(u[lop],'Abun')call UnitAddType(u[lop],UNIT_TYPE_PEON)call PauseUnit(u[lop],true)call SetUnitAnimationByIndex(u[lop],2)call SetUnitMoveSpeed(u[lop],0)set bj_lastCreatedLightning=AddLightningEx("AFOD",true,xboss,yboss,100.,GetUnitX(u[lop]),GetUnitY(u[lop]),5.)call SaveUnitHandle(udg_hash,hhprestore,1+lop,u[lop])call SaveLightningHandle(udg_hash,GetHandleId(u[lop]),1+lop,bj_lastCreatedLightning)
set angle=angle+72set u[lop]=nullendloopcall DestroyTimer(twact)
set twact=nullcall FlushChildHashtable(udg_hash,hwact)
set boss=nullcall DestroyEffect(ef)set ef=nullset thprestore=nullendfunctionfunction Trig_BossStart_vulcano_Actions takes nothing returns nothinglocal timer tvul=GetExpiredTimer()local unit boss=LoadUnitHandle(udg_hash,GetHandleId(tvul),1)
local boolean zaniat=LoadBoolean(udg_hash,GetHandleId(boss),$A)local effect ef=LoadEffectHandle(udg_hash,GetHandleId(boss),$F)set zaniat=false
call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call DestroyEffect(ef)set ef=nullcall UnitRemoveAbility(boss,'Avul')call FlushChildHashtable(udg_hash,GetHandleId(tvul))
endfunctionfunction Trig_BossStart_golems_Actions takes nothing returns nothing
local timer tgol=GetExpiredTimer()local unit boss=LoadUnitHandle(udg_hash,GetHandleId(tgol),1)
local boolean zaniat=LoadBoolean(udg_hash,GetHandleId(boss),$A)set zaniat=false
call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call FlushChildHashtable(udg_hash,GetHandleId(tgol))
endfunctionfunction Trig_BossStart_hpcheck_Actions takes nothing returns nothinglocal real xc=GetRectCenterX(gg_rct_6)local real yc=GetRectCenterY(gg_rct_6)local timer thpcheck=GetExpiredTimer()local integer hhpcheck=GetHandleId(thpcheck)
local unit boss=LoadUnitHandle(udg_hash,hhpcheck,1)local integer stage=LoadInteger(udg_hash,hhpcheck,2)
local integer dammicheck=LoadInteger(udg_hash,hhpcheck,4)local real dx=GetUnitX(boss)-xclocal real dy=GetUnitY(boss)-yclocal timer twact=CreateTimer()local integer hwact=GetHandleId(twact)local timer taltarslocal boolean zaniat=LoadBoolean(udg_hash,GetHandleId(boss),$A)local integer cdvul=LoadInteger(udg_hash,GetHandleId(boss),$B)local integer cdgol=LoadInteger(udg_hash,GetHandleId(boss),$C)local group grp=CreateGroup()local timer tvul
local timer tgol
local group heroes=CreateGroup()
local group heroes2local unit targetherolocal group heroes2dummi
local unit Pickedlocal integer kolvo=0local integer random=GetRandomInt(1,4)local timer tend
local integer hendlocal integer ishod=0local effect eflocal player p=Player($C)local integer itemrand=R2I($F+5*CountPlayersInForceBJ(udg_IGRAET))local real itemx=(GetRandomReal(-1350.,100.))local real itemy=(GetRandomReal(1900.,3450.))local unit dammi
local group geroi=CreateGroup()local real maxhp=GetUnitState(boss,UNIT_STATE_MAX_LIFE)if GetRandomInt(1,'d')<=itemrand thencall CreatePotion(itemx,itemy,3,6)endifif(zaniat==false and stage==0 and GetUnitState(boss,UNIT_STATE_LIFE)>(maxhp*.566)and GetUnitState(boss,UNIT_STATE_LIFE)<(maxhp*.733))or(stage==1 and GetUnitState(boss,UNIT_STATE_LIFE)>(maxhp*.3)and GetUnitState(boss,UNIT_STATE_LIFE)<(maxhp*.466))or(stage==2 and GetUnitState(boss,UNIT_STATE_LIFE)>(maxhp*.03)and GetUnitState(boss,UNIT_STATE_LIFE)<(maxhp*.2))thenset stage=stage+1set zaniat=truecall SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,hhpcheck,2,stage)call SaveUnitHandle(udg_hash,hwact,1,boss)if SquareRoot(dx*dx+dy*dy)>500 thencall IssuePointOrderById(boss,$D0012,xc+GetRandomReal(-250.,250.),yc+GetRandomReal(-250.,250.))call SetUnitPathing(boss,false)call TimerStart(twact,4.,false,function Trig_BossStart_ActionWithWait_Actions)else
call TimerStart(twact,.25,false,function Trig_BossStart_ActionWithWait_Actions)endifcall UnitAddAbility(boss,'Avul')
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedTarget.mdl",boss,"chest")call SaveEffectHandle(udg_hash,GetHandleId(boss),$F,ef)endifif cdgol>0 thencall SaveInteger(udg_hash,GetHandleId(boss),$C,cdgol-1)endifcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,geroi)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,grp)
loop
set Picked=FirstOfGroup(grp)
exitwhen Picked==nullif IsUnitType(Picked,UNIT_TYPE_HERO) and GetPlayerId(GetOwningPlayer(Picked))<=8 and Picked!=boss thencall GroupAddUnit(heroes,Picked)
endifcall GroupRemoveUnit(grp,Picked)
endloopcall FilterMostNearUnit(heroes,boss)
set Picked=nullcall AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodSorceress.mdl",udg_Unit_FilterMostNearUnit,"chest")set dammicheck=dammicheck+1if dammicheck==7 or dammicheck==$E or dammicheck==21 thenset heroes2dummi=CreateGroup()set heroes2=CreateGroup()call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,heroes2dummi)call RandomUnitFromGroup(1,heroes2dummi)
call GroupAddGroup(udg_GroupRandomUnitFromGroup,heroes2)
set targethero=FirstOfGroup(heroes2)
set dammi=CreateUnit(Player($B),'h00U',GetUnitX(boss),GetUnitY(boss),.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0O4')call IssuePointOrderById(dammi,$D0201,GetUnitX(targethero),GetUnitY(targethero))
call GroupClear(heroes2dummi)call DestroyGroup(heroes2dummi)set heroes2dummi=nullcall GroupClear(heroes2)
call DestroyGroup(heroes2)set heroes2=null
set targethero=nullset dammi=nullendifif dammicheck==$A or dammicheck==20 then
set dammi=CreateUnit(Player($B),'h00U',GetUnitX(boss),GetUnitY(boss),.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A06J')call IssueTargetOrderById(dammi,$D02BC,udg_Unit_FilterMostNearUnit)endifif dammicheck==21 thenset dammicheck=0
endifcall SaveInteger(udg_hash,hhpcheck,4,dammicheck)
if zaniat==false and GetRandomInt(2,4)<=2 thenif random==1 thenif udg_Unit_FilterMostNearUnit!=null thencall IssuePointOrderById(boss,$D009D,GetUnitX(udg_Unit_FilterMostNearUnit),GetUnitY(udg_Unit_FilterMostNearUnit))endifendifif random==2 and SquareRoot(dx*dx+dy*dy)<700 and cdgol<=0 thencall IssueImmediateOrderById(boss,$D0080)set zaniat=trueset tgol=CreateTimer()call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,GetHandleId(boss),$C,20)call SaveUnitHandle(udg_hash,GetHandleId(tgol),1,boss)call TimerStart(tgol,4.,false,function Trig_BossStart_golems_Actions)set tgol=nullendifif random==4 and SquareRoot(dx*dx+dy*dy)<700 thencall IssueImmediateOrderById(boss,$D00B1)endifendifif SquareRoot(dx*dx+dy*dy)>$4B0 and zaniat==false thencall SetUnitPosition(boss,xc,yc)
endifcall GroupClear(heroes)if GetUnitState(boss,UNIT_STATE_LIFE)<.405 thenset tend=CreateTimer()set hend=GetHandleId(tend)call SaveInteger(udg_hash,hend,2,ishod)call SaveUnitHandle(udg_hash,hend,1,boss)call TimerStart(tend,3.,false,function Trig_BossStart_end_Actions)set taltars=LoadTimerHandle(udg_hash,hhpcheck,3)
call FlushChildHashtable(udg_hash,GetHandleId(taltars))call DestroyTimer(taltars)call GroupEnumUnitsInRect(heroes,gg_rct_6,null)call DestroyTimer(thpcheck)set tend=nullcall FlushChildHashtable(udg_hash,hhpcheck)endifcall GroupClear(heroes)loop
set Picked=FirstOfGroup(geroi)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)<.405 thenset kolvo=kolvo+1call SaveInteger(udg_hash,GetHandleId(Picked),1,1)endifcall GroupRemoveUnit(geroi,Picked)endloopset Picked=nullif kolvo>=CountUnitsInGroup(udg_Gruppa_HeroUnitov_Geroev)thenset tend=CreateTimer()set hend=GetHandleId(tend)call SaveInteger(udg_hash,hend,2,ishod+1)call SaveUnitHandle(udg_hash,hend,1,boss)set taltars=LoadTimerHandle(udg_hash,hhpcheck,3)
call FlushChildHashtable(udg_hash,GetHandleId(taltars))call DestroyTimer(taltars)call TimerStart(tend,3.,false,function Trig_BossStart_end_Actions)call DestroyTimer(thpcheck)set tend=nullcall FlushChildHashtable(udg_hash,hhpcheck)endifset thpcheck=nullset boss=nullset twact=nullcall GroupClear(grp)
call DestroyGroup(grp)set grp=null
call GroupClear(heroes)call DestroyGroup(heroes)call GroupClear(geroi)call DestroyGroup(geroi)
set geroi=nullset heroes=nullset p=nullset dammi=nullendfunctionfunction Trig_BossStart_frasa_Actions takes nothing returns nothinglocal timer tfrasa=GetExpiredTimer()
local integer hfrasa=GetHandleId(tfrasa)
local unit boss=LoadUnitHandle(udg_hash,hfrasa,1)local integer random=GetRandomInt(1,4)if GetUnitState(boss,UNIT_STATE_LIFE)>.405 thenif random==1 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"Pyrovulcanous the Sunderer",gg_snd_HeroFirelordWarcry1,"|cFFFF0000Всех сожгу!!!......Один останусь!!!|r",0,4.77,false)endifif random==2 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"Pyrovulcanous the Sunderer",gg_snd_HeroFirelordYesAttack1,"|cFFFF0000Сожгу!!!......|r",0,2.13,false)
endifif random==3 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"Pyrovulcanous the Sunderer",gg_snd_HeroFirelordYesAttack2,"|cFFFF0000Всё поглотит огонь!!!...|r",0,3.2,false)
endifif random==4 thencall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"Pyrovulcanous the Sunderer",gg_snd_HeroFirelordYesAttack3,"|cFFFF0000Испепелю!!!...|r",0,2.49,false)endifelse
call FlushChildHashtable(udg_hash,hfrasa)call DestroyTimer(tfrasa)endifset tfrasa=nullset boss=nullendfunctionfunction Trig_BossStart_5sec_Actions takes nothing returns nothinglocal timer t5sec=GetExpiredTimer()local integer h5sec=GetHandleId(t5sec)local unit boss=LoadUnitHandle(udg_hash,h5sec,1)
local group gruppa=CreateGroup()
local unit Pickedlocal timer tfrasa=CreateTimer()
local integer hfrasa=GetHandleId(tfrasa)
local timer thpcheck=CreateTimer()local integer hhpcheck=GetHandleId(thpcheck)
local integer stage=0local timer taltars=CreateTimer()local boolean zaniat=falsecall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(false,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)
loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall PauseUnit(Picked,false)
call IssueTargetOrderById(Picked,$D000F,boss)if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ClearSelection()call SelectUnit(Picked,true)
call ResetToGameCamera(.0)call PanCameraToTimed(GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6),.0)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall PauseUnit(boss,false)call IssuePointOrderById(boss,$D0012,GetRectCenterX(gg_rct_6),GetRectCenterY(gg_rct_6))call SaveUnitHandle(udg_hash,hfrasa,1,boss)call TimerStart(tfrasa,14.,true,function Trig_BossStart_frasa_Actions)call SaveUnitHandle(udg_hash,hhpcheck,1,boss)call SaveInteger(udg_hash,hhpcheck,2,stage)call SaveTimerHandle(udg_hash,hhpcheck,3,taltars)call SaveBoolean(udg_hash,GetHandleId(boss),$A,zaniat)call SaveInteger(udg_hash,GetHandleId(boss),$B,0)call SaveInteger(udg_hash,GetHandleId(boss),$C,0)call SaveInteger(udg_hash,hhpcheck,4,0)call TimerStart(thpcheck,1.,true,function Trig_BossStart_hpcheck_Actions)call TimerStart(taltars,61.,true,function Trig_BossStart_altars_Actions)
call DestroyTimer(t5sec)
call FlushChildHashtable(udg_hash,h5sec)
set t5sec=nullset boss=nullset Picked=nullset tfrasa=nullset thpcheck=nullset taltars=null
call GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullendfunctionfunction Trig_BossStart_3sec_Actions takes nothing returns nothinglocal timer t3sec=GetExpiredTimer()local integer h3sec=GetHandleId(t3sec)local timer t5sec=CreateTimer()local integer h5sec=GetHandleId(t5sec)local unit boss=LoadUnitHandle(udg_hash,h3sec,1)
call SaveUnitHandle(udg_hash,h5sec,1,boss)call TimerStart(t5sec,5.25,false,function Trig_BossStart_5sec_Actions)call ForceCinematicSubtitles(true)call TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,boss,"Pyrovulcanous the Sunderer",gg_snd_HeroFirelordWarcry1,"|cFFFF0000Всех сожгу!!!......Один останусь!!!|r",0,5.07,false)call DestroyTimer(t3sec)
call FlushChildHashtable(udg_hash,h3sec)
set t3sec=nullset t5sec=nullset boss=nullendfunctionfunction Trig_BossStart_Actions takes nothing returns nothinglocal real xc=GetRectCenterX(gg_rct_6)local real yc=GetRectCenterY(gg_rct_6)local real xp=xc-1216.local real yp=yc+1088.local integer random
local integer end=1local group gruppa=CreateGroup()
local unit Pickedlocal real dist=-350
local unit boss=CreateUnit(Player($B),'N00J',(xc-500),yc,.0)
local timer t3sec=CreateTimer()local integer h3sec=GetHandleId(t3sec)set udg_BossFightWeather=AddWeatherEffect(gg_rct_6,'FDrh')call EnableWeatherEffect(udg_BossFightWeather,true)call DisableTrigger(gg_trg_Hero_Dead)call EnableTrigger(gg_trg_FlameSpells)call EnableTrigger(gg_trg_Upgrade_Summons)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(true,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)call CinematicFadeBJ(1,.0,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call CinematicFadeBJ(0,8.25,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call SetAttackSpeedAbilityLevel(boss,$F*CountPlayersInForceBJ(udg_IGRAET))call SetAttackAbilityLevel(boss,30*CountPlayersInForceBJ(udg_IGRAET))call SetArmorAbilityLevel(boss,5*CountPlayersInForceBJ(udg_IGRAET))call SetUnitMaxState(boss,UNIT_STATE_MAX_LIFE,R2I(3000.*CountPlayersInForceBJ(udg_IGRAET)))loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall SetUnitPosition(Picked,(xc+500),(yc+dist))call SetUnitFacing(Picked,bj_RADTODEG*Atan2(yc-GetUnitY(Picked),xc-GetUnitX(Picked)))call PauseUnit(Picked,true)call ClearSelection()set dist=dist+'d'if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall CameraSetupApplyForceDuration(gg_cam_Camera_BossFightStart,true,.0)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall SetHeroLevel(boss,30,false)
call AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",boss,"chest")call AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",boss,"hand,right")call AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",boss,"hand,left")call AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire2.mdl",boss,"head")call UnitAddAbility(boss,'A05T')
call UnitAddAbility(boss,'A051')
call UnitAddAbility(boss,'A05U')
call UnitAddAbility(boss,'A004')
call PauseUnit(boss,true)call SaveUnitHandle(udg_hash,h3sec,1,boss)call TimerStart(t3sec,3.,false,function Trig_BossStart_3sec_Actions)
call ShowAndFlushAllPlayerDamage(true)call TimerStart(udg_TimerShowAndFlushAllPlayerDmg,10000.,false,null)
loop
exitwhen end>16set yp=yp-$80set bj_forLoopAIndex=1loop
exitwhen bj_forLoopAIndex>20
set random=GetRandomInt(1,$A)if random>=1 and random<=3 thencall SetTerrainType(xp,yp,'Ddrt',-1,2,1)
else
if random>=4 and random<=7 thencall SetTerrainType(xp,yp,'Dlvc',-1,2,1)
else
call SetTerrainType(xp,yp,'Dlav',-1,2,1)
endifendifset xp=xp+$80set bj_forLoopAIndex=bj_forLoopAIndex+1endloopset end=end+1set xp=xc-1216.endloopset Picked=nullset boss=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset t3sec=nullendfunctionfunction InitTrig_BossStart takes nothing returns nothingset gg_trg_BossStart=CreateTrigger()
call TriggerAddAction(gg_trg_BossStart,function Trig_BossStart_Actions)endfunctionfunction Trig_FlameSpells_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A05T' or GetSpellAbilityId()=='A05U'endfunctionfunction Trig_FlameSpells_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local real xu=LoadReal(udg_hash,h,1)
local real yu=LoadReal(udg_hash,h,2)
local real angle=LoadReal(udg_hash,h,3)local integer i=LoadInteger(udg_hash,h,4)local unit caster=LoadUnitHandle(udg_hash,h,5)local real x=xu+400*Cos((angle+i*'x')*bj_DEGTORAD)local real y=yu+400*Sin((angle+i*'x')*bj_DEGTORAD)local unit u
local unit unlocal boolean zaniat=LoadBoolean(udg_hash,GetHandleId(caster),$A)local effect ef=LoadEffectHandle(udg_hash,GetHandleId(caster),$F)set i=i+1call SaveInteger(udg_hash,h,4,i)
if i<4 thenset u=CreateUnit(GetOwningPlayer(caster),'h00U',xu,yu,.0)set un=CreateUnit(GetOwningPlayer(caster),'h00U',xu,yu,.0)call UnitApplyTimedLife(u,'BTLF',2.)
call UnitAddAbility(u,'A055')call UnitAddAbility(un,'A05A')call SetUnitAbilityLevel(u,'A055',1)
call IssuePointOrderById(u,$D0100,x,y)call IssuePointOrderById(un,$D0208,x,y)else
set zaniat=false
call SaveBoolean(udg_hash,GetHandleId(caster),$A,zaniat)
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
call PauseUnit(caster,false)
call UnitRemoveAbility(caster,'Avul')call SetUnitAnimation(caster,"stand")call DestroyEffect(ef)endifset t=nullset u=nullset un=nullset caster=nullset ef=nullendfunctionfunction Trig_FlameSpells_Actions takes nothing returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local real x
local real y
local real angle=0local integer lop=0local location loclocal unit u=GetSpellAbilityUnit()local effect efif GetSpellAbilityId()=='A05T' thencall PauseUnit(u,true)call UnitAddAbility(u,'Avul')set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedTarget.mdl",u,"chest")call SaveEffectHandle(udg_hash,GetHandleId(u),$F,ef)
call SetUnitAnimationByIndex(u,7)call SaveReal(udg_hash,h,1,GetUnitX(u))call SaveReal(udg_hash,h,2,GetUnitY(u))call SaveReal(udg_hash,h,3,GetUnitFacing(u))
call SaveInteger(udg_hash,h,4,0)
call SaveUnitHandle(udg_hash,h,5,u)call TimerStart(t,1.,true,function Trig_FlameSpells_Periodic_Actions)set ef=nullendifif GetSpellAbilityId()=='A05U' thenset loc=GetSpellTargetLoc()set x=GetLocationX(loc)set y=GetLocationY(loc)loop
exitwhen lop>4set lop=lop+1call CreateUnit(GetOwningPlayer(u),'n00L',x+$96*Cos(angle*bj_DEGTORAD),y+$96*Sin(angle*bj_DEGTORAD),GetUnitFacing(u))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",x+$96*Cos(angle*bj_DEGTORAD),y+$96*Sin(angle*bj_DEGTORAD)))call UnitApplyTimedLife(bj_lastCreatedUnit,'BTLF',GetRandomReal(40.,60.))set angle=angle+72endloopcall RemoveLocation(loc)
set loc=null
endifset t=nullset u=nullendfunctionfunction InitTrig_FlameSpells takes nothing returns nothinglocal integer index=0set gg_trg_FlameSpells=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_FlameSpells,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_FlameSpells,Condition(function Trig_FlameSpells_Conditions))
call TriggerAddAction(gg_trg_FlameSpells,function Trig_FlameSpells_Actions)endfunctionfunction Trig_Fire_Circle_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local real angle=LoadReal(udg_hash,h,4)local integer waitcreate=LoadInteger(udg_hash,h,6)local integer wait=LoadInteger(udg_hash,h,7)
local real damage=LoadReal(udg_hash,h,8)
local integer counter=LoadInteger(udg_hash,h,9)local group gdamage=CreateGroup()local group gdamage2=CreateGroup()local unit Pickedlocal player p=GetOwningPlayer(caster)local effect eflocal integer lopalocal real xnewlocal real ynewlocal real xchecklocal real ycheckif waitcreate>0 then
set waitcreate=waitcreate-1call SaveInteger(udg_hash,h,6,waitcreate)set xcheck=x+500.*Cos(angle+((40-waitcreate)*9.)*bj_DEGTORAD)set ycheck=y+500.*Sin(angle+((40-waitcreate)*9.)*bj_DEGTORAD)if(waitcreate-(waitcreate/ 2)*2)==0 and IsTerrainPathable(xcheck,ycheck,PATHING_TYPE_FLYABILITY)==false then
set counter=counter+1set ef=AddSpecialEffect("Doodads\\Cinematic\\TownBurningFireEmitter\\TownBurningFireEmitter.mdl",xcheck,ycheck)call SaveEffectHandle(udg_hash,h,counter,ef)
set ef=nullcall SaveInteger(udg_hash,h,9,counter)endifendifif wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,7,wait)set lopa=$Aloop
exitwhen lopa>counterset xnew=x+500.*Cos(angle+(lopa*18.)*bj_DEGTORAD)set ynew=y+500.*Sin(angle+(lopa*18.)*bj_DEGTORAD)call GroupEnumUnitsInRange(gdamage,xnew,ynew,150.,null)call GroupAddGroup(gdamage,gdamage2)
set lopa=lopa+1endlooploop
set Picked=FirstOfGroup(gdamage2)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,(damage/ 25.),false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)if(wait-(wait/ $F)*$F)==0 thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\FlameStrike\\FlameStrikeEmbers.mdl",Picked,"chest"))endifendifcall GroupRemoveUnit(gdamage2,Picked)endloopelse
set lopa=$Aloop
exitwhen lopa>counterset ef=LoadEffectHandle(udg_hash,h,lopa)
call DestroyEffect(ef)set ef=nullset lopa=lopa+1endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset ef=nullset Picked=nullset p=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call GroupClear(gdamage2)call DestroyGroup(gdamage2)set gdamage2=nullendfunctionfunction Trig_Fire_Circle_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real angle=GetUnitFacing(caster)local real xt=x+500.*Cos(angle*bj_DEGTORAD)local real yt=y+500.*Sin(angle*bj_DEGTORAD)local timer t=CreateTimer()local integer h=GetHandleId(t)local integer waitcreate=20*2local integer wait=390local integer counter=9local real damage=40.+20.*CountPlayersInForceBJ(udg_IGRAET)call TimerStart(t,.04,true,function Trig_Fire_Circle_Periodic_Actions)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SaveReal(udg_hash,h,4,angle)call SaveInteger(udg_hash,h,6,waitcreate)call SaveInteger(udg_hash,h,7,wait)call SaveReal(udg_hash,h,8,damage)call SaveInteger(udg_hash,h,9,counter)set caster=nullset t=nullendfunctionfunction Trig_Fire_Circle_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A004'endfunctionfunction InitTrig_Fire_Circle takes nothing returns nothinglocal integer index=0set gg_trg_Fire_Circle=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Circle,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Circle,Condition(function Trig_Fire_Circle_Conditions))
call TriggerAddAction(gg_trg_Fire_Circle,function Trig_Fire_Circle_Actions)endfunctionfunction Trig_Fire_Meteor_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit casterlocal real damagelocal real stuntimelocal integer wait=LoadInteger(udg_hash,h,4)
local unit circlelocal effect eflocal real xtlocal real ytlocal player plocal group glocal unit Pickedlocal unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,4,wait)if wait==24 then
set xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)call DestroyEffect(AddSpecialEffect("Effects\\MeteorStrike.mdl",xt,yt))endifelse
set caster=LoadUnitHandle(udg_hash,h,1)set circle=LoadUnitHandle(udg_hash,h,6)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall RemoveUnit(circle)set damage=LoadReal(udg_hash,h,2)set stuntime=LoadReal(udg_hash,h,3)set xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)set p=GetOwningPlayer(caster)set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,200.,null)set dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0O5')call IssuePointOrderById(dammi,$D0208,xt,yt)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,stuntime)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\FireBall.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopset ef=LoadEffectHandle(udg_hash,h,$E)call DestroyEffect(ef)set ef=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall DestroyTimer(t)
set Picked=nullset caster=nullset circle=nullset dammi=nullcall FlushChildHashtable(udg_hash,h)
endifset t=nullendfunctionfunction Trig_Fire_Meteor_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real damage=200.+40.*CountPlayersInForceBJ(udg_IGRAET)
local real stuntime=4.local real time=3.local unit circle=CreateUnit(GetOwningPlayer(caster),'h00U',xt,yt,270.)local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\CommandAura\\CommandAuraTarget.mdl",circle,"origin")
local timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitScale(circle,4.,4.,4.)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveReal(udg_hash,h,3,stuntime)
call SaveInteger(udg_hash,h,4,R2I(time/ .03))call SaveUnitHandle(udg_hash,h,6,circle)
call SaveEffectHandle(udg_hash,h,7,ef)call SaveReal(udg_hash,h,$B,xt)call SaveReal(udg_hash,h,$C,yt)call TimerStart(t,.03,true,function Trig_Fire_Meteor_Move_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset circle=nullset ef=nullendfunctionfunction Trig_Fire_Meteor_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0O4'endfunctionfunction InitTrig_Fire_Meteor takes nothing returns nothinglocal integer index=0set gg_trg_Fire_Meteor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Meteor,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Meteor,Condition(function Trig_Fire_Meteor_Conditions))
call TriggerAddAction(gg_trg_Fire_Meteor,function Trig_Fire_Meteor_Actions)endfunctionfunction Trig_Upgrade_Summons_Actions takes nothing returns nothinglocal unit summon=GetEnteringUnit()local integer h=GetUnitTypeId(summon)if h=='n00L' thencall SetAttackAbilityLevel(summon,5*CountPlayersInForceBJ(udg_IGRAET))call SetUnitMaxState(summon,UNIT_STATE_MAX_LIFE,R2I(75.*CountPlayersInForceBJ(udg_IGRAET)))endifif h=='n00M' thencall SetAttackAbilityLevel(summon,3*CountPlayersInForceBJ(udg_IGRAET))call SetUnitMaxState(summon,UNIT_STATE_MAX_LIFE,R2I(30.*CountPlayersInForceBJ(udg_IGRAET)))endifif h=='n00N' thencall SetAttackAbilityLevel(summon,$C*CountPlayersInForceBJ(udg_IGRAET))call SetUnitMaxState(summon,UNIT_STATE_MAX_LIFE,R2I(100.*CountPlayersInForceBJ(udg_IGRAET)))
endifendfunctionfunction Trig_Upgrade_Summons_Conditions takes nothing returns booleanreturn GetOwningPlayer(GetEnteringUnit())==Player($B)endfunctionfunction InitTrig_Upgrade_Summons takes nothing returns nothinglocal region rectRegion=CreateRegion()set gg_trg_Upgrade_Summons=CreateTrigger()call RegionAddRect(rectRegion,gg_rct_6)call TriggerRegisterEnterRegion(gg_trg_Upgrade_Summons,rectRegion,null)call TriggerAddCondition(gg_trg_Upgrade_Summons,Condition(function Trig_Upgrade_Summons_Conditions))
call TriggerAddAction(gg_trg_Upgrade_Summons,function Trig_Upgrade_Summons_Actions)endfunctionfunction Trig_UseBeornSpells_Is_Enemy_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerEnemy(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_UseBeornSpells_Is_Ally_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)<GetUnitState(GetFilterUnit(),UNIT_STATE_MAX_LIFE)*.6)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerAlly(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_UseBeornSpells_Condition takes nothing returns boolean
return(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_UseBeornSpells_Actions takes nothing returns nothinglocal group gall=CreateGroup()local group glocal group g2local unit Pickedlocal unit targetlocal real x
local real y
local real distlocal real angle
call GroupEnumUnitsInRect(gall,bj_mapInitialPlayableArea,Condition(function Trig_UseBeornSpells_Condition))set g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0OD')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_UseBeornSpells_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00CB,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0OC')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,575.,Condition(function Trig_UseBeornSpells_Is_Ally_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00C0,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0OF')>0)and GetRandomInt(1,3)<=2 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,300.,Condition(function Trig_UseBeornSpells_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00BD,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gall)call DestroyGroup(gall)set gall=nullendfunctionfunction InitTrig_UseBeornSpells takes nothing returns nothingset gg_trg_UseBeornSpells=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_UseBeornSpells,1.,true)call TriggerAddAction(gg_trg_UseBeornSpells,function Trig_UseBeornSpells_Actions)endfunctionfunction Trig_Beorn_Den_onbase_Actions takes nothing returns nothing
local timer tonbase=GetExpiredTimer()local integer honbase=GetHandleId(tonbase)local integer ishod=LoadInteger(udg_hash,honbase,3)local unit boss=udg_BeornBosslocal group gruppa=CreateGroup()
local unit Pickedlocal real xc=GetRectCenterX(gg_rct_Respawn_Heroes)local real yc=GetRectCenterY(gg_rct_Respawn_Heroes)local texttag txtlocal real vel=.0221875local real angle=45.+GetRandomReal(.0,90.)local real xvel=vel*Cos(angle*bj_DEGTORAD)local real yvel=vel*Sin(angle*bj_DEGTORAD)local integer dead=0
local real perekluchatel=.1local group g1=CreateGroup()
local group g2=CreateGroup()
local group g3=CreateGroup()
local group g4=CreateGroup()
local group g=CreateGroup()local group grp=CreateGroup()local integer lopb=0
local integer lopa=0
call RemoveUnit(udg_EnergyWallUnit[$A])call RemoveUnit(udg_EnergyWallUnit[$B])set lopb=1loop
exitwhen lopb>$B
call RemoveUnit(udg_EnergyWallUnit[lopb])set lopb=lopb+1endloopset lopb=1set lopa=0loop
exitwhen lopa>$B
set lopa=lopa+1loop
exitwhen lopb>7call RemoveDestructable(udg_EnergyWallBlock[lopa*7+lopb])set lopb=lopb+1endloopset lopb=1endloopcall GroupEnumUnitsInRange(grp,0,0,99999,null)call KillSummonsAndIllusions(grp)call DisableTrigger(gg_trg_UseBeornSpells)call ShowAndFlushAllPlayerDamage(false)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(false,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)
call CinematicFadeBJ(0,5.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,0)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif perekluchatel>=0 then
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel-50.else
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel+50.endifset xc=GetRectCenterX(gg_rct_Respawn_Heroes)+perekluchatelset yc=GetRectCenterY(gg_rct_Respawn_Heroes)
call ReviveHero(Picked,xc,yc,true)call SetUnitPosition(Picked,xc,yc)call SetUnitFacing(Picked,270.)call SetUnitState(Picked,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(Picked,UNIT_STATE_MANA,$540BE3FF)if ishod==2 then
set txt=CreateTextTag()call SetTextTagText(txt,"|cFFFFFF00+800|r",.045)
call SetTextTagPos(txt,GetUnitX(Picked),GetUnitY(Picked),.0)
call SetTextTagColor(txt,0,0,0,50)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,4.)call SetTextTagFadepoint(txt,.0)
set txt=null
call SetHeroStr(Picked,GetHeroStr(Picked,false)+8,true)call SetHeroAgi(Picked,GetHeroAgi(Picked,false)+8,true)call SetHeroInt(Picked,GetHeroInt(Picked,false)+8,true)call SetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetOwningPlayer(Picked),PLAYER_STATE_RESOURCE_GOLD)+800))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIem\\AIemTarget.mdl",Picked,"overhead"))if GetLocalPlayer()==GetOwningPlayer(Picked)then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Вы получили "+udg_ColorString[23]+I2S(800)+" золота|r!!!")call DisplayTextToPlayer(GetLocalPlayer(),0,0,"Все характеристики вашего героя повышены на |cff99ccff8!|r")endifendifif(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ResetToGameCamera(.0)endifif ishod==1 then
call DisplayTextToPlayer(GetOwningPlayer(Picked),0,0,"|cFFFF0000ВЫ ПРОИГРАЛИ БИТВУ С БЕОРНАМИ!!!|r")else
call DisplayTextToPlayer(GetOwningPlayer(Picked),0,0,"|cFFFFFF00ВЫ ПОБЕДИЛИ В БИТВЕ С БЕОРНАМИ!!!|r")endifif(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ResetToGameCamera(.0)call PanCameraToTimed(xc,yc,.0)call SelectUnit(Picked,true)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall EnableTrigger(gg_trg_Hero_Dead)
set Picked=nullcall GroupEnumUnitsInRect(g1,gg_rct_Les_1,null)call GroupEnumUnitsInRect(g2,gg_rct_Les1_Dop1,null)call GroupEnumUnitsInRect(g3,gg_rct_Les1_Dop2,null)call GroupAddGroup(g1,g)
call GroupAddGroup(g2,g)
call GroupAddGroup(g3,g)
call GroupEnumUnitsInRange(g4,.0,.0,999999.,null)loop
set Picked=FirstOfGroup(g4)exitwhen Picked==nullif GetUnitTypeId(Picked)=='n01N' or GetUnitTypeId(Picked)=='n01R' or GetUnitTypeId(Picked)=='n01P' thencall GroupAddUnit(g,Picked)endifcall GroupRemoveUnit(g4,Picked)endloopcall DestroyGroup(g4)set g4=nullloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitTypeId(Picked)!='h00C' and GetUnitTypeId(Picked)!='h00B' and GetUnitTypeId(Picked)!='h00U' thencall RemoveUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall StartTimerBJ(udg_Timer_Nomera_Volni,false,50.)call CreateTimerDialogBJ(udg_Timer_Nomera_Volni,("Волна № |cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+"|r")))
set udg_TimerDialog_Nomera_Volni=bj_lastCreatedTimerDialogcall TimerDialogSetTimeColorBJ(udg_TimerDialog_Nomera_Volni,'d',90.,30.,20.)
set udg_Is_Fast_Wave_Start_On_Off=trueset Picked=nullcall RemoveUnit(boss)set boss=nullcall DestroyGroup(gruppa)set gruppa=nullcall FlushChildHashtable(udg_hash,honbase)call DestroyTimer(tonbase)set tonbase=null
call DisableTrigger(gg_trg_Start_Beorn_Den)endfunctionfunction Trig_Beorn_Den_end_Actions takes nothing returns nothinglocal timer tend=GetExpiredTimer()local integer hend=GetHandleId(tend)
local unit boss=udg_BeornBosslocal integer lop=0local integer ishod=udg_Ishod_S_Beornami
local timer tonbase=CreateTimer()local integer honbase=GetHandleId(tonbase)local group g1=CreateGroup()
local group g2=CreateGroup()
local group g22=CreateGroup()local group g3=CreateGroup()
local group g=CreateGroup()local group gglocal unit Pickedcall DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(boss),$87))
call SaveUnitHandle(udg_hash,honbase,1,boss)
call SaveInteger(udg_hash,honbase,3,ishod)call GroupEnumUnitsInRect(g1,gg_rct_Les_1,null)call GroupEnumUnitsInRect(g2,gg_rct_Les1_Dop1,null)call GroupEnumUnitsInRect(g3,gg_rct_Les1_Dop2,null)call GroupAddGroup(g1,g)
call GroupAddGroup(g2,g)
call GroupAddGroup(g3,g)
loop
exitwhen lop>9if(GetLocalPlayer()==Player(lop))thencall CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den1,true,.0)
call SetCameraRotateMode(GetRectCenterX(gg_rct_Beorn_Boss_Area),GetRectCenterY(gg_rct_Beorn_Boss_Area),bj_DEGTORAD*360.,5.)endifset lop=lop+1endloopcall TimerStart(tonbase,5.,false,function Trig_Beorn_Den_onbase_Actions)
if ishod==1 then
call IssuePointOrderById(boss,$D0012,GetRectCenterX(gg_rct_Beorn_Boss_Area),GetRectCenterY(gg_rct_Beorn_Boss_Area))else
set udg_IsBeronsFightWin=falseset gg=CreateGroup()
call GroupAddGroup(udg_PortalCastersMagi,gg)
loop
set Picked=FirstOfGroup(gg)exitwhen Picked==nullcall UnitAddAbility(Picked,'A0OL')call GroupRemoveUnit(gg,Picked)endloopcall DestroyGroup(gg)set gg=nullloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetOwningPlayer(Picked)==Player($B)thencall KillUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifset g22=CreateGroup()call GroupEnumUnitsInRange(g22,0,0,99999,null)call KillSummonsAndIllusions(g22)call CinematicModeExBJ(true,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)call CinematicFadeBJ(1,5.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call FlushChildHashtable(udg_hash,hend)call DestroyTimer(tend)set tend=nullset boss=nullset tonbase=null
call DestroyGroup(g)
set g=nullendfunctionfunction Trig_Beorn_Den_Boss_hpcheck_Actions takes nothing returns nothinglocal unit boss=udg_BeornBosslocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer maxwait=LoadInteger(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local integer cdskill=LoadInteger(udg_hash,h,3)local integer itemrand=R2I($A+5*CountPlayersInForceBJ(udg_IGRAET))local real itemx=(GetRandomReal(1000.,1650.))local real itemy=(GetRandomReal(-9800.,-10200.))
local unit beorn
if GetUnitState(boss,UNIT_STATE_LIFE)>.405 and udg_BeornBossFightEnd==false then
if GetRandomInt(1,'d')<=itemrand thencall CreatePotion(itemx,itemy,1,4)endifif cdskill<8 thencall SaveInteger(udg_hash,h,3,cdskill+1)
endifif cdskill>=8 thencall IssueImmediateOrderById(boss,$D0105)call SaveInteger(udg_hash,h,3,0)
endifif wait<maxwait then
call SaveInteger(udg_hash,h,2,wait+1)endifif wait>=maxwait thencall SaveInteger(udg_hash,h,2,0)
set beorn=CreateUnit(Player($B),'n01R',itemx,itemy,GetRandomReal(.0,360.))call UnitApplyTimedLife(beorn,'BTLF',60.)set beorn=nullcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",itemx,itemy))
endifelse
call DestroyTimer(t)
endifset boss=nullendfunctionfunction Trig_Beorn_Den_HeroInHeroArea_Check_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer lopblocal group gruppa=CreateGroup()
local group g2local unit Pickedlocal real x
local real y
local integer countrct=0
local real dist=1.call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullset x=GetUnitX(Picked)set y=GetUnitY(Picked)if(GetRectMinX(gg_rct_Beorn_Boss_Area)<=x)and(x<=GetRectMaxX(gg_rct_Beorn_Boss_Area))and(GetRectMinY(gg_rct_Beorn_Boss_Area)<=y)and(y<=GetRectMaxY(gg_rct_Beorn_Boss_Area))thenset countrct=1endifcall GroupRemoveUnit(gruppa,Picked)endloopif countrct==1 thencall CreateEnergyWall($A,$B)
call GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset g2=CreateGroup()
call GroupEnumUnitsInRange(g2,0,0,99999,null)call KillSummonsAndIllusions(g2)
set gruppa=CreateGroup()
call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall SetUnitPosition(Picked,1320.+dist,-9540.)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",1320.+dist,-9540.))
if dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifcall SetUnitFacing(Picked,270.)if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den6,true,1.)
call ClearSelection()call SelectUnit(Picked,true)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall SetAttackAbilityLevel(udg_BeornBoss,$F*CountPlayersInForceBJ(udg_IGRAET))call SetArmorAbilityLevel(udg_BeornBoss,3*CountPlayersInForceBJ(udg_IGRAET))
call SetUnitMaxState(udg_BeornBoss,UNIT_STATE_MAX_LIFE,R2I(800.*CountPlayersInForceBJ(udg_IGRAET)))call SetUnitInvulnerable(udg_BeornBoss,false)call IssueImmediateOrderById(udg_BeornBoss,$D0004)call DestroyTimer(t)
set t=CreateTimer()set h=GetHandleId(t)
call SaveInteger(udg_hash,h,1,R2I(22.-CountPlayersInForceBJ(udg_IGRAET)*2.))
call SaveInteger(udg_hash,h,2,0)
call SaveInteger(udg_hash,h,3,0)
call TimerStart(t,1.,true,function Trig_Beorn_Den_Boss_hpcheck_Actions)set t=nullendifset t=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullendfunctionfunction Trig_Beorn_Den_Shamans_HP_Check_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit sh1=LoadUnitHandle(udg_hash,h,1)local unit sh2=LoadUnitHandle(udg_hash,h,2)local unit sh3=LoadUnitHandle(udg_hash,h,3)local integer lopbif(GetUnitState(sh1,UNIT_STATE_LIFE)<.0 or sh1==null)and(GetUnitState(sh2,UNIT_STATE_LIFE)<.0 or sh2==null)and(GetUnitState(sh3,UNIT_STATE_LIFE)<.0 or sh3==null)thencall DestroyTimer(t)
call RemoveUnit(udg_EnergyWallUnit[$A])call RemoveUnit(udg_EnergyWallUnit[$B])set lopb=1loop
exitwhen lopb>7call RemoveDestructable(udg_EnergyWallBlock[63+lopb])call RemoveDestructable(udg_EnergyWallBlock[70+lopb])set lopb=lopb+1endloopset t=CreateTimer()call TimerStart(t,1.,true,function Trig_Beorn_Den_HeroInHeroArea_Check_Actions)set t=nullendifset t=nullset sh1=null
set sh2=null
set sh3=null
endfunctionfunction Trig_Beorn_Shamans_Animation_Check_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit sh1=LoadUnitHandle(udg_hash,h,1)if GetUnitState(sh1,UNIT_STATE_LIFE)>.405 thencall SetUnitAnimationByIndex(sh1,3)else
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset t=nullset sh1=null
endfunctionfunction Trig_Beorn_Den_HP_Check_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer players=CountPlayersInForceBJ(udg_IGRAET)local integer lopa=1
local integer countmelee=1+R2I(players/ 4)local real dist=1.local integer hlocal unit u
local timer t1local integer h1
if GetUnitState(udg_BeornDenHouse[1],UNIT_STATE_LIFE)<.405 and GetUnitState(udg_BeornDenHouse[2],UNIT_STATE_LIFE)<.405 thencall DestroyTimer(t)
set t=CreateTimer()set h=GetHandleId(t)
set u=CreateUnit(Player($B),'n01Q',1900.,-8000.,270.)call UnitAddAbility(u,'Abun')call UnitAddType(u,UNIT_TYPE_PEON)call PauseUnit(u,true)call SetUnitAnimationByIndex(u,3)call SetUnitMoveSpeed(u,0)set t1=CreateTimer()
set h1=GetHandleId(t1)call SaveUnitHandle(udg_hash,h1,1,u)
call TimerStart(t1,1.,true,function Trig_Beorn_Shamans_Animation_Check_Actions)set t1=nullcall SaveUnitHandle(udg_hash,h,1,u)loop
exitwhen lopa>countmelee
call CreateUnit(Player($B),'n01R',1900.+dist,-8000.,270.)if dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifset lopa=lopa+1endloopset lopa=1set dist=1.set u=CreateUnit(Player($B),'n01Q',2400.,-8850.,90.)
call UnitAddAbility(u,'Abun')call UnitAddType(u,UNIT_TYPE_PEON)call PauseUnit(u,true)call SetUnitAnimationByIndex(u,3)call SetUnitMoveSpeed(u,0)set t1=CreateTimer()
set h1=GetHandleId(t1)call SaveUnitHandle(udg_hash,h1,1,u)
call TimerStart(t1,1.,true,function Trig_Beorn_Shamans_Animation_Check_Actions)set t1=nullcall SaveUnitHandle(udg_hash,h,2,u)loop
exitwhen lopa>countmelee
call CreateUnit(Player($B),'n01R',2400.+dist,-8600.,90.)
if dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifset lopa=lopa+1endloopset lopa=1set dist=1.set u=CreateUnit(Player($B),'n01Q',850.,-8900.,.0)call UnitAddAbility(u,'Abun')call UnitAddType(u,UNIT_TYPE_PEON)call PauseUnit(u,true)call SetUnitAnimationByIndex(u,3)call SetUnitMoveSpeed(u,0)call SaveUnitHandle(udg_hash,h,3,u)set t1=CreateTimer()
set h1=GetHandleId(t1)call SaveUnitHandle(udg_hash,h1,1,u)
call TimerStart(t1,1.,true,function Trig_Beorn_Shamans_Animation_Check_Actions)set t1=nullloop
exitwhen lopa>countmelee
call CreateUnit(Player($B),'n01R',850.+dist,-8700.,.0)if dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifset lopa=lopa+1endloopset lopa=1set dist=1.call TimerStart(t,1.,true,function Trig_Beorn_Den_Shamans_HP_Check_Actions)set t=nullendifset t=nullendfunctionfunction Trig_Beorn_Den_Create_Beorns2_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer players=CountPlayersInForceBJ(udg_IGRAET)local integer countmelee=1+R2I(players/ 3)local integer countrange=1+R2I(players/ 3)local integer lopa=1
local real dist=1.local unit u
local unit herolocal group g=CreateGroup()if GetUnitState(udg_BeornDenHouse[2],UNIT_STATE_LIFE)>.0 thencall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,g)loop
exitwhen lopa>countmelee
set u=CreateUnit(Player($B),'n01N',70.+dist,-8870.,90.)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",GetUnitX(u),GetUnitY(u)))
call RandomUnitFromGroup(1,g)set hero=FirstOfGroup(udg_GroupRandomUnitFromGroup)call IssuePointOrderById(u,$D000F,GetUnitX(hero),GetUnitY(hero))
set u=nullset u=CreateUnit(Player($B),'n01P',70.+dist,-9000.,90.)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",GetUnitX(u),GetUnitY(u)))
call IssuePointOrderById(u,$D000F,GetUnitX(hero),GetUnitY(hero))
set u=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullif dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifset lopa=lopa+1endloopcall TimerStart(t,30.,false,function Trig_Beorn_Den_Create_Beorns2_Actions)else
call DestroyTimer(t)
endifset t=nullendfunctionfunction Trig_Beorn_Den_Create_Beorns_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer players=CountPlayersInForceBJ(udg_IGRAET)local integer countmelee=1+R2I(players/ 3)local integer countrange=1+R2I(players/ 3)local integer lopa=1
local real dist=1.local unit u
local unit herolocal group g=CreateGroup()if GetUnitState(udg_BeornDenHouse[1],UNIT_STATE_LIFE)>.0 thencall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,g)loop
exitwhen lopa>countmelee
set u=CreateUnit(Player($B),'n01N',500.,-8400.+dist,.0)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",GetUnitX(u),GetUnitY(u)))
call RandomUnitFromGroup(1,g)set hero=FirstOfGroup(udg_GroupRandomUnitFromGroup)call IssuePointOrderById(u,$D000F,GetUnitX(hero),GetUnitY(hero))
set u=nullset u=CreateUnit(Player($B),'n01P',300.,-8400.+dist,.0)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",GetUnitX(u),GetUnitY(u)))
call IssuePointOrderById(u,$D000F,GetUnitX(hero),GetUnitY(hero))
set u=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullif dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifset lopa=lopa+1endloopcall TimerStart(t,35.,false,function Trig_Beorn_Den_Create_Beorns_Actions)else
call DestroyTimer(t)
endifset t=nullendfunctionfunction Trig_Start_Beorn_Den_5sec_Actions takes nothing returns nothing
local timer t5sec=GetExpiredTimer()local integer h5sec=GetHandleId(t5sec)local unit boss=LoadUnitHandle(udg_hash,h5sec,1)
local group gruppa=CreateGroup()
local unit Pickedlocal timer tfrasa=CreateTimer()
local integer hfrasa=GetHandleId(tfrasa)
local timer thpcheck=CreateTimer()local integer stage=0local boolean zaniat=falselocal timer tbeorn=CreateTimer()
local timer tbeorn2=CreateTimer()call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(false,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)
loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall PauseUnit(Picked,false)
if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ClearSelection()call SelectUnit(Picked,true)
call ResetToGameCamera(.0)call PanCameraToTimed(2090.,-8300.,.0)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall TimerStart(thpcheck,1.,true,function Trig_Beorn_Den_HP_Check_Actions)call TimerStart(tbeorn,2.,false,function Trig_Beorn_Den_Create_Beorns_Actions)call TimerStart(tbeorn2,17.,false,function Trig_Beorn_Den_Create_Beorns2_Actions)call DestroyTimer(t5sec)
call FlushChildHashtable(udg_hash,h5sec)
set t5sec=nullset boss=nullset Picked=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullendfunctionfunction Trig_Start_Beorn_Den_6sec_Actions takes nothing returns nothing
local timer t3sec=GetExpiredTimer()local integer h3sec=GetHandleId(t3sec)local timer t5sec=CreateTimer()local integer h5sec=GetHandleId(t5sec)local unit boss=LoadUnitHandle(udg_hash,h3sec,1)
local group gruppa=CreateGroup()
local unit Pickedlocal unit support=CreateUnit(Player($F),'h00J',.0,.0,.0)call UnitApplyTimedLife(support,'BTLF',20.)call SaveUnitHandle(udg_hash,h5sec,1,boss)call TimerStart(t5sec,7.,false,function Trig_Start_Beorn_Den_5sec_Actions)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif(GetLocalPlayer()==GetOwningPlayer(Picked))thencall CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den3,true,.0)
call CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den4,true,7.)
endifcall GroupRemoveUnit(gruppa,Picked)endloopcall TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,support,"Помощник",null,"|cff99ccffДля этого уничтожьте две Хижины Беорнов, а затем... Ну, как-нибудь уберите магическую защиту и войдите в логово Старейшины Беорнов. Удачи...|r",0,7.,false)call DestroyTimer(t3sec)
call FlushChildHashtable(udg_hash,h3sec)
set t3sec=nullset t5sec=nullset boss=nullendfunctionfunction Trig_Start_Beorn_Den_4sec_Actions takes nothing returns nothing
local timer t3sec=GetExpiredTimer()local integer h3sec=GetHandleId(t3sec)local timer t6sec=CreateTimer()local integer h6sec=GetHandleId(t6sec)local unit boss=LoadUnitHandle(udg_hash,h3sec,1)
local unit support=CreateUnit(Player($F),'h00J',.0,.0,.0)call UnitApplyTimedLife(support,'BTLF',20.)call SaveUnitHandle(udg_hash,h6sec,1,boss)call TimerStart(t6sec,8.,false,function Trig_Start_Beorn_Den_6sec_Actions)call TransmissionFromUnitWithNameBJ(bj_FORCE_ALL_PLAYERS,support,"Помощник",null,"|cff99ccffУничтожьте Старейшину Беорнов, для того чтобы получить награду золотом, бонусы для своего героя и усилить стражей-заклинателей на базе|r",0,8.,false)call DestroyTimer(t3sec)
call FlushChildHashtable(udg_hash,h3sec)
set t3sec=nullset t6sec=nullset boss=nullendfunctionfunction Trig_Start_Beorn_Den_Check_Rects_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit boss=LoadUnitHandle(udg_hash,h,1)
local group gruppa=CreateGroup()
local unit Pickedlocal real x
local real y
local integer countrctif GetUnitState(boss,UNIT_STATE_LIFE)>.0 thenset x=GetUnitX(boss)
set y=GetUnitY(boss)
if(GetRectMinX(gg_rct_Beorn_Boss_Area2)<=x)and(x<=GetRectMaxX(gg_rct_Beorn_Boss_Area2))and(GetRectMinY(gg_rct_Beorn_Boss_Area2)<=y)and(y<=GetRectMaxY(gg_rct_Beorn_Boss_Area2))thenelse
call SetUnitPosition(boss,1400.,-9900.)call SetUnitFacing(boss,90.)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",1400.,-9900.))endifcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullset x=GetUnitX(Picked)set y=GetUnitY(Picked)set countrct=0if(GetRectMinX(gg_rct_Les_1)<=x)and(x<=GetRectMaxX(gg_rct_Les_1))and(GetRectMinY(gg_rct_Les_1)<=y)and(y<=GetRectMaxY(gg_rct_Les_1))thenset countrct=1endifif(GetRectMinX(gg_rct_Les1_Dop1)<=x)and(x<=GetRectMaxX(gg_rct_Les1_Dop1))and(GetRectMinY(gg_rct_Les1_Dop1)<=y)and(y<=GetRectMaxY(gg_rct_Les1_Dop1))thenset countrct=1endifif(GetRectMinX(gg_rct_Les1_Dop2)<=x)and(x<=GetRectMaxX(gg_rct_Les1_Dop2))and(GetRectMinY(gg_rct_Les1_Dop2)<=y)and(y<=GetRectMaxY(gg_rct_Les1_Dop2))thenset countrct=1endifif countrct==0 thenif(GetLocalPlayer()==GetOwningPlayer(Picked))thencall ClearSelection()call SelectUnit(Picked,true)
call CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den5,true,.0)
endifcall SetUnitPosition(Picked,2090.,-8300.)call SetUnitFacing(Picked,180.)endifcall GroupRemoveUnit(gruppa,Picked)endloopelse
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset t=nullset Picked=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset boss=nullendfunctionfunction Trig_Start_Beorn_Den_Check_Alive_Units_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local group gruppa=CreateGroup()
local unit Pickedlocal integer ishod=0local boolean alive=falselocal boolean start=falseif GetUnitState(udg_BeornBoss,UNIT_STATE_LIFE)<.405 then
set udg_Ishod_S_Beornami=2set start=trueendifcall GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 thenset alive=trueendifcall GroupRemoveUnit(gruppa,Picked)endloopif alive==false then
set udg_Ishod_S_Beornami=1set start=trueendifif start thencall DestroyTimer(t)
set udg_BeornBossFightEnd=trueset t=CreateTimer()call TimerStart(t,1.,false,function Trig_Beorn_Den_end_Actions)endifset t=nullset Picked=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullendfunctionfunction Trig_Start_Beorn_Den_Actions takes nothing returns nothinglocal integer random
local integer end=1local group gruppa=CreateGroup()
local unit Pickedlocal real dist=1.local unit boss=CreateUnit(Player($B),'n01S',1400.,-9950.,90.)local timer t3sec=CreateTimer()local integer h3sec=GetHandleId(t3sec)local timer tobl=CreateTimer()local integer hobl=GetHandleId(tobl)
local timer talive=CreateTimer()
local group grp=CreateGroup()call GroupEnumUnitsInRange(grp,0,0,99999,null)call KillSummonsAndIllusions(grp)call CreateEnergyWall(1,$B)set udg_BeornBoss=bosscall SetUnitInvulnerable(boss,true)call CreateUnit(Player($B),'n01R',1200.,-9900.,90.)call IssueImmediateOrderById(bj_lastCreatedUnit,$D0019)call CreateUnit(Player($B),'n01R',1600.,-9900.,90.)call IssueImmediateOrderById(bj_lastCreatedUnit,$D0019)set udg_BeornDenHouse[1]=CreateUnit(Player($B),'n01O',440.,-8060.,270.)set udg_BeornDenHouse[2]=CreateUnit(Player($B),'n01O',-140.,-9150.,270.)
call DisableTrigger(gg_trg_Hero_Dead)call IssueImmediateOrderById(udg_BeornBoss,$D0019)call EnableTrigger(gg_trg_UseBeornSpells)call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,gruppa)call CinematicModeExBJ(true,bj_FORCE_ALL_PLAYERS,bj_CINEMODE_INTERFACEFADE)call CinematicFadeBJ(1,.0,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call CinematicFadeBJ(0,4.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)loop
set Picked=FirstOfGroup(gruppa)exitwhen Picked==nullcall SetUnitPosition(Picked,2090.,(-8300.+dist))
if dist>.0 thenset dist=-dist-50.else
set dist=-dist+50.endifcall SetUnitFacing(Picked,180.)call PauseUnit(Picked,true)call ClearSelection()if(GetLocalPlayer()==GetOwningPlayer(Picked))thencall CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den1,true,.0)
call CameraSetupApplyForceDuration(gg_cam_Camera_Beorn_Den2,true,12.)endifcall GroupRemoveUnit(gruppa,Picked)endloopcall SaveUnitHandle(udg_hash,h3sec,1,boss)call TimerStart(t3sec,4.,false,function Trig_Start_Beorn_Den_4sec_Actions)call ShowAndFlushAllPlayerDamage(true)call TimerStart(udg_TimerShowAndFlushAllPlayerDmg,10000.,false,null)
call SaveUnitHandle(udg_hash,hobl,1,boss)call TimerStart(tobl,1.,true,function Trig_Start_Beorn_Den_Check_Rects_Actions)call TimerStart(talive,1.,true,function Trig_Start_Beorn_Den_Check_Alive_Units_Actions)set Picked=nullset boss=nullcall GroupClear(gruppa)call DestroyGroup(gruppa)set gruppa=nullset t3sec=nullendfunctionfunction InitTrig_Start_Beorn_Den takes nothing returns nothingset gg_trg_Start_Beorn_Den=CreateTrigger()call TriggerAddAction(gg_trg_Start_Beorn_Den,function Trig_Start_Beorn_Den_Actions)endfunctionfunction Trig_Beorn_Push_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local unit dammi
call UnitDamageTarget(caster,target,65.+15.*CountPlayersInForceBJ(udg_IGRAET),false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call MoveUnit(target,.5,800.,1200.,angle,.0,true)set dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0OG')call IssueTargetOrderById(dammi,$D006B,target)set dammi=nullset caster=nullset target=nullendfunctionfunction Trig_Beorn_Push_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0OF'endfunctionfunction InitTrig_Beorn_Push takes nothing returns nothinglocal integer index=0set gg_trg_Beorn_Push=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Beorn_Push,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Beorn_Push,Condition(function Trig_Beorn_Push_Conditions))call TriggerAddAction(gg_trg_Beorn_Push,function Trig_Beorn_Push_Actions)endfunctionfunction Trig_Beorn_Stomp_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real radius=300.local real damage=75.+25.*CountPlayersInForceBJ(udg_IGRAET)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real distlocal real angle
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",x,y))
call GroupEnumUnitsInRange(g,x,y,radius,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,1.5)set dist=SquareRoot((GetUnitX(Picked)-x)*(GetUnitX(Picked)-x)+(GetUnitY(Picked)-y)*(GetUnitY(Picked)-y))
set angle=bj_RADTODEG*Atan2(GetUnitY(Picked)-y,GetUnitX(Picked)-x)call MoveUnit(Picked,(300.-dist)/ 300.+.25,(600.-dist),.0,angle,.0,true)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"origin"))endifcall GroupRemoveUnit(g,Picked)endloopset caster=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Beorn_Stomp_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0OH'endfunctionfunction InitTrig_Beorn_Stomp takes nothing returns nothinglocal integer index=0set gg_trg_Beorn_Stomp=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Beorn_Stomp,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Beorn_Stomp,Condition(function Trig_Beorn_Stomp_Conditions))
call TriggerAddAction(gg_trg_Beorn_Stomp,function Trig_Beorn_Stomp_Actions)endfunctionfunction Trig_HeroUnitGameSave_Func001C takes nothing returns booleanreturn(IsUnitType(GetEnteringUnit(),UNIT_TYPE_HERO))!=nullendfunctionfunction Trig_HeroUnitGameSave_Actions takes nothing returns nothing
if(Trig_HeroUnitGameSave_Func001C())then
set udg_herounit[(1+GetPlayerId(GetOwningPlayer(GetEnteringUnit())))]=GetEnteringUnit()call GroupAddUnit(udg_Gruppa_HeroUnitov_Geroev,GetEnteringUnit())endifendfunctionfunction InitTrig_HeroUnitGameSave takes nothing returns nothing
set gg_trg_HeroUnitGameSave=CreateTrigger()call TriggerRegisterEnterRectSimple(gg_trg_HeroUnitGameSave,gg_rct_Oblstb_Tavern)call TriggerAddAction(gg_trg_HeroUnitGameSave,function Trig_HeroUnitGameSave_Actions)endfunctionfunction Trig_INIT_Func001Func001C takes nothing returns boolean
return((IsUnitType(GetEnumUnit(),UNIT_TYPE_STRUCTURE)==false)and(GetUnitTypeId(GetEnumUnit())!='h00A'))!=nullendfunctionfunction Trig_INIT_Func001A takes nothing returns nothingif(Trig_INIT_Func001Func001C())thenset udg_herounit[(1+GetPlayerId(GetOwningPlayer(GetEnumUnit())))]=GetEnumUnit()call GroupAddUnit(udg_Gruppa_HeroUnitov_Geroev,GetEnumUnit())call ForceAddPlayer(udg_IGRAET,GetOwningPlayer(GetEnumUnit()))endifendfunctionfunction Trig_INIT_Func002A takes nothing returns nothingcall ForceAddPlayer(udg_Gruppa_Igrokov_Vibor_Heroev,GetEnumPlayer())
call CameraSetupApplyForPlayer(true,gg_cam_Kamera_na_taverni,GetEnumPlayer(),0)call CreateNUnitsAtLoc(1,'h00A',GetEnumPlayer(),PolarProjectionBJ(GetRectCenter(gg_rct_Oblstb_Tavern),50.,(I2R((1+GetPlayerId(GetEnumPlayer())))*40.)),bj_UNIT_FACING)set udg_DummyHeroPick[(1+GetPlayerId(GetEnumPlayer()))]=bj_lastCreatedUnitset udg_System_ShowAbil_And_Items_Hint[(1+GetPlayerId(GetEnumPlayer()))]=trueendfunctionfunction Trig_INIT_Actions takes nothing returns nothing
call ForGroupBJ(GetUnitsInRectAll(gg_rct_Oblstb_Tavern),function Trig_INIT_Func001A)
call ForForce(udg_IGRAET,function Trig_INIT_Func002A)set udg_Heroes_Types[1]='H01M'set udg_MutliBoardHeroIcon[1]="ReplaceableTextures\\CommandButtons\\BTNGuardsman.blp"call SaveInteger(udg_hash,'H01M',84,1)set udg_Heroes_Types[2]='O005'set udg_MutliBoardHeroIcon[2]="ReplaceableTextures\\CommandButtons\\BTNChaosGrunt.blp"call SaveInteger(udg_hash,'O005',84,2)set udg_Heroes_Types[3]='N012'set udg_MutliBoardHeroIcon[3]="ReplaceableTextures\\CommandButtons\\BTNChaosBlademaster.blp"
call SaveInteger(udg_hash,'N012',84,3)set udg_Heroes_Types[4]='E004'set udg_MutliBoardHeroIcon[4]="ReplaceableTextures\\CommandButtons\\BTNEvilIllidan.blp"call SaveInteger(udg_hash,'E004',84,4)set udg_Heroes_Types[5]='H01L'set udg_MutliBoardHeroIcon[5]="ReplaceableTextures\\CommandButtons\\BTNSylvanusWindrunner.blp"call SaveInteger(udg_hash,'H01L',84,5)set udg_Heroes_Types[6]='E001'set udg_MutliBoardHeroIcon[6]="ReplaceableTextures\\CommandButtons\\BTNPriest.blp"call SaveInteger(udg_hash,'E001',84,6)set udg_Heroes_Types[7]='H01I'set udg_MutliBoardHeroIcon[7]="ReplaceableTextures\\CommandButtons\\BTNSeaElemental.blp"
call SaveInteger(udg_hash,'H01I',84,7)set udg_Heroes_Types[8]='N00W'set udg_MutliBoardHeroIcon[8]="ReplaceableTextures\\CommandButtons\\BTNRevenant.blp"
call SaveInteger(udg_hash,'N00W',84,8)set udg_Heroes_Types[9]='O000'set udg_MutliBoardHeroIcon[9]="ReplaceableTextures\\CommandButtons\\BTNArthas.blp"call SaveInteger(udg_hash,'O000',84,9)set udg_Heroes_Types[$A]='E005'set udg_MutliBoardHeroIcon[$A]="ReplaceableTextures\\CommandButtons\\BTNAncientOfWonders.blp"call SaveInteger(udg_hash,'E005',84,$A)set udg_Heroes_Types[$B]='E003'set udg_MutliBoardHeroIcon[$B]="ReplaceableTextures\\CommandButtons\\BTNFurion.blp"call SaveInteger(udg_hash,'E003',84,$B)set udg_Heroes_Types[$C]='E007'set udg_MutliBoardHeroIcon[$C]="ReplaceableTextures\\CommandButtons\\BTNHuntress.blp"call SaveInteger(udg_hash,'E007',84,$C)set udg_Heroes_Types[$D]='O001'set udg_MutliBoardHeroIcon[$D]="ReplaceableTextures\\CommandButtons\\BTNSpiritWalker.blp"call SaveInteger(udg_hash,'O001',84,$D)set udg_Heroes_Types[$E]='E008'set udg_MutliBoardHeroIcon[$E]="ReplaceableTextures\\CommandButtons\\BTNHeroWarden.blp"call SaveInteger(udg_hash,'E008',84,$E)set udg_Heroes_Types[$F]='H00O'set udg_MutliBoardHeroIcon[$F]="ReplaceableTextures\\CommandButtons\\BTNGarithos.blp"call SaveInteger(udg_hash,'H00O',84,$F)set udg_Heroes_Types[16]='H00Q'set udg_MutliBoardHeroIcon[16]="ReplaceableTextures\\CommandButtons\\BTNHeroArchMage.blp"call SaveInteger(udg_hash,'H00Q',84,16)set udg_Heroes_Types[17]='N01T'set udg_MutliBoardHeroIcon[17]="ReplaceableTextures\\CommandButtons\\BTNHeroAlchemist.blp"call SaveInteger(udg_hash,'N01T',84,17)set udg_Heroes_Types[18]='H00R'set udg_MutliBoardHeroIcon[18]="ReplaceableTextures\\CommandButtons\\BTNRifleman.blp"call SaveInteger(udg_hash,'H00R',84,18)set udg_Total_Heroes_Count=18set udg_Random_Hero_Count=18
set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=udg_Total_Heroes_Countloop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndset udg_Heroes_Random_Data[bj_forLoopAIndex]=bj_forLoopAIndexset udg_Is_Player_Got_Randomed[bj_forLoopAIndex]=falseset bj_forLoopAIndex=bj_forLoopAIndex+1endloopendfunctionfunction InitTrig_INIT takes nothing returns nothing
set gg_trg_INIT=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_INIT,1.)
call TriggerAddAction(gg_trg_INIT,function Trig_INIT_Actions)endfunctionfunction Trig_Pick_Hero_Upgrade_Func006A takes nothing returns nothingcall SetPlayerTechMaxAllowed(GetEnumPlayer(),GetUnitTypeId(udg_Temp_Unit),0)
endfunctionfunction Trig_Pick_Hero_Upgrade_Actions takes nothing returns nothinglocal unit herolocal player plocal integer heroid
local integer pidlocal boolean randomed=false
local integer iif udg_Hero_Randomed!=null thenset hero=udg_Hero_Randomedset randomed=trueset udg_Hero_Randomed=nullelse
set hero=GetSoldUnit()endifset p=GetOwningPlayer(hero)set pid=GetPlayerId(p)+1
set heroid=GetUnitTypeId(hero)set udg_Temp_Unit=heroset udg_Temp_Integer[1]=LoadInteger(udg_hash,heroid,84)call MultiboardSetItemIconBJ(udg_MultiBoard,1,udg_PlayerNumberInMB[pid],udg_MutliBoardHeroIcon[udg_Temp_Integer[1]])
call MultiboardSetItemValueBJ(udg_MultiBoard,6,udg_PlayerNumberInMB[pid],(udg_ColorString[22]+("1|r")))call SetPlayerTechMaxAllowed(p,'HERO',0)
call ForForce(bj_FORCE_ALL_PLAYERS,function Trig_Pick_Hero_Upgrade_Func006A)
call ForceRemovePlayer(udg_Gruppa_Igrokov_Vibor_Heroev,p)if(GetLocalPlayer()==p)thencall ClearSelection()call SelectUnit(hero,true)call CameraSetupApplyForceDuration(gg_cam_Kamera_glavnoi_bazi,true,.0)endifset bj_lastCreatedItem=CreateItem('I01E',.0,.0)call UnitAddItem(hero,bj_lastCreatedItem)call SetUnitPosition(hero,1232.,-6368.)call RemoveUnit(udg_DummyHeroPick[pid])set bj_lastCreatedFogModifier=CreateFogModifierRadius(p,FOG_OF_WAR_VISIBLE,1024.,-5696.,1700.,true,false)call FogModifierStart(bj_lastCreatedFogModifier)
set udg_BaseVisionFogModifier[pid]=bj_lastCreatedFogModifier
call MoveDammiReferencePanel(hero)if heroid=='H01M' thencall SetUnitColor(hero,PLAYER_COLOR_RED)
call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"str")set udg_Hero_Player_Color_String[pid]="|cFFC80000"if TriggerEvaluate(gg_trg_Guardsman_Load)thencall TriggerExecute(gg_trg_Guardsman_Load)endifendifif heroid=='O005' thencall SetUnitColor(hero,ConvertPlayerColor($C))call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"str")call ForceAddPlayer(udg_Drenor_Bull_Hint_Player_Group,p)
set udg_Hero_Player_Color_String[pid]="|cFFF0692D"if TriggerEvaluate(gg_trg_Drenor_Bull_Load)thencall TriggerExecute(gg_trg_Drenor_Bull_Load)
endifendifif heroid=='O000' thencall SetUnitColor(hero,PLAYER_COLOR_ORANGE)call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"str")set udg_Hero_Player_Color_String[pid]="|cFFF89A00"if TriggerEvaluate(gg_trg_Paladin_Load)thencall TriggerExecute(gg_trg_Paladin_Load)
endifendifif heroid=='E005' thencall SetUnitColor(hero,PLAYER_COLOR_LIGHT_GRAY)call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"str")set udg_Hero_Player_Color_String[pid]="|cFFAFAFAF"call SetUnitAnimation(hero,"stand")if TriggerEvaluate(gg_trg_Stone_Guard_Load)thencall TriggerExecute(gg_trg_Stone_Guard_Load)
endifendifif heroid=='N012' thencall SetUnitColor(hero,PLAYER_COLOR_RED)
call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"agi")set udg_Hero_Player_Color_String[pid]="|cFFFF3200"if TriggerEvaluate(gg_trg_BladeMaster_Load)thencall TriggerExecute(gg_trg_BladeMaster_Load)
endifendifif heroid=='E004' thencall SetUnitColor(hero,PLAYER_COLOR_PINK)call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"agi")set udg_Hero_Player_Color_String[pid]="|cFFB496AF"if TriggerEvaluate(gg_trg_Illusionist_Load)thencall TriggerExecute(gg_trg_Illusionist_Load)
endifendifif heroid=='H01L' thencall SetUnitColor(hero,PLAYER_COLOR_BLUE)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"agi")set udg_Hero_Player_Color_String[pid]="|cFF146EE6"if TriggerEvaluate(gg_trg_Ranger_Load)thencall TriggerExecute(gg_trg_Ranger_Load)endifendifif heroid=='E007' thencall SetUnitColor(hero,PLAYER_COLOR_PURPLE)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"agi")set udg_Hero_Player_Color_String[pid]="|cFF9664FF"if TriggerEvaluate(gg_trg_MoonWarrior_Load)thencall TriggerExecute(gg_trg_MoonWarrior_Load)
endifendifif heroid=='E001' thencall SetUnitColor(hero,PLAYER_COLOR_YELLOW)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"int")set udg_Hero_Player_Color_String[pid]="|cFFFFFF64"if TriggerEvaluate(gg_trg_Healer_Load)thencall TriggerExecute(gg_trg_Healer_Load)endifendifif heroid=='H01I' thencall SetUnitColor(hero,PLAYER_COLOR_CYAN)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"int")set udg_Hero_Player_Color_String[pid]="|cFF64DCFA"if TriggerEvaluate(gg_trg_Water_Elemental_Load)thencall TriggerExecute(gg_trg_Water_Elemental_Load)
endifendifif heroid=='N00W' thencall SetUnitColor(hero,PLAYER_COLOR_LIGHT_GRAY)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"int")set udg_Hero_Player_Color_String[pid]="|cFF9696AF"if TriggerEvaluate(gg_trg_Master_of_Lightnings_Load)then
call TriggerExecute(gg_trg_Master_of_Lightnings_Load)endifendifif heroid=='E003' thencall SetUnitColor(hero,PLAYER_COLOR_GREEN)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"int")set udg_Hero_Player_Color_String[pid]="|cff00CD00"if TriggerEvaluate(gg_trg_Archdruid_Load)thencall TriggerExecute(gg_trg_Archdruid_Load)endifendifif heroid=='O001' thencall SetUnitColor(hero,PLAYER_COLOR_ORANGE)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"int")set udg_Hero_Player_Color_String[pid]="|cffEE9A00"if TriggerEvaluate(gg_trg_SpiritBreaker_Load)thencall TriggerExecute(gg_trg_SpiritBreaker_Load)endifendifif heroid=='E008' thencall SetUnitColor(hero,PLAYER_COLOR_LIGHT_BLUE)call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"agi")set udg_Hero_Player_Color_String[pid]="|cffB0E2FF"if TriggerEvaluate(gg_trg_Warden_Load)thencall TriggerExecute(gg_trg_Warden_Load)endifendifif heroid=='H00O' thencall SetUnitColor(hero,PLAYER_COLOR_YELLOW)call SaveStr(udg_hash,heroid,91,"melee")
call SaveStr(udg_hash,heroid,70,"str")set udg_Hero_Player_Color_String[pid]="|cFFFFE150"if TriggerEvaluate(gg_trg_Marshal_Load)thencall TriggerExecute(gg_trg_Marshal_Load)
endifendifif heroid=='H00Q' thencall SetUnitColor(hero,PLAYER_COLOR_BLUE)set udg_Hero_Player_Color_String[pid]="|cFF6496FF"call SaveStr(udg_hash,heroid,70,"int")call SaveStr(udg_hash,heroid,91,"ranged")if TriggerEvaluate(gg_trg_Load_ArchMage)then
call TriggerExecute(gg_trg_Load_ArchMage)endifendifif heroid=='N01T' thencall SetUnitColor(hero,PLAYER_COLOR_AQUA)set udg_Hero_Player_Color_String[pid]="|cFF00C800"call SaveStr(udg_hash,heroid,70,"str")call SaveStr(udg_hash,heroid,91,"melee")
if TriggerEvaluate(gg_trg_Load_Alchemist)thencall TriggerExecute(gg_trg_Load_Alchemist)endifendifif heroid=='H00R' thencall SetUnitColor(hero,PLAYER_COLOR_LIGHT_BLUE)call SaveStr(udg_hash,heroid,91,"ranged")call SaveStr(udg_hash,heroid,70,"agi")set udg_Hero_Player_Color_String[pid]="|cffC0C0C0"if TriggerEvaluate(gg_trg_Load_Sniper)thencall TriggerExecute(gg_trg_Load_Sniper)endifendifset udg_Is_Player_Got_Randomed[pid]=true
set udg_Heroes_Random_Data[LoadInteger(udg_hash,heroid,84)]=udg_Heroes_Random_Data[udg_Total_Heroes_Count]set udg_Total_Heroes_Count=udg_Total_Heroes_Count-1if randomed==false and IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,udg_ColorString[pid]+GetPlayerName(p)+"|r выбрал героя: "+udg_Hero_Player_Color_String[pid]+GetUnitName(hero)+"|r")
endifif randomed and IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,udg_ColorString[pid]+GetPlayerName(p)+"|r наугад выбрал героя: "+udg_Hero_Player_Color_String[pid]+GetUnitName(hero)+"|r")endifif randomed then
call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+$FA)if(GetLocalPlayer()==p)thencall DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10.,"За случайный выбор героя вы получили |cFFFFFF00+250|r золота!")
endifendifendfunctionfunction Trig_Pick_Hero_Upgrade_Conditions takes nothing returns boolean
return(IsUnitType(GetSoldUnit(),UNIT_TYPE_HERO) and IsPlayerInForce(GetOwningPlayer(GetSoldUnit()),udg_Gruppa_Igrokov_Vibor_Heroev))!=nullendfunctionfunction InitTrig_Pick_Hero_Upgrade takes nothing returns nothinglocal integer index=0set gg_trg_Pick_Hero_Upgrade=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Pick_Hero_Upgrade,Player(index),EVENT_PLAYER_UNIT_SELL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Pick_Hero_Upgrade,Condition(function Trig_Pick_Hero_Upgrade_Conditions))
call TriggerAddAction(gg_trg_Pick_Hero_Upgrade,function Trig_Pick_Hero_Upgrade_Actions)endfunctionfunction Trig_Hero_Dead_MultiBoard_Check_Actions takes nothing returns nothinglocal timer tmb=GetExpiredTimer()local integer htmb=GetHandleId(tmb)local real time=LoadReal(udg_hash,htmb,1)local integer pnumber=LoadInteger(udg_hash,htmb,2)if time>0 thenset time=time-1call SaveReal(udg_hash,htmb,1,time)call MultiboardSetItemValueBJ(udg_MultiBoard,2,udg_PlayerNumberInMB[pnumber],(udg_ColorString[pnumber]+GetPlayerName(Player(pnumber-1))+"|r ("+udg_ColorString[pnumber]+I2S((R2I(time)))+"|r)"))
else
set time=0call MultiboardSetItemValueBJ(udg_MultiBoard,2,udg_PlayerNumberInMB[pnumber],(udg_ColorString[pnumber]+GetPlayerName(Player(pnumber-1))+"|r"))call FlushChildHashtable(udg_hash,htmb)call DestroyTimer(tmb)endifset udg_Hero_Respawn_Time[pnumber]=R2I(time)
set tmb=null
endfunctionfunction Trig_Hero_Dead_Timer2_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)call UnitRemoveAbility(u,'Avul')
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset u=nullendfunctionfunction Trig_Hero_Dead_Timer_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)local real x=GetRectCenterX(gg_rct_Respawn_Heroes)local real y=GetRectCenterY(gg_rct_Respawn_Heroes)local timerdialog td=LoadTimerDialogHandle(udg_hash,h,2)
local camerasetup theCam=CreateCameraSetup()
call TimerStart(t,4.,false,function Trig_Hero_Dead_Timer2_Actions)call ReviveHero(u,x,y,true)call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MAX_MANA))
call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_MAX_LIFE))
call UnitAddAbility(u,'Avul')call DisplayTextToPlayer(GetOwningPlayer(u),500.,500,"|cFFFFFF00Ваш Герой Воскрешен!!!|r")if(GetLocalPlayer()==GetOwningPlayer(u))and udg_IsGameEnd==false thencall CameraSetupSetField(theCam,CAMERA_FIELD_TARGET_DISTANCE,GetCameraField(CAMERA_FIELD_TARGET_DISTANCE),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_FARZ,GetCameraField(CAMERA_FIELD_FARZ),0)call CameraSetupSetField(theCam,CAMERA_FIELD_ZOFFSET,GetCameraField(CAMERA_FIELD_ZOFFSET),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_ANGLE_OF_ATTACK,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_FIELD_OF_VIEW,bj_RADTODEG*GetCameraField(CAMERA_FIELD_FIELD_OF_VIEW),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_ROLL,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ROLL),0)call CameraSetupSetField(theCam,CAMERA_FIELD_ROTATION,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ROTATION),0)call CameraSetupSetDestPosition(theCam,GetUnitX(u),GetUnitY(u),0)call CameraSetupApplyForceDuration(theCam,true,0)call ClearSelection()call SelectUnit(u,true)endifcall DestroyTimerDialog(td)set t=nullset u=nullset td=nullendfunctionfunction Trig_Hero_Dead_Conditions takes nothing returns boolean
return(IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO)and IsUnitIllusion(GetDyingUnit())==false and GetPlayerId(GetOwningPlayer(GetDyingUnit()))<=8 and GetOwningPlayer(GetDyingUnit())!=Player($F)and GetOwningPlayer(GetDyingUnit())!=Player($B))!=nullendfunctionfunction Trig_Hero_Dead_Actions takes nothing returns nothinglocal timer t=CreateTimer()local timerdialog td=CreateTimerDialog(t)local integer h=GetHandleId(t)local unit u=GetDyingUnit()local player p=GetOwningPlayer(u)local integer pnumber=GetPlayerId(p)+1local timer tmb=CreateTimer()local integer htmb=GetHandleId(tmb)local real time=5.+(2.*GetHeroLevel(u))if LoadReal(udg_hash,GetHandleId(u),'t')>.0 then
set time=R2I(time*(1.-LoadReal(udg_hash,GetHandleId(u),'t')))call SaveReal(udg_hash,GetHandleId(u),'t',.0)endifset time=time*(1.-HaveAnyTimeTalisman())
call SaveUnitHandle(udg_hash,h,1,u)call SaveTimerDialogHandle(udg_hash,h,2,td)if pnumber<=9 thenset udg_MultiBoard_Player_Deaths_Count[pnumber]=udg_MultiBoard_Player_Deaths_Count[pnumber]+1call MultiboardSetItemValueBJ(udg_MultiBoard,4,udg_PlayerNumberInMB[pnumber],udg_ColorString[21]+I2S(udg_MultiBoard_Player_Deaths_Count[pnumber])+"|r")endifcall TimerStart(t,time,false,function Trig_Hero_Dead_Timer_Actions)call TimerDialogDisplay(td,false)call TimerDialogSetTitle(td,"Respawn in:")if(GetLocalPlayer()==p)thencall TimerDialogDisplay(td,true)
call TimerDialogSetTitleColor(td,$FF,$E6,80,65)call TimerDialogSetTimeColor(td,$FF,45,45,20)endifif(IsPlayerInForce(GetLocalPlayer(),udg_IGRAET))then
call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,10.,"Герой "+udg_Hero_Player_Color_String[pnumber]+GetUnitName(u)+"|r ("+udg_ColorString[pnumber]+GetPlayerName(p)+"|r) погибает!!!")endifset udg_Hero_Respawn_Time[pnumber]=R2I(time)
call SaveReal(udg_hash,htmb,1,time)call SaveInteger(udg_hash,htmb,2,pnumber)call TimerStart(tmb,1.,true,function Trig_Hero_Dead_MultiBoard_Check_Actions)set u=nullset t=nullset tmb=null
set td=nullendfunctionfunction InitTrig_Hero_Dead takes nothing returns nothinglocal integer index=0set gg_trg_Hero_Dead=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Hero_Dead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Hero_Dead,Condition(function Trig_Hero_Dead_Conditions))
call TriggerAddAction(gg_trg_Hero_Dead,function Trig_Hero_Dead_Actions)endfunctionfunction Trig_Duel_Checking_On_HighGround_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero1=LoadUnitHandle(udg_hash,h,1)local unit hero2=LoadUnitHandle(udg_hash,h,2)local real x1=GetUnitX(hero1)local real y1=GetUnitY(hero1)local real x2=GetUnitX(hero2)local real y2=GetUnitY(hero2)local integer h2=LoadInteger(udg_hash,h,3)if LoadBoolean(udg_hash,h2,$D)==false thenif not((GetRectMinX(gg_rct_Hero_Arena)<=x1)and(x1<=GetRectMaxX(gg_rct_Hero_Arena))and(GetRectMinY(gg_rct_Hero_Arena)<=y1)and(y1<=GetRectMaxY(gg_rct_Hero_Arena)))thencall SetUnitPosition(hero1,2000.,2950.)if(GetLocalPlayer()==GetOwningPlayer(hero1))then
call PanCameraToTimed(2000.,2950.,.0)endifcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",2000.,2950.))endifif not((GetRectMinX(gg_rct_Hero_Arena)<=x2)and(x2<=GetRectMaxX(gg_rct_Hero_Arena))and(GetRectMinY(gg_rct_Hero_Arena)<=y2)and(y2<=GetRectMaxY(gg_rct_Hero_Arena)))thencall SetUnitPosition(hero2,2000.,2950.)if(GetLocalPlayer()==GetOwningPlayer(hero2))then
call PanCameraToTimed(2000.,2950.,.0)endifcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",2000.,2950.))endifelse
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset hero1=nullset hero2=nullendfunctionfunction Trig_Duel_Timer_Dialog_Destroy_2sec_wait_Actions takes nothing returns nothinglocal timer t2secwait=GetExpiredTimer()call ExecuteFunc("Trig_Hero_Death_On_Duel_2secwait_Actions")
call DestroyTimer(t2secwait)
set t2secwait=nullendfunctionfunction Trig_Duel_Timer_Dialog_Destroy_Actions takes nothing returns nothinglocal rect rct=gg_rct_Hero_Arena
local integer h=GetHandleId(rct)
local timer t=GetExpiredTimer()local integer ht=GetHandleId(t)local timerdialog td=LoadTimerDialogHandle(udg_hash,ht,1)local timer t2secwait=CreateTimer()local integer counterduel=LoadInteger(udg_hash,h,$A)
local unit hero1=udg_herounit[LoadInteger(udg_hash,h,counterduel)]local unit hero2=udg_herounit[LoadInteger(udg_hash,h,counterduel+1)]
local player pw=GetOwningPlayer(hero1)local player pd=GetOwningPlayer(hero2)local integer gold=$96+(udg_Nomer_samoi_volni*60)local integer xp=300+(udg_Nomer_samoi_volni*'d')
if LoadBoolean(udg_hash,h,$D)==false thencall SaveBoolean(udg_hash,h,$D,true)
call DestroyTimerDialog(td)call CinematicFadeBJ(1,2.5,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call TimerStart(t2secwait,2.5,false,function Trig_Duel_Timer_Dialog_Destroy_2sec_wait_Actions)call SetUnitInvulnerable(hero1,true)
call SetUnitInvulnerable(hero2,true)
if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,"Дуэль закончилась вничью")endifif(GetLocalPlayer()==pw)then
call DisplayTextToPlayer(pw,.0,.0,"Дуэль закончилась вничью, ваш герой получaeт |cFFFFFF00"+I2S(xp)+" опыта|r и |cFFFFFF00"+I2S(gold)+" золота|r")endifcall AddHeroXP(hero1,xp,false)call SetPlayerState(pw,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(pw,PLAYER_STATE_RESOURCE_GOLD)+gold)if(GetLocalPlayer()==pd)then
call DisplayTextToPlayer(pw,.0,.0,"Дуэль закончилась вничью, ваш герой получaeт |cFFFFFF00"+I2S(xp)+" опыта|r и |cFFFFFF00"+I2S(gold)+" золота|r")endifcall AddHeroXP(hero2,xp,false)call SetPlayerState(pd,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(pd,PLAYER_STATE_RESOURCE_GOLD)+gold)endifset rct=null
call DestroyTimer(t)
set t=nullcall FlushChildHashtable(udg_hash,ht)set td=nullset t2secwait=nullset hero1=nullset hero2=nullset pw=nullset pd=nullendfunctionfunction Trig_Duel_Start_Fight_Actions takes nothing returns nothing
local rect rct=gg_rct_Hero_Arena
local integer h=GetHandleId(rct)
local integer counterduel=LoadInteger(udg_hash,h,$A)
local unit hero1=udg_herounit[LoadInteger(udg_hash,h,counterduel)]local unit hero2=udg_herounit[LoadInteger(udg_hash,h,counterduel+1)]
local timer t=CreateTimer()local timerdialog td=CreateTimerDialog(t)local integer ht=GetHandleId(t)local timer t2local integer h2
call SoundForPlayer(GetOwningPlayer(hero1),4)call SoundForPlayer(GetOwningPlayer(hero2),4)call TimerDialogSetTitle(td,"Дуэль:")call TimerDialogDisplay(td,true)
call TimerDialogSetTitleColor(td,$FF,$E6,80,65)call TimerDialogSetTimeColor(td,$FF,0,0,20)call SaveTimerDialogHandle(udg_hash,ht,1,td)
call SaveTimerHandle(udg_hash,h,$D,t)call SaveTimerDialogHandle(udg_hash,h,$E,td)
if hero1!=null and hero2!=null thenset hero1=udg_herounit[LoadInteger(udg_hash,h,counterduel)]set hero2=udg_herounit[LoadInteger(udg_hash,h,counterduel+1)]call PauseUnit(hero1,false)call PauseUnit(hero2,false)call IssueTargetOrderById(hero1,$D000F,hero2)call IssueTargetOrderById(hero2,$D000F,hero1)set t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,hero1)
call SaveUnitHandle(udg_hash,h2,2,hero2)
call SaveInteger(udg_hash,h2,3,h)call TimerStart(t2,.5,true,function Trig_Duel_Checking_On_HighGround_Actions)call TimerStart(t,120.,false,function Trig_Duel_Timer_Dialog_Destroy_Actions)endifcall DestroyTimer(GetExpiredTimer())
set rct=null
set hero1=nullset hero2=nullset t=nullset td=nullendfunctionfunction Trig_Duel_TextTag_Size_Increase_Actions takes nothing returns nothinglocal timer ttxt=GetExpiredTimer()local integer httxt=GetHandleId(ttxt)local rect rct=gg_rct_Hero_Arena
local texttag txt=LoadTextTagHandle(udg_hash,httxt,1)local integer count=LoadInteger(udg_hash,httxt,2)if count<=2 then
if count==0 then
call SetTextTagText(txt,"2",.05)
endifif count==1 then
call SetTextTagText(txt,"1",.05)
endifif count==2 then
call SetTextTagText(txt,"FIGHT!",.05)call SetTextTagPos(txt,GetRectCenterX(rct)-80.,GetRectCenterY(rct),.0)endifset count=count+1call SaveInteger(udg_hash,httxt,2,count)
else
call DestroyTextTag(txt)
call DestroyTimer(ttxt)call FlushChildHashtable(udg_hash,httxt)
endifset ttxt=nullset rct=null
set txt=null
endfunctionfunction Trig_Duel_Round_Actions takes nothing returns nothinglocal rect rct=gg_rct_Hero_Arena
local real x=GetRectCenterX(rct)
local real y=GetRectCenterY(rct)
local integer h=GetHandleId(rct)
local integer counterduel=LoadInteger(udg_hash,h,$A)
local integer maxplayers=LoadInteger(udg_hash,h,$B)local boolean endduels=LoadBoolean(udg_hash,h,$C)local timer t=CreateTimer()local integer ht=GetHandleId(t)local integer number1local integer number2local unit hero1
local unit hero2
local integer i=1local real xclocal real yclocal texttag txtlocal timer ttxt
local real perekluchatel=0local player p1local player p2local group gruppaif maxplayers>=counterduel+1 thenset number1=LoadInteger(udg_hash,h,counterduel)set number2=LoadInteger(udg_hash,h,counterduel+1)set hero1=udg_herounit[number1]set hero2=udg_herounit[number2]call SaveBoolean(udg_hash,h,$D,false)set txt=CreateTextTag()set ttxt=CreateTimer()call SetTextTagText(txt,"3",.05)
call SetTextTagColor(txt,$FF,0,0,0)call SetTextTagPos(txt,x,y,.0)call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,1215752191.)
call SetTextTagFadepoint(txt,.0)
call SaveTextTagHandle(udg_hash,GetHandleId(ttxt),1,txt)
call SaveInteger(udg_hash,GetHandleId(ttxt),2,0)
call TimerStart(ttxt,1.,true,function Trig_Duel_TextTag_Size_Increase_Actions)set p1=GetOwningPlayer(hero1)set p2=GetOwningPlayer(hero2)if(IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS))thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,"Дуэль №"+udg_ColorString[20]+I2S(R2I((counterduel/ 2)+1))+"|r: "+udg_ColorString[GetPlayerId(p1)+1]+GetPlayerName(p1)+"|r против "+udg_ColorString[GetPlayerId(p2)+1]+GetPlayerName(p2)+"|r")endifcall ShowUnit(hero1,true)call ShowUnit(hero2,true)call SetUnitPosition(hero1,x+500.*Cos(180.*bj_DEGTORAD),y)call SetUnitPosition(hero2,x+500.*Cos(.0*bj_DEGTORAD),y)
call PauseUnit(hero1,true)call PauseUnit(hero2,true)call SetUnitFacing(hero1,.0)
call SetUnitFacing(hero2,180.)call SetUnitState(hero1,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(hero1,UNIT_STATE_MANA,$540BE3FF)call SetUnitState(hero2,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(hero2,UNIT_STATE_MANA,$540BE3FF)if(GetLocalPlayer()==GetOwningPlayer(hero1))then
call ClearSelection()call SelectUnit(hero1,true)call PanCameraToTimed(x,y,.0)endifif(GetLocalPlayer()==GetOwningPlayer(hero2))then
call ClearSelection()call SelectUnit(hero2,true)call PanCameraToTimed(x,y,.0)endifset gruppa=CreateGroup()
call GroupEnumUnitsInRect(gruppa,gg_rct_Hero_Arena,null)
call KillSummonsAndIllusions(gruppa)
call SetPlayerAllianceStateBJ(Player(number1-1),Player(number2-1),0)
call SetPlayerAllianceStateBJ(Player(number2-1),Player(number1-1),0)
call TimerStart(t,4.,false,function Trig_Duel_Start_Fight_Actions)else
call DisableTrigger(gg_trg_Hero_Death_On_Duel)if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,"Все дуэли завершены, спасибо героям за участие!!!")endifloop
exitwhen i>9
set hero1=udg_herounit[i]if perekluchatel>=0 then
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel-50.else
set perekluchatel=-perekluchatel
set perekluchatel=perekluchatel+50.endifset xc=GetRectCenterX(gg_rct_Respawn_Heroes)+perekluchatelset yc=GetRectCenterY(gg_rct_Respawn_Heroes)
call SetUnitPosition(hero1,xc,yc)call SetUnitFacing(hero1,270.)call SetUnitState(hero1,UNIT_STATE_LIFE,$540BE3FF)call SetUnitState(hero1,UNIT_STATE_MANA,$540BE3FF)call ShowUnit(hero1,true)call DestroyFogModifier(LoadFogModifierHandle(udg_hash,h,20+i))if(GetLocalPlayer()==GetOwningPlayer(hero1))then
call ResetToGameCamera(.0)call PanCameraToTimed(xc,yc,.0)call ClearSelection()call SelectUnit(hero1,true)endifset i=i+1endloopcall StartTimerBJ(udg_Timer_Nomera_Volni,false,75.)call CreateTimerDialogBJ(udg_Timer_Nomera_Volni,("Волна № |cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+"|r")))
set udg_TimerDialog_Nomera_Volni=bj_lastCreatedTimerDialogcall TimerDialogSetTimeColorBJ(udg_TimerDialog_Nomera_Volni,'d',90.,30.,20.)
set udg_Is_Fast_Wave_Start_On_Off=truecall FlushChildHashtable(udg_hash,h)
call EnableTrigger(gg_trg_Hero_Dead)
endifset rct=null
set t=nullset hero1=nullset hero2=nullset txt=null
set ttxt=nullendfunctionfunction Trig_Duel_WaitBeforeActions_Actions takes nothing returns nothinglocal rect rct=gg_rct_Hero_Arena
local real x=GetRectCenterX(rct)
local real y=GetRectCenterY(rct)
local integer i=0loop
exitwhen i>8
if(GetLocalPlayer()==Player(i))thencall ResetToGameCamera(.0)call PanCameraToTimed(x,y,.0)endifset i=i+1endloopcall ExecuteFunc("Trig_Duel_Round_Actions")call DestroyTimer(GetExpiredTimer())
set rct=null
endfunctionfunction Trig_Start_Duel_Actions takes nothing returns nothinglocal integer i=1local integer schetchik=0local integer array numberlocal integer random=0local integer maksintlocal integer array playernumber
local group g=CreateGroup()local timer t=CreateTimer()local player p1local player p2local integer emptyplayernumberlocal rect rct=gg_rct_Hero_Arena
local real x=GetRectCenterX(rct)
local real y=GetRectCenterY(rct)
local integer h=GetHandleId(rct)
call GroupEnumUnitsInRange(g,.0,.0,9999999.,null)call KillSummonsAndIllusions(g)loop
exitwhen i>9
if udg_herounit[i]!=null thencall ReviveHero(udg_herounit[i],.0,.0,false)
call ShowUnit(udg_herounit[i],false)
set schetchik=schetchik+1set number[schetchik]=schetchikset playernumber[schetchik]=iendifset i=i+1endloopset maksint=schetchikset schetchik=schetchikset emptyplayernumber=schetchikloop
exitwhen schetchik<=0set random=GetRandomInt(1,maksint)if number[random]==random thencall SaveInteger(udg_hash,h,random,playernumber[schetchik])set bj_lastCreatedFogModifier=CreateFogModifierRect(Player(playernumber[schetchik]-1),FOG_OF_WAR_VISIBLE,rct,true,false)
call FogModifierStart(bj_lastCreatedFogModifier)
call SaveFogModifierHandle(udg_hash,h,20+random,bj_lastCreatedFogModifier)if(GetLocalPlayer()==Player(playernumber[schetchik]-1))thencall PanCameraToTimed(x,y,.0)endifif random==maksint and(emptyplayernumber!=2 and emptyplayernumber!=4 and emptyplayernumber!=6 and emptyplayernumber!=8)thenif(GetLocalPlayer()==Player(playernumber[schetchik]-1))thencall DisplayTextToPlayer(Player(playernumber[schetchik]-1),.0,.0,"К сожалению, вы не поучавствуете в дуэли, так как вам не хватило противника, но вы все равно получаете |cFFFFFF00"+I2S($C8+(udg_Nomer_samoi_volni*'x'))+" опыта|r и |cFFFFFF00"+I2S('d'+(udg_Nomer_samoi_volni*60))+" золота|r")
endifcall AddHeroXP(udg_herounit[playernumber[schetchik]],$C8+(udg_Nomer_samoi_volni*'x'),false)call SetPlayerState(Player(playernumber[schetchik]-1),PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(Player(playernumber[schetchik]-1),PLAYER_STATE_RESOURCE_GOLD)+'d'+(udg_Nomer_samoi_volni*60))endifset schetchik=schetchik-1set number[random]=0
endifendloopif(IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS))thencall DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,10.,"Список Дуэлей:")
call SoundForPlayer(GetLocalPlayer(),5)endifset schetchik=1loop
exitwhen LoadInteger(udg_hash,h,schetchik)==0 or LoadInteger(udg_hash,h,schetchik+1)==0set p1=Player(LoadInteger(udg_hash,h,schetchik)-1)set p2=Player(LoadInteger(udg_hash,h,schetchik+1)-1)
if(IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS))thencall DisplayTextToPlayer(GetLocalPlayer(),0,0,"Дуэль №"+udg_ColorString[20]+I2S(R2I((schetchik/ 2)+1))+"|r: "+udg_ColorString[GetPlayerId(p1)+1]+GetPlayerName(p1)+"|r против "+udg_ColorString[GetPlayerId(p2)+1]+GetPlayerName(p2)+"|r")endifset schetchik=schetchik+2set p1=nullset p2=nullendloopcall CinematicFadeBJ(1,.0,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call CinematicFadeBJ(0,3.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call DisableTrigger(gg_trg_Hero_Dead)call SaveInteger(udg_hash,h,$A,1)call SaveInteger(udg_hash,h,$B,maksint)call SaveBoolean(udg_hash,h,$C,false)call SaveBoolean(udg_hash,h,$D,false)call EnableTrigger(gg_trg_Hero_Death_On_Duel)call TimerStart(t,3.,false,function Trig_Duel_WaitBeforeActions_Actions)
set t=nullset rct=null
endfunctionfunction InitTrig_Start_Duel takes nothing returns nothingset gg_trg_Start_Duel=CreateTrigger()call TriggerAddAction(gg_trg_Start_Duel,function Trig_Start_Duel_Actions)endfunctionfunction Trig_Hero_Death_On_Duel_2secwait_Actions takes nothing returns nothinglocal rect rct=gg_rct_Hero_Arena
local integer h=GetHandleId(rct)
local timer t=GetExpiredTimer()local integer ht=GetHandleId(t)local integer counterduel=LoadInteger(udg_hash,h,$A)
local unit winner=LoadUnitHandle(udg_hash,ht,1)local unit defeater=LoadUnitHandle(udg_hash,ht,2)local unit hero1=udg_herounit[LoadInteger(udg_hash,h,counterduel)]local unit hero2=udg_herounit[LoadInteger(udg_hash,h,counterduel+1)]
local real x=GetRectCenterX(gg_rct_Respawn_Heroes)local real y=GetRectCenterY(gg_rct_Respawn_Heroes)local timer tdialog=LoadTimerHandle(udg_hash,h,$D)local integer htdialog=GetHandleId(tdialog)local timerdialog td=LoadTimerDialogHandle(udg_hash,h,$E)local group g=CreateGroup()call SetUnitInvulnerable(hero1,false)call SetUnitInvulnerable(hero2,false)call ReviveHero(defeater,x,y,false)call SetUnitPosition(winner,x,y)
call ShowUnit(hero1,false)call ShowUnit(hero2,false)call SetPlayerAllianceStateBJ(GetOwningPlayer(hero1),GetOwningPlayer(hero2),3)call SetPlayerAllianceStateBJ(GetOwningPlayer(hero2),GetOwningPlayer(hero1),3)call CinematicFadeBJ(0,1.5,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call GroupEnumUnitsInRange(g,GetRectCenterX(gg_rct_Hero_Arena),GetRectCenterY(gg_rct_Hero_Arena),1500.,null)
call KillSummonsAndIllusions(g)set counterduel=counterduel+2call SaveInteger(udg_hash,h,$A,counterduel)call ExecuteFunc("Trig_Duel_Round_Actions")call DestroyTimerDialog(td)call DestroyTimer(tdialog)set rct=null
call DestroyTimer(t)
set t=nullcall FlushChildHashtable(udg_hash,ht)set winner=nullset defeater=nullset hero1=nullset hero2=nullset tdialog=null
set td=nullendfunctionfunction Trig_Hero_Death_On_Duel_Actions takes nothing returns nothinglocal rect rct=gg_rct_Hero_Arena
local integer h=GetHandleId(rct)
local integer counterduel=LoadInteger(udg_hash,h,$A)
local timer t=CreateTimer()local integer ht=GetHandleId(t)local player pw=GetOwningPlayer(GetKillingUnit())local unit winner=udg_herounit[GetPlayerId(pw)+1]local player pd=GetOwningPlayer(GetDyingUnit())local unit defeater=udg_herounit[GetPlayerId(pd)+1]local integer goldlocal integer xp
if pw!=null then
if LoadBoolean(udg_hash,h,$D)==false thencall SaveBoolean(udg_hash,h,$D,true)
call SetUnitInvulnerable(GetKillingUnit(),true)call SaveUnitHandle(udg_hash,ht,1,winner)call SaveUnitHandle(udg_hash,ht,2,defeater)call CinematicFadeBJ(1,2.5,"ReplaceableTextures\\CameraMasks\\White_mask.blp",0,0,0,1)call TimerStart(t,2.5,false,function Trig_Hero_Death_On_Duel_2secwait_Actions)if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,udg_ColorString[GetPlayerId(pw)+1]+GetPlayerName(pw)+"|r Победил в дуэле "+udg_ColorString[GetPlayerId(pd)+1]+GetPlayerName(pd)+"|r")endifset gold=300+(udg_Nomer_samoi_volni*'d')
set xp=600+(udg_Nomer_samoi_volni*$AF)if(GetLocalPlayer()==pw)then
call DisplayTextToPlayer(pw,.0,.0,"За победу в дуэле ваш герой получает |cFFFFFF00"+I2S(xp)+" опыта|r и |cFFFFFF00"+I2S(gold)+" золота|r")
endifcall AddHeroXP(winner,xp,true)call SetPlayerState(pw,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(pw,PLAYER_STATE_RESOURCE_GOLD)+gold)set gold='d'+(udg_Nomer_samoi_volni*60)set xp=$C8+(udg_Nomer_samoi_volni*'x')if(GetLocalPlayer()==pd)then
call DisplayTextToPlayer(pw,.0,.0,"За участие в дуэле ваш герой получает |cFFFFFF00"+I2S(xp)+" опыта|r и |cFFFFFF00"+I2S(gold)+" золота|r")endifcall AddHeroXP(defeater,xp,false)call SetPlayerState(pd,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(pd,PLAYER_STATE_RESOURCE_GOLD)+gold)endifendifset rct=null
set t=nullset winner=nullset pw=nullset defeater=nullset pd=nullendfunctionfunction Trig_Hero_Death_On_Duel_Conditions takes nothing returns booleanreturn(IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO) and IsUnitIllusion(GetTriggerUnit())==false and GetPlayerId(GetOwningPlayer(GetKillingUnit()))<=8 and GetPlayerId(GetOwningPlayer(GetDyingUnit()))<=8 and LoadInteger(udg_hash,GetHandleId(gg_rct_Hero_Arena),$A)>0)!=nullendfunctionfunction InitTrig_Hero_Death_On_Duel takes nothing returns nothinglocal integer index=0set gg_trg_Hero_Death_On_Duel=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Hero_Death_On_Duel,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Hero_Death_On_Duel,Condition(function Trig_Hero_Death_On_Duel_Conditions))call TriggerAddAction(gg_trg_Hero_Death_On_Duel,function Trig_Hero_Death_On_Duel_Actions)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func002001001001002 takes nothing returns boolean
return(GetUnitTypeId(GetFilterUnit())!='h00U')endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func002001 takes nothing returns booleanreturn(IsUnitGroupDeadBJ(GetUnitsOfPlayerMatching(Player(9),Condition(function Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func002001001001002))))
endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func003001001001002 takes nothing returns boolean
return(GetUnitTypeId(GetFilterUnit())!='h00U')endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func003001 takes nothing returns booleanreturn(IsUnitGroupDeadBJ(GetUnitsOfPlayerMatching(Player($A),Condition(function Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func003001001001002))))endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001001001002001 takes nothing returns booleanreturn(GetUnitTypeId(GetFilterUnit())!='h00U')endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001001001002002 takes nothing returns booleanreturn(GetUnitTypeId(GetFilterUnit())!='h009')endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001001001002 takes nothing returns boolean
return GetBooleanAnd(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001001001002001(),Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001001001002002())endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001 takes nothing returns booleanreturn(IsUnitGroupDeadBJ(GetUnitsOfPlayerMatching(Player($B),Condition(function Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001001001002))))endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func034Func005Func002C takes nothing returns booleanreturn(udg_Bonus_Gold_ChestGold[(1+GetPlayerId(GetEnumPlayer()))]==0)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func034Func005C takes nothing returns boolean
return(1==0)and(UnitHasItemOfTypeBJ(udg_herounit[(1+GetPlayerId(GetEnumPlayer()))],'I00V'))endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func034A takes nothing returns nothingcall AddHeroXPSwapped((80+('x'*udg_Nomer_samoi_volni)),udg_herounit[(1+GetPlayerId(GetEnumPlayer()))],true)call SetPlayerStateBJ(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD)+('x'+(80*udg_Nomer_samoi_volni))))call SoundForPlayer(GetEnumPlayer(),2)if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func034Func005C())thenif(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func034Func005Func002C())thenset udg_Bonus_Gold_ChestGold[(1+GetPlayerId(GetEnumPlayer()))]=60call SetPlayerStateBJ(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD)+udg_Bonus_Gold_ChestGold[(1+GetPlayerId(GetEnumPlayer()))]))else
set udg_Bonus_Gold_ChestGold[(1+GetPlayerId(GetEnumPlayer()))]=(udg_Bonus_Gold_ChestGold[(1+GetPlayerId(GetEnumPlayer()))]+40)call SetPlayerStateBJ(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD,(GetPlayerState(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD)+udg_Bonus_Gold_ChestGold[(1+GetPlayerId(GetEnumPlayer()))]))endifcall CreateTexttag(udg_ColorString[23]+"+"+I2S(udg_Bonus_Gold_ChestGold[GetPlayerId(GetEnumPlayer())+1])+"|r",.031,$FF,GetUnitX(udg_herounit[GetPlayerId(GetEnumPlayer())+1])-15.,GetUnitY(udg_herounit[GetPlayerId(GetEnumPlayer())+1]),.0,.0,.04,4.5)endifendfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func036A takes nothing returns nothingset udg_Temp_Real[1]=GetUnitStateSwap(UNIT_STATE_LIFE,GetEnumUnit())
call SetUnitMaxState(GetEnumUnit(),UNIT_STATE_MAX_LIFE,$AF)call SetWidgetLife(GetEnumUnit(),udg_Temp_Real[1])call SetWidgetLife(GetEnumUnit(),(GetUnitStateSwap(UNIT_STATE_LIFE,GetEnumUnit())+(130.+(25.*I2R(udg_Nomer_samoi_volni)))))call SetArmorAbilityLevel(GetEnumUnit(),4)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001Func003Func001Func003C takes nothing returns booleanreturn(udg_Nomer_samoi_volni==6)and(udg_Fire_Boss_Turn_On==false)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001Func003Func001C takes nothing returns booleanreturn(udg_Nomer_samoi_volni==2)or(udg_Nomer_samoi_volni==7)or(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001Func003Func001Func003C())endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001Func003C takes nothing returns boolean
return(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001Func003Func001C())endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001C takes nothing returns booleanreturn(udg_Nomer_samoi_volni==3)
endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001C takes nothing returns booleanreturn(udg_Nomer_samoi_volni==$B)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001C takes nothing returns booleanreturn(udg_Nomer_samoi_volni==6)
endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001C takes nothing returns boolean
return(udg_Nomer_samoi_volni==5)
endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func002C takes nothing returns boolean
return(udg_Nomer_samoi_volni==4)or(udg_Nomer_samoi_volni==8)or(udg_Nomer_samoi_volni==$A)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045C takes nothing returns booleanreturn(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func002C())endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001C takes nothing returns booleanreturn(udg_Integer_kreeps_system_check==7)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001Func001C takes nothing returns booleanreturn(udg_Integer_kreeps_system_check==6)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001Func001C takes nothing returns boolean
return(udg_Integer_kreeps_system_check==5)endfunctionfunction Trig_Timer_Check_Func002Func001Func001Func001C takes nothing returns booleanreturn(udg_Integer_kreeps_system_check==4)endfunctionfunction Trig_Timer_Check_Func002Func001Func001C takes nothing returns booleanreturn(udg_Integer_kreeps_system_check==3)endfunctionfunction Trig_Timer_Check_Func002Func001C takes nothing returns booleanreturn(udg_Integer_kreeps_system_check==2)endfunctionfunction Trig_Timer_Check_Func002C takes nothing returns boolean
return(udg_Integer_kreeps_system_check==1)endfunctionfunction Trig_Timer_Check_Actions takes nothing returns nothingset udg_Integer_kreeps_system_check=(udg_Integer_kreeps_system_check+1)if(Trig_Timer_Check_Func002C())thenset udg_number_of_otriad_mobs=(udg_number_of_otriad_mobs+1)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,(udg_Time_Before_Creeps_Spawn*2.))else
if(Trig_Timer_Check_Func002Func001C())thenset udg_number_of_otriad_mobs=(udg_number_of_otriad_mobs+1)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,(udg_Time_Before_Creeps_Spawn*1.))else
if(Trig_Timer_Check_Func002Func001Func001C())thenset udg_number_of_otriad_mobs=(udg_number_of_otriad_mobs-1)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,(udg_Time_Before_Creeps_Spawn*2.))else
if(Trig_Timer_Check_Func002Func001Func001Func001C())then
set udg_number_of_otriad_mobs=(udg_number_of_otriad_mobs+1)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,(udg_Time_Before_Creeps_Spawn*1.))else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001C())thenset udg_number_of_otriad_mobs=(udg_number_of_otriad_mobs-1)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,(udg_Time_Before_Creeps_Spawn*2.))else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001C())thenset udg_number_of_otriad_mobs=(udg_number_of_otriad_mobs+2)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,(udg_Time_Before_Creeps_Spawn*1.))else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001C())thencall PauseTimerBJ(true,udg_TimerMobsAttackBase)loop
exitwhen(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func002001())
call TriggerSleepAction(RMaxBJ(bj_WAIT_FOR_COND_MIN_INTERVAL,1))
endlooploop
exitwhen(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func003001())
call TriggerSleepAction(RMaxBJ(bj_WAIT_FOR_COND_MIN_INTERVAL,1))
endlooploop
exitwhen(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func004001())
call TriggerSleepAction(RMaxBJ(bj_WAIT_FOR_COND_MIN_INTERVAL,1))
endloopset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_3_up_Start)
call PlaySoundAtPointBJ(udg_Game_Sound[$F],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_2_down_right_Start)
call PlaySoundAtPointBJ(udg_Game_Sound[$F],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_1_down_left_Start)call PlaySoundAtPointBJ(udg_Game_Sound[$F],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullcall SetAttackAbilityLevel(udg_Dammy_Portal[1],50)call SetAttackAbilityLevel(udg_Dammy_Portal[2],50)call SetAttackAbilityLevel(udg_Dammy_Portal[3],50)call DisableTrigger(gg_trg_TeleportStuckedCreeps)call DisableTrigger(gg_trg_go_mochiytb_portal)call DisableTrigger(gg_trg_Periodic_Rune_Creation)set udg_Arrow_Pointer_Guide_Count=CountPlayersInForceBJ(udg_IGRAET)set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=CountPlayersInForceBJ(udg_IGRAET)loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall CreateNUnitsAtLoc(1,'h00U',Player($F),Location(I2R(udg_Arrow_Pointer_Guide_X[bj_forLoopAIndex]),I2R(udg_Arrow_Pointer_Guide_Y[bj_forLoopAIndex])),I2R(udg_Arrow_Pointer_Guide_Angle[bj_forLoopAIndex]))
set udg_Arrow_Pointer_Guide_Unit[bj_forLoopAIndex]=bj_lastCreatedUnitcall AddSpecialEffectTargetUnitBJ("origin",bj_lastCreatedUnit,"Effects\\Arrow - Chapter Browse - Rotated.mdx")set udg_Arrow_Pointer_Guide_Effect[bj_forLoopAIndex]=bj_lastCreatedEffectset bj_forLoopAIndex=bj_forLoopAIndex+1endloopset bj_forLoopAIndex=1set bj_forLoopAIndexEnd=9loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall SetWidgetLife(udg_herounit[bj_forLoopAIndex],GetUnitStateSwap(UNIT_STATE_MAX_LIFE,udg_herounit[bj_forLoopAIndex]))call SetUnitManaBJ(udg_herounit[bj_forLoopAIndex],GetUnitStateSwap(UNIT_STATE_MAX_MANA,udg_herounit[bj_forLoopAIndex]))set bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cff99ccffВНИМАНИЕ!|r")
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,("За успешное прохождение волны герои получают |cFFFFDC00"+(I2S(('x'+(80*udg_Nomer_samoi_volni)))+(" золота|r и |cFFFFDC00"+(I2S((80+('x'*udg_Nomer_samoi_volni)))+" опыта|r!!!")))))call ForForce(udg_IGRAET,function Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func034A)call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,("Стражам-заклинателям восстановлено|cff99ccff "+(I2S(($82+(25*udg_Nomer_samoi_volni)))+" |rздоровья. А их защита и максимальный запас здоровье повышены на |cff99ccff4|r и |cff99ccff175|r соответсвенно.")))call ForGroupBJ(udg_PortalCastersMagi,function Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func036A)call ShowAndFlushAllPlayerDamage(false)set udg_Time_Before_Creeps_Spawn=(udg_Time_Before_Creeps_Spawn-1.)set udg_number_of_otriad_mobs=0set udg_Integer_kreeps_system_check=0set udg_Nomer_samoi_volni=(udg_Nomer_samoi_volni+1)call SetDoodadAnimationRect(bj_mapInitialPlayableArea,'D01A',"Stand",false)if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045C())then
call TimerToFunction(50.,"Дуэли Героев",function Trig_Start_Duel_Actions)
else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001C())thencall TimerToFunction(70.,"Золотая Поляна",function Trig_Nachalo_Eiti_aren_Actions)else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001C())thencall TimerToFunction(50.,"Битва с Боссом",function Trig_BossStart_Actions)else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001C())thencall TimerToFunction(90.,"Битва с Боссом",function Trig_IceBoss_Actions)
else
if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001C())then
call TimerToFunction(40.,"Битва с Беорнами",function Trig_Start_Beorn_Den_Actions)
else
call StartTimerBJ(udg_Timer_Nomera_Volni,false,60.)if(Trig_Timer_Check_Func002Func001Func001Func001Func001Func001Func001Func045Func001Func001Func001Func001Func003C())thencall StartTimerBJ(udg_Timer_Hint_About_Fast_Start,false,15.)
endifcall CreateTimerDialogBJ(udg_Timer_Nomera_Volni,("Волна № |cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+"|r")))
set udg_TimerDialog_Nomera_Volni=bj_lastCreatedTimerDialogcall TimerDialogSetTimeColorBJ(udg_TimerDialog_Nomera_Volni,'d',90.,30.,20.)
set udg_Is_Fast_Wave_Start_On_Off=trueendifendifendifendifendifendifendifendifendifendifendifendifendfunctionfunction InitTrig_Timer_Check takes nothing returns nothingset gg_trg_Timer_Check=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_Timer_Check,udg_Timer_Check_Forkreep_system)
call TriggerAddAction(gg_trg_Timer_Check,function Trig_Timer_Check_Actions)endfunctionfunction Trig_go_mochiytb_portal_Filter takes nothing returns booleanreturn((GetOwningPlayer(GetFilterUnit())==Player(9))or(GetOwningPlayer(GetFilterUnit())==Player($A))or(GetOwningPlayer(GetFilterUnit())==Player($B)))endfunctionfunction Trig_go_mochiytb_portal_Actions takes nothing returns nothinglocal group g=CreateGroup()local group g2local unit Pickedlocal rect rct=gg_rct_Portal_bazalocal real x=GetRectCenterX(rct)
local real y=GetRectCenterY(rct)
local integer orderlocal integer orderIdset orderId=$D0004if(orderId!=0)thenelse
set orderId=UnitId("stop")if(orderId!=0)thenendifendifset g2=CreateGroup()
call GroupEnumUnitsInRect(g2,rct,null)call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Condition(function Trig_go_mochiytb_portal_Filter))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset order=GetUnitCurrentOrder(Picked)if(IsUnitInGroup(Picked,g2)==false)thenif(order==orderId)or order==0 thencall IssuePointOrderById(Picked,$D000F,x,y)endifendifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset rct=null
endfunctionfunction InitTrig_go_mochiytb_portal takes nothing returns nothingset gg_trg_go_mochiytb_portal=CreateTrigger()call DisableTrigger(gg_trg_go_mochiytb_portal)call TriggerRegisterTimerEvent(gg_trg_go_mochiytb_portal,2.,true)call TriggerAddAction(gg_trg_go_mochiytb_portal,function Trig_go_mochiytb_portal_Actions)endfunctionfunction Trig_Start_game_Actions takes nothing returns nothingcall RemoveAllGuardPositions(Player($B))
set udg_Nomer_samoi_volni=1set udg_Time_Before_Creeps_Spawn=21.
call StartTimerBJ(udg_Timer_Nomera_Volni,false,180.)
call CreateTimerDialogBJ(bj_lastStartedTimer,("Волна № |cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+"|r")))set udg_TimerDialog_Nomera_Volni=bj_lastCreatedTimerDialogcall TimerDialogSetTimeColorBJ(udg_TimerDialog_Nomera_Volni,'d',90.,30.,20.)
set udg_Is_Fast_Wave_Start_On_Off=trueset udg_Wave_Unit_tape[1]='u001'
set udg_Wave_Unit_tape[2]='u002'
set udg_Wave_Unit_tape[3]='u003'
set udg_Wave_Unit_tape[4]='n00K'
set udg_Wave_Unit_tape[5]='n00H'
set udg_Wave_Unit_tape[6]='n00P'
set udg_Wave_Unit_tape[7]='u005'
set udg_Wave_Unit_tape[8]='n00O'
set udg_Wave_Unit_tape[9]='u006'
set udg_Wave_Unit_tape[$A]='u004'set udg_Wave_Unit_tape[$B]='u007'set udg_Wave_Unit_tape[$C]='u008'set udg_Wave_Unit_tape[$D]='u00D'set udg_Wave_Unit_tape[$E]='n00R'set udg_Wave_Unit_tape[$F]='n00U'set udg_Wave_Unit_tape[16]='n00V'set udg_Wave_Unit_tape[17]='u009'set udg_Wave_Unit_tape[18]='u00B'set udg_Wave_Unit_tape[19]='u00A'set udg_Wave_Unit_tape[20]='u00C'set udg_Wave_Unit_tape[21]='u00E'set udg_Wave_Unit_tape[22]='n013'set udg_Wave_Unit_tape[23]='n014'set udg_Wave_Unit_tape[24]='n015'set udg_Wave_Unit_tape[25]='n016'set udg_Wave_Unit_tape[26]='n017'set udg_Wave_Unit_tape[27]='n018'set udg_Wave_Unit_tape[28]='n019'set udg_Wave_Unit_tape[29]='n01A'set udg_Wave_Unit_tape[30]='n01B'set udg_Wave_Unit_tape[31]='n01E'set udg_Wave_Unit_tape[32]='n01C'set udg_Wave_Unit_tape[33]='n003'set udg_Wave_Unit_tape[34]='n00D'set udg_Wave_Unit_tape[35]='n008'set udg_Wave_Unit_tape[36]='n009'set udg_Wave_Unit_tape[37]='n00F'set udg_Wave_Unit_tape[38]='n00I'set udg_Wave_Unit_tape[39]='n00G'set udg_Wave_Unit_tape[40]='n00E'call TriggerExecute(gg_trg_Init_System_Receiving_Experience_for_Creeps)call TriggerExecute(gg_trg_Init_System_Receiving_Gold_for_Creeps)endfunctionfunction InitTrig_Start_game takes nothing returns nothingset gg_trg_Start_game=CreateTrigger()call TriggerAddAction(gg_trg_Start_game,function Trig_Start_game_Actions)endfunctionfunction Trig_StartWave_Func007A takes nothing returns nothingcall SoundForPlayer(GetEnumPlayer(),3)endfunctionfunction Trig_StartWave_Actions takes nothing returns nothingcall DestroyTimerDialog(udg_TimerDialog_Nomera_Volni)set udg_Is_Fast_Wave_Start_On_Off=falseset udg_Count_Players_Fast_Wave_Start=0set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=16loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndset udg_Is_Player_Fast_Wave_Start[bj_forLoopAIndex]=falseset bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,5.,("Волна №|cFFFF0000"+(I2S(udg_Nomer_samoi_volni)+" |rначалась!!!")))
call ForForce(udg_IGRAET,function Trig_StartWave_Func007A)call EnableTrigger(gg_trg_go_mochiytb_portal)call EnableTrigger(gg_trg_Periodic_Rune_Creation)call StartTimerBJ(udg_Timer_Check_Forkreep_system,false,.0)call StartTimerBJ(udg_TimerMobsAttackBase,false,.1)call EnableTrigger(gg_trg_TeleportStuckedCreeps)
set udg_Wave_Progress_for_MultiBoard=0call MultiboardSetItemValueBJ(udg_MultiBoard,3,(udg_CountPlayers+3),"|Cfffed3120|r|cFF969696/|r|Cfffed3129|r")call MultiboardSetTitleText(udg_MultiBoard,("Последние Стражи"+(" (Волна "+(udg_ColorString[20]+(I2S(udg_Nomer_samoi_volni)+("|r из "+(udg_ColorString[20]+"10|r)")))))))call SetDoodadAnimationRect(bj_mapInitialPlayableArea,'D01A',"Stand Work",false)
call ShowAndFlushAllPlayerDamage(true)set udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_3_up_Start)
call PlaySoundAtPointBJ(udg_Game_Sound[$E],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_2_down_right_Start)
call PlaySoundAtPointBJ(udg_Game_Sound[$E],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_1_down_left_Start)call PlaySoundAtPointBJ(udg_Game_Sound[$E],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullset bj_forLoopAIndex=1set bj_forLoopAIndexEnd=CountPlayersInForceBJ(udg_IGRAET)loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall SetUnitAnimation(udg_Rune_On_Base_Dummy[bj_forLoopAIndex],"Stand Alternate")set bj_forLoopAIndex=bj_forLoopAIndex+1endloopset bj_forLoopAIndex=1set bj_forLoopAIndexEnd=udg_Arrow_Pointer_Guide_Countloop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall DestroyEffect(udg_Arrow_Pointer_Guide_Effect[bj_forLoopAIndex])
call KillUnit(udg_Arrow_Pointer_Guide_Unit[bj_forLoopAIndex])set bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall StartTimerBJ(udg_TimerShowAndFlushAllPlayerDmg,false,10000.)endfunctionfunction InitTrig_StartWave takes nothing returns nothingset gg_trg_StartWave=CreateTrigger()
call TriggerRegisterTimerExpireEvent(gg_trg_StartWave,udg_Timer_Nomera_Volni)call TriggerAddAction(gg_trg_StartWave,function Trig_StartWave_Actions)endfunctionfunction Trig_MobsAttackBase_Actions takes nothing returns nothinglocal integer wavenumber=udg_Nomer_samoi_volnilocal integer players=CountPlayersInForceBJ(udg_IGRAET)local integer count=2local integer count2=1local integer count3=3local integer array mobscountlocal integer array mobscount2local integer array mobscount3local integer numbergroup=udg_number_of_otriad_mobslocal integer difficultlevel
local real xc=GetRectCenterX(gg_rct_cast_magi)local real yc=GetRectCenterY(gg_rct_cast_magi)local rect array rct
local real array xlocal real array ylocal real array x1typelocal real array y1typelocal real array x2typelocal real array y2typelocal real array x3typelocal real array y3typelocal real array anglelocal unit moblocal integer lopa=1
local integer lopb=1
local integer id1=udg_Wave_Unit_tape[(4*wavenumber)-3]local integer id2=udg_Wave_Unit_tape[(4*wavenumber)-2]local integer id3=udg_Wave_Unit_tape[(4*wavenumber)-1]local integer mobsrandom
local integer array multiplayers
local real dist=.0local integer perekluchatel=1local player array p
local unit dammi
if numbergroup==3 thenset count=count*2set count2=count2*2endifif players>=1 and players<=2 thenset multiplayers[1]=1endifif players>=3 and players<=4 thenset multiplayers[1]=2endifif players>=5 and players<=9 thenset multiplayers[1]=3endifif players>=2 and players<=3 thenset multiplayers[2]=1endifif players>=4 and players<=5 thenset multiplayers[2]=2endifif players>=6 and players<=9 thenset multiplayers[2]=3endifif players>=7 and players<=9 thenset multiplayers[3]=(players-6)endifif(udg_Integer_Creep_On_Line_Spawn[1]!=0)or(udg_Integer_Creep_On_Line_Spawn[2]!=0)or(udg_Integer_Creep_On_Line_Spawn[3]!=0)thenset multiplayers[1]=udg_Integer_Creep_On_Line_Spawn[1]set multiplayers[2]=udg_Integer_Creep_On_Line_Spawn[2]set multiplayers[3]=udg_Integer_Creep_On_Line_Spawn[3]endifset mobsrandom=0
if count*multiplayers[1]>0 thenset mobscount[1]=(count*multiplayers[1])+mobsrandomset mobscount2[1]=(count2*multiplayers[1])+mobsrandomset mobscount3[1]=(count3*multiplayers[1])+mobsrandomset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_3_up_Start)
call PlaySoundAtPointBJ(udg_Game_Sound[16],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullendifif count*multiplayers[2]>0 thenset mobscount[2]=(count*multiplayers[2])+mobsrandomset mobscount2[2]=(count2*multiplayers[2])+mobsrandomset mobscount3[2]=(count3*multiplayers[2])+mobsrandomset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_2_down_right_Start)
call PlaySoundAtPointBJ(udg_Game_Sound[16],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullendifif count*multiplayers[3]>0 thenset mobscount[3]=(count*multiplayers[3])+mobsrandomset mobscount2[3]=(count2*multiplayers[3])+mobsrandomset mobscount3[3]=(count3*multiplayers[3])+mobsrandomset udg_Temp_Location[1]=GetRectCenter(gg_rct_Portal_1_down_left_Start)call PlaySoundAtPointBJ(udg_Game_Sound[16],100.,udg_Temp_Location[1],.0)
call RemoveLocation(udg_Temp_Location[1])set udg_Temp_Location[1]=nullendifset rct[1]=gg_rct_Portal_3_up_Startset rct[2]=gg_rct_Portal_2_down_right_Startset rct[3]=gg_rct_Portal_1_down_left_Startset x[1]=GetRectCenterX(rct[1])set x[2]=GetRectCenterX(rct[2])set x[3]=GetRectCenterX(rct[3])set y[1]=GetRectCenterY(rct[1])set y[2]=GetRectCenterY(rct[2])set y[3]=GetRectCenterY(rct[3])set angle[1]=-90.set angle[2]=123.set angle[3]=50.
set x1type[1]=x[1]+150.*Cos(angle[1]*bj_DEGTORAD)set x1type[2]=x[2]+150.*Cos(angle[2]*bj_DEGTORAD)set x1type[3]=x[3]+150.*Cos(angle[3]*bj_DEGTORAD)set y1type[1]=y[1]+150.*Sin(angle[1]*bj_DEGTORAD)set y1type[2]=y[2]+150.*Sin(angle[2]*bj_DEGTORAD)set y1type[3]=y[3]+150.*Sin(angle[3]*bj_DEGTORAD)if wavenumber=='d' thenset mobscount[1]=R2I((mobscount[1]*1.5)+.5)set mobscount[2]=R2I((mobscount[2]*1.5)+.5)set mobscount[3]=R2I((mobscount[3]*1.5)+.5)set mobscount2[1]=R2I((mobscount2[1]*1.5)+.5)set mobscount2[2]=R2I((mobscount2[2]*1.5)+.5)set mobscount2[3]=R2I((mobscount2[3]*1.5)+.5)set mobscount3[1]=R2I((mobscount3[1]*1.5)+.5)set mobscount3[2]=R2I((mobscount3[2]*1.5)+.5)set mobscount3[3]=R2I((mobscount3[3]*1.5)+.5)endifif wavenumber=='d' thenset mobscount[1]=R2I((mobscount[1]/ 2.)+.5)set mobscount[2]=R2I((mobscount[2]/ 2.)+.5)set mobscount[3]=R2I((mobscount[3]/ 2.)+.5)set mobscount2[1]=R2I((mobscount2[1]/ 2.)+.5)set mobscount2[2]=R2I((mobscount2[2]/ 2.)+.5)set mobscount2[3]=R2I((mobscount2[3]/ 2.)+.5)set mobscount3[1]=R2I((mobscount3[1]/ 2.)+.5)set mobscount3[2]=R2I((mobscount3[2]/ 2.)+.5)set mobscount3[3]=R2I((mobscount3[3]/ 2.)+.5)endifset p[1]=Player(9)set p[2]=Player($A)set p[3]=Player($B)loop
exitwhen lopa>3if mobscount[lopa]>0 thenset dammi=CreateUnit(Player($B),'h00U',x1type[lopa],y1type[lopa],.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call SetUnitScale(dammi,2.,2.,2.)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl",dammi,"origin"))set dammi=nullloop
exitwhen lopb>mobscount[lopa]if perekluchatel==1 then
set perekluchatel=-1
else
if perekluchatel==-1 thenset perekluchatel=1endifendifset dist=dist+32.set mob=CreateUnit(p[lopa],id1,x1type[lopa]+dist*Cos((angle[lopa]+perekluchatel*90.)*bj_DEGTORAD),y1type[lopa]+dist*Sin((angle[lopa]+perekluchatel*90.)*bj_DEGTORAD),angle[lopa])set udg_count=udg_count+1call IssuePointOrderById(mob,$D000F,xc,yc)call SaveBoolean(udg_hash,GetHandleId(mob),83,true)set mob=null
set lopb=lopb+1endloopendifset dist=.0set lopb=1set lopa=lopa+1endloopset lopa=1set lopb=1if numbergroup>=1 thenset x2type[1]=x[1]+60.*Cos(angle[1]*bj_DEGTORAD)
set x2type[2]=x[2]+60.*Cos(angle[2]*bj_DEGTORAD)
set x2type[3]=x[3]+60.*Cos(angle[3]*bj_DEGTORAD)
set y2type[1]=y[1]+60.*Sin(angle[1]*bj_DEGTORAD)
set y2type[2]=y[2]+60.*Sin(angle[2]*bj_DEGTORAD)
set y2type[3]=y[3]+60.*Sin(angle[3]*bj_DEGTORAD)
loop
exitwhen lopa>3loop
exitwhen lopb>mobscount2[lopa]if perekluchatel==1 then
set perekluchatel=-1
else
if perekluchatel==-1 thenset perekluchatel=1endifendifset dist=dist+30.set mob=CreateUnit(p[lopa],id2,x2type[lopa]+dist*Cos((angle[lopa]+perekluchatel*90.)*bj_DEGTORAD),y2type[lopa]+dist*Sin((angle[lopa]+perekluchatel*90.)*bj_DEGTORAD),angle[lopa])set udg_count=udg_count+1call SaveBoolean(udg_hash,GetHandleId(mob),83,true)call IssuePointOrderById(mob,$D000F,xc,yc)set mob=null
set lopb=lopb+1endloopset dist=.0set lopb=1set lopa=lopa+1endloopset lopa=1set lopb=1endifif numbergroup==2 thenloop
exitwhen lopa>3loop
exitwhen lopb>mobscount3[lopa]set udg_count=udg_count+1set mob=CreateUnit(p[lopa],id3,x[lopa]-25.*Cos(angle[lopa]*bj_DEGTORAD),y[lopa]-25.*Sin(angle[lopa]*bj_DEGTORAD),angle[lopa])call IssuePointOrderById(mob,$D000F,xc,yc)call SaveBoolean(udg_hash,GetHandleId(mob),83,true)set mob=null
set lopb=lopb+1endloopset lopb=1set lopa=lopa+1endloopset lopa=1set lopb=1endifif numbergroup==3 thenif(IsPlayerInForce(GetLocalPlayer(),udg_IGRAET))then
call DisplayTextToPlayer(GetLocalPlayer(),0,0,"|cFFFF0000БОСС!!!|r")
call SoundForPlayer(GetLocalPlayer(),6)endifloop
exitwhen lopa>3if mobscount[lopa]>0 thenset udg_count=udg_count+1set mob=CreateUnit(p[lopa],udg_Wave_Unit_tape[4*wavenumber],x[lopa]-25.*Cos(angle[lopa]*bj_DEGTORAD),y[lopa]-25.*Sin(angle[lopa]*bj_DEGTORAD),angle[lopa])call IssuePointOrderById(mob,$D000F,xc,yc)call SaveBoolean(udg_hash,GetHandleId(mob),83,true)set mob=null
endifset lopa=lopa+1endloopset lopa=1endifset p[1]=nullset p[2]=nullset p[3]=nullset mob=null
set dammi=nullset udg_Wave_Progress_for_MultiBoard=udg_Wave_Progress_for_MultiBoard+1call MultiboardSetItemValueBJ(udg_MultiBoard,3,(udg_CountPlayers+3),(("|Cfffed312"+I2S(udg_Wave_Progress_for_MultiBoard))+"|r|cFF969696/|r|Cfffed3129|r"))call StartTimerBJ(udg_TimerMobsAttackBase,false,udg_Time_Before_Creeps_Spawn)endfunctionfunction InitTrig_MobsAttackBase takes nothing returns nothingset gg_trg_MobsAttackBase=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_MobsAttackBase,udg_TimerMobsAttackBase)call TriggerAddAction(gg_trg_MobsAttackBase,function Trig_MobsAttackBase_Actions)endfunctionfunction Trig_Filter_TeleportStuckedCreeps_Actions takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405 and IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(GetFilterUnit())!='h00U' and GetUnitTypeId(GetFilterUnit())!='n01M' and GetUnitTypeId(GetFilterUnit())!='h00C')and(GetOwningPlayer(GetFilterUnit())==Player(9)or GetOwningPlayer(GetFilterUnit())==Player($A)or GetOwningPlayer(GetFilterUnit())==Player($B)))!=null
endfunctionfunction Trig_TeleportStuckedCreeps_Actions takes nothing returns nothinglocal group g=CreateGroup()local unit Pickedlocal integer hlocal real x
local real y
local real dist1=.0local real dist2=.0local real dist3=.0local real x1=GetRectCenterX(gg_rct_Portal_3_up_Start)local real y1=GetRectCenterY(gg_rct_Portal_3_up_Start)local real x2=GetRectCenterX(gg_rct_Portal_2_down_right_Start)local real y2=GetRectCenterY(gg_rct_Portal_2_down_right_Start)local real x3=GetRectCenterX(gg_rct_Portal_1_down_left_Start)local real y3=GetRectCenterY(gg_rct_Portal_1_down_left_Start)local real xtlocal real ytlocal real xload=.0local real yload=.0local integer i=0call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,Filter(function Trig_Filter_TeleportStuckedCreeps_Actions))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset h=GetHandleId(Picked)set x=GetUnitX(Picked)set y=GetUnitY(Picked)set i=LoadInteger(udg_hash,h,'k')set i=i+2call SaveInteger(udg_hash,h,'k',i)if i>=20 and udg_IsGameEnd==false thenset dist1=SquareRoot(((x-x1)*(x-x1))+((y-y1)*(y-y1)))set dist2=SquareRoot(((x-x2)*(x-x2))+((y-y2)*(y-y2)))set dist3=SquareRoot(((x-x3)*(x-x3))+((y-y3)*(y-y3)))if(dist1<dist2)and(dist1<dist3)thenset xt=x1set yt=y1else
if(dist2<dist3)thenset xt=x2set yt=y2else
set xt=x3set yt=y3endifendifcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",x,y))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",xt,yt))
call SetUnitPosition(Picked,xt,yt)call SaveInteger(udg_hash,h,'k',0)endifset xload=LoadReal(udg_hash,h,'l')set yload=LoadReal(udg_hash,h,'m')set dist1=SquareRoot((x-xload)*(x-xload))+((y-yload)*(y-yload))if dist1>500. thencall SaveReal(udg_hash,h,'l',x)call SaveReal(udg_hash,h,'m',y)call SaveInteger(udg_hash,h,'k',0)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction InitTrig_TeleportStuckedCreeps takes nothing returns nothingset gg_trg_TeleportStuckedCreeps=CreateTrigger()
call DisableTrigger(gg_trg_TeleportStuckedCreeps)call TriggerRegisterTimerEvent(gg_trg_TeleportStuckedCreeps,2.,true)
call TriggerAddAction(gg_trg_TeleportStuckedCreeps,function Trig_TeleportStuckedCreeps_Actions)endfunctionfunction Trig_vhodit_v_zony_Actions takes nothing returns nothingcall IssueImmediateOrderById(GetEnteringUnit(),$D0004)endfunctionfunction Trig_vhodit_v_zony_Conditions takes nothing returns boolean
return GetOwningPlayer(GetEnteringUnit())==Player($B)endfunctionfunction InitTrig_vhodit_v_zony takes nothing returns nothinglocal region rectRegion=CreateRegion()set gg_trg_vhodit_v_zony=CreateTrigger()
call RegionAddRect(rectRegion,gg_rct_cast_magi)call TriggerRegisterEnterRegion(gg_trg_vhodit_v_zony,rectRegion,null)call TriggerAddCondition(gg_trg_vhodit_v_zony,Condition(function Trig_vhodit_v_zony_Conditions))
call TriggerAddAction(gg_trg_vhodit_v_zony,function Trig_vhodit_v_zony_Actions)endfunctionfunction Trig_Add_Gold_System_Receiving_Gold_for_Creeps_AddGoldAssists_Actions takes nothing returns nothing
local player p=GetEnumPlayer()local integer pnumber=GetPlayerId(p)+1local integer goldassist=udg_Temp_Integer[1]
local real angle=udg_Temp_Real[3]local real x=udg_Temp_Real[1]local real y=udg_Temp_Real[2]local texttag txt=CreateTextTag()if CountItemOfTypeOnUnit(udg_herounit[pnumber],'I00V')>0 thenset goldassist=goldassist*2endifcall SetTextTagText(txt,udg_ColorString[23]+"+"+I2S(goldassist)+"|r",.023)call SetTextTagColor(txt,$FF,$FF,$FF,$FF)call SetTextTagPos(txt,x-15.,y,.0)call SetTextTagVelocity(txt,.0,.035)
call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,2.75)call SetTextTagFadepoint(txt,2.75)if GetLocalPlayer()==p thencall SetTextTagVisibility(txt,true)else
call SetTextTagVisibility(txt,false)
endifcall SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+goldassist)if pnumber<=9 thenset udg_MultiBoard_Player_Assist_Count[pnumber]=udg_MultiBoard_Player_Assist_Count[pnumber]+1call MultiboardSetItemValueBJ(udg_MultiBoard,5,udg_PlayerNumberInMB[pnumber],udg_ColorString[24]+I2S(udg_MultiBoard_Player_Assist_Count[pnumber])+"|r")endifset txt=null
set p=nullendfunctionfunction Trig_Add_Gold_System_Receiving_Gold_for_Creeps_Actions takes nothing returns nothinglocal unit creep=GetDyingUnit()local unit killer=GetKillingUnit()local player p=GetOwningPlayer(killer)local integer pnumber=GetPlayerId(p)+1local integer mingold=LoadInteger(udg_hash,GetUnitTypeId(creep),70)local integer maxgold=LoadInteger(udg_hash,GetUnitTypeId(creep),71)local integer gold=GetRandomInt(mingold,maxgold)
local force players=LoadForceHandle(udg_hash,GetHandleId(creep),72)local real angle=.0local integer countplayers=0
local integer assistgold=0local real x=GetUnitX(creep)
local real y=GetUnitY(creep)
local boolean normalmob=LoadBoolean(udg_hash,GetHandleId(creep),83)local texttag txt=CreateTextTag()if gold>0 and LoadBoolean(udg_hash,GetHandleId(creep),85)==false thenif normalmob==false then
set gold=R2I((gold/ 2)+.5)endifcall ForceRemovePlayer(players,p)set countplayers=CountPlayersInForceBJ(players)if countplayers!=0 thenset assistgold=R2I((.2+.05*countplayers)*gold+.5)set angle=(360./ countplayers)endifset gold=gold-assistgold
if countplayers!=0 thenset assistgold=R2I(assistgold/ countplayers)
endifif assistgold<=0 thenset assistgold=1
endifcall SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+gold)call SetTextTagText(txt,udg_ColorString[23]+"+"+I2S(gold)+"|r",.025)
call SetTextTagColor(txt,$FF,$FF,$FF,$FF)call SetTextTagPos(txt,x-15.,y,.0)call SetTextTagVelocity(txt,.0,.035)
call SetTextTagPermanent(txt,false)call SetTextTagLifespan(txt,3.5)
call SetTextTagFadepoint(txt,3.5/ 2)
if(GetLocalPlayer()==p)thencall SetTextTagVisibility(txt,true)else
call SetTextTagVisibility(txt,false)
endifset txt=null
if pnumber<=9 thenset udg_MultiBoard_Player_Kills_Count[pnumber]=udg_MultiBoard_Player_Kills_Count[pnumber]+1call MultiboardSetItemValueBJ(udg_MultiBoard,3,udg_PlayerNumberInMB[pnumber],udg_ColorString[20]+I2S(udg_MultiBoard_Player_Kills_Count[pnumber])+"|r")endifset udg_Temp_Integer[1]=assistgoldset udg_Temp_Real[1]=xset udg_Temp_Real[2]=yset udg_Temp_Real[3]=angleset udg_Temp_Real[4]=anglecall ForForce(players,function Trig_Add_Gold_System_Receiving_Gold_for_Creeps_AddGoldAssists_Actions)endifcall ForceClear(players)
call DestroyForce(players)set creep=nullset killer=nullset p=nullset players=null
endfunctionfunction Trig_Add_Gold_System_Receiving_Gold_for_Creeps_Conditions takes nothing returns boolean
return IsUnitIllusion(GetDyingUnit())==false and GetUnitAbilityLevel(GetDyingUnit(),'Aloc')<=0 and GetUnitTypeId(GetDyingUnit())!='h00U' and(GetOwningPlayer(GetDyingUnit())==Player(9)or GetOwningPlayer(GetDyingUnit())==Player($A)or GetOwningPlayer(GetDyingUnit())==Player($B))
endfunctionfunction InitTrig_Add_Gold_System_Receiving_Gold_for_Creeps takes nothing returns nothinglocal integer index=0set gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps,Condition(function Trig_Add_Gold_System_Receiving_Gold_for_Creeps_Conditions))
call TriggerAddAction(gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps,function Trig_Add_Gold_System_Receiving_Gold_for_Creeps_Actions)endfunctionfunction Trig_Init_System_Receiving_Gold_for_Creeps_Actions takes nothing returns nothinglocal real factor=.25local real factorwavelocal integer wavenumber
local integer array goldconstmin
local integer array goldconstmax
local integer array goldminlocal integer array goldmaxset goldconstmin[1]=$Aset goldconstmax[1]=$Dset goldconstmin[2]=8set goldconstmax[2]=$Cset goldconstmin[3]=$Dset goldconstmax[3]=20set goldconstmin[4]='x'set goldconstmax[4]=$D2call SaveInteger(udg_hash,'n01D',70,20)call SaveInteger(udg_hash,'n01D',71,24)call SaveInteger(udg_hash,'u00F',70,19)call SaveInteger(udg_hash,'u00F',71,26)call SaveInteger(udg_hash,'u00H',70,54)call SaveInteger(udg_hash,'u00H',71,70)call SaveInteger(udg_hash,'n011',70,20)call SaveInteger(udg_hash,'n011',71,24)call SaveInteger(udg_hash,'n00T',70,$D)call SaveInteger(udg_hash,'n00T',71,$F)call SaveInteger(udg_hash,'n00X',70,6)call SaveInteger(udg_hash,'n00X',71,7)call SaveInteger(udg_hash,'n00Z',70,$D)call SaveInteger(udg_hash,'n00Z',71,19)call SaveInteger(udg_hash,'u00G',70,30)call SaveInteger(udg_hash,'u00G',71,35)call SaveInteger(udg_hash,'n00L',70,30)call SaveInteger(udg_hash,'n00L',71,35)call SaveInteger(udg_hash,'n00M',70,$C)call SaveInteger(udg_hash,'n00M',71,16)call SaveInteger(udg_hash,'n00N',70,50)call SaveInteger(udg_hash,'n00N',71,60)call SaveInteger(udg_hash,'n00A',70,40)call SaveInteger(udg_hash,'n00A',71,50)set wavenumber=1
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[1],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[1],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[2],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[2],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[3],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[3],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[4],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[4],71,goldmax[4])set wavenumber=2
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[5],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[5],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[6],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[6],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[7],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[7],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[8],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[8],71,goldmax[4])set wavenumber=3
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[9],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[9],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$A],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$A],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$B],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$B],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$C],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$C],71,goldmax[4])set wavenumber=4
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[$D],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$D],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$E],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$E],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$F],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$F],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[16],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[16],71,goldmax[4])set wavenumber=5
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[17],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[17],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[18],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[18],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[19],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[19],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[20],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[20],71,goldmax[4])set wavenumber=6
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[21],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[21],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[22],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[22],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[23],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[23],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[24],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[24],71,goldmax[4])set wavenumber=7
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[25],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[25],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[26],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[26],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[27],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[27],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[28],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[28],71,goldmax[4])set wavenumber=8
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[29],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[29],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[30],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[30],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[31],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[31],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[32],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[32],71,goldmax[4])set wavenumber=9
set factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[33],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[33],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[34],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[34],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[35],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[35],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[36],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[36],71,goldmax[4])set wavenumber=$Aset factorwave=1.+(factor*(wavenumber-1))set goldmin[1]=R2I((goldconstmin[1]*factorwave)+.5)set goldmax[1]=R2I((goldconstmax[1]*factorwave)+.5)set goldmin[2]=R2I((goldconstmin[2]*factorwave)+.5)set goldmax[2]=R2I((goldconstmax[2]*factorwave)+.5)set goldmin[3]=R2I((goldconstmin[3]*factorwave)+.5)set goldmax[3]=R2I((goldconstmax[3]*factorwave)+.5)set goldmin[4]=R2I((goldconstmin[4]*factorwave)+.5)set goldmax[4]=R2I((goldconstmax[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[37],70,goldmin[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[37],71,goldmax[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[38],70,goldmin[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[38],71,goldmax[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[39],70,goldmin[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[39],71,goldmax[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[40],70,goldmin[4])call SaveInteger(udg_hash,udg_Wave_Unit_tape[40],71,goldmax[4])endfunctionfunction InitTrig_Init_System_Receiving_Gold_for_Creeps takes nothing returns nothingset gg_trg_Init_System_Receiving_Gold_for_Creeps=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Init_System_Receiving_Gold_for_Creeps,3.,false)call TriggerAddAction(gg_trg_Init_System_Receiving_Gold_for_Creeps,function Trig_Init_System_Receiving_Gold_for_Creeps_Actions)endfunctionfunction Trig_Init_System_Receiving_Experience_for_Creeps_Actions takes nothing returns nothinglocal real factor=.75local real factorwavelocal integer wavenumber
local integer array xpconstlocal integer array xpset xpconst[1]=8
set xpconst[2]=7
set xpconst[3]=$Dset xpconst[4]=$87call SaveInteger(udg_hash,'n01D',82,50)call SaveInteger(udg_hash,'u00F',82,35)call SaveInteger(udg_hash,'u00H',82,'h')
call SaveInteger(udg_hash,'n011',82,30)call SaveInteger(udg_hash,'n00T',82,24)call SaveInteger(udg_hash,'n00X',82,8)call SaveInteger(udg_hash,'n00Z',82,40)call SaveInteger(udg_hash,'u00G',82,52)call SaveInteger(udg_hash,'n00A',82,70)set wavenumber=1
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[1],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[2],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[3],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[4],82,xp[4])set wavenumber=2
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[5],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[6],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[7],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[8],82,xp[4])set wavenumber=3
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[9],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$A],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$B],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$C],82,xp[4])set wavenumber=4
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[$D],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$E],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[$F],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[16],82,xp[4])set wavenumber=5
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[17],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[18],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[19],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[20],82,xp[4])set wavenumber=6
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[21],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[22],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[23],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[24],82,xp[4])set wavenumber=7
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[25],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[26],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[27],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[28],82,xp[4])set wavenumber=8
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[29],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[30],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[31],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[32],82,xp[4])set wavenumber=9
set factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[33],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[34],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[35],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[36],82,xp[4])set wavenumber=$Aset factorwave=1.+(factor*(wavenumber-1))set xp[1]=R2I((xpconst[1]*factorwave)+.5)set xp[2]=R2I((xpconst[2]*factorwave)+.5)set xp[3]=R2I((xpconst[3]*factorwave)+.5)set xp[4]=R2I((xpconst[4]*factorwave)+.5)call SaveInteger(udg_hash,udg_Wave_Unit_tape[37],82,xp[1])call SaveInteger(udg_hash,udg_Wave_Unit_tape[38],82,xp[2])call SaveInteger(udg_hash,udg_Wave_Unit_tape[39],82,xp[3])call SaveInteger(udg_hash,udg_Wave_Unit_tape[40],82,xp[4])endfunctionfunction InitTrig_Init_System_Receiving_Experience_for_Creeps takes nothing returns nothingset gg_trg_Init_System_Receiving_Experience_for_Creeps=CreateTrigger()call TriggerAddAction(gg_trg_Init_System_Receiving_Experience_for_Creeps,function Trig_Init_System_Receiving_Experience_for_Creeps_Actions)endfunctionfunction Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Condition_Actions takes nothing returns booleanreturn(GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405 and IsUnitIllusion(GetFilterUnit())==false and IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO) and IsUnitEnemy(GetFilterUnit(),udg_Temp_Player[1]))!=nullendfunctionfunction Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Actions takes nothing returns nothinglocal unit creep=GetDyingUnit()local integer xp=LoadInteger(udg_hash,GetUnitTypeId(creep),82)local group g=CreateGroup()local integer countlocal unit Pickedlocal boolean normalmob=LoadBoolean(udg_hash,GetHandleId(creep),83)if xp>0 then
set udg_Temp_Player[1]=GetOwningPlayer(creep)call GroupEnumUnitsInRange(g,GetUnitX(creep),GetUnitY(creep),1200.,Filter(function Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Condition_Actions))set count=CountUnitsInGroup(g)if normalmob==false then
set xp=R2I((xp/ 2)+.5)endifloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullcall AddHeroXP(Picked,R2I((xp/ count)+.5),true)call GroupRemoveUnit(g,Picked)endloopendifset creep=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Conditions takes nothing returns boolean
return IsUnitIllusion(GetDyingUnit())==false and GetUnitAbilityLevel(GetDyingUnit(),'Aloc')<=0 and GetUnitTypeId(GetDyingUnit())!='h00U' and(GetOwningPlayer(GetDyingUnit())==Player(9)or GetOwningPlayer(GetDyingUnit())==Player($A)or GetOwningPlayer(GetDyingUnit())==Player($B))
endfunctionfunction InitTrig_Add_Experience_System_Receiving_Experience_for_Creeps takes nothing returns nothinglocal integer index=0set gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps,Condition(function Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Conditions))
call TriggerAddAction(gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps,function Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Actions)endfunctionfunction Trig_Init_Potion_System_Actions takes nothing returns nothingset udg_Potion_Effect[1]="war3mapImported\\Item_Potion_TinyGreen.mdl"set udg_Potion_Type[1]="life"set udg_Potion_Heal_Amount[1]=80
set udg_Potion_Size[1]=1.2set udg_Potion_Effect[2]="war3mapImported\\Item_Potion_TinyBlue.mdl"
set udg_Potion_Type[2]="mana"set udg_Potion_Heal_Amount[2]=55
set udg_Potion_Size[2]=1.2set udg_Potion_Effect[3]="war3mapImported\\Item_Potion_SmallGreen.mdl"set udg_Potion_Type[3]="life"set udg_Potion_Heal_Amount[3]=$A0set udg_Potion_Size[3]=1.35set udg_Potion_Effect[4]="war3mapImported\\Item_Potion_SmallBlue.mdl"set udg_Potion_Type[4]="mana"set udg_Potion_Heal_Amount[4]='x'set udg_Potion_Size[4]=1.35set udg_Potion_Effect[5]="war3mapImported\\Item_Potion_BigGreen.mdl"
set udg_Potion_Type[5]="life"set udg_Potion_Heal_Amount[5]=305set udg_Potion_Size[5]=1.4set udg_Potion_Effect[6]="war3mapImported\\Item_Potion_BigBlue.mdl"set udg_Potion_Type[6]="mana"set udg_Potion_Heal_Amount[6]=$DCset udg_Potion_Size[6]=1.4set udg_Potion_Effect[7]="war3mapImported\\Item_Potion_LargeGreen.mdl"set udg_Potion_Type[7]="life"set udg_Potion_Heal_Amount[7]=555set udg_Potion_Size[7]=1.55set udg_Potion_Effect[8]="war3mapImported\\Item_Potion_LargeBlue.mdl"set udg_Potion_Type[8]="mana"set udg_Potion_Heal_Amount[8]=405set udg_Potion_Size[8]=1.55endfunctionfunction InitTrig_Init_Potion_System takes nothing returns nothingset gg_trg_Init_Potion_System=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Init_Potion_System,1.,false)call TriggerAddAction(gg_trg_Init_Potion_System,function Trig_Init_Potion_System_Actions)endfunctionfunction Trig_Mob_Dead_Create_Potion_Conditions takes nothing returns booleanreturn((GetOwningPlayer(GetDyingUnit())==Player($B)or GetOwningPlayer(GetDyingUnit())==Player($A)or GetOwningPlayer(GetDyingUnit())==Player(9))and GetRandomInt(1,'d')<=8 and IsUnitType(GetDyingUnit(),UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(GetDyingUnit())!='h00U' and IsUnitIllusion(GetDyingUnit())==false and IsUnitType(GetDyingUnit(),UNIT_TYPE_SUMMONED)==false)!=nullendfunctionfunction Trig_Mob_Dead_Create_Potion_Actions takes nothing returns nothinglocal integer minint
local integer maxint
local integer numberwave=udg_Nomer_samoi_volniif numberwave>=1 and numberwave<=3 thenset minint=1
endifif numberwave>=4 and numberwave<=6 thenset minint=3
endifif numberwave>=7 and numberwave<=9 thenset minint=5
endifif numberwave>=$A thenset minint=7
endifif numberwave==1 thenset maxint=2
endifif numberwave>=2 and numberwave<=4 thenset maxint=4
endifif numberwave>=5 and numberwave<=7 thenset maxint=6
endifif numberwave>=8 thenset maxint=8
endifcall CreatePotion(GetUnitX(GetDyingUnit()),GetUnitY(GetDyingUnit()),minint,maxint)endfunctionfunction InitTrig_Mob_Dead_Create_Potion takes nothing returns nothinglocal integer index=0set gg_trg_Mob_Dead_Create_Potion=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Mob_Dead_Create_Potion,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Mob_Dead_Create_Potion,Condition(function Trig_Mob_Dead_Create_Potion_Conditions))call TriggerAddAction(gg_trg_Mob_Dead_Create_Potion,function Trig_Mob_Dead_Create_Potion_Actions)endfunctionfunction Trig_Check_Potion_Picked_Up_Conditions takes nothing returns booleanreturn(GetUnitState(GetEnteringUnit(),UNIT_STATE_LIFE)>.405 and IsUnitType(GetEnteringUnit(),UNIT_TYPE_HERO)and GetPlayerId(GetOwningPlayer(GetEnteringUnit()))<=8)!=nullendfunctionfunction Trig_Check_Potion_Picked_Up_Actions takes nothing returns nothinglocal region reg=GetTriggeringRegion()local unit hero=GetEnteringUnit()local unit dammi=LoadUnitHandle(udg_hash,GetHandleId(reg),1)
local rect rct=LoadRectHandle(udg_hash,GetHandleId(reg),2)local integer potionindex=LoadInteger(udg_hash,GetHandleId(dammi),1)
local effect ef=LoadEffectHandle(udg_hash,GetHandleId(dammi),2)local string healtype=udg_Potion_Type[potionindex]local integer heal=udg_Potion_Heal_Amount[potionindex]local real x=GetUnitX(hero)local real y=GetUnitY(hero)local real xp=GetUnitState(hero,UNIT_STATE_LIFE)
local real xpmax=GetUnitState(hero,UNIT_STATE_MAX_LIFE)local real mp=GetUnitState(hero,UNIT_STATE_MANA)
local real mpmax=GetUnitState(hero,UNIT_STATE_MAX_MANA)local texttag txtlocal real vel=.0221875local real angle=45.+GetRandomReal(.0,90.)local real xvel=vel*Cos(angle*bj_DEGTORAD)local real yvel=vel*Sin(angle*bj_DEGTORAD)local boolean hil=falseif healtype=="life" and(xp<xpmax)thencall SetUnitState(hero,UNIT_STATE_LIFE,xp+heal)call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",hero,"origin"),2.)set txt=CreateTextTag()call SetTextTagText(txt,"|cFF00DC00+"+I2S(heal)+"|r",.03)set hil=true
endifif healtype=="mana" and(mp<mpmax)thencall SetUnitState(hero,UNIT_STATE_MANA,mp+heal)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",hero,"origin"))set txt=CreateTextTag()call SetTextTagText(txt,"|c000347FC+"+I2S(heal)+"|r",.03)set hil=true
endifif hil thencall KillUnit(dammi)
call DestroyEffect(ef)call SetTextTagPos(txt,x,y,.0)call SetTextTagColor(txt,0,0,0,$C8)call SetTextTagVelocity(txt,xvel,yvel)call SetTextTagLifespan(txt,3.)call SetTextTagFadepoint(txt,.0)
call SetTextTagPermanent(txt,false)call FlushChildHashtable(udg_hash,GetHandleId(reg))call FlushChildHashtable(udg_hash,GetHandleId(dammi))call RemoveRect(rct)
call RemoveRegion(reg)endifset reg=null
set hero=nullset dammi=nullset rct=null
set ef=nullset txt=null
endfunctionfunction InitTrig_Check_Potion_Picked_Up takes nothing returns nothingset gg_trg_Check_Potion_Picked_Up=CreateTrigger()call TriggerAddCondition(gg_trg_Check_Potion_Picked_Up,Condition(function Trig_Check_Potion_Picked_Up_Conditions))call TriggerAddAction(gg_trg_Check_Potion_Picked_Up,function Trig_Check_Potion_Picked_Up_Actions)endfunctionfunction Trig_InitSystem_ForGroup takes nothing returns nothingcall SetPlayerAbilityAvailable(GetEnumPlayer(),'A66B',false)
endfunctionfunction Trig_InitSystem_Actions takes nothing returns nothinglocal group g=CreateGroup()local unit Pickedcall ForForce(bj_FORCE_ALL_PLAYERS,function Trig_InitSystem_ForGroup)call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitType(Picked,UNIT_TYPE_STRUCTURE)!=true then
call GroupAddUnit(udg_DamageGroup,Picked)call UnitAddAbility(Picked,'A66B')call UnitMakeAbilityPermanent(Picked,true,'A66B')call UnitMakeAbilityPermanent(Picked,true,'A666')call TriggerRegisterUnitEvent(gg_trg_AddDamage,Picked,EVENT_UNIT_DAMAGED)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall DestroyGroup(g)
set g=nullendfunctionfunction InitTrig_InitSystem takes nothing returns nothingset gg_trg_InitSystem=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_InitSystem,.01,false)call TriggerAddAction(gg_trg_InitSystem,function Trig_InitSystem_Actions)endfunctionfunction Trig_EnterUnit_Conditions takes nothing returns boolean
return IsUnitInGroup(GetEnteringUnit(),udg_DamageGroup)==falseendfunctionfunction Trig_EnterUnit_Actions takes nothing returns nothinglocal unit u=GetEnteringUnit()if GetUnitTypeId(u)!='h00U' and IsUnitType(u,UNIT_TYPE_STRUCTURE)!=true and GetUnitTypeId(u)!='h00C' thencall GroupAddUnit(udg_DamageGroup,u)
call UnitAddAbility(u,'A66B')call UnitMakeAbilityPermanent(u,true,'A66B')
call UnitMakeAbilityPermanent(u,true,'A666')
call TriggerRegisterUnitEvent(gg_trg_AddDamage,u,EVENT_UNIT_DAMAGED)
endifset u=nullendfunctionfunction InitTrig_EnterUnit takes nothing returns nothinglocal region rectRegion=CreateRegion()set gg_trg_EnterUnit=CreateTrigger()
call RegionAddRect(rectRegion,GetWorldBounds())call TriggerRegisterEnterRegion(gg_trg_EnterUnit,rectRegion,null)call TriggerAddCondition(gg_trg_EnterUnit,Condition(function Trig_EnterUnit_Conditions))
call TriggerAddAction(gg_trg_EnterUnit,function Trig_EnterUnit_Actions)endfunctionfunction Trig_Remove_Bonus_Marshal_Armor_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)call SetUnitLifeAndManaRegeneration(damaged,"life",-1)call SetArmorAbilityLevel(damaged,-1)call SaveInteger(udg_hash,GetHandleId(damaged),$99,LoadInteger(udg_hash,GetHandleId(damaged),$99)-1)
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damaged=null
endfunctionfunction Trig_Remove_ASBonus_Double_Attack_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damager=LoadUnitHandle(udg_hash,h,1)call DestroyEffect(LoadEffectHandle(udg_hash,h,2))call DestroyEffect(LoadEffectHandle(udg_hash,h,3))call UnitRemoveAbility(damager,'A0P4')call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damager=null
endfunctionfunction Trig_Remove_Lightning_From_Staff_Of_Lightning_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit Picked=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local unit damaged=LoadUnitHandle(udg_hash,h,3)local lightning l=LoadLightningHandle(udg_hash,h,4)local location locr=GetUnitLoc(damaged)local location locd=GetUnitLoc(Picked)set wait=wait-1call SaveInteger(udg_hash,h,2,wait)call MoveLightningEx(l,true,GetUnitX(damaged),GetUnitY(damaged),GetUnitFlyHeight(damaged)+25.+GetLocationZ(locr),GetUnitX(Picked),GetUnitY(Picked),GetUnitFlyHeight(Picked)+25.+GetLocationZ(locd))if wait<=0 thencall DestroyLightning(l)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset Picked=nullset damaged=null
set l=nullcall RemoveLocation(locr)call RemoveLocation(locd)set locr=nullset locd=nullendfunctionfunction Trig_Beorn_Rage_Remove_Effects_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local effect efset ef=LoadEffectHandle(udg_hash,h,2)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullcall SaveBoolean(udg_hash,GetHandleId(damaged),$84,false)call SetAttackSpeedAbilityLevel(damaged,-50)
call SetAttackAbilityLevel(damaged,-$A)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set damaged=null
set t=nullendfunctionfunction Trig_Blood_Bow_Remove_Effects_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer attackspeed=LoadInteger(udg_hash,h,1)local unit damager=LoadUnitHandle(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall SetAttackSpeedAbilityLevel(damager,-attackspeed)call SetAttackAbilityLevel(damager,-R2I(attackspeed/ 2))
call SaveInteger(udg_hash,GetHandleId(damager),$82,0)call SaveTimerHandle(udg_hash,GetHandleId(damager),$81,null)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set damager=null
set t=nullendfunctionfunction Trig_Moon_Chackrum_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damager=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,$C)local integer count=LoadInteger(udg_hash,h,3)local unit glaive=LoadUnitHandle(udg_hash,h,$A)local unit target2local real damagelocal real damagemagiclocal group gdamagelocal real heightlocal effect eflocal real x=GetUnitX(glaive)local real y=GetUnitY(glaive)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real xorblocal real yorblocal real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local player plocal group glocal group grup
local unit Pickedlocal boolean remove=falselocal boolean reselect=false
local unit orb2local effect ef2
local boolean nightlocal string str
local real resistif GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset xorb=x+27.*Cos(angle*bj_DEGTORAD)set yorb=y+27.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(glaive,xorb,yorb)set dist=SquareRoot((xt-xorb)*(xt-xorb)+(yt-yorb)*(yt-yorb))
call SetUnitFacing(glaive,angle)
if dist<21. then
call SetUnitPosition(glaive,xt,yt)set p=GetOwningPlayer(damager)set gdamage=LoadGroupHandle(udg_hash,h,9)set night=LoadBoolean(udg_hash,h,4)call SetUnitPosition(glaive,xt,yt)if GetUnitState(target,UNIT_STATE_LIFE)>.0 and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(target)!='h00U' and GetUnitTypeId(target)!='uplg' thenset damage=LoadReal(udg_hash,h,2)set damagemagic=LoadReal(udg_hash,h,20)set resist=LoadReal(udg_hash,h,21)set damage=damage*resist
set damagemagic=damagemagic*resistcall SaveReal(udg_hash,h,2,damage)call SaveReal(udg_hash,h,20,damagemagic)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",target,"chest"))call UnitDamageTarget(damager,target,ConvertMagicAndChaosDamageInClear(target,damagemagic,damage),false,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)if night thencall DestroyEffect(AddSpecialEffectTarget("Effects\\SoundTrauma.mdl",target,"chest"))endifcall GroupAddUnit(gdamage,target)endifset count=count-1call SaveInteger(udg_hash,h,3,count)
call SaveGroupHandle(udg_hash,h,9,gdamage)set reselect=trueset p=nullset gdamage=null
endifendifif count>0 and reselect then
set grup=CreateGroup()set p=GetOwningPlayer(damager)set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,350.,null)set gdamage=LoadGroupHandle(udg_hash,h,9)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitInGroup(Picked,gdamage)==false and IsUnitEnemy(Picked,p) and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' and GetUnitTypeId(Picked)!='uplg' then
call GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall RandomUnitFromGroup(1,grup)
set target2=FirstOfGroup(udg_GroupRandomUnitFromGroup)set p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullif target2!=null thenset x=GetUnitX(glaive)set y=GetUnitY(glaive)set xt=GetUnitX(target2)
set yt=GetUnitY(target2)
set dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))
set angle=bj_RADTODEG*Atan2((yt-y),(xt-x))set p=GetOwningPlayer(damager)set ef=LoadEffectHandle(udg_hash,h,$B)call DestroyEffect(ef)set ef=nullset orb2=CreateUnit(p,'h00U',x,y,angle)call RemoveUnit(glaive)set glaive=nullif night thenset str="Effects\\BlueGlaivie.mdl"call SetUnitScale(orb2,.6,.6,.6)
else
set str="Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl"endifset ef2=AddSpecialEffectTarget(str,orb2,"origin")call DestroyEffect(AddSpecialEffectTarget(str,target2,"chest"))call UnitAddAbility(orb2,'Amrf')
call UnitRemoveAbility(orb2,'Amrf')call SetUnitFlyHeight(orb2,45.,.0)call SaveUnitHandle(udg_hash,h,$A,orb2)call SaveEffectHandle(udg_hash,h,$B,ef2)
call SaveUnitHandle(udg_hash,h,$C,target2)set p=nullset orb2=nullset ef2=null
set target2=null
else
set remove=trueendifset target2=null
set p=nullset gdamage=null
endifif count<=0 or(GetUnitState(target,UNIT_STATE_LIFE)<.405)thenset remove=trueendifif remove thencall RemoveUnit(glaive)set glaive=nullset ef=LoadEffectHandle(udg_hash,h,$B)call DestroyEffect(ef)set ef=nullset gdamage=LoadGroupHandle(udg_hash,h,9)call GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call DestroyTimer(t)
set Picked=nullcall FlushChildHashtable(udg_hash,h)
endifset t=nullset damager=null
set glaive=nullset target=nullendfunctionfunction Trig_Stone_Armor_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit casterlocal unit dammi=LoadUnitHandle(udg_hash,h,2)local integer wait2=LoadInteger(udg_hash,h,3)local unit target=LoadUnitHandle(udg_hash,h,4)local real damagelocal real heightlocal effect eflocal real x=GetUnitX(dammi)
local real y=GetUnitY(dammi)
local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-y,xt-x)local real distlocal boolean destroy=falseif GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset wait2=wait2-1call SaveInteger(udg_hash,h,3,wait2)
if wait2==0 then
set height=LoadReal(udg_hash,h,6)call SetUnitFlyHeight(dammi,.0,height*3.33)endifset x=x+24.*Cos(angle*bj_DEGTORAD)set y=y+24.*Sin(angle*bj_DEGTORAD)call SetUnitFacing(dammi,GetUnitFacing(dammi)+30.)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(dammi,x,y)endifset dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))
if dist<25. then
set caster=LoadUnitHandle(udg_hash,h,1)set damage=LoadReal(udg_hash,h,5)set destroy=true
call SetUnitFlyHeight(dammi,GetUnitFlyHeight(target)+50.,.0)
call SetUnitPosition(dammi,xt,yt)call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",target,"chest"))call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GetUnitX(target),GetUnitY(target)))call MoveUnit(target,.3,600.,900.,angle,.0,true)
set caster=nullendifelse
set destroy=true
endifif destroy thencall RemoveUnit(dammi)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset target=nullset dammi=nullendfunctionfunction Trig_IsMinimapPingGuardsAttacked_Refresh_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()set udg_IsMinimapPingGuardsAttacked=falsecall DestroyTimer(t)
set t=nullendfunctionfunction Trig_Archimagus_Armor_Timer_Death_Denial_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local integer hd=GetHandleId(damaged)local effect efif LoadBoolean(udg_hash,hd,'f') then
set ef=AddSpecialEffectTarget("Effects\\MagicShieldBlue.mdx",damaged,"origin")call SaveEffectHandle(udg_hash,hd,'g',ef)call SaveReal(udg_hash,hd,'i',(500.+(GetHeroInt(damaged,true)*3.)))endifcall SaveReal(udg_hash,hd,'h',.0)call SaveBoolean(udg_hash,hd,'j',false)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set damaged=null
set t=nullset ef=nullendfunctionfunction Trig_Cuirass_of_Invulnerable_Timer_Death_Denial_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local integer hd=GetHandleId(damaged)local effect efif LoadBoolean(udg_hash,hd,94) thenset ef=AddSpecialEffectTarget("Effects\\PurpleSphere.mdx",damaged,"chest")call SaveEffectHandle(udg_hash,hd,95,ef)
endifcall SaveBoolean(udg_hash,hd,$A2,false)call SaveReal(udg_hash,hd,96,.0)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set damaged=null
set t=nullset ef=nullendfunctionfunction Trig_Wind_Bow_Remove_Attack_Speed_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer attackspeed=LoadInteger(udg_hash,h,1)local unit damager=LoadUnitHandle(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall SetAttackSpeedAbilityLevel(damager,-attackspeed)call SaveTimerHandle(udg_hash,GetHandleId(damager),92,null)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set damager=null
set t=nullendfunctionfunction Trig_Pancir_Iachera_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local unit dammi=LoadUnitHandle(udg_hash,h,2)local integer wait=LoadInteger(udg_hash,h,3)
local real angle=LoadReal(udg_hash,h,4)local real damagelocal real stuntimelocal effect eflocal real x=GetUnitX(dammi)
local real y=GetUnitY(dammi)
local real xnew=x+24.*Cos(angle*bj_DEGTORAD)
local real ynew=y+24.*Sin(angle*bj_DEGTORAD)
local player p=GetOwningPlayer(damaged)local unit Pickedlocal group g=CreateGroup()local boolean destroy=falseset wait=wait-1call SaveInteger(udg_hash,h,3,wait)if wait>0 thenif IsTerrainPathable(xnew,ynew,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(dammi,xnew,ynew)endifcall GroupEnumUnitsInRange(g,xnew,ynew,100.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset damage=LoadReal(udg_hash,h,5)set stuntime=LoadReal(udg_hash,h,6)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FireBallMissile\\FireBallMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"chest"))call UnitDamageTarget(damaged,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call StunUnitTimed(Picked,stuntime)set destroy=true
endifcall GroupRemoveUnit(g,Picked)endloopelse
set destroy=true
endifif destroy thenset ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall KillUnit(dammi)
set dammi=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset damaged=null
set t=nullset dammi=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullendfunctionfunction Trig_Pancir_Iachera_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damager=LoadUnitHandle(udg_hash,h,1)call SetAttackAbilityLevel(damager,$E)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damager=null
endfunctionfunction Trig_Spirit_of_Absorption_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damager=LoadUnitHandle(udg_hash,h,1)local real damage=LoadReal(udg_hash,h,2)
local real manaburn=LoadReal(udg_hash,h,3)local integer wait=LoadInteger(udg_hash,h,4)
local unit dammi=LoadUnitHandle(udg_hash,h,5)local group gdamage=LoadGroupHandle(udg_hash,h,6)local effect eflocal real x=GetUnitX(dammi)
local real y=GetUnitY(dammi)
local player p=GetOwningPlayer(damager)local unit Pickedlocal group g=CreateGroup()set wait=wait-1call SaveInteger(udg_hash,h,4,wait)if wait>0 thencall GroupEnumUnitsInRange(g,x,y,100.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and(IsUnitInGroup(Picked,udg_PortalCastersMagi)==false)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\OrbOfDeath\\OrbOfDeathMissile.mdl",Picked,"chest"))call UnitDamageTarget(damager,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call SetUnitState(Picked,UNIT_STATE_MANA,GetUnitState(Picked,UNIT_STATE_MANA)-manaburn)call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,6,gdamage)else
call SetUnitTimeScale(dammi,1.)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\OrbOfDeath\\OrbOfDeathMissile.mdl",x,y))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\OrbOfDeath\\AnnihilationMissile.mdl",x,y))call RemoveUnit(dammi)set dammi=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset damager=null
set t=nullset dammi=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gdamage=null
set p=nullset Picked=nullendfunctionfunction Trig_Triple_Strike_Move_And_Attack_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damager=LoadUnitHandle(udg_hash,h,1)local unit damaged=LoadUnitHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local integer wait=LoadInteger(udg_hash,h,4)
local integer lvl=LoadInteger(udg_hash,h,$A)
local real xdr=GetUnitX(damager)
local real ydr=GetUnitY(damager)
local real xdd=GetUnitX(damaged)
local real ydd=GetUnitY(damaged)
local real angle=(LoadReal(udg_hash,h,5))+120.local real x=xdd+100.*Cos(angle*bj_DEGTORAD)
local real y=ydd+100.*Sin(angle*bj_DEGTORAD)
local group glocal unit Pickedlocal player pcall SaveReal(udg_hash,h,5,angle)set wait=wait+1call SaveInteger(udg_hash,h,4,wait)if wait<=4 thenset damage=(damage*(.3+.1*lvl))if wait==3 thencall SetUnitX(damager,x)
call SetUnitY(damager,y)
call SetUnitFacing(damager,angle+180.)call SaveReal(udg_hash,h,8,xdd)call SaveReal(udg_hash,h,9,ydd)call SetUnitTimeScale(damager,1.4)call SetUnitAnimationByIndex(damager,3)call TimerStart(t,.6,false,function Trig_Triple_Strike_Move_And_Attack_Actions)endifif wait==4 thenset g=CreateGroup()call GroupEnumUnitsInRange(g,LoadReal(udg_hash,h,8),LoadReal(udg_hash,h,9),200.,null)set p=GetOwningPlayer(damager)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(damager,Picked,damage+(30*lvl),false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopcall DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl",LoadReal(udg_hash,h,8),LoadReal(udg_hash,h,9)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl",LoadReal(udg_hash,h,8),LoadReal(udg_hash,h,9)))call TimerStart(t,.0,false,function Trig_Triple_Strike_Move_And_Attack_Actions)endifif wait<3 thenif GetRandomInt(1,2)==1 then
call SetUnitAnimationByIndex(damager,8)else
call SetUnitAnimationByIndex(damager,2)endifcall SetUnitX(damager,x)
call SetUnitY(damager,y)
call SetUnitFacing(damager,angle+180.)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl",damager,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",damaged,"chest"))call UnitDamageTarget(damager,damaged,damage,true,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifelse
call SaveBoolean(udg_hash,GetHandleId(damager),61,false)
call DestroyEffect(LoadEffectHandle(udg_hash,h,6))call DestroyEffect(LoadEffectHandle(udg_hash,h,7))call SetUnitInvulnerable(damager,false)call SetUnitPathing(damager,true)call SetUnitAnimation(damager,"Stand")call SetUnitTimeScale(damager,1.)call SetUnitTurnSpeed(damager,GetUnitDefaultTurnSpeed(damager))call IssueImmediateOrderById(damager,$D0004)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset damager=null
set damaged=null
call GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset p=nullendfunctionfunction Trig_Damage_Unit_With_Wait_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local unit damager=LoadUnitHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local string str=LoadStr(udg_hash,h,4)if str=="phys" thencall UnitDamageTarget(damager,damaged,damage,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifif str=="magic" then
call UnitDamageTarget(damager,damaged,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifif str=="clear" then
call UnitDamageTarget(damager,damaged,damage,false,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
endifcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damaged=null
set damager=null
endfunctionfunction Trig_Make_Unit_UnInvulnerable_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)call SetUnitInvulnerable(damaged,false)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damaged=null
endfunctionfunction Trig_Hil_Unit_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local real hil=LoadReal(udg_hash,h,2)call SetUnitState(damaged,UNIT_STATE_LIFE,GetUnitState(damaged,UNIT_STATE_LIFE)+hil)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damaged=null
endfunctionfunction Trig_Trolls_Evasion_Salto_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)local integer i=LoadInteger(udg_hash,h,2)if i==0 then
call SaveInteger(udg_hash,h,2,1)
call TimerStart(t,.5,false,function Trig_Trolls_Evasion_Salto_Actions)call SetUnitTimeScale(damaged,1.75)else
call PauseUnit(damaged,false)call SetUnitTimeScale(damaged,1.)if GetUnitState(damaged,UNIT_STATE_LIFE)>.405 thencall SetUnitAnimation(damaged,"Stand")endifcall SetUnitInvulnerable(damaged,false)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset damaged=null
endfunctionfunction Trig_Dark_Crypt_Fiend_Attack_Unbuff_Dispel_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damaged=LoadUnitHandle(udg_hash,h,1)call SetArmorAbilityLevel(damaged,2)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damaged=null
endfunctionfunction Trig_Varmosar_Lightning_Destroy_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local lightning l=LoadLightningHandle(udg_hash,h,1)call DestroyLightning(l)
set l=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_AddDamage_Refresh_Creep_Assists_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local player pr=LoadPlayerHandle(udg_hash,h,1)local force players=LoadForceHandle(udg_hash,h,2)local integer hdd=LoadInteger(udg_hash,h,3)call ForceRemovePlayer(players,pr)call SaveForceHandle(udg_hash,hdd,72,players)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset pr=nullset players=null
endfunctionfunction Trig_AddDamage_Refresh_Magic_Damage_Handle_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer hdd=LoadInteger(udg_hash,h,1)call SaveBoolean(udg_hash,hdd,$9D,false)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_AddDamage_Refresh_Handle_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer hdd=LoadInteger(udg_hash,h,2)call SaveInteger(udg_hash,hdd,$AA,0)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_AddDamage_Actions takes nothing returns nothinglocal unit damager=GetEventDamageSource()local unit damaged=GetTriggerUnit()local real damage=GetEventDamage()local integer hdr=GetHandleId(damager)local integer hdd=GetHandleId(damaged)local real xr=GetUnitX(damager)local real yr=GetUnitY(damager)local real xd=GetUnitX(damaged)local real yd=GetUnitY(damaged)local player pr=GetOwningPlayer(damager)
local player pd=GetOwningPlayer(damaged)
local location locrlocal location locdlocal unit dammi
local unit Pickedlocal unit u
local lightning llocal timer tlocal integer hlocal timer t2local integer h2
local timer t3local integer h3
local texttag txtlocal integer ilocal integer lvllocal integer countlocal effect eflocal real angle
local real r1local real r2local real r3local real r4local string str
local group glocal group g2local force playerslocal boolean boollocal real distlocal boolean blocal player plocal group gdamagefromdamagerlocal group gdamagefromdamagedlocal integer random
local boolean meleelocal boolean physical=false
local boolean loadphysical=false
if 1==2 then
set t=CreateTimer()set h=GetHandleId(t)
call SaveInteger(udg_hash,h,2,hdd)call TimerStart(t,.0,false,function Trig_AddDamage_Refresh_Handle_Actions)set t=nullendifif(GetUnitAbilityLevel(damaged,'B00M')>0 or GetUnitAbilityLevel(damaged,'B00L')>0)thenif GetUnitAbilityLevel(GetTriggerUnit(),'B00M')>0 thenset melee=trueelse
set melee=falseendifset physical=truecall UnitRemoveAbility(GetTriggerUnit(),'B00M')call UnitRemoveAbility(GetTriggerUnit(),'B00L')endifset gdamagefromdamager=CreateGroup()
set gdamagefromdamaged=CreateGroup()
if damage>=.01 and physical then
if GetUnitTypeId(damager)=='N00W' thenset t=CreateTimer()set h=GetHandleId(t)
set locr=GetUnitLoc(damager)
set locd=GetUnitLoc(damaged)
set l=AddLightningEx("CLPB",true,xr,yr,GetUnitFlyHeight(damager)+125.+GetLocationZ(locr),xd,yd,GetUnitFlyHeight(damaged)+30.+GetLocationZ(locd))
call SaveLightningHandle(udg_hash,h,1,l)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",damaged,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\ChimaeraLightningMissile\\ChimaeraLightningMissile.mdl",damaged,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Effects\\OrbOfLightning.mdx",damaged,"origin"))call TimerStart(t,.3,false,function Trig_Varmosar_Lightning_Destroy_Actions)
set l=nullcall RemoveLocation(locr)call RemoveLocation(locd)set locr=nullset locd=nullset t=nullendifif GetUnitAbilityLevel(damager,'A051')>0 and GetRandomInt(1,4)==1 thenset g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,250.,null)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",xd,yd))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(damager,Picked,100.+25*CountPlayersInForceBJ(udg_IGRAET),false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,1.)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendifif GetUnitAbilityLevel(damager,'A06Z')>0 and GetRandomInt(1,'d')<=8 and LoadInteger(udg_hash,GetHandleId(damager),64)<(GetUnitAbilityLevel(damager,'A06Z')+2)thenset dammi=CreateUnit(pr,udg_spirits_of_water[GetUnitAbilityLevel(damager,'A06Z')],xd,yd,GetRandomReal(0,360))call SaveUnitHandle(udg_hash,GetHandleId(dammi),63,damager)call SaveInteger(udg_hash,GetHandleId(damager),64,LoadInteger(udg_hash,GetHandleId(damager),64)+1)endifif GetUnitAbilityLevel(damager,'A07J')>0 and GetRandomInt(1,'d')<=$A and LoadInteger(udg_hash,hdr,'z')<=$E thencall SetAttackAbilityLevel(damager,2)call SetUnitMaxState(damager,UNIT_STATE_MAX_LIFE,20)
call SaveInteger(udg_hash,hdr,'z',LoadInteger(udg_hash,hdr,'z')+1)if LoadInteger(udg_hash,hdr,'z')==$F thenset ef=AddSpecialEffectTarget("war3mapImported\\s_WateryAura.mdx",damager,"origin")call SaveEffectHandle(udg_hash,hdr,'{',ef)set ef=nullendifendifif GetUnitTypeId(damager)=='u00D' and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false and IsUnitIllusion(damager)==false and GetRandomInt(1,$A)==1 thenset dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A08R')call IssuePointOrderById(dammi,$D00FA,xd,yd)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl",damaged,"chest"))
if GetUnitAbilityLevel(damaged,'A087')<=0 thencall UnitAddAbility(damaged,'A087')call UnitAddAbility(damaged,'A0AH')call UnitAddAbility(damaged,'A0AG')call UnitAddAbility(damaged,'A0D8')call UnitAddAbility(damaged,'A0AT')call UnitAddAbility(damaged,'A0AS')endifcall SetArmorAbilityLevel(damaged,-2)set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call TimerStart(t,10.,false,function Trig_Dark_Crypt_Fiend_Attack_Unbuff_Dispel_Actions)
set t=nullset dammi=nullendifif GetUnitAbilityLevel(damager,'A0EO')>0 thenset h=GetHandleId(damager)set lvl=LoadInteger(udg_hash,h,52)set i=LoadInteger(udg_hash,h,53)
if lvl+i<=30*GetUnitAbilityLevel(damager,'A0EN')-5 thenset lvl=lvl+icall SetHeroAgi(damager,GetHeroAgi(damager,false)+i,true)call ProgressBarAddPercentComplete(LoadUnitHandle(udg_hash,GetHandleId(damager),'u'),(i*100./(30*GetUnitAbilityLevel(damager,'A0EN')-5)))call SaveInteger(udg_hash,h,52,lvl)else
call SetHeroAgi(damager,GetHeroAgi(damager,false)-lvl+(30*GetUnitAbilityLevel(damager,'A0EN'))-5,true)set lvl=30*GetUnitAbilityLevel(damager,'A0EN')-5
call SaveInteger(udg_hash,h,52,lvl)endifendifif GetUnitTypeId(damaged)=='n00U' and IsUnitType(damager,UNIT_TYPE_MAGIC_IMMUNE)==false and GetRandomInt(1,4)==1 thenset dammi=CreateUnit(pd,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0E0')call IssueTargetOrderById(dammi,$D007F,damager)endifif GetUnitAbilityLevel(damager,'A08V')>0 and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false and GetRandomInt(1,'d')<=6 thenset dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A08Z')call IssueTargetOrderById(dammi,$D00CB,damaged)set dammi=nullendifif GetUnitAbilityLevel(damager,'A0E4')>0 and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false and GetRandomInt(1,'d')<=$F thenset dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A092')call IssueTargetOrderById(dammi,$D006B,damaged)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",damaged,"chest"))endifif GetUnitAbilityLevel(damaged,'A0E5')>0 and GetRandomInt(1,5)==1 and 1==2 thenset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveInteger(udg_hash,h,2,0)
if IsTerrainPathable(xd+50.*Cos((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD),yd+50.*Sin((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD),PATHING_TYPE_WALKABILITY)==false thencall SetUnitX(damaged,xd+50.*Cos((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD))
call SetUnitY(damaged,yd+50.*Sin((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD))
endifcall DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\ImpaleTargetDust\\ImpaleTargetDust.mdl",xd+50.*Cos((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD),yd+50.*Sin((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD)))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl",xd+50.*Cos((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD),yd+50.*Sin((180.+bj_RADTODEG*Atan2(yr-yd,xr-xd))*bj_DEGTORAD)))call SetUnitFacing(damaged,bj_RADTODEG*Atan2(yr-yd,xr-xd))call PauseUnit(damaged,true)
call SetUnitTimeScale(damaged,10.)call SetUnitAnimationByIndex(damaged,2)set txt=CreateTextTag()call SetTextTagText(txt,"|cFFFF0000miss!|r",.0275)call SetTextTagPos(txt,xd,yd,.0)
call SetTextTagColor(txt,0,0,0,$C8)call SetTextTagVelocity(txt,.0221875*Cos(45.+GetRandomReal(.0,90.)*bj_DEGTORAD),.0221875*Sin(45.+GetRandomReal(.0,90.)*bj_DEGTORAD))
call SetTextTagLifespan(txt,3.)call SetTextTagFadepoint(txt,.0)
call SetTextTagPermanent(txt,false)call TimerStart(t,.04,false,function Trig_Trolls_Evasion_Salto_Actions)set t=nullset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveReal(udg_hash,h,2,damage)if GetUnitState(damaged,UNIT_STATE_LIFE)<damage then
call SetUnitInvulnerable(damaged,true)else
call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifset t=nullendifif GetUnitAbilityLevel(damager,'A09E')>0 and GetRandomInt(1,2)==1 thenset h=GetHandleId(damager)set i=0set i=LoadInteger(udg_hash,h,54)
if i<=0 then
set i=1set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",damager,"hand, left")
call SaveEffectHandle(udg_hash,h,55,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",damager,"hand, right")call SaveEffectHandle(udg_hash,h,56,ef)set ef=nullendifif i<=8 and i>0 then
set i=i+1call SaveInteger(udg_hash,h,54,i)call SetAttackAbilityLevel(damager,6)endifif i==8 then
set i=i+$Acall SaveInteger(udg_hash,h,54,i)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl",damager,"overhead")call SaveEffectHandle(udg_hash,h,57,ef)call IssueImmediateOrderById(damager,$D0084)
set ef=nullendifendifif GetUnitAbilityLevel(damaged,'A0ET')>0 and LoadBoolean(udg_hash,GetHandleId(damaged),1) thenset lvl=GetUnitAbilityLevel(damaged,'A0EU')set r1=.03*GetUnitAbilityLevel(damaged,'A0ET')+.05set r2=GetUnitFacing(damaged)set angle=(Atan2(GetUnitY(damaged)-GetUnitY(damager),GetUnitX(damaged)-GetUnitX(damager))*bj_RADTODEG)+360.if(angle<=(r2+240.)and angle>=(r2+120.))then
set r1=r1*2if lvl>0 and GetRandomReal(0,'d')<=($B+lvl*4)thenset r1=1.set r3=damage+((.05+(.05*lvl))*GetHeroStr(damaged,true))
call CreateTexttag(""+SubString(R2S(r3),0,StringLength(R2S(r3))-2),.023,'x',xd,yd,.0,.0,.035,3.5)call GroupAddUnit(gdamagefromdamaged,damager)call SaveReal(udg_hash,hdr,$A0,LoadReal(udg_hash,hdr,$A0)+r3)set dammi=CreateUnit(pd,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0EV')call IssueTargetOrderById(dammi,$D007F,damager)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl",damaged,"origin"))endifendifcall SetUnitState(damaged,UNIT_STATE_LIFE,GetUnitState(damaged,UNIT_STATE_LIFE)+damage*r1)endifif GetUnitAbilityLevel(damager,'A0F3')>0 thenset u=udg_herounit[GetPlayerId(pr)+1]if LoadInteger(udg_hash,GetHandleId(u),60)<GetUnitAbilityLevel(damager,'A0F3')+1 and GetUnitAbilityLevel(damager,'Aloc')<=0 and((GetRandomInt(1,'d')<3+(2*GetUnitAbilityLevel(damager,'A0F3'))and IsUnitIllusion(damager)==false)or((GetRandomInt(1,'d')<2+GetUnitAbilityLevel(damager,'A0F3')and IsUnitIllusion(damager))))then
set dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0AY')call SetUnitAbilityLevel(dammi,'A0AY',1+GetUnitAbilityLevel(u,'A0F2'))call IssueTargetOrderById(dammi,$D0132,damager)call SaveBoolean(udg_hash,GetHandleId(dammi),3,false)endifendifif GetUnitAbilityLevel(damager,'B01P')>=1 thencall UnitRemoveAbility(damager,'B01P')call UnitRemoveAbility(damager,'A0GY')endifif GetUnitAbilityLevel(damaged,'B01P')>=1 and GetUnitAbilityLevel(damaged,'A0GY')<1 then
call UnitAddAbility(damaged,'A0GY')endifif GetUnitAbilityLevel(damaged,'A09Y')==1 thencall PauseUnit(damaged,false)call UnitRemoveAbility(damaged,'A09Y')set dammi=CreateUnit(GetOwningPlayer(damaged),'h013',xr,yr,0)call UnitAddAbility(dammi,'A0HF')call SetUnitAbilityLevel(dammi,'A0HF',GetUnitAbilityLevel(damaged,'A0GZ'))call IssueTargetOrderById(dammi,$D02B6,damager)call UnitApplyTimedLife(dammi,'BTLF',.5)
endifif GetUnitAbilityLevel(damager,'B03I')>0 and GetRandomInt(1,'d')<=20 thenset dammi=CreateUnit(GetOwningPlayer(damager),'h013',xr,yr,0)call UnitAddAbility(dammi,'A0HK')call IssueTargetOrderById(dammi,$D0062,damaged)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitRemoveAbility(damager,'B03I')endifif GetUnitAbilityLevel(damager,'A0FF')>0 and GetRandomInt(1,'d')<=(8+2*GetUnitAbilityLevel(damager,'A0FF'))and IsUnitIllusion(damager)==false and LoadBoolean(udg_hash,hdr,61)==false and GetUnitState(damaged,UNIT_STATE_LIFE)>.405 thenset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damager)call SaveUnitHandle(udg_hash,h,2,damaged)call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,0)
call SaveReal(udg_hash,h,5,bj_RADTODEG*Atan2(yr-yd,xr-xd))call SaveBoolean(udg_hash,hdr,61,true)call SaveInteger(udg_hash,h,$A,GetUnitAbilityLevel(damager,'A0FF'))call UnitPeriodicPostionMove(damager,.02,1.2)call SetUnitInvulnerable(damager,true)call SetUnitPathing(damager,false)call SetUnitAnimationByIndex(damager,2)call SetUnitTimeScale(damager,4.)call SetUnitTurnSpeed(damager,3.)if GetRandomInt(1,2)==1 then
call SetUnitAnimationByIndex(damager,8)else
call SetUnitAnimationByIndex(damager,2)endifset ef=AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",damager,"weapon")call SaveEffectHandle(udg_hash,h,6,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl",damager,"weapon")call SaveEffectHandle(udg_hash,h,7,ef)set ef=nullcall TimerStart(t,.2,true,function Trig_Triple_Strike_Move_And_Attack_Actions)set t=nullendifif GetUnitAbilityLevel(damager,'A0GH')>0 and GetRandomInt(1,'d')<=40 and IsUnitIllusion(damager)==false then
set angle=bj_RADTODEG*Atan2(yd-yr,xd-xr)
set r1=200.set r2=100.set r3=xr+50.*Cos(angle*bj_DEGTORAD)
set r4=yr+50.*Sin(angle*bj_DEGTORAD)
set g=CreateGroup()set dammi=CreateUnit(pr,'h01P',r3,r4,angle)call SetUnitVertexColor(dammi,$DC,$DC,$DC,'d')call SetUnitAnimation(dammi,"stand")
call SetUnitTimeScale(dammi,1.5)
call SetUnitAnimationByIndex(dammi,1)set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damager)call SaveReal(udg_hash,h,2,r1)call SaveReal(udg_hash,h,3,r2)call SaveInteger(udg_hash,h,4,66)call SaveUnitHandle(udg_hash,h,5,dammi)call SaveGroupHandle(udg_hash,h,6,g)
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl",dammi,"chest")
call SaveEffectHandle(udg_hash,h,7,ef)set ef=nullcall MoveUnit(dammi,2.,400.,.0,angle,.0,true)call TimerStart(t,.03,true,function Trig_Spirit_of_Absorption_Actions)set t=nullset dammi=nullendifif GetUnitAbilityLevel(damager,'A09O')>0 and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitState(damaged,UNIT_STATE_MAX_MANA)>.0 then
call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+15.)call SetUnitState(damaged,UNIT_STATE_MANA,GetUnitState(damaged,UNIT_STATE_MANA)-15.)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\ArcaneTowerAttack.mdl",damaged,"origin"))
endifset r1=LoadReal(udg_hash,hdr,68)
if GetUnitAbilityLevel(damager,'A0H2')>0 and r1>0 thenset r2=r1-damage
set r3=GetUnitState(damaged,UNIT_STATE_LIFE)
call SaveReal(udg_hash,hdr,68,r2)if r2<.0 thenset r2=damagecall UnitRemoveAbility(damager,'A0H2')call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagicBirthMissile.mdl",damager,"hand,right"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagicBirthMissile.mdl",damager,"hand,left"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagicBirthMissile.mdl",damager,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DevourMagic\\DevourMagicBirthMissile.mdl",damager,"weapon"))endifset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",damaged,"chest"))if damage>=r3 thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)else
call SaveReal(udg_hash,h,2,damage)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifset t=nullendifif GetUnitAbilityLevel(damaged,'A0HN')>0 and GetRandomInt(1,'d')<=40 thenset r1=damage/ 2
set r2=GetUnitState(damaged,UNIT_STATE_LIFE)
set r3=SquareRoot((xr-xd)*(xr-xd)+(yr-yd)*(yr-yd))if damage>=r2 and r1<r2 then
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r1)endifif damage<r2 thenset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveReal(udg_hash,h,2,r1)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifset t=nullset t=CreateTimer()set h=GetHandleId(t)
if r3<=225. then
call GroupAddUnit(gdamagefromdamaged,damager)call SaveReal(udg_hash,hdr,$A0,LoadReal(udg_hash,hdr,$A0)+50.)call SaveUnitHandle(udg_hash,h,1,damager)call SetAttackAbilityLevel(damager,-$E)call TimerStart(t,10.,false,function Trig_Pancir_Iachera_Actions)call StunUnitTimed(damager,1.45)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl",damager,"weapon"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl",damager,"hand,right"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl",damager,"hand,left"))else
set angle=bj_RADTODEG*Atan2(yr-yd,xr-xd)
set dammi=CreateUnit(pd,'h00U',GetUnitX(damaged),GetUnitY(damaged),angle)call SetUnitFlyHeight(dammi,50.,.0)call SetUnitFacing(dammi,angle)set ef=AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",dammi,"chest")
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveUnitHandle(udg_hash,h,2,dammi)call SaveInteger(udg_hash,h,3,50)call SaveReal(udg_hash,h,4,angle)call SaveReal(udg_hash,h,5,250.)
call SaveReal(udg_hash,h,6,1.45)
call SaveEffectHandle(udg_hash,h,7,ef)call TimerStart(t,.03,true,function Trig_Pancir_Iachera_Periodic_Actions)set ef=nullset dammi=nullendifcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FireBallMissile\\FireBallMissile.mdl",damager,"chest"))set t=nullendifif GetUnitAbilityLevel(damager,'A00K')>0 and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false thenset dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A01T')call IssueTargetOrderById(dammi,$D0102,damaged)set dammi=nullendifif GetUnitAbilityLevel(damager,'A0AW')>0 and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false and($B+(3*GetUnitAbilityLevel(damager,'A0AW')))>=GetRandomInt(1,'d')thencall GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+(15.+($A*GetUnitAbilityLevel(damager,'A0AW'))))call StunUnitTimed(damaged,.4+(.2*GetUnitAbilityLevel(damager,'A0AW')))endifif GetUnitAbilityLevel(damager,'A0HV')>0 and GetRandomInt(1,'d')<=18 thenset r1=(damage*.7)+20.call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r1)call CreateTexttag(udg_ColorString[1]+I2S(R2I(r1+damage))+"!|r",.025,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)endifif GetUnitAbilityLevel(damager,'A0K0')>0 and GetRandomInt(1,'d')<=$F thenset r1=(damage*.7)+10.call UnitDamageTarget(damager,damaged,r1,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call CreateTexttag(udg_ColorString[1]+I2S(R2I(r1+damage))+"!|r",.025,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)endifset r1=GetUnitState(damaged,UNIT_STATE_LIFE)
set r2=GetUnitState(damaged,UNIT_STATE_MAX_LIFE)
if(GetUnitAbilityLevel(damager,'A0I1')>0 and(r2*.3)>r1)or(GetUnitAbilityLevel(damager,'A0I3')>0 and(r2*.4)>r1)or(GetUnitAbilityLevel(damager,'A0I2')>0 and(r2*.5)>r1)thenif(GetUnitAbilityLevel(damager,'A0I1'))>0 thenset r3=18.endifif(GetUnitAbilityLevel(damager,'A0I3'))>0 thenset r3=27.endifif(GetUnitAbilityLevel(damager,'A0I2'))>0 thenset r3=36.endifcall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",damaged,"chest"))call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r3)endifif(GetUnitAbilityLevel(damager,'A0I5')>0 and GetRandomInt(1,'d')<=20)or(GetUnitAbilityLevel(damager,'A0I4')>0 and GetRandomInt(1,'d')<=25)or(GetUnitAbilityLevel(damager,'A0I6')>0 and GetRandomInt(1,'d')<=30)thenif(GetUnitAbilityLevel(damager,'A0I6'))>0 thenset lvl=3endifif(GetUnitAbilityLevel(damager,'A0I4'))>0 thenset lvl=2endifif(GetUnitAbilityLevel(damager,'A0I5'))>0 thenset lvl=1endifset dammi=CreateUnit(pr,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0HX')call SetUnitAbilityLevel(dammi,'A0HX',lvl)call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",damaged,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPriest.mdl",damaged,"origin"))
endifif(GetUnitAbilityLevel(damager,'A0IA')>0 and GetRandomInt(1,'d')<=22)thencall GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+(25.+(.3*GetHeroStr(damager,true))))call StunUnitTimed(damaged,1.25)
endifif GetUnitAbilityLevel(damager,'A0J2')>=1 thencall GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+(.5*GetHeroStr(damager,true)))
call DestroyEffect(AddSpecialEffectTarget("Effects\\AxeEffect.mdl",damaged,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Effects\\AxeEffect.mdl",damaged,"origin"))call DestroyEffect(AddSpecialEffect("Effects\\AxeEffect.mdl",xd,yd))
endifif GetUnitAbilityLevel(damager,'A0JH')>=1 thenset dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0J3')call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullendifif GetUnitAbilityLevel(damager,'A0JI')>=1 thenset t=LoadTimerHandle(udg_hash,hdr,92)if t!=null thenset i=LoadInteger(udg_hash,GetHandleId(t),1)
if i<=58 thenset i=i+2call SetAttackSpeedAbilityLevel(damager,2)call SaveInteger(udg_hash,GetHandleId(t),1,i)else
set ef=LoadEffectHandle(udg_hash,GetHandleId(t),3)if ef==null then
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\Tornado_Target.mdl",damager,"weapon")call SaveEffectHandle(udg_hash,GetHandleId(t),3,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\Tornado_Target.mdl",damager,"chest")call SaveEffectHandle(udg_hash,GetHandleId(t),4,ef)endifset ef=nullendifelse
set t=CreateTimer()call SaveTimerHandle(udg_hash,hdr,92,t)call SetAttackSpeedAbilityLevel(damager,2)call SaveInteger(udg_hash,GetHandleId(t),1,2)call SaveUnitHandle(udg_hash,GetHandleId(t),2,damager)endifcall TimerStart(t,15.,false,function Trig_Wind_Bow_Remove_Attack_Speed_Actions)set t=nullendifif GetUnitAbilityLevel(damager,'A0LE')>=1 thenset r1=.15*damageset str=LoadStr(udg_hash,GetUnitTypeId(damager),70)if str=="str" thenset r2=GetHeroStr(damager,true)/ 2endifif str=="agi" thenset r2=GetHeroAgi(damager,true)/ 2endifif str=="int" thenset r2=GetHeroInt(damager,true)/ 2endifset r3=150.+r2set g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,r3,null)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl",damaged,"chest"))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,pr)and Picked!=damaged and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9F,LoadReal(udg_hash,GetHandleId(Picked),$9F)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif GetUnitAbilityLevel(damager,'A0LI')>=1 thenset r1=.25*damageset str=LoadStr(udg_hash,GetUnitTypeId(damager),70)if str=="str" thenset r2=GetHeroStr(damager,true)/ 1.75endifif str=="agi" thenset r2=GetHeroAgi(damager,true)/ 1.75endifif str=="int" thenset r2=GetHeroInt(damager,true)/ 1.75endifset r3=150.+r2set g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,r3,null)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl",damaged,"chest"))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,pr)and Picked!=damaged and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9F,LoadReal(udg_hash,GetHandleId(Picked),$9F)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Cleave\\CleaveDamageTarget.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif GetUnitAbilityLevel(damager,'A0LJ')>=1 and GetRandomInt(1,'d')<=30 thenset r1=.5*GetHeroStr(damager,true)set g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,150.,null)loop
set Picked=FirstOfGroup(g)if IsUnitEnemy(Picked,pr)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,LoadReal(udg_hash,GetHandleId(Picked),$9E)+r1)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodGhoul.mdl",Picked,"origin"))call StunUnitTimed(Picked,.75)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif(GetUnitAbilityLevel(damager,'A0LP')>0 and GetRandomInt(1,'d')<=25)thenif GetUnitState(damaged,UNIT_STATE_LIFE)<GetUnitState(damaged,UNIT_STATE_MAX_LIFE)*.5 thenset r1=(damage*3.4)+80.call CreateTexttag(udg_ColorString[1]+I2S(R2I(r1+damage))+"!|r",.03,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)else
set r1=(damage*1.2)+40.call CreateTexttag(udg_ColorString[1]+I2S(R2I(r1+damage))+"!|r",.025,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)endifcall GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9F,LoadReal(udg_hash,hdd,$9F)+r1)set dammi=CreateUnit(pr,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0LQ')call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodSorceress.mdl",damaged,"origin"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Other\\HumanBloodCinematicEffect\\HumanBloodCinematicEffect.mdl",damaged,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",damaged,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",damaged,"origin"))endifif LoadBoolean(udg_hash,hdr,99) then
set r1=(GetUnitState(damager,UNIT_STATE_LIFE)-GetUnitState(damaged,UNIT_STATE_LIFE))/ 10.if r1<0 then
set r1=-r1endifset r1=r1+R2I(GetHeroStr(damager,true)*.75)if r1>150. thenset r1=150.endifcall GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r1)call DestroyEffectWithWait(AddSpecialEffectTarget("Effects\\BloodBreathDamage.mdx",damaged,"origin"),.35)call DestroyEffectWithWait(AddSpecialEffectTarget("Effects\\BloodElementalMisile.mdx",damaged,"origin"),.35)
endifif GetUnitAbilityLevel(damager,'A0M8')>0 thenif LoadBoolean(udg_hash,hdr,'q')==false then
set r1=LoadReal(udg_hash,hdr,'p')set r2=360.+(GetUnitAbilityLevel(damager,'A0M8')*40.)set r1=r1+damage
call ProgressBarAddPercentComplete(LoadUnitHandle(udg_hash,GetHandleId(damager),'v'),(damage*100./ r2))if r1>=r2 thencall SaveBoolean(udg_hash,hdr,'q',true)call SaveReal(udg_hash,hdr,'p',.0)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Human\\slow\\slowtarget.mdl",damager,"weapon")
call SaveEffectHandle(udg_hash,hdr,'r',ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\LifeHigh.mdx",damager,"weapon")call SaveEffectHandle(udg_hash,hdr,'s',ef)set ef=nullelse
call SaveReal(udg_hash,hdr,'p',r1)endifelse
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(damager),'v'))call AddProgressBar(damager,235.+(3.*GetUnitAbilityLevel(damager,'A0M8')),(.9+.05*GetUnitAbilityLevel(damager,'A0M8')),1.,true,false,'v',$F8,$9A,0)set g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,250.,null)set lvl=GetUnitAbilityLevel(damager,'A0M8')set r3=damage*(.25+(.25*lvl))set r1=(25+(lvl*$A))+(GetHeroStr(damager,true)*(.3+(.2*lvl)))set r2=(25+(lvl*$A))+(GetHeroInt(damager,true)*(.3+(.2*lvl)))call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r3)set dammi=CreateUnit(pr,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',3.)
call SetUnitScale(dammi,.5,.5,.5)call SetUnitPathing(dammi,false)
call SetUnitX(dammi,xd)call SetUnitY(dammi,yd)call DestroyEffect(AddSpecialEffectTarget("Effects\\LightNova.mdl",dammi,"origin"))set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",damager,"weapon"))set ef=LoadEffectHandle(udg_hash,hdr,'r')call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,hdr,'s')call DestroyEffect(ef)set ef=nullcall SaveBoolean(udg_hash,hdr,'q',false)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,pr)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,LoadReal(udg_hash,GetHandleId(Picked),$9E)+r1)call DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",Picked,"origin"))set dammi=CreateUnit(pr,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0M9')call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullendifif IsUnitAlly(Picked,pr)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+r2)call DestroyEffect(AddSpecialEffectTarget("Effects\\MegaHeal.mdx",Picked,"origin"))call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",Picked,"origin"),2.)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif GetUnitAbilityLevel(damager,'A0JA')>=1 and GetRandomInt(1,'d')<=20 and GetUnitAbilityLevel(damaged,'A0JC')<1 then
set dammi=CreateUnit(pr,'h013',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A0JD')call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullendifif GetUnitAbilityLevel(damager,'A0K3')>0 and GetRandomInt(1,'d')<=$F and IsUnitIllusion(damager)==false then
set r1=(.3*GetHeroStr(damager,true))
set g=CreateGroup()call GroupEnumUnitsInRange(g,xr,yr,250.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,LoadReal(udg_hash,GetHandleId(Picked),$9E)+r1)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif GetUnitAbilityLevel(damager,'A0K4')>0 and GetRandomInt(1,'d')<=30 and IsUnitIllusion(damager)==false then
set r1=(.6*GetHeroStr(damager,true))
set g=CreateGroup()call GroupEnumUnitsInRange(g,xr,yr,300.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,LoadReal(udg_hash,GetHandleId(Picked),$9E)+r1)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendifif GetUnitAbilityLevel(damager,'A0K4')>0 and GetRandomInt(1,'d')<=$F and IsUnitIllusion(damager)==false then
set g=CreateGroup()call GroupEnumUnitsInRange(g,xr,yr,270.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false thencall StunUnitTimed(Picked,1.)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendifif GetUnitAbilityLevel(damaged,'A0MK')>0 and IsUnitType(damager,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitState(damaged,UNIT_STATE_LIFE)>.405 and damage>.0 and GetRandomInt(1,'d')<=($C+(3*GetUnitAbilityLevel(damaged,'A0MK')))thenset lvl=GetUnitAbilityLevel(damaged,'A0MK')set r1=SquareRoot((xr-xd)*(xr-xd)+(yr-yd)*(yr-yd))set r2=(5.+5.*lvl)+(r1/(34.-4.*lvl))
set r3=.1+.15*lvlset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveReal(udg_hash,h,2,(r3*damage))call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)set t=nullset t=CreateTimer()set h=GetHandleId(t)
set angle=bj_RADTODEG*Atan2(yr-yd,xr-xd)
set dammi=CreateUnit(pd,'h00E',GetUnitX(damaged),GetUnitY(damaged),angle)call SetUnitFlyHeight(dammi,50.,.0)call SetUnitFlyHeight(dammi,200.,r1)
call SetUnitFacing(dammi,angle)call SetUnitScale(dammi,1.5,1.5,1.5)
set ef=AddSpecialEffectTarget("Effects\\StoneSmall.mdl",dammi,"chest")call SaveUnitHandle(udg_hash,h,1,damaged)call SaveUnitHandle(udg_hash,h,2,dammi)call SaveInteger(udg_hash,h,3,R2I(r1/ 40))call SaveUnitHandle(udg_hash,h,4,damager)call SaveReal(udg_hash,h,5,r2)call SaveReal(udg_hash,h,6,(r1/ 3))call SaveEffectHandle(udg_hash,h,7,ef)call TimerStart(t,.03,true,function Trig_Stone_Armor_Periodic_Actions)set ef=nullset dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",damaged,"chest"))set t=nullendifif GetUnitAbilityLevel(damager,'A0N7')>0 and IsUnitIllusion(damager)==false and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false thenset r1=(GetUnitState(damager,UNIT_STATE_MAX_MANA)/ 25.)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl",damaged,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareMissile.mdl",damaged,"chest"))call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r1)endifif GetUnitAbilityLevel(damager,'A0ND')>0 and IsUnitIllusion(damager)==false then
set g=CreateGroup()set g2=CreateGroup()
call GroupEnumUnitsInRange(g,xd,yd,150.,null)call GroupRemoveUnit(g,damaged)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false thencall GroupAddUnit(g2,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RandomUnitFromGroup(2,g2)set g=CreateGroup()call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set r1=(GetUnitState(damager,UNIT_STATE_MAX_MANA)/ 20.)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullcall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,LoadReal(udg_hash,GetHandleId(Picked),$9E)+r1)call DestroyEffect(AddSpecialEffectTarget("Effects\\FlameBomb.mdx",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",Picked,"chest"))call GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset Picked=nullendifif(GetUnitAbilityLevel(damaged,'A0NJ')>0 or GetUnitAbilityLevel(damaged,'A0NK')>0 or GetUnitAbilityLevel(damaged,'A0NL')>0)and(GetUnitAbilityLevel(damaged,'A0IT')<=0 and GetUnitAbilityLevel(damaged,'A0J8')<=0)and IsUnitType(damager,UNIT_TYPE_MAGIC_IMMUNE)==false thenif GetUnitAbilityLevel(damaged,'A0NJ')>0 thenset r1=damage*.1+10.
endifif GetUnitAbilityLevel(damaged,'A0NK')>0 thenset r1=damage*.15+12.endifif GetUnitAbilityLevel(damaged,'A0NL')>0 thenset r1=damage*.2+14.
endifcall GroupAddUnit(gdamagefromdamaged,damager)call SaveReal(udg_hash,hdr,$A1,LoadReal(udg_hash,hdr,$A1)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl",damager,"overhead"))endifif GetUnitAbilityLevel(damager,'A08G')>0 and GetRandomInt(1,'d')<=20 thenset r1=(damage*.5)call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9F,LoadReal(udg_hash,hdd,$9F)+r1+10.)call CreateTexttag(udg_ColorString[1]+I2S(R2I(r1+damage))+"!|r",.022,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)endifif GetUnitAbilityLevel(damager,'A0NI')>0 and IsUnitIllusion(damager)==false and IsUnitType(damaged,UNIT_TYPE_MAGIC_IMMUNE)==false thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",damaged,"chest"))
endifif GetUnitAbilityLevel(damager,'A0NS')>0 thenset lvl=GetUnitAbilityLevel(damager,'A0NS')set r1=damageset r2=.0if lvl==1 or lvl==2 then
set i=1endifif lvl==3 or lvl==4 then
set i=2endifif lvl==5 or lvl==6 then
set i=3endifif GetFloatGameState(GAME_STATE_TIME_OF_DAY)<6. or GetFloatGameState(GAME_STATE_TIME_OF_DAY)>18. thenset r2=(GetHeroAgi(damager,true)+GetHeroInt(damager,true))/ 3set str="Effects\\BlueGlaivie.mdl"set r4=.6set b=trueelse
set str="Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl"set r4=1.set b=falseendifset t=CreateTimer()set h=GetHandleId(t)
call SaveReal(udg_hash,h,21,.6)if LoadBoolean(udg_hash,hdr,$7F) thenset i=i*2endifif LoadBoolean(udg_hash,hdr,$80) thencall SaveReal(udg_hash,h,21,.8)endifcall SaveUnitHandle(udg_hash,h,1,damager)call SaveReal(udg_hash,h,2,r1)call SaveReal(udg_hash,h,20,r2)call SaveInteger(udg_hash,h,3,i)
call SaveBoolean(udg_hash,h,4,b)
if b thencall DestroyEffect(AddSpecialEffectTarget("Effects\\SoundTrauma.mdl",damaged,"chest"))call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+r2)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",damaged,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\BlueGlaivie.mdl",damaged,"chest"))endifset g=nullset g2=nullset g=CreateGroup()set g2=CreateGroup()
call GroupEnumUnitsInRange(g,xd,yd,350.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif damaged!=Picked and IsUnitEnemy(Picked,pr)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' and GetUnitTypeId(Picked)!='uplg' thencall GroupAddUnit(g2,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall RandomUnitFromGroup(1,g2)set u=FirstOfGroup(udg_GroupRandomUnitFromGroup)
call GroupClear(g)call DestroyGroup(g)
set g=nullif u!=null thenset r1=GetUnitX(u)set r2=GetUnitY(u)set dist=SquareRoot(((r1-xd)*(r1-xd))+((r2-yd)*(r2-yd)))
set angle=bj_RADTODEG*Atan2((r2-yd),(r1-xd))
set dammi=CreateUnit(pr,'h00U',xd,yd,angle)call SetUnitScale(dammi,r4,r4,r4)set ef=AddSpecialEffectTarget(str,dammi,"origin")call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,45.,.0)set g=CreateGroup()call GroupAddUnit(g,damaged)
call SaveGroupHandle(udg_hash,h,9,g)
call SaveUnitHandle(udg_hash,h,$A,dammi)
call SaveEffectHandle(udg_hash,h,$B,ef)call SaveUnitHandle(udg_hash,h,$C,u)
call TimerStart(t,.03,true,function Trig_Moon_Chackrum_Periodic_Actions)
set ef=nullset dammi=nullset t=nullset u=nullset g=nullelse
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullendifendifif GetUnitAbilityLevel(damager,'A0O0')>=1 thenset dammi=CreateUnit(pr,'h00U',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0O2')call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullendifif GetUnitAbilityLevel(damager,'A0OE')>=1 and GetRandomInt(1,'d')<=20 thencall StunUnitTimed(damaged,1.)call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+15.)endifif GetUnitAbilityLevel(damager,'A0O1')>=1 thenset t=LoadTimerHandle(udg_hash,hdr,$81)if t!=null thenset i=LoadInteger(udg_hash,GetHandleId(t),1)
if i<=58 thenset i=i+2call SetAttackSpeedAbilityLevel(damager,2)call SetAttackAbilityLevel(damager,1)call SaveInteger(udg_hash,GetHandleId(t),1,i)call SaveInteger(udg_hash,hdr,$82,i)
else
set ef=LoadEffectHandle(udg_hash,GetHandleId(t),3)if ef==null then
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\Tornado_Target.mdl",damager,"weapon")call SaveEffectHandle(udg_hash,GetHandleId(t),3,ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\Spellorb.mdl",damager,"origin")call SaveEffectHandle(udg_hash,GetHandleId(t),4,ef)endifset ef=nullendifelse
set t=CreateTimer()call SaveTimerHandle(udg_hash,hdr,$81,t)
call SetAttackSpeedAbilityLevel(damager,2)call SetAttackAbilityLevel(damager,1)call SaveInteger(udg_hash,hdr,$82,2)
call SaveInteger(udg_hash,GetHandleId(t),1,2)call SaveUnitHandle(udg_hash,GetHandleId(t),2,damager)endifcall TimerStart(t,15.,false,function Trig_Blood_Bow_Remove_Effects_Actions)set t=nullendifif LoadBoolean(udg_hash,hdd,$84)==false and GetUnitAbilityLevel(damaged,'A0OB')>=1 and(GetUnitState(damaged,UNIT_STATE_LIFE)<=GetUnitState(damaged,UNIT_STATE_MAX_LIFE)*.5)thencall SaveBoolean(udg_hash,hdd,$84,true)call SetAttackSpeedAbilityLevel(damaged,50)call SetAttackAbilityLevel(damaged,$A)set t=CreateTimer()set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl",damaged,"overhead")call SaveEffectHandle(udg_hash,GetHandleId(t),2,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",damaged,"hand,left")call SaveEffectHandle(udg_hash,GetHandleId(t),3,ef)set ef=nullcall SaveUnitHandle(udg_hash,GetHandleId(t),1,damaged)call TimerStart(t,7.,false,function Trig_Beorn_Rage_Remove_Effects_Actions)set t=nullendifif GetUnitAbilityLevel(damager,'A0OJ')>=1 thenset u=LoadUnitHandle(udg_hash,hdr,$85)if u==null thenset u=damagedset ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",damaged,"overhead")call SaveEffectHandle(udg_hash,hdr,$87,ef)set ef=nullendifset i=0set i=LoadInteger(udg_hash,hdr,$86)if damaged==u thenif i<$A then
set i=i+1endifelse
if i>=4 then
if i==$A thenset i=9endifcall SetAttackSpeedAbilityLevel(damager,-20*(i-3))endifset i=0set ef=LoadEffectHandle(udg_hash,hdr,$87)call DestroyEffect(ef)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl",damaged,"overhead")call SaveEffectHandle(udg_hash,hdr,$87,ef)set ef=nullendifif i>3 and i<$A then
call SetAttackSpeedAbilityLevel(damager,20)endifcall SaveUnitHandle(udg_hash,hdr,$85,damaged)call SaveInteger(udg_hash,hdr,$86,i)
endifif GetUnitAbilityLevel(damager,'A0O1')>=1 thenset r1=LoadInteger(udg_hash,hdr,$82)*damage*.15*.01call SetUnitState(damager,UNIT_STATE_LIFE,GetUnitState(damager,UNIT_STATE_LIFE)+r1)endifif GetUnitAbilityLevel(damager,'A0OZ')>0 and IsUnitIllusion(damager)==false then
set i=LoadInteger(udg_hash,hdr,$8F)set b=falseset i=i+1if i==3 then
set ef=AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",damager,"weapon")
call SaveEffectHandle(udg_hash,hdr,$90,ef)set ef=nullendifif i==4 then
set i=0set b=trueendifcall SaveInteger(udg_hash,hdr,$8F,i)
if b thencall DestroyEffect(LoadEffectHandle(udg_hash,hdr,$90))set r1=(damage*1.)+GetHeroInt(damager,true)call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9E,LoadReal(udg_hash,hdd,$9E)+GetHeroInt(damager,true))call SaveReal(udg_hash,hdd,$9F,LoadReal(udg_hash,hdd,$9F)+(damage*1.))call CreateTexttag(udg_ColorString[2]+I2S(R2I(r1+damage))+"!|r",.025,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",damaged,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl",damaged,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",damaged,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldBuff.mdl",damaged,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Purge\\PurgeBuffTarget.mdl",damaged,"chest"))
set g=CreateGroup()set g2=CreateGroup()
call GroupEnumUnitsInRange(g,xd,yd,300.,null)call GroupRemoveUnit(g,damaged)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false thencall GroupAddUnit(g2,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RandomUnitFromGroup(3,g2)set g=CreateGroup()call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set r1=100.+(GetUnitState(damager,UNIT_STATE_MAX_MANA)/ 15.)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,Picked)
call SaveInteger(udg_hash,h,2,$F)call SaveUnitHandle(udg_hash,h,3,damaged)set locr=GetUnitLoc(damaged)
set locd=GetUnitLoc(Picked)set l=AddLightningEx("CLPB",true,xd,yd,GetUnitFlyHeight(damaged)+25.+GetLocationZ(locr),GetUnitX(Picked),GetUnitY(Picked),GetUnitFlyHeight(Picked)+25.+GetLocationZ(locd))call SaveLightningHandle(udg_hash,h,4,l)
set l=nullcall RemoveLocation(locr)set locr=nullcall RemoveLocation(locd)set locd=nullcall TimerStart(t,.04,true,function Trig_Remove_Lightning_From_Staff_Of_Lightning_Actions)call GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,LoadReal(udg_hash,GetHandleId(Picked),$9E)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl",Picked,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldBuff.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Purge\\PurgeBuffTarget.mdl",Picked,"chest"))call GroupRemoveUnit(g,Picked)set t=nullendloopcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset Picked=nullendifendifif GetUnitAbilityLevel(damager,'A0P3')>0 and LoadTimerHandle(udg_hash,hdr,$92)!=null and IsUnitIllusion(damager)==false then
call DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(LoadTimerHandle(udg_hash,hdr,$92)),2))call DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(LoadTimerHandle(udg_hash,hdr,$92)),3))call UnitRemoveAbility(damager,'A0P4')set r1=damage*.5
set g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,150.,null)call GroupRemoveUnit(g,damaged)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,pr) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false thencall GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9F,LoadReal(udg_hash,GetHandleId(Picked),$9F)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",Picked,"origin"))endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullcall FlushChildHashtable(udg_hash,GetHandleId(LoadTimerHandle(udg_hash,hdr,$92)))call DestroyTimer(LoadTimerHandle(udg_hash,hdr,$92))
endifif GetUnitAbilityLevel(damager,'A0P3')>0 and GetRandomInt(1,'d')<=($A+5*GetUnitAbilityLevel(damager,'A0P3'))and IsUnitIllusion(damager)==false thencall SaveInteger(udg_hash,hdr,$91,1)
set t=LoadTimerHandle(udg_hash,hdr,$92)if t==null thenset t=CreateTimer()set h=GetHandleId(t)
call SaveTimerHandle(udg_hash,hdr,$92,t)
call UnitAddAbility(damager,'A0P4')call SaveUnitHandle(udg_hash,h,1,damager)call SaveEffectHandle(udg_hash,h,2,AddSpecialEffectTarget("Effects\\CosmicTouch.MDX",damager,"weapon"))call SaveEffectHandle(udg_hash,h,3,AddSpecialEffectTarget("Effects\\CosmicTouch.MDX",damager,"overhead"))endifcall TimerStart(t,1.,false,function Trig_Remove_ASBonus_Double_Attack_Actions)set t=nullendifif GetUnitAbilityLevel(damaged,'A0P9')>0 and IsUnitIllusion(damaged)==false then
set i=LoadInteger(udg_hash,hdd,$98)set lvl=LoadInteger(udg_hash,hdd,$99)if lvl>0 and(IsUnitType(damager,UNIT_TYPE_MAGIC_IMMUNE)==false)thencall GroupAddUnit(gdamagefromdamaged,damager)call SaveReal(udg_hash,hdr,$A0,LoadReal(udg_hash,hdr,$A0)+I2R(lvl))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",damager,"chest"))endifset i=i+1if i==5 then
set i=0if lvl<GetUnitAbilityLevel(damaged,'A0P9')*5 thenset lvl=lvl+1call SaveInteger(udg_hash,hdd,$99,lvl)set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SetUnitLifeAndManaRegeneration(damaged,"life",1)call SetArmorAbilityLevel(damaged,1)
call TimerStart(t,5.*GetUnitAbilityLevel(damaged,'A0P9'),false,function Trig_Remove_Bonus_Marshal_Armor_Actions)
set t=nullendifendifcall SaveInteger(udg_hash,hdd,$98,i)
set t=nullendifif GetUnitAbilityLevel(damager,'A09L')>0 thenset i=LoadInteger(udg_hash,hdr,$A7)set b=falseset i=i+1if i==2 then
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl",damager,"hand,left")
call SaveEffectHandle(udg_hash,hdr,$A8,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSRight.mdl",damager,"weapon,right")
call SaveEffectHandle(udg_hash,hdr,$A9,ef)set ef=nullendifif i==3 then
set i=0set b=trueendifcall SaveInteger(udg_hash,hdr,$A7,i)
if b thencall DestroyEffect(LoadEffectHandle(udg_hash,hdr,$A8))call DestroyEffect(LoadEffectHandle(udg_hash,hdr,$A9))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl",damaged,"origin"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",damaged,"origin"))
set r1=damage*2.
call GroupAddUnit(gdamagefromdamager,damaged)call SaveReal(udg_hash,hdd,$9F,LoadReal(udg_hash,hdd,$9F)+r1)call CreateTexttag(udg_ColorString[1]+I2S(R2I(r1+damage))+"!|r",.031,$FF,xd-18.,yd+15.,.0,.0,.035,3.5)set dammi=CreateUnit(pr,'h00U',xd,yd,.0)
call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0F8')call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullendifendifif GetUnitAbilityLevel(damager,'A0GS')>0 thenset r1=GetUnitFacing(damaged)set r2=(Atan2(yr-yd,xr-xd)*bj_RADTODEG)set r3=r2+360.set dist=SquareRoot((xd-xr)*(xd-xr)+(yd-yr)*(yd-yr))
if((r1<r2+60.)and(r1>r2-60.))or((r1<r3+60.)and(r1>r3-60.))and dist<=175. thencall UnitDamageTarget(damager,damaged,GetHeroAgi(damager,true)*.6,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",damaged,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GargoyleMissile\\GargoyleMissile.mdl",damaged,"chest"))endifendifif GetUnitAbilityLevel(damager,'A0QT')>=1 and GetRandomInt(0,'d')<=(7+GetUnitAbilityLevel(damager,'A0QT')*3)then
set r1=(GetUnitAbilityLevel(damager,'A0QT')*.05+.15)*damagecall StunUnitTimed(damaged,1.5)set g=CreateGroup()if LoadBoolean(udg_hash,hdr,$B3)==false then
call GroupEnumUnitsInRange(g,xd,yd,150.,null)else
call GroupEnumUnitsInRange(g,xd,yd,225.,null)set r1=((GetUnitAbilityLevel(damager,'A0QT')*.05+.15)*damage)+GetHeroAgi(damager,true)*.75endifcall GroupRemoveUnit(g,damaged)call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl",xd,yd))
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,pr)and Picked!=damaged and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GyroCopter\\GyroCopterMissile.mdl",Picked,"origin"))call StunUnitTimed(Picked,.25)call GroupAddUnit(gdamagefromdamager,Picked)
call SaveReal(udg_hash,GetHandleId(Picked),$9F,LoadReal(udg_hash,GetHandleId(Picked),$9F)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GyroCopter\\GyroCopterImpact.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif GetUnitAbilityLevel(damaged,'A0OW')>0 thenif damage>7 then
set r1=7
endifif damage<=7 thenset r1=damageendifset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveReal(udg_hash,h,2,r1)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)set t=nullendifif GetUnitAbilityLevel(damaged,'A0K7')>0 and GetRandomInt(1,'d')<=20 and GetUnitAbilityLevel(damaged,'A0K9')<1 thenset dammi=CreateUnit(pd,'h013',xr,yr,.0)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0K8')call IssueTargetOrderById(dammi,$D006B,damaged)set dammi=nullendifif GetUnitAbilityLevel(damaged,'B03P')>0 thencall UnitDamageTarget(damaged,damager,(GetRandomReal(20.,50.)),false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Immolation\\ImmolationDamage.mdl",damager,"chest"))endifendifif damage>=.01 thenif LoadReal(udg_hash,hdd,65)>.0 and LoadEffectHandle(udg_hash,hdd,66)!=null then
set r1=LoadReal(udg_hash,hdd,65)
if(r1-damage)>.0 thenset r2=damageelse
set r2=r1set ef=LoadEffectHandle(udg_hash,hdd,66)
call DestroyEffect(ef)set ef=nullendifset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveReal(udg_hash,h,2,r2)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)call SaveReal(udg_hash,hdd,65,r1-damage)
set t=nullendifif GetUnitAbilityLevel(damaged,'A07U')>0 and GetRandomInt(1,'d')<=30 thenset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)set r2=damage*.2
if GetUnitState(damaged,UNIT_STATE_LIFE)<=damage thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)else
call SaveReal(udg_hash,h,2,damage)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifset dammi=CreateUnit(Player($F),'h00U',xd,yd,bj_RADTODEG*Atan2(yr-yd,xr-xd))
call UnitApplyTimedLife(dammi,'BTLF',2.)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SpiritOfVengeanceMissile\\SpiritOfVengeanceMissile.mdl",damager,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\SpellShieldAmulet\\SpellShieldCaster.mdl",dammi,"origin"))set dammi=nullif IsUnitType(damager,UNIT_TYPE_MAGIC_IMMUNE)==false thencall GroupAddUnit(gdamagefromdamaged,damager)call SaveReal(udg_hash,hdr,$A0,LoadReal(udg_hash,hdr,$A0)+r2)endifset t=nullendifif damage>.0 and(pd==Player(9)or pd==Player($A)or pd==Player($B))thenset players=LoadForceHandle(udg_hash,hdd,72)
if players==null thenset players=CreateForce()endifif IsPlayerInForce(pr,players)==false thencall ForceAddPlayer(players,pr)endifset t=nullset t=LoadTimerHandle(udg_hash,hdd,73+GetPlayerId(pr))if t==null thenset t=CreateTimer()endifcall SaveTimerHandle(udg_hash,hdd,73+GetPlayerId(pr),t)set h=GetHandleId(t)
call SavePlayerHandle(udg_hash,h,1,pr)call SaveForceHandle(udg_hash,h,2,players)call SaveInteger(udg_hash,h,3,hdd)call TimerStart(t,7.,false,function Trig_AddDamage_Refresh_Creep_Assists_Actions)call SaveForceHandle(udg_hash,hdd,72,players)set players=null
set t=nullendifif damage>5. and GetUnitAbilityLevel(damaged,'A09G')>0 and GetRandomInt(1,'d')<=25 thencall SetUnitState(damaged,UNIT_STATE_LIFE,GetUnitState(damaged,UNIT_STATE_LIFE)+25.)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",damaged,"chest"))endifif damage>10. and GetUnitAbilityLevel(damaged,'A09K')>0 and GetRandomInt(1,'d')<=40 then
call SetUnitState(damaged,UNIT_STATE_LIFE,GetUnitState(damaged,UNIT_STATE_LIFE)+25.+(damage/ 3))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\SpellSteal\\SpellStealMissile.mdl",damaged,"chest"))endifif LoadReal(udg_hash,hdd,86)>.0 and LoadEffectHandle(udg_hash,hdd,87)!=null then
set r1=LoadReal(udg_hash,hdd,86)
set r3=GetUnitState(damaged,UNIT_STATE_LIFE)
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)if(r1-damage)>.0 thenset r2=damageelse
set r2=r1set ef=LoadEffectHandle(udg_hash,hdd,87)
call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,hdd,87,null)endifif r3<=damage and(r1+r3-damage)>.0 thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)if r1<=damage thenset t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,damaged)call SaveUnitHandle(udg_hash,h2,2,damager)call SaveReal(udg_hash,h2,3,(damage-r1))
call SaveStr(udg_hash,h2,4,"clear")call TimerStart(t2,.0,false,function Trig_Damage_Unit_With_Wait_Actions)
set t2=nullendifendifif r3>damage thencall SaveReal(udg_hash,h,2,r2)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifcall SaveReal(udg_hash,hdd,86,r1-damage)
set t=nullendifif(GetUnitAbilityLevel(damaged,'A0IT')>0 or GetUnitAbilityLevel(damaged,'A0J8')>0)and IsUnitType(damager,UNIT_TYPE_MAGIC_IMMUNE)==false then
if GetUnitAbilityLevel(damaged,'A0IT')>0 thenset r1=damage*.2+20.
endifif GetUnitAbilityLevel(damaged,'A0J8')>0 thenset r1=damage*.3+30.
endifcall GroupAddUnit(gdamagefromdamaged,damager)call SaveReal(udg_hash,hdr,$A1,LoadReal(udg_hash,hdr,$A1)+r1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ThornsAura\\ThornsAuraDamage.mdl",damager,"overhead"))endifif LoadBoolean(udg_hash,hdd,94) and LoadBoolean(udg_hash,hdd,$A2)==false and LoadEffectHandle(udg_hash,hdd,95)!=null and(GetUnitState(damaged,UNIT_STATE_LIFE)<=damage or GetUnitState(damaged,UNIT_STATE_LIFE)<=GetUnitState(damaged,UNIT_STATE_MAX_LIFE)*.02)thenset ef=LoadEffectHandle(udg_hash,hdd,95)
call DestroyEffect(ef)set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)call SetUnitState(damaged,UNIT_STATE_LIFE,GetUnitState(damaged,UNIT_STATE_MAX_LIFE)*.5)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",damaged,"origin"))
call SaveEffectHandle(udg_hash,hdd,95,null)call SaveReal(udg_hash,hdd,96,60.)call SaveBoolean(udg_hash,hdd,$A2,true)set t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,damaged)call TimerStart(t2,60.,false,function Trig_Cuirass_of_Invulnerable_Timer_Death_Denial_Actions)set ef=nullset t=nullset t2=nullendifif LoadReal(udg_hash,hdd,'i')>.0 and LoadBoolean(udg_hash,hdd,'f') thenset r1=LoadReal(udg_hash,hdd,'i')set r3=GetUnitState(damaged,UNIT_STATE_LIFE)
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveBoolean(udg_hash,hdd,'j',true)if(r1-damage)>.0 thenset r2=damageelse
set r2=r1set ef=LoadEffectHandle(udg_hash,hdd,'g')call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,hdd,'g',null)
set t3=CreateTimer()
set h3=GetHandleId(t3)call SaveUnitHandle(udg_hash,h3,1,damaged)call SaveReal(udg_hash,hdd,'h',45.)call TimerStart(t3,45.,false,function Trig_Archimagus_Armor_Timer_Death_Denial_Actions)set g=CreateGroup()call GroupEnumUnitsInRange(g,xd,yd,500.,null)call SetUnitState(damaged,UNIT_STATE_MANA,GetUnitState(damaged,UNIT_STATE_MANA)+((50+GetHeroInt(damaged,true)*.5)))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,pd)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call SetUnitState(Picked,UNIT_STATE_MANA,GetUnitState(Picked,UNIT_STATE_MANA)+((50+GetHeroInt(damaged,true)*.5)))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",Picked,"origin"))
endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendifif r3<=damage and(r1+r3-damage)>.0 thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)if r1<=damage thenset t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,damaged)call SaveUnitHandle(udg_hash,h2,2,damager)call SaveReal(udg_hash,h2,3,(damage-r1))
call SaveStr(udg_hash,h2,4,"clear")call TimerStart(t2,.0,false,function Trig_Damage_Unit_With_Wait_Actions)
set t2=nullendifendifif r3>damage thencall SaveReal(udg_hash,h,2,r2)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifcall SaveReal(udg_hash,hdd,'i',r1-damage)set t=nullendifif LoadReal(udg_hash,hdd,'n')>.0 and LoadUnitHandle(udg_hash,hdd,'o')!=null then
set r2=damage*LoadReal(udg_hash,hdd,'n')
set r3=GetUnitState(damaged,UNIT_STATE_LIFE)
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call GroupAddUnit(gdamagefromdamager,LoadUnitHandle(udg_hash,hdd,'o'))call SaveReal(udg_hash,GetHandleId(LoadUnitHandle(udg_hash,hdd,'o')),$9E,LoadReal(udg_hash,GetHandleId(LoadUnitHandle(udg_hash,hdd,'o')),$9E)+(r2)/ 2)if(r3<=damage)and(r2+r3-damage)>.0 thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)endifif r3>damage thencall SaveReal(udg_hash,h,2,r2)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifset t=nullendifif LoadReal(udg_hash,hdd,$93)>.0 and LoadTimerHandle(udg_hash,hdd,$95)!=null thenset r1=LoadReal(udg_hash,hdd,$93)if(r1-damage)>.0 thenset r2=damageelse
set r2=r1set g=CreateGroup()set u=LoadUnitHandle(udg_hash,hdd,$97)set p=GetOwningPlayer(u)
set r3=LoadReal(udg_hash,hdd,$96)call DestroyEffect(AddSpecialEffect("Effects\\LightNova.mdl",GetUnitX(damaged),GetUnitY(damaged)))set udg_Temp_Integer[$A]=0set udg_Temp_Integer[$B]=0call DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",damaged,"origin"))call GroupEnumUnitsInRange(g,GetUnitX(damaged),GetUnitY(damaged),500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",Picked,"origin"))call UnitDamageTarget(u,Picked,r3,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopset t2=LoadTimerHandle(udg_hash,hdd,$95)
set h2=GetHandleId(t2)set ef=LoadEffectHandle(udg_hash,h2,4)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h2,5)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h2,6)call DestroyEffect(ef)set ef=nullcall SetAttackSpeedAbilityLevel(damaged,-LoadInteger(udg_hash,GetHandleId(damaged),$94))
call FlushChildHashtable(udg_hash,h2)call DestroyTimer(t2)set t2=nullset u=nullset p=nullcall DestroyGroup(g)
set g=nullendifset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)call SaveReal(udg_hash,h,2,r2)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)call SaveReal(udg_hash,hdd,$93,r1-damage)set t=nullendifif LoadBoolean(udg_hash,hdd,$A5) and LoadTimerHandle(udg_hash,hdd,$A6)!=null thenset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)if GetUnitState(damaged,UNIT_STATE_LIFE)>damage then
call SaveReal(udg_hash,h,2,damage)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifif GetUnitState(damaged,UNIT_STATE_LIFE)<=damage thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)endifset t=nullendifif udg_IsBeronsFightWin and(GetUnitTypeId(damaged)=='h01K' or GetUnitTypeId(damaged)=='e002' or GetUnitTypeId(damaged)=='n00Y' or GetUnitTypeId(damaged)=='o003')thenset r2=damageset r3=GetUnitState(damaged,UNIT_STATE_LIFE)
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,damaged)if(r3<=damage)thencall SetUnitInvulnerable(damaged,true)call TimerStart(t,.0,false,function Trig_Make_Unit_UnInvulnerable_Actions)endifif r3>damage thencall SaveReal(udg_hash,h,2,r2*.3)call TimerStart(t,.0,false,function Trig_Hil_Unit_Actions)endifset t=nullendifif IsUnitAlly(damaged,Player($B)) or IsUnitAlly(damager,Player($B)) then
if IsUnitAlly(damaged,Player($B)) thenset dammi=damagedelse
set dammi=damagerendifif IsUnitIllusion(dammi)==false and GetUnitState(dammi,UNIT_STATE_LIFE)>.405 and GetUnitTypeId(dammi)!='h00U' thencall SaveInteger(udg_hash,GetHandleId(dammi),'k',0)endifendifif pd==Player($F)and damage>.0 and IsUnitIllusion(damaged)==false and udg_IsMinimapPingGuardsAttacked==false and(GetUnitTypeId(damaged)=='h01K' or GetUnitTypeId(damaged)=='e002' or GetUnitTypeId(damaged)=='n00Y' or GetUnitTypeId(damaged)=='o003')thenif(IsPlayerInForce(GetLocalPlayer(),udg_IGRAET))then
call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"|cff99ccffВНИМАНИЕ!!!|r")call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"|cffff0000Стражи-Чародеи атакованы!!!|r")
call PingMinimapEx(xd,yd,3.,$FE,0,0,true)endifset udg_IsMinimapPingGuardsAttacked=true
set t=CreateTimer()call TimerStart(t,6.,false,function Trig_IsMinimapPingGuardsAttacked_Refresh_Actions)set t=nullendifif damage>.0 thenset i=GetPlayerId(pr)if GetPlayerId(pr)<=8 thenset udg_Player_Taken_Damage_Current[i]=udg_Player_Taken_Damage_Current[i]+damage
set udg_Player_Taken_Damage_All[i]=udg_Player_Taken_Damage_All[i]+damage
endifset i=GetPlayerId(pd)if GetPlayerId(pd)<=8 thenset udg_Player_Received_Damage_Current[i]=udg_Player_Received_Damage_Current[i]+damageendifendifendifloop
set Picked=FirstOfGroup(gdamagefromdamaged)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(damaged,Picked,ConvertMagicAndChaosDamageInClear(Picked,LoadReal(udg_hash,GetHandleId(Picked),$A0),LoadReal(udg_hash,GetHandleId(Picked),$A1)),false,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call SaveReal(udg_hash,GetHandleId(Picked),$A0,.0)call SaveReal(udg_hash,GetHandleId(Picked),$A1,.0)endifcall GroupRemoveUnit(gdamagefromdamaged,Picked)endloopset Picked=nullcall GroupClear(gdamagefromdamaged)call DestroyGroup(gdamagefromdamaged)set gdamagefromdamaged=nullloop
set Picked=FirstOfGroup(gdamagefromdamager)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(damager,Picked,ConvertMagicAndChaosDamageInClear(Picked,LoadReal(udg_hash,GetHandleId(Picked),$9E),LoadReal(udg_hash,GetHandleId(Picked),$9F)),false,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call SaveReal(udg_hash,GetHandleId(Picked),$9E,.0)call SaveReal(udg_hash,GetHandleId(Picked),$9F,.0)endifcall GroupRemoveUnit(gdamagefromdamager,Picked)endloopset Picked=nullcall GroupClear(gdamagefromdamager)call DestroyGroup(gdamagefromdamager)set gdamagefromdamager=nullset damager=null
set damaged=null
set pr=nullset pd=nullset dammi=nullset u=nullset l=nullset t=nullset txt=null
set ef=nullset g=nullendfunctionfunction Trig_Del_Conditions takes nothing returns booleanreturn GetEventDamage()>.0endfunctionfunction InitTrig_AddDamage takes nothing returns nothingset gg_trg_AddDamage=CreateTrigger()
call TriggerAddCondition(gg_trg_AddDamage,Condition(function Trig_Del_Conditions))call TriggerAddAction(gg_trg_AddDamage,function Trig_AddDamage_Actions)endfunctionfunction Trig_TimeTalisman_Remove_Bonuses_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local integer as=LoadInteger(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,5)call SetAttackSpeedAbilityLevel(target,-as)call SaveBoolean(udg_hash,GetHandleId(target),$B1,false)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call DestroyEffect(ef)set target=nullset ef=nullset t=nullendfunctionfunction Trig_TimeTalisman_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local integer id=GetSpellAbilityId()
local effect eflocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer as
local unit dammi
set dammi=CreateUnit(GetOwningPlayer(caster),'h00U',GetUnitX(caster),GetUnitY(caster),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0QQ')call IssueTargetOrderById(dammi,$D0085,target)set dammi=nullif id=='A0QI' thenset as=30endifif id=='A0QM' thenset as=45endifif id=='A0QN' thenset as=60endifif id=='A0QO' thenset as=75endifif id=='A0QP' thenset as=90endifif LoadBoolean(udg_hash,GetHandleId(target),$B1)==false then
set ef=AddSpecialEffectTarget("Punishment_Missle.mdx",target,"chest")call SaveBoolean(udg_hash,GetHandleId(target),$B1,true)call SetAttackSpeedAbilityLevel(target,as)call SaveUnitHandle(udg_hash,h,1,target)
call SaveInteger(udg_hash,h,2,as)call SaveEffectHandle(udg_hash,h,5,ef)call TimerStart(t,10.,false,function Trig_TimeTalisman_Remove_Bonuses_Actions)set ef=nullelse
call SimError(GetOwningPlayer(caster),"На этого воина уже наложено заклинание: 'Обгоняя Время'.")endifset caster=nullset target=nullset t=nullendfunctionfunction Trig_TimeTalisman_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0QI' or GetSpellAbilityId()=='A0QM' or GetSpellAbilityId()=='A0QN' or GetSpellAbilityId()=='A0QO' or GetSpellAbilityId()=='A0QP')endfunctionfunction InitTrig_TimeTalisman takes nothing returns nothing
local integer index=0set gg_trg_TimeTalisman=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_TimeTalisman,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_TimeTalisman,Condition(function Trig_TimeTalisman_Conditions))call TriggerAddAction(gg_trg_TimeTalisman,function Trig_TimeTalisman_Actions)endfunctionfunction Trig_Take_Paladin_Armor_Periodic_Wave_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local unit dammi=LoadUnitHandle(udg_hash,h,4)local real x
local real y
local real xtlocal real ytlocal real angle
local real distlocal real heallocal effect efset x=GetUnitX(dammi)set y=GetUnitY(dammi)set xt=GetUnitX(target)set yt=GetUnitY(target)set angle=bj_RADTODEG*Atan2(yt-y,xt-x)set x=x+17.*Cos(angle*bj_DEGTORAD)set y=y+17.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(dammi,x,y)set dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))
if dist<23. or GetUnitState(target,UNIT_STATE_LIFE)<.405 thencall SetUnitScale(dammi,.6,.6,.6)set ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullif GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset heal=LoadReal(udg_hash,h,2)call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+heal)call DestroyEffect(AddSpecialEffectTarget("Effects\\MegaHeal.mdx",target,"origin"))call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",target,"origin"),2.)else
call DestroyEffect(AddSpecialEffect("Effects\\HolyPhoenixMissle.mdx",x,y))endifcall RemoveUnit(dammi)call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset t=nullset target=nullset dammi=nullendfunctionfunction Trig_Take_Paladin_Armor_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local integer regen=LoadInteger(udg_hash,h,2)local item armor=LoadItemHandle(udg_hash,h,3)local integer newregen=R2I(GetUnitState(hero,UNIT_STATE_MAX_LIFE)*.01)local real heallocal timer t2local integer h2
local unit targetlocal group glocal group grup
local unit Pickedlocal unit dammi
local effect efif armor!=LoadItemHandle(udg_hash,GetHandleId(hero),$AD)or UnitHasItem(hero,armor)==false thencall SetUnitLifeAndManaRegeneration(hero,"life",-LoadInteger(udg_hash,h,2))call SaveInteger(udg_hash,h,2,0)
endifif UnitHasItem(hero,armor)==false thencall SaveItemHandle(udg_hash,GetHandleId(hero),$AD,GetItemOfTypeFromUnitBJ(hero,'I02P'))
endifif GetUnitState(hero,UNIT_STATE_LIFE)>.405 and CountItemOfTypeOnUnit(hero,'I02P')>0 and armor==LoadItemHandle(udg_hash,GetHandleId(hero),$AD)thenif regen!=newregen thencall SetUnitLifeAndManaRegeneration(hero,"life",-regen)call SetUnitLifeAndManaRegeneration(hero,"life",newregen)call SaveInteger(udg_hash,h,2,newregen)endifset g=CreateGroup()set grup=CreateGroup()call GroupEnumUnitsInRange(g,GetUnitX(hero),GetUnitY(hero),750.,null)call GroupRemoveUnit(g,hero)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,GetOwningPlayer(hero))and(GetUnitState(Picked,UNIT_STATE_LIFE)<.99*GetUnitState(Picked,UNIT_STATE_MAX_LIFE))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall RandomUnitFromGroup(1,grup)
call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set target=FirstOfGroup(udg_GroupRandomUnitFromGroup)if target==null then
set target=heroendifif target!=null then
set t2=CreateTimer()
set h2=GetHandleId(t2)set heal=200.+GetHeroStr(hero,true)set dammi=CreateUnit(GetOwningPlayer(hero),'h00U',GetUnitX(hero),GetUnitY(hero),(bj_RADTODEG*Atan2(GetUnitY(target)-GetUnitY(hero),GetUnitX(target)-GetUnitX(hero))))call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,50.,.0)set ef=AddSpecialEffectTarget("Effects\\HolyPhoenixMissle.mdx",dammi,"chest")call SaveUnitHandle(udg_hash,h2,1,target)call SaveReal(udg_hash,h2,2,heal)call SaveEffectHandle(udg_hash,h2,3,ef)call SaveUnitHandle(udg_hash,h2,4,dammi)
call TimerStart(t2,.03,true,function Trig_Take_Paladin_Armor_Periodic_Wave_Move_Actions)
set ef=nullset dammi=nullset t2=nullendifcall GroupClear(g)call DestroyGroup(g)
set g=nullendifif CountItemOfTypeOnUnit(hero,'I02P')<=0 thencall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset armor=nullset t=nullset hero=nullendfunctionfunction Trig_Take_Paladin_Armor_Actions takes nothing returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer regen=0local unit hero=GetTriggerUnit()
call SaveUnitHandle(udg_hash,h,1,hero)call SaveInteger(udg_hash,h,2,regen)
call SaveItemHandle(udg_hash,h,3,GetManipulatedItem())call SaveItemHandle(udg_hash,GetHandleId(hero),$AD,GetManipulatedItem())
call TimerStart(t,5.,true,function Trig_Take_Paladin_Armor_Periodic_Actions)
set t=nullset hero=nullendfunctionfunction Trig_Take_Paladin_Armor_Conditions takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())=='I02P')endfunctionfunction InitTrig_Take_Paladin_Armor takes nothing returns nothinglocal integer index=0set gg_trg_Take_Paladin_Armor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Paladin_Armor,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Paladin_Armor,Condition(function Trig_Take_Paladin_Armor_Conditions))call TriggerAddAction(gg_trg_Take_Paladin_Armor,function Trig_Take_Paladin_Armor_Actions)endfunctionfunction Trig_Take_Archimagus_Staff_Conditions takes nothing returns boolean
return GetItemTypeId(GetManipulatedItem())=='I04V'endfunctionfunction Trig_Take_Archimagus_Staff_Remove_Recipe_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local item it=LoadItemHandle(udg_hash,h,1)local item staff=LoadItemHandle(udg_hash,h,2)if staff!=null thencall UnitAddItem(LoadUnitHandle(udg_hash,h,3),staff)
endifcall RemoveItem(it)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set it=nullset t=nullendfunctionfunction Trig_Take_Archimagus_Staff_Actions takes nothing returns nothinglocal item it=GetManipulatedItem()local integer id=GetItemTypeId(it)local unit hero=GetManipulatingUnit()local integer heroid=GetUnitTypeId(hero)
local item staff
local timer t=CreateTimer()local integer h=GetHandleId(t)if heroid=='H00Q' thenset staff=CreateItem('I01Y',GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,staff)
call SetItemUserData(staff,GetPlayerId(GetOwningPlayer(hero))+1)
endifif heroid=='O001' thenset staff=CreateItem('I01Z',GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,staff)
call SetItemUserData(staff,GetPlayerId(GetOwningPlayer(hero))+1)
endifif heroid=='E003' thenset staff=CreateItem('I020',GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,staff)
call SetItemUserData(staff,GetPlayerId(GetOwningPlayer(hero))+1)
endifif heroid=='E001' thenset staff=CreateItem('I024',GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,staff)
call SetItemUserData(staff,GetPlayerId(GetOwningPlayer(hero))+1)
endifif heroid=='N00W' thenset staff=CreateItem('I025',GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,staff)
call SetItemUserData(staff,GetPlayerId(GetOwningPlayer(hero))+1)
endifif heroid=='H01I' thenset staff=CreateItem('I028',GetUnitX(hero),GetUnitY(hero))call UnitAddItem(hero,staff)
call SetItemUserData(staff,GetPlayerId(GetOwningPlayer(hero))+1)
endifcall SaveItemHandle(udg_hash,h,1,it)
if staff!=null thencall SaveItemHandle(udg_hash,h,2,staff)call SaveUnitHandle(udg_hash,h,3,hero)endifcall TimerStart(t,.01,false,function Trig_Take_Archimagus_Staff_Remove_Recipe_Actions)set it=nullset hero=nullendfunctionfunction InitTrig_Take_Archimagus_Staff takes nothing returns nothinglocal integer index=0set gg_trg_Take_Archimagus_Staff=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Archimagus_Staff,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Archimagus_Staff,Condition(function Trig_Take_Archimagus_Staff_Conditions))
call TriggerAddAction(gg_trg_Take_Archimagus_Staff,function Trig_Take_Archimagus_Staff_Actions)endfunctionfunction Trig_Lost_Charged_Staff_of_Lightning_Actions takes nothing returns nothinglocal unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local integer i=LoadInteger(udg_hash,h,$8F)if i==3 then
call DestroyEffect(LoadEffectHandle(udg_hash,h,$90))
endifcall SaveInteger(udg_hash,h,$8F,0)endfunctionfunction Trig_Lost_Charged_Staff_of_Lightning_Conditions takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())=='I01W' and IsUnitType(GetManipulatingUnit(),UNIT_TYPE_HERO))!=nullendfunctionfunction InitTrig_Lost_Charged_Staff_of_Lightning takes nothing returns nothinglocal integer index=0set gg_trg_Lost_Charged_Staff_of_Lightning=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Charged_Staff_of_Lightning,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Charged_Staff_of_Lightning,Condition(function Trig_Lost_Charged_Staff_of_Lightning_Conditions))
call TriggerAddAction(gg_trg_Lost_Charged_Staff_of_Lightning,function Trig_Lost_Charged_Staff_of_Lightning_Actions)endfunctionfunction Trig_Blood_Bow_Actions takes nothing returns nothinglocal unit killer=GetKillingUnit()call SetUnitState(killer,UNIT_STATE_LIFE,GetUnitState(killer,UNIT_STATE_LIFE)+(GetUnitState(GetDyingUnit(),UNIT_STATE_MAX_LIFE)*.1))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPriest.mdl",killer,"chest"))set killer=nullendfunctionfunction Trig_Blood_Bow_Conditions takes nothing returns boolean
return GetUnitAbilityLevel(GetKillingUnit(),'A0O0')>=1endfunctionfunction InitTrig_Blood_Bow takes nothing returns nothinglocal integer index=0set gg_trg_Blood_Bow=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blood_Bow,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blood_Bow,Condition(function Trig_Blood_Bow_Conditions))
call TriggerAddAction(gg_trg_Blood_Bow,function Trig_Blood_Bow_Actions)endfunctionfunction Trig_Balance_Ring_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real hp=GetUnitState(caster,UNIT_STATE_LIFE)local real hp2local real removehp=200.
local real healmp=150.if(GetUnitState(caster,UNIT_STATE_MANA)<(GetUnitState(caster,UNIT_STATE_MAX_MANA)*.5))thenif hp>removehp thenset hp2=removehp
else
set hp2=hp-1.endifcall SetUnitState(caster,UNIT_STATE_LIFE,hp-hp2)
call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)+250.)else
if hp>removehp thenset hp2=removehp
else
set hp2=hp-1.endifcall SetUnitState(caster,UNIT_STATE_LIFE,hp-hp2)
call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)+150.)endifcall DestroyEffect(AddSpecialEffectTarget("Effects\\RefreshingSurge.mdl",caster,"origin"))set caster=nullendfunctionfunction Trig_Balance_Ring_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NQ'endfunctionfunction InitTrig_Balance_Ring takes nothing returns nothing
local integer index=0set gg_trg_Balance_Ring=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Balance_Ring,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Balance_Ring,Condition(function Trig_Balance_Ring_Conditions))call TriggerAddAction(gg_trg_Balance_Ring,function Trig_Balance_Ring_Actions)endfunctionfunction Trig_Armageddon_Staff_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,37)local real damage=LoadReal(udg_hash,h,38)local integer wait=LoadInteger(udg_hash,h,39)local real angle=LoadReal(udg_hash,h,40)
local group gdamage=LoadGroupHandle(udg_hash,h,41)local player p=GetOwningPlayer(caster)local group gdammi=CreateGroup()
local group g=CreateGroup()local real dammianglelocal real xdammilocal real ydammilocal unit Pickedlocal unit dammi
local integer lopa=1
local effect eflocal real anglestep
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,39,wait)
loop
exitwhen lopa>$A
set dammi=LoadUnitHandle(udg_hash,h,lopa)set dammiangle=LoadReal(udg_hash,h,lopa+20)set anglestep=LoadReal(udg_hash,h,lopa+50)if dammiangle<-45. thenset anglestep=-anglestep
call SaveReal(udg_hash,h,lopa+50,anglestep)endifif dammiangle>45. thenset anglestep=-anglestep
call SaveReal(udg_hash,h,lopa+50,anglestep)endifset dammiangle=dammiangle+anglestepset xdammi=GetUnitX(dammi)+16.*Cos((angle+dammiangle)*bj_DEGTORAD)set ydammi=GetUnitY(dammi)+16.*Sin((angle+dammiangle)*bj_DEGTORAD)call SetUnitPosition(dammi,xdammi,ydammi)call SetUnitFacing(dammi,angle+dammiangle)call GroupEnumUnitsInRange(gdammi,xdammi,ydammi,125.,null)call GroupAddGroup(gdammi,g)
call SaveReal(udg_hash,h,lopa+20,dammiangle)
set dammi=nullset lopa=lopa+1endlooploop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitInGroup(Picked,gdamage)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0NE')call IssueTargetOrderById(dammi,$D02B6,Picked)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",Picked,"chest"))call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall SaveGroupHandle(udg_hash,h,41,gdamage)else
loop
exitwhen lopa>$A
set dammi=LoadUnitHandle(udg_hash,h,lopa)set ef=LoadEffectHandle(udg_hash,h,lopa+$A)call KillUnit(dammi)
call DestroyEffect(ef)set lopa=lopa+1set dammi=nullset ef=nullendloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call GroupClear(gdamage)
call DestroyGroup(gdamage)endifset t=nullset caster=nullset gdamage=null
set p=nullcall GroupClear(gdammi)call DestroyGroup(gdammi)set gdammi=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Armageddon_Staff_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local location loclocal real xtlocal real ytlocal unit dammi
local effect eflocal real xdammilocal real ydammilocal integer lopa=1
local group gdamage=CreateGroup()local real angle
local integer count=$Alocal real damage=335.+GetHeroInt(caster,true)local integer wait=50local real dammidist=-300.local real dammiangleif GetSpellTargetUnit()==null thenset loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
call RemoveLocation(loc)
set loc=null
else
set xt=GetUnitX(GetSpellTargetUnit())set yt=GetUnitY(GetSpellTargetUnit())endifset angle=bj_RADTODEG*Atan2(yt-y,xt-x)loop
exitwhen lopa>countset dammiangle=GetRandomReal(-45.,45.)set xdammi=x+dammidist*Cos((angle-90.)*bj_DEGTORAD)set ydammi=y+dammidist*Sin((angle-90.)*bj_DEGTORAD)set dammi=CreateUnit(p,'h00U',xdammi,ydammi,dammiangle)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,50.,.0)set ef=AddSpecialEffectTarget("Effects\\SunfireMissile.mdl",dammi,"chest")call SaveUnitHandle(udg_hash,h,lopa,dammi)call SaveEffectHandle(udg_hash,h,lopa+$A,ef)
call SaveReal(udg_hash,h,lopa+20,dammiangle)
call SaveReal(udg_hash,h,lopa+50,3.6)set dammidist=dammidist+70.set lopa=lopa+1set dammi=nullset ef=nullendloopcall SaveUnitHandle(udg_hash,h,37,caster)call SaveReal(udg_hash,h,38,damage)call SaveInteger(udg_hash,h,39,wait)
call SaveReal(udg_hash,h,40,angle)call SaveGroupHandle(udg_hash,h,41,gdamage)call TimerStart(t,.03,true,function Trig_Armageddon_Staff_Periodic_Actions)set caster=nullset p=nullset t=nullset gdamage=null
endfunctionfunction Trig_Armageddon_Staff_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NC'endfunctionfunction InitTrig_Armageddon_Staff takes nothing returns nothing
local integer index=0set gg_trg_Armageddon_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Armageddon_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Armageddon_Staff,Condition(function Trig_Armageddon_Staff_Conditions))call TriggerAddAction(gg_trg_Armageddon_Staff,function Trig_Armageddon_Staff_Actions)endfunctionfunction Trig_Sargeras_Crown_Remove_Bonuses_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local integer bonusstr=LoadInteger(udg_hash,h,2)
local integer bonusagi=LoadInteger(udg_hash,h,3)
local integer bonusint=LoadInteger(udg_hash,h,4)
local effect ef=LoadEffectHandle(udg_hash,h,5)call SetHeroStr(target,GetHeroStr(target,false)-bonusstr,true)call SetHeroAgi(target,GetHeroAgi(target,false)-bonusagi,true)call SetHeroInt(target,GetHeroInt(target,false)-bonusint,true)call SaveBoolean(udg_hash,GetHandleId(target),'}',false)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call DestroyEffect(ef)set target=nullset ef=nullset t=nullendfunctionfunction Trig_Sargeras_Crown_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local integer agi=GetHeroAgi(target,true)local integer id=GetSpellAbilityId()
local real bonus=.0local real time=.0local effect eflocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer bonusstrlocal integer bonusagilocal integer bonusintif id=='A0N2' thenset bonus=.3
set time=7.endifif id=='A0N3' thenset bonus=.5
set time=9.endifif id=='A0N4' thenset bonus=.7
set time=11.
endifif LoadBoolean(udg_hash,GetHandleId(target),'}')==false then
set ef=AddSpecialEffectTarget("Effects\\HolyBlessing.mdl",target,"origin")call SaveBoolean(udg_hash,GetHandleId(target),'}',true)set bonusstr=R2I(GetHeroStr(target,true)*bonus)set bonusagi=R2I(GetHeroAgi(target,true)*bonus)set bonusint=R2I(GetHeroInt(target,true)*bonus)call SetHeroStr(target,GetHeroStr(target,false)+bonusstr,true)call SetHeroAgi(target,GetHeroAgi(target,false)+bonusagi,true)call SetHeroInt(target,GetHeroInt(target,false)+bonusint,true)call SaveUnitHandle(udg_hash,h,1,target)
call SaveInteger(udg_hash,h,2,bonusstr)call SaveInteger(udg_hash,h,3,bonusagi)call SaveInteger(udg_hash,h,4,bonusint)call SaveEffectHandle(udg_hash,h,5,ef)call TimerStart(t,time,false,function Trig_Sargeras_Crown_Remove_Bonuses_Actions)set ef=nullelse
call SimError(GetOwningPlayer(caster),"На этого героя уже наложено Благославление Саргераса.")
endifset caster=nullset target=nullset t=nullendfunctionfunction Trig_Sargeras_Crown_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0N2' or GetSpellAbilityId()=='A0N3' or GetSpellAbilityId()=='A0N4')endfunctionfunction InitTrig_Sargeras_Crown takes nothing returns nothinglocal integer index=0set gg_trg_Sargeras_Crown=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sargeras_Crown,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sargeras_Crown,Condition(function Trig_Sargeras_Crown_Conditions))call TriggerAddAction(gg_trg_Sargeras_Crown,function Trig_Sargeras_Crown_Actions)endfunctionfunction Trig_Lost_Sargeras_Crown_Actions takes nothing returns nothinglocal unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local integer id=GetItemTypeId(GetManipulatedItem())
local integer bonus=0local string smainstat=LoadStr(udg_hash,GetUnitTypeId(hero),70)if id=='I008' thenset bonus=$F
endifif id=='I009' thenset bonus=30
endifif id=='I00L' thenset bonus=45
endifif smainstat=="str" then
call SetHeroStr(hero,GetHeroStr(hero,false)-bonus,true)endifif smainstat=="agi" then
call SetHeroAgi(hero,GetHeroAgi(hero,false)-bonus,true)endifif smainstat=="int" then
call SetHeroInt(hero,GetHeroInt(hero,false)-bonus,true)endifset hero=nullendfunctionfunction Trig_Lost_Sargeras_Crown_Conditions takes nothing returns booleanreturn((GetItemTypeId(GetManipulatedItem())=='I008' or GetItemTypeId(GetManipulatedItem())=='I009' or GetItemTypeId(GetManipulatedItem())=='I00L')and IsUnitType(GetManipulatingUnit(),UNIT_TYPE_HERO))!=nullendfunctionfunction InitTrig_Lost_Sargeras_Crown takes nothing returns nothinglocal integer index=0set gg_trg_Lost_Sargeras_Crown=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Sargeras_Crown,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Sargeras_Crown,Condition(function Trig_Lost_Sargeras_Crown_Conditions))
call TriggerAddAction(gg_trg_Lost_Sargeras_Crown,function Trig_Lost_Sargeras_Crown_Actions)endfunctionfunction Trig_Take_Sargeras_Crown_Actions takes nothing returns nothinglocal unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local integer id=GetItemTypeId(GetManipulatedItem())
local integer bonus=0local string smainstat=LoadStr(udg_hash,GetUnitTypeId(hero),70)if id=='I008' thenset bonus=$F
endifif id=='I009' thenset bonus=30
endifif id=='I00L' thenset bonus=45
endifif smainstat=="str" then
call SetHeroStr(hero,GetHeroStr(hero,false)+bonus,true)endifif smainstat=="agi" then
call SetHeroAgi(hero,GetHeroAgi(hero,false)+bonus,true)endifif smainstat=="int" then
call SetHeroInt(hero,GetHeroInt(hero,false)+bonus,true)endifset hero=nullendfunctionfunction Trig_Take_Sargeras_Crown_Conditions takes nothing returns booleanreturn((GetItemTypeId(GetManipulatedItem())=='I008' or GetItemTypeId(GetManipulatedItem())=='I009' or GetItemTypeId(GetManipulatedItem())=='I00L')and IsUnitType(GetManipulatingUnit(),UNIT_TYPE_HERO))!=nullendfunctionfunction InitTrig_Take_Sargeras_Crown takes nothing returns nothinglocal integer index=0set gg_trg_Take_Sargeras_Crown=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Sargeras_Crown,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Sargeras_Crown,Condition(function Trig_Take_Sargeras_Crown_Conditions))
call TriggerAddAction(gg_trg_Take_Sargeras_Crown,function Trig_Take_Sargeras_Crown_Actions)endfunctionfunction Trig_Lost_Archimagus_Armor_Actions takes nothing returns nothinglocal unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local effect ef=LoadEffectHandle(udg_hash,h,'g')
call DestroyEffect(ef)call SaveBoolean(udg_hash,h,'f',false)call SaveEffectHandle(udg_hash,h,'g',null)set hero=nullset ef=nullendfunctionfunction Trig_Lost_Archimagus_Armor_Conditions takes nothing returns boolean
return GetItemTypeId(GetManipulatedItem())=='I05A' and CountItemOfTypeOnUnit(GetTriggerUnit(),'I05A')==1
endfunctionfunction InitTrig_Lost_Archimagus_Armor takes nothing returns nothinglocal integer index=0set gg_trg_Lost_Archimagus_Armor=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Archimagus_Armor,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Archimagus_Armor,Condition(function Trig_Lost_Archimagus_Armor_Conditions))
call TriggerAddAction(gg_trg_Lost_Archimagus_Armor,function Trig_Lost_Archimagus_Armor_Actions)endfunctionfunction Trig_Take_Archimagus_Armor_Actions takes nothing returns nothinglocal unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local effect efif LoadReal(udg_hash,h,'h')<1. thenset ef=AddSpecialEffectTarget("Effects\\MagicShieldBlue.mdx",hero,"origin")call SaveBoolean(udg_hash,h,'f',true)call SaveEffectHandle(udg_hash,h,'g',ef)
if LoadBoolean(udg_hash,h,'j')==false thencall SaveReal(udg_hash,GetHandleId(hero),'i',(500.+(GetHeroInt(hero,true)*3.)))endifendifset hero=nullset ef=nullendfunctionfunction Trig_Take_Archimagus_Armor_Conditions takes nothing returns boolean
return GetItemTypeId(GetManipulatedItem())=='I05A' and CountItemOfTypeOnUnit(GetTriggerUnit(),'I05A')==1
endfunctionfunction InitTrig_Take_Archimagus_Armor takes nothing returns nothinglocal integer index=0set gg_trg_Take_Archimagus_Armor=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Archimagus_Armor,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Archimagus_Armor,Condition(function Trig_Take_Archimagus_Armor_Conditions))
call TriggerAddAction(gg_trg_Take_Archimagus_Armor,function Trig_Take_Archimagus_Armor_Actions)endfunctionfunction Trig_Sorcerers_Talisman_Cast_Actions takes nothing returns nothingset udg_Temp_Unit=GetSpellTargetUnit()endfunctionfunction Trig_Sorcerers_Talisman_Cast_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0LW' or GetSpellAbilityId()=='A0LZ' or GetSpellAbilityId()=='A0M0' or GetSpellAbilityId()=='A0M1'endfunctionfunction InitTrig_Sorcerers_Talisman_Cast takes nothing returns nothinglocal integer index=0set gg_trg_Sorcerers_Talisman_Cast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sorcerers_Talisman_Cast,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sorcerers_Talisman_Cast,Condition(function Trig_Sorcerers_Talisman_Cast_Conditions))
call TriggerAddAction(gg_trg_Sorcerers_Talisman_Cast,function Trig_Sorcerers_Talisman_Cast_Actions)endfunctionfunction Trig_Sorcerers_Talisman_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local effect eflocal boolean ally=LoadBoolean(udg_hash,h,4)
local real heal=LoadReal(udg_hash,h,5)local real damage=LoadReal(udg_hash,h,6)
local integer wait=LoadInteger(udg_hash,h,7)
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,7,wait)if ally and GetUnitState(target,UNIT_STATE_LIFE)>.405 thencall SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+heal)else
if IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false then
call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifendifelse
call DestroyTimer(t)
set ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)call FlushChildHashtable(udg_hash,h)
endifset t=nullset caster=nullset target=nullendfunctionfunction Trig_Sorcerers_Talisman_Actions takes nothing returns nothinglocal unit caster=GetManipulatingUnit()local unit target=udg_Temp_Unitlocal player p=GetOwningPlayer(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local integer lvllocal item it=GetManipulatedItem()local integer charges=GetItemCharges(it)
local integer id=GetItemTypeId(it)local effect eflocal boolean allylocal real heallocal real damagelocal integer waitif charges!=0 thencall SetItemCharges(it,charges+1)endifif charges==0 thencall SetItemCharges(it,1)endifif GetItemCharges(it)<=7 thencall SimError(p,"Для Применения необходимо минимум 8 душ.")
else
if id=='I055' thenset lvl=1endifif id=='I056' thenset lvl=2endifif id=='I057' thenset lvl=3endifif id=='I058' thenset lvl=4endifset wait=8-lvlset heal=(125.+(75.*lvl))/ waitset damage=(200.+(100.*lvl))/ waitcall SetItemCharges(it,GetItemCharges(it)-8)
if IsUnitEnemy(target,p) and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false then
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Voodoo\\VoodooAuraTarget.mdl",target,"overhead")set ally=falseendifif IsUnitAlly(target,p) and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false thenset ef=AddSpecialEffectTarget("Abilities\\Spells\\Items\\StaffOfSanctuary\\Staff_Sanctuary_Target.mdl",target,"chest")set ally=trueendifcall DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl",caster,"origin"),2.5)call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\EtherealForm\\SpiritWalkerChange.mdl",target,"origin"),3.)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveEffectHandle(udg_hash,h,3,ef)call SaveBoolean(udg_hash,h,4,ally)call SaveReal(udg_hash,h,5,heal)
call SaveReal(udg_hash,h,6,damage)call SaveInteger(udg_hash,h,7,wait)call TimerStart(t,1.,true,function Trig_Sorcerers_Talisman_Periodic_Actions)
endifset caster=nullset target=nullset p=nullset t=nullset it=nullset ef=nullendfunctionfunction Trig_Sorcerers_Talisman_Conditions takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I055' or GetItemTypeId(GetManipulatedItem())=='I056' or GetItemTypeId(GetManipulatedItem())=='I057' or GetItemTypeId(GetManipulatedItem())=='I058'endfunctionfunction InitTrig_Sorcerers_Talisman takes nothing returns nothinglocal integer index=0set gg_trg_Sorcerers_Talisman=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sorcerers_Talisman,Player(index),EVENT_PLAYER_UNIT_USE_ITEM,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sorcerers_Talisman,Condition(function Trig_Sorcerers_Talisman_Conditions))call TriggerAddAction(gg_trg_Sorcerers_Talisman,function Trig_Sorcerers_Talisman_Actions)endfunctionfunction Trig_Sorcerers_Talisman_Dead_Unit_Condition_Actions takes nothing returns booleanreturn GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405 and GetUnitTypeId(GetFilterUnit())!='h00U' and IsUnitEnemy(udg_Temp_Unit,GetOwningPlayer(GetFilterUnit())) and(CountItemOfTypeOnUnit(GetFilterUnit(),'I055')>=1 or CountItemOfTypeOnUnit(GetFilterUnit(),'I056')>=1 or CountItemOfTypeOnUnit(GetFilterUnit(),'I057')>=1 or CountItemOfTypeOnUnit(GetFilterUnit(),'I058')>=1)endfunctionfunction Trig_Sorcerers_Talisman_Dead_Unit_Actions takes nothing returns nothing
local unit enemy=GetDyingUnit()local real x=GetUnitX(enemy)
local real y=GetUnitY(enemy)
local group g=CreateGroup()local unit dammi=CreateUnit(GetOwningPlayer(enemy),'h00U',x,y,.0)local item talismanlocal integer lop=1call UnitApplyTimedLife(dammi,'BTLF',2.)
set udg_Temp_Unit=enemycall GroupEnumUnitsInRange(g,x,y,1200.,Filter(function Trig_Sorcerers_Talisman_Dead_Unit_Condition_Actions))
call FilterMostNearUnit(g,dammi)
if udg_Unit_FilterMostNearUnit!=null and SquareRoot(((GetUnitX(udg_Unit_FilterMostNearUnit)-x)*(GetUnitX(udg_Unit_FilterMostNearUnit)-x))+((GetUnitY(udg_Unit_FilterMostNearUnit)-y)*(GetUnitY(udg_Unit_FilterMostNearUnit)-y)))<=1200. then
set talisman=UnitItemInSlot(udg_Unit_FilterMostNearUnit,0)loop
exitwhen lop>5if((GetItemTypeId(talisman)=='I055' and GetItemCharges(talisman)<24)or(GetItemTypeId(talisman)=='I056' and GetItemCharges(talisman)<32)or(GetItemTypeId(talisman)=='I057' and GetItemCharges(talisman)<40)or(GetItemTypeId(talisman)=='I058' and GetItemCharges(talisman)<48))thencall SetItemCharges(talisman,GetItemCharges(talisman)+1)
set lop=6else
set talisman=UnitItemInSlot(udg_Unit_FilterMostNearUnit,lop)
endifset lop=lop+1endloopendifset enemy=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset talisman=nullendfunctionfunction Trig_Sorcerers_Talisman_Dead_Unit_Condition takes nothing returns booleanreturn GetUnitTypeId(GetDyingUnit())!='h00U'
endfunctionfunction InitTrig_Sorcerers_Talisman_Dead_Unit takes nothing returns nothing
local integer index=0set gg_trg_Sorcerers_Talisman_Dead_Unit=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sorcerers_Talisman_Dead_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sorcerers_Talisman_Dead_Unit,Condition(function Trig_Sorcerers_Talisman_Dead_Unit_Condition))call TriggerAddAction(gg_trg_Sorcerers_Talisman_Dead_Unit,function Trig_Sorcerers_Talisman_Dead_Unit_Actions)endfunctionfunction Trig_Orc_Banner_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local group gmain=LoadGroupHandle(udg_hash,h,2)local integer bonushp=LoadInteger(udg_hash,h,3)local integer bonusa=LoadInteger(udg_hash,h,4)local integer bonusstat=LoadInteger(udg_hash,h,5)local integer lvl=LoadInteger(udg_hash,h,6)local item it=LoadItemHandle(udg_hash,h,7)local group g=CreateGroup()local group g2=CreateGroup()
local player p=GetOwningPlayer(hero)
local unit Pickedlocal string slocal real x=GetUnitX(hero)local real y=GetUnitY(hero)local boolean dest=false
local boolean tdest=falseif UnitHasItem(hero,it) then
if GetItemTypeId(it)=='I052' and LoadInteger(udg_hash,GetHandleId(hero),'e')==2 then
set dest=trueendifif dest==false thencall GroupEnumUnitsInRange(g,GetUnitX(hero),GetUnitY(hero),800.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,p)and IsUnitInGroup(Picked,gmain)==false and(LoadInteger(udg_hash,GetHandleId(Picked),'e')==0 or(LoadInteger(udg_hash,GetHandleId(Picked),'e')==1 and lvl==2))and IsUnitType(Picked,UNIT_TYPE_HERO) and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall SetAttackAbilityLevel(Picked,bonusa)call SetUnitMaxState(Picked,UNIT_STATE_MAX_LIFE,bonushp)
set s=LoadStr(udg_hash,GetUnitTypeId(Picked),70)
if s=="str" then
call SetHeroStr(Picked,GetHeroStr(Picked,false)+bonusstat,true)endifif s=="agi" then
call SetHeroAgi(Picked,GetHeroAgi(Picked,false)+bonusstat,true)endifif s=="int" then
call SetHeroInt(Picked,GetHeroInt(Picked,false)+bonusstat,true)endifcall SaveInteger(udg_hash,GetHandleId(Picked),'e',lvl)call GroupAddUnit(gmain,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupAddGroup(gmain,g2)
loop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullif SquareRoot((x-GetUnitX(Picked))*(x-GetUnitX(Picked))+(y-GetUnitY(Picked))*(y-GetUnitY(Picked)))>800. then
call SetAttackAbilityLevel(Picked,-bonusa)call SetUnitMaxState(Picked,UNIT_STATE_MAX_LIFE,-bonushp)set s=LoadStr(udg_hash,GetUnitTypeId(Picked),70)
if s=="str" then
call SetHeroStr(Picked,GetHeroStr(Picked,false)-bonusstat,true)endifif s=="agi" then
call SetHeroAgi(Picked,GetHeroAgi(Picked,false)-bonusstat,true)endifif s=="int" then
call SetHeroInt(Picked,GetHeroInt(Picked,false)-bonusstat,true)endifif LoadInteger(udg_hash,GetHandleId(Picked),'e')==lvl thencall SaveInteger(udg_hash,GetHandleId(Picked),'e',0)
endifcall GroupRemoveUnit(gmain,Picked)endifcall GroupRemoveUnit(g2,Picked)endloopset Picked=nullendifcall SaveGroupHandle(udg_hash,h,2,gmain)
else
set dest=trueendifif dest then
loop
set Picked=FirstOfGroup(gmain)exitwhen Picked==nullcall SetAttackAbilityLevel(Picked,-bonusa)call SetUnitMaxState(Picked,UNIT_STATE_MAX_LIFE,-bonushp)set s=LoadStr(udg_hash,GetUnitTypeId(Picked),70)
if s=="str" then
call SetHeroStr(Picked,GetHeroStr(Picked,false)-bonusstat,true)endifif s=="agi" then
call SetHeroAgi(Picked,GetHeroAgi(Picked,false)-bonusstat,true)endifif s=="int" then
call SetHeroInt(Picked,GetHeroInt(Picked,false)-bonusstat,true)endifif LoadInteger(udg_hash,GetHandleId(Picked),'e')==lvl thencall SaveInteger(udg_hash,GetHandleId(Picked),'e',0)
endifcall GroupRemoveUnit(gmain,Picked)endloopendifif UnitHasItem(hero,it)==false thencall GroupClear(gmain)call DestroyGroup(gmain)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
else
call SaveGroupHandle(udg_hash,h,2,gmain)
endifset t=nullset hero=nullset gmain=nullset it=nullset p=nullset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullendfunctionfunction Trig_Orc_Banner_Actions takes nothing returns nothinglocal unit hero=GetTriggerUnit()
local group g=CreateGroup()local group gmain=CreateGroup()local player p=GetOwningPlayer(hero)
local unit Pickedlocal integer bonushplocal integer bonusa
local integer bonusstatlocal integer lvllocal item it=GetManipulatedItem()local string slocal timer t=CreateTimer()local integer h=GetHandleId(t)if GetItemTypeId(it)=='I052' thenset bonushp=$AFset bonusa=20set bonusstat=7set lvl=1else
set bonushp=$FAset bonusa=30set bonusstat=$A
set lvl=2endifcall GroupEnumUnitsInRange(g,GetUnitX(hero),GetUnitY(hero),800.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,p)and(LoadInteger(udg_hash,GetHandleId(Picked),'e')==0 or(LoadInteger(udg_hash,GetHandleId(Picked),'e')==1 and lvl==2))and IsUnitType(Picked,UNIT_TYPE_HERO) and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall SetAttackAbilityLevel(Picked,bonusa)call SetUnitMaxState(Picked,UNIT_STATE_MAX_LIFE,bonushp)
set s=LoadStr(udg_hash,GetUnitTypeId(Picked),70)
if s=="str" then
call SetHeroStr(Picked,GetHeroStr(Picked,false)+bonusstat,true)endifif s=="agi" then
call SetHeroAgi(Picked,GetHeroAgi(Picked,false)+bonusstat,true)endifif s=="int" then
call SetHeroInt(Picked,GetHeroInt(Picked,false)+bonusstat,true)endifcall SaveInteger(udg_hash,GetHandleId(Picked),'e',lvl)call GroupAddUnit(gmain,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveUnitHandle(udg_hash,h,1,hero)call SaveGroupHandle(udg_hash,h,2,gmain)
call SaveInteger(udg_hash,h,3,bonushp)call SaveInteger(udg_hash,h,4,bonusa)call SaveInteger(udg_hash,h,5,bonusstat)
call SaveInteger(udg_hash,h,6,lvl)call SaveItemHandle(udg_hash,h,7,it)
call TimerStart(t,.3,true,function Trig_Orc_Banner_Periodic_Actions)
set hero=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gmain=nullset p=nullset Picked=nullset it=nullset t=nullendfunctionfunction Trig_Orc_Banner_Conditions takes nothing returns booleanreturn(GetItemTypeId(GetManipulatedItem())=='I052' or(GetItemTypeId(GetManipulatedItem())=='I053'))endfunctionfunction InitTrig_Orc_Banner takes nothing returns nothinglocal integer index=0set gg_trg_Orc_Banner=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Orc_Banner,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Orc_Banner,Condition(function Trig_Orc_Banner_Conditions))call TriggerAddAction(gg_trg_Orc_Banner,function Trig_Orc_Banner_Actions)endfunctionfunction Trig_Devil_Axe_Remove_Stregnth_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer strenght=LoadInteger(udg_hash,GetHandleId(caster),'d')
local effect efcall SetHeroStr(caster,GetHeroStr(caster,false)-strenght,true)set ef=LoadEffectHandle(udg_hash,h,2)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullcall SaveBoolean(udg_hash,GetHandleId(caster),99,false)call SaveInteger(udg_hash,GetHandleId(caster),'d',0)
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset caster=nullendfunctionfunction Trig_Devil_Axe_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',GetUnitX(caster),GetUnitY(caster),.0)
local effect efcall UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0LT')call IssueTargetOrderById(dammi,$D00F1,caster)call SaveUnitHandle(udg_hash,h,1,caster)
set ef=AddSpecialEffectTarget("Effects\\EvilMissileofShadowyDOOMV2.mdx",caster,"weapon")
call SaveEffectHandle(udg_hash,h,2,ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\BloodCloudTarget.mdx",caster,"overhead")
call SaveEffectHandle(udg_hash,h,3,ef)set ef=nullcall SaveBoolean(udg_hash,GetHandleId(caster),99,true)call TimerStart(t,30.,false,function Trig_Devil_Axe_Remove_Stregnth_Actions)
set caster=nullset t=nullset dammi=nullendfunctionfunction Trig_Devil_Axe_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0LS'endfunctionfunction InitTrig_Devil_Axe takes nothing returns nothinglocal integer index=0set gg_trg_Devil_Axe=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Devil_Axe,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Devil_Axe,Condition(function Trig_Devil_Axe_Conditions))
call TriggerAddAction(gg_trg_Devil_Axe,function Trig_Devil_Axe_Actions)endfunctionfunction Trig_Devil_Axe_Kill_Unit_Actions takes nothing returns nothingcall SetHeroStr(GetKillingUnit(),GetHeroStr(GetKillingUnit(),false)+3,true)call SetUnitState(GetKillingUnit(),UNIT_STATE_LIFE,GetUnitState(GetKillingUnit(),UNIT_STATE_LIFE)+(GetUnitState(GetDyingUnit(),UNIT_STATE_MAX_LIFE)*.15))call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",GetUnitX(GetDyingUnit()),GetUnitY(GetDyingUnit())))
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodSorceress.mdl",GetUnitX(GetDyingUnit()),GetUnitY(GetDyingUnit())))call DestroyEffectWithWait(AddSpecialEffectTarget("Effects\\BloodBreathDamage.mdx",GetKillingUnit(),"origin"),2.)call SaveInteger(udg_hash,GetHandleId(GetKillingUnit()),'d',LoadInteger(udg_hash,GetHandleId(GetKillingUnit()),'d')+3)endfunctionfunction Trig_Devil_Axe_Kill_Unit_Conditions takes nothing returns booleanreturn LoadBoolean(udg_hash,GetHandleId(GetKillingUnit()),99)endfunctionfunction InitTrig_Devil_Axe_Kill_Unit takes nothing returns nothinglocal integer index=0set gg_trg_Devil_Axe_Kill_Unit=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Devil_Axe_Kill_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Devil_Axe_Kill_Unit,Condition(function Trig_Devil_Axe_Kill_Unit_Conditions))
call TriggerAddAction(gg_trg_Devil_Axe_Kill_Unit,function Trig_Devil_Axe_Kill_Unit_Actions)endfunctionfunction Trig_Tokugawas_Katan_Kill_Unit_Actions takes nothing returns nothingcall SetHeroAgi(GetKillingUnit(),GetHeroAgi(GetKillingUnit(),false)+1,true)endfunctionfunction Trig_Tokugawas_Katan_Kill_Unit_Conditions takes nothing returns boolean
return LoadBoolean(udg_hash,GetHandleId(GetKillingUnit()),98) and GetRandomInt(1,'d')<=20endfunctionfunction InitTrig_Tokugawas_Katan_Kill_Unit takes nothing returns nothinglocal integer index=0set gg_trg_Tokugawas_Katan_Kill_Unit=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Tokugawas_Katan_Kill_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Tokugawas_Katan_Kill_Unit,Condition(function Trig_Tokugawas_Katan_Kill_Unit_Conditions))
call TriggerAddAction(gg_trg_Tokugawas_Katan_Kill_Unit,function Trig_Tokugawas_Katan_Kill_Unit_Actions)endfunctionfunction Trig_Tokugawas_Katan_Remove_Agi_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer bonus=LoadInteger(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)local effect ef2=LoadEffectHandle(udg_hash,h,4)local integer clearagi=GetHeroAgi(caster,false)call SetHeroAgi(caster,clearagi-bonus,true)call SaveBoolean(udg_hash,GetHandleId(caster),98,false)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call DestroyEffect(ef)call DestroyEffect(ef2)set caster=nullset ef=nullset ef2=null
set t=nullendfunctionfunction Trig_Tokugawas_Katan_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer agi=GetHeroAgi(caster,true)local integer clearagi=GetHeroAgi(caster,false)local integer bonus=R2I(agi*.7)local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\AcidBomb\\BottleImpact.mdl",caster,"weapon")local effect ef2=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Drain\\DrainCaster.mdl",caster,"head")local timer t=CreateTimer()local integer h=GetHandleId(t)call SetHeroAgi(caster,clearagi+bonus,true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,bonus)
call SaveEffectHandle(udg_hash,h,3,ef)call SaveEffectHandle(udg_hash,h,4,ef2)call SaveBoolean(udg_hash,GetHandleId(caster),98,true)call TimerStart(t,8.,false,function Trig_Tokugawas_Katan_Remove_Agi_Actions)
set caster=nullset ef=nullset ef2=null
set t=nullendfunctionfunction Trig_Tokugawas_Katan_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0LO'endfunctionfunction InitTrig_Tokugawas_Katan takes nothing returns nothinglocal integer index=0set gg_trg_Tokugawas_Katan=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Tokugawas_Katan,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Tokugawas_Katan,Condition(function Trig_Tokugawas_Katan_Conditions))
call TriggerAddAction(gg_trg_Tokugawas_Katan,function Trig_Tokugawas_Katan_Actions)endfunctionfunction Trig_Kings_Armor_Remove_Buffs_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group g=LoadGroupHandle(udg_hash,h,2)local integer count=LoadInteger(udg_hash,h,3)local effect eflocal unit Pickedloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullcall SetArmorAbilityLevel(Picked,-$F)call SetAttackSpeedAbilityLevel(Picked,-(20+LoadInteger(udg_hash,GetHandleId(Picked),97)))call SetUnitLifeAndManaRegeneration(Picked,"life",-25)set ef=LoadEffectHandle(udg_hash,h,count)call DestroyEffect(ef)set ef=nullset count=count-1call GroupRemoveUnit(g,Picked)endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset t=nullset caster=nullendfunctionfunction Trig_Kings_Armor_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local integer armor=$Flocal integer hpregen=25
local integer as=20local integer asbonuslocal group g=CreateGroup()local group g2=CreateGroup()
local unit Pickedlocal effect eflocal unit dammi
local timer t=CreateTimer()local integer h=GetHandleId(t)local integer count=$Acall DestroyEffect(AddSpecialEffectTarget("Effects\\BattleCryCaster.mdl",caster,"origin"))call GroupEnumUnitsInRange(g,x,y,750.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0LD')call IssueTargetOrderById(dammi,$D0062,Picked)set dammi=nullcall SetArmorAbilityLevel(Picked,armor)set asbonus=R2I((R2I((1.-GetUnitState(Picked,UNIT_STATE_LIFE)/ GetUnitState(Picked,UNIT_STATE_MAX_LIFE))/ .1)*8))call SetAttackSpeedAbilityLevel(Picked,as+asbonus)call SetUnitLifeAndManaRegeneration(Picked,"life",hpregen)set count=count+1set ef=AddSpecialEffectTarget("Abilities\\Spells\\Human\\InnerFire\\InnerFireTarget.mdl",Picked,"overhead")call SaveEffectHandle(udg_hash,h,count,ef)set ef=nullcall SaveInteger(udg_hash,GetHandleId(Picked),97,asbonus)call GroupAddUnit(g2,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,g2)call SaveInteger(udg_hash,h,3,count)
call TimerStart(t,10.,false,function Trig_Kings_Armor_Remove_Buffs_Actions)set caster=nullset p=nullset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g2=nullset t=nullendfunctionfunction Trig_Kings_Armor_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0LC'endfunctionfunction InitTrig_Kings_Armor takes nothing returns nothinglocal integer index=0set gg_trg_Kings_Armor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Kings_Armor,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Kings_Armor,Condition(function Trig_Kings_Armor_Conditions))
call TriggerAddAction(gg_trg_Kings_Armor,function Trig_Kings_Armor_Actions)endfunctionfunction Trig_Steel_Bib_Remove_Buffs_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl",caster,"origin"))
call SetArmorAbilityLevel(caster,-20)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullendfunctionfunction Trig_Steel_Bib_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)local timer t=CreateTimer()local integer h=GetHandleId(t)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0L5')call IssueTargetOrderById(dammi,$D006B,caster)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl",caster,"origin"))
call SetArmorAbilityLevel(caster,20)
call SaveUnitHandle(udg_hash,h,1,caster)
call TimerStart(t,7.,false,function Trig_Steel_Bib_Remove_Buffs_Actions)
set caster=nullset dammi=nullset t=nullendfunctionfunction Trig_Steel_Bib_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0L4'endfunctionfunction InitTrig_Steel_Bib takes nothing returns nothinglocal integer index=0set gg_trg_Steel_Bib=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Steel_Bib,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Steel_Bib,Condition(function Trig_Steel_Bib_Conditions))
call TriggerAddAction(gg_trg_Steel_Bib,function Trig_Steel_Bib_Actions)endfunctionfunction Trig_Archimagus_Staff_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,20)local real damage=LoadReal(udg_hash,h,21)local integer wait=LoadInteger(udg_hash,h,22)local real angle=LoadReal(udg_hash,h,23)
local group gdamage=LoadGroupHandle(udg_hash,h,24)local real dammiangle=LoadReal(udg_hash,h,25)local real dist=LoadReal(udg_hash,h,27)local real xt=LoadReal(udg_hash,h,28)local real yt=LoadReal(udg_hash,h,29)local player p=GetOwningPlayer(caster)local group gdammi=CreateGroup()
local group g=CreateGroup()local real xdammilocal real ydammilocal unit Pickedlocal unit dammi
local integer lopa=1
local effect efif wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,22,wait)
set dammiangle=dammiangle+7.2set dist=dist-5.5call SaveReal(udg_hash,h,25,dammiangle)call SaveReal(udg_hash,h,27,dist)loop
exitwhen lopa>5set dammi=LoadUnitHandle(udg_hash,h,lopa)set xdammi=xt+dist*Cos((dammiangle+(72.*(lopa-1)))*bj_DEGTORAD)set ydammi=yt+dist*Sin((dammiangle+(72.*(lopa-1)))*bj_DEGTORAD)call SetUnitPosition(dammi,xdammi,ydammi)call SetUnitFacing(dammi,dammiangle+(72.*(lopa-1)))call GroupEnumUnitsInRange(gdammi,xdammi,ydammi,100.,null)call GroupAddGroup(gdammi,g)
set lopa=lopa+1set dammi=nullset ef=nullendlooploop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitInGroup(Picked,gdamage)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call SetUnitState(Picked,UNIT_STATE_MANA,GetUnitState(Picked,UNIT_STATE_MANA)+125.)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishMana\\ReplenishManaCaster.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",Picked,"origin"))
call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall SaveGroupHandle(udg_hash,h,24,gdamage)else
loop
exitwhen lopa>5set dammi=LoadUnitHandle(udg_hash,h,lopa)set ef=LoadEffectHandle(udg_hash,h,lopa+5)call KillUnit(dammi)
call DestroyEffect(ef)set lopa=lopa+1set dammi=nullset ef=nullendloopcall GroupEnumUnitsInRange(g,xt,yt,275.,null)set dammi=CreateUnit(p,'h00U',xt,yt,.0)call SetUnitScale(dammi,4.,4.,1.)call DestroyEffect(AddSpecialEffectTarget("Effects\\Fireworksblue.mdl",dammi,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\Fireworksblue.mdl",dammi,"chest"))set dammi=nullcall DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NEDeathMedium\\NEDeath.mdl",xt,yt))
call DestroyEffect(AddSpecialEffect("Effects\\MagicStomp.mdl",xt,yt))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Effects\\Fireworksblue.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call GroupClear(gdamage)
call DestroyGroup(gdamage)endifset t=nullset caster=nullset gdamage=null
set p=nullcall GroupClear(gdammi)call DestroyGroup(gdammi)set gdammi=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Archimagus_Staff_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi
local effect eflocal real xdammilocal real ydammilocal integer lopa=1
local group gdamage=CreateGroup()local real angle
local real dammiangle=-72.local real damage=100.+GetHeroInt(caster,true)*1.75local integer wait=50set angle=bj_RADTODEG*Atan2(yt-y,xt-x)loop
exitwhen lopa>5set xdammi=xt+275.*Cos((angle+dammiangle)*bj_DEGTORAD)set ydammi=yt+275.*Sin((angle+dammiangle)*bj_DEGTORAD)set dammiangle=dammiangle+72.set dammi=CreateUnit(p,'h00U',xdammi,ydammi,dammiangle)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,50.,.0)set ef=AddSpecialEffectTarget("Effects\\Magic Missile.mdl",dammi,"chest")call SaveUnitHandle(udg_hash,h,lopa,dammi)call SaveEffectHandle(udg_hash,h,lopa+5,ef)set lopa=lopa+1set dammi=nullset ef=nullendloopcall SaveUnitHandle(udg_hash,h,20,caster)call SaveReal(udg_hash,h,21,damage)call SaveInteger(udg_hash,h,22,wait)
call SaveReal(udg_hash,h,23,angle)call SaveGroupHandle(udg_hash,h,24,gdamage)call SaveReal(udg_hash,h,25,.0)call SaveReal(udg_hash,h,27,275.)call SaveReal(udg_hash,h,28,xt)call SaveReal(udg_hash,h,29,yt)call TimerStart(t,.03,true,function Trig_Archimagus_Staff_Periodic_Actions)set caster=nullset p=nullset t=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Archimagus_Staff_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0L1'endfunctionfunction InitTrig_Archimagus_Staff takes nothing returns nothing
local integer index=0set gg_trg_Archimagus_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Archimagus_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Archimagus_Staff,Condition(function Trig_Archimagus_Staff_Conditions))call TriggerAddAction(gg_trg_Archimagus_Staff,function Trig_Archimagus_Staff_Actions)endfunctionfunction Trig_Isidors_Scepter_Add_Mana_Caster_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)+175.)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullendfunctionfunction Trig_Isidors_Scepter_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local real heal=200.+(GetHeroInt(caster,true)*3.)local real mana=175.
local group g=CreateGroup()local unit Pickedlocal timer t=CreateTimer()local integer h=GetHandleId(t)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",x,y))call GroupEnumUnitsInRange(g,x,y,350.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+heal)if Picked!=caster thencall SetUnitState(Picked,UNIT_STATE_MANA,GetUnitState(Picked,UNIT_STATE_MANA)+mana)endifcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",Picked,"origin"))
call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",Picked,"origin"),2.)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call TimerStart(t,.0,false,function Trig_Isidors_Scepter_Add_Mana_Caster_Actions)set caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
set Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset t=nullendfunctionfunction Trig_Isidors_Scepter_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0L0'endfunctionfunction InitTrig_Isidors_Scepter takes nothing returns nothinglocal integer index=0set gg_trg_Isidors_Scepter=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Isidors_Scepter,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Isidors_Scepter,Condition(function Trig_Isidors_Scepter_Conditions))
call TriggerAddAction(gg_trg_Isidors_Scepter,function Trig_Isidors_Scepter_Actions)endfunctionfunction Trig_Detached_Shield_Use_Remove_Agr_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group g=LoadGroupHandle(udg_hash,h,2)local integer damage=LoadInteger(udg_hash,h,4)local integer armor=LoadInteger(udg_hash,h,5)local effect eflocal unit Pickedcall SetUnitLifeAndManaRegeneration(caster,"life",-35)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullcall SetAttackAbilityLevel(Picked,damage)call SetArmorAbilityLevel(Picked,armor)set ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),89)
call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(Picked),89,null)call GroupRemoveUnit(g,Picked)endloopset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullcall DestroyGroup(g)
call GroupClear(g)set g=nullset ef=nullset Picked=nullendfunctionfunction Trig_Detached_Shield_Use_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local group g=CreateGroup()local group g2=CreateGroup()
local unit Pickedlocal timer t=CreateTimer()local integer h=GetHandleId(t)local effect eflocal integer damage=20local integer armor=8call SetUnitLifeAndManaRegeneration(caster,"life",35)call GroupEnumUnitsInRange(g,x,y,450.,null)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl",x,y))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),89)
if ef==null and GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and IsUnitEnemy(Picked,p) and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(g2,Picked)
call IssueTargetOrderById(Picked,$D000F,caster)call SetAttackAbilityLevel(Picked,-damage)call SetArmorAbilityLevel(Picked,-armor)
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\TrollBerserk\\HeadhunterWEAPONSLeft.mdl",Picked,"overhead")call SaveEffectHandle(udg_hash,GetHandleId(Picked),89,ef)set ef=nullendifcall GroupRemoveUnit(g,Picked)endloopset ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\HowlOfTerror\\HowlTarget.mdl",caster,"chest")call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,g2)call SaveEffectHandle(udg_hash,h,3,ef)call SaveInteger(udg_hash,h,4,damage)call SaveInteger(udg_hash,h,5,armor)
call TimerStart(t,7.,false,function Trig_Detached_Shield_Use_Remove_Agr_Actions)
set caster=nullset p=nullcall DestroyGroup(g)
call GroupClear(g)set g=nullset g2=nullset Picked=nullset t=nullset ef=nullendfunctionfunction Trig_Detached_Shield_Use_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0IV'endfunctionfunction InitTrig_Detached_Shield_Use takes nothing returns nothinglocal integer index=0set gg_trg_Detached_Shield_Use=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Detached_Shield_Use,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Detached_Shield_Use,Condition(function Trig_Detached_Shield_Use_Conditions))
call TriggerAddAction(gg_trg_Detached_Shield_Use,function Trig_Detached_Shield_Use_Actions)endfunctionfunction Trig_Cuirass_of_Invulnerable_Use2_Remove_Agr_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group g=LoadGroupHandle(udg_hash,h,2)local integer damage=LoadInteger(udg_hash,h,4)local integer armor=LoadInteger(udg_hash,h,5)local effect eflocal unit Pickedcall SetUnitLifeAndManaRegeneration(caster,"life",-75)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullcall SetAttackAbilityLevel(Picked,damage)call SetArmorAbilityLevel(Picked,armor)set ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),89)
call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(Picked),89,null)call GroupRemoveUnit(g,Picked)endloopset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullcall DestroyGroup(g)
call GroupClear(g)set g=nullset ef=nullset Picked=nullendfunctionfunction Trig_Cuirass_of_Invulnerable_Use2_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local group g=CreateGroup()local group g2=CreateGroup()
local unit Pickedlocal timer t=CreateTimer()local integer h=GetHandleId(t)local effect eflocal integer damage=30local integer armor=$Dcall SetUnitLifeAndManaRegeneration(caster,"life",75)call GroupEnumUnitsInRange(g,x,y,500.,null)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl",x,y))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),89)
if ef==null and GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and IsUnitEnemy(Picked,p) and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(g2,Picked)
call IssueTargetOrderById(Picked,$D000F,caster)call SetAttackAbilityLevel(Picked,-damage)call SetArmorAbilityLevel(Picked,-armor)
set ef=AddSpecialEffectTarget("Effects\\RedZapMissle.mdl",Picked,"overhead")
call SaveEffectHandle(udg_hash,GetHandleId(Picked),89,ef)set ef=nullendifcall GroupRemoveUnit(g,Picked)endloopset ef=AddSpecialEffectTarget("Effects\\Duel.mdx",caster,"overhead")
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,g2)call SaveEffectHandle(udg_hash,h,3,ef)call SaveInteger(udg_hash,h,4,damage)call SaveInteger(udg_hash,h,5,armor)
call TimerStart(t,8.,false,function Trig_Cuirass_of_Invulnerable_Use2_Remove_Agr_Actions)set caster=nullset p=nullcall DestroyGroup(g)
call GroupClear(g)set g=nullset g2=nullset Picked=nullset t=nullset ef=nullendfunctionfunction Trig_Cuirass_of_Invulnerable_Use2_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0JT'endfunctionfunction InitTrig_Cuirass_of_Invulnerable_Use2 takes nothing returns nothing
local integer index=0set gg_trg_Cuirass_of_Invulnerable_Use2=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Cuirass_of_Invulnerable_Use2,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Cuirass_of_Invulnerable_Use2,Condition(function Trig_Cuirass_of_Invulnerable_Use2_Conditions))call TriggerAddAction(gg_trg_Cuirass_of_Invulnerable_Use2,function Trig_Cuirass_of_Invulnerable_Use2_Actions)endfunctionfunction Trig_Lost_Cuirass_of_Invulnerable_Actions takes nothing returns nothing
local unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local effect ef=LoadEffectHandle(udg_hash,h,95)call DestroyEffect(ef)call SaveBoolean(udg_hash,h,94,true)
call SaveEffectHandle(udg_hash,h,95,null)set hero=nullset ef=nullendfunctionfunction Trig_Lost_Cuirass_of_Invulnerable_Conditions takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I048' and CountItemOfTypeOnUnit(GetTriggerUnit(),'I048')==1
endfunctionfunction InitTrig_Lost_Cuirass_of_Invulnerable takes nothing returns nothing
local integer index=0set gg_trg_Lost_Cuirass_of_Invulnerable=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Cuirass_of_Invulnerable,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Cuirass_of_Invulnerable,Condition(function Trig_Lost_Cuirass_of_Invulnerable_Conditions))call TriggerAddAction(gg_trg_Lost_Cuirass_of_Invulnerable,function Trig_Lost_Cuirass_of_Invulnerable_Actions)endfunctionfunction Trig_Take_Cuirass_of_Invulnerable_Actions takes nothing returns nothing
local unit hero=GetTriggerUnit()
local integer h=GetHandleId(hero)local effect efif LoadReal(udg_hash,h,96)<1. thenset ef=AddSpecialEffectTarget("Effects\\PurpleSphere.mdx",hero,"chest")call SaveBoolean(udg_hash,h,94,true)
call SaveEffectHandle(udg_hash,h,95,ef)endifset hero=nullset ef=nullendfunctionfunction Trig_Take_Cuirass_of_Invulnerable_Conditions takes nothing returns booleanreturn GetItemTypeId(GetManipulatedItem())=='I048' and CountItemOfTypeOnUnit(GetTriggerUnit(),'I048')==1
endfunctionfunction InitTrig_Take_Cuirass_of_Invulnerable takes nothing returns nothing
local integer index=0set gg_trg_Take_Cuirass_of_Invulnerable=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Cuirass_of_Invulnerable,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Cuirass_of_Invulnerable,Condition(function Trig_Take_Cuirass_of_Invulnerable_Conditions))call TriggerAddAction(gg_trg_Take_Cuirass_of_Invulnerable,function Trig_Take_Cuirass_of_Invulnerable_Actions)endfunctionfunction Trig_Fire_Staff_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,7)local real damage=LoadReal(udg_hash,h,8)
local integer wait=LoadInteger(udg_hash,h,9)
local real angle=LoadReal(udg_hash,h,$A)
local group gdamage=LoadGroupHandle(udg_hash,h,$B)local real dammiangle=LoadReal(udg_hash,h,$C)local real anglestep=LoadReal(udg_hash,h,$D)
local player p=GetOwningPlayer(caster)local group gdammi=CreateGroup()
local group g=CreateGroup()local real xdammilocal real ydammilocal unit Pickedlocal unit dammi
local integer lopa=1
local effect efif wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,9,wait)set dammiangle=dammiangle-anglestepif dammiangle<-45. thenset anglestep=-anglestep
call SaveReal(udg_hash,h,$D,anglestep)endifif dammiangle>45. thenset anglestep=-anglestep
call SaveReal(udg_hash,h,$D,anglestep)endifcall SaveReal(udg_hash,h,$C,dammiangle)set dammi=LoadUnitHandle(udg_hash,h,1)set xdammi=GetUnitX(dammi)+15.*Cos((angle+dammiangle)*bj_DEGTORAD)set ydammi=GetUnitY(dammi)+15.*Sin((angle+dammiangle)*bj_DEGTORAD)call SetUnitPosition(dammi,xdammi,ydammi)call GroupEnumUnitsInRange(gdammi,xdammi,ydammi,125.,null)call GroupAddGroup(gdammi,g)
set dammi=nullset dammiangle=-dammiangleset dammi=LoadUnitHandle(udg_hash,h,3)set xdammi=GetUnitX(dammi)+15.*Cos((angle+dammiangle)*bj_DEGTORAD)set ydammi=GetUnitY(dammi)+15.*Sin((angle+dammiangle)*bj_DEGTORAD)call SetUnitPosition(dammi,xdammi,ydammi)call GroupEnumUnitsInRange(gdammi,xdammi,ydammi,125.,null)call GroupAddGroup(gdammi,g)
set dammi=nullset dammi=LoadUnitHandle(udg_hash,h,2)set xdammi=GetUnitX(dammi)+13.2*Cos(angle*bj_DEGTORAD)set ydammi=GetUnitY(dammi)+13.2*Sin(angle*bj_DEGTORAD)call SetUnitPosition(dammi,xdammi,ydammi)call GroupEnumUnitsInRange(gdammi,xdammi,ydammi,125.,null)call GroupAddGroup(gdammi,g)
set dammi=nullloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitInGroup(Picked,gdamage)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0JK')call IssueTargetOrderById(dammi,$D02B6,Picked)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",Picked,"chest"))call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,$B,gdamage)else
loop
exitwhen lopa>3set dammi=LoadUnitHandle(udg_hash,h,lopa)set ef=LoadEffectHandle(udg_hash,h,lopa+3)call KillUnit(dammi)
call DestroyEffect(ef)set lopa=lopa+1set dammi=nullset ef=nullendloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call GroupClear(gdamage)
call DestroyGroup(gdamage)endifset t=nullset caster=nullset gdamage=null
set p=nullcall GroupClear(gdammi)call DestroyGroup(gdammi)set gdammi=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Fire_Staff_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local location loclocal real xtlocal real ytlocal unit dammi
local effect eflocal real xdammilocal real ydammilocal integer lopa=1
local group gdamage=CreateGroup()local real angle
local real dammiangle=-90.local real damage=170.local integer wait=50if GetSpellTargetUnit()==null thenset loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
call RemoveLocation(loc)
set loc=null
else
set xt=GetUnitX(GetSpellTargetUnit())set yt=GetUnitY(GetSpellTargetUnit())endifset angle=bj_RADTODEG*Atan2(yt-y,xt-x)loop
exitwhen lopa>3set xdammi=x+100.*Cos((angle+dammiangle)*bj_DEGTORAD)set ydammi=y+100.*Sin((angle+dammiangle)*bj_DEGTORAD)set dammiangle=dammiangle+90.set dammi=CreateUnit(p,'h00U',xdammi,ydammi,angle)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,50.,.0)set ef=AddSpecialEffectTarget("Effects\\SunfireMissile.mdl",dammi,"chest")call SaveUnitHandle(udg_hash,h,lopa,dammi)call SaveEffectHandle(udg_hash,h,lopa+3,ef)set lopa=lopa+1set dammi=nullset ef=nullendloopcall SaveUnitHandle(udg_hash,h,7,caster)
call SaveReal(udg_hash,h,8,damage)call SaveInteger(udg_hash,h,9,wait)call SaveReal(udg_hash,h,$A,angle)call SaveGroupHandle(udg_hash,h,$B,gdamage)call SaveReal(udg_hash,h,$C,45.)
call SaveReal(udg_hash,h,$D,3.6)
call TimerStart(t,.03,true,function Trig_Fire_Staff_Periodic_Actions)set caster=nullset p=nullset t=nullset gdamage=null
endfunctionfunction Trig_Fire_Staff_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0JJ'endfunctionfunction InitTrig_Fire_Staff takes nothing returns nothinglocal integer index=0set gg_trg_Fire_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Staff,Condition(function Trig_Fire_Staff_Conditions))call TriggerAddAction(gg_trg_Fire_Staff,function Trig_Fire_Staff_Actions)endfunctionfunction Trig_Demon_Axe_Remove_Stregnth_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)call UnitRemoveAbility(caster,'A0J2')call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset caster=nullendfunctionfunction Trig_Demon_Axe_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',GetUnitX(caster),GetUnitY(caster),.0)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0IW')call IssueTargetOrderById(dammi,$D00F1,caster)call UnitAddAbility(caster,'A0J2')call SaveUnitHandle(udg_hash,h,1,caster)
call TimerStart(t,35.,false,function Trig_Demon_Axe_Remove_Stregnth_Actions)
set caster=nullset t=nullset dammi=nullendfunctionfunction Trig_Demon_Axe_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0J1'endfunctionfunction InitTrig_Demon_Axe takes nothing returns nothinglocal integer index=0set gg_trg_Demon_Axe=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Demon_Axe,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Demon_Axe,Condition(function Trig_Demon_Axe_Conditions))
call TriggerAddAction(gg_trg_Demon_Axe,function Trig_Demon_Axe_Actions)endfunctionfunction Trig_Demon_Axe_Kill_Unit_Actions takes nothing returns nothinglocal unit killer=GetKillingUnit()call SetUnitAbilityLevel(killer,'A0J2',(GetUnitAbilityLevel(killer,'A0J2')+1))set killer=nullendfunctionfunction Trig_Demon_Axe_Kill_Unit_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetKillingUnit(),'A0J2')>0endfunctionfunction InitTrig_Demon_Axe_Kill_Unit takes nothing returns nothinglocal integer index=0set gg_trg_Demon_Axe_Kill_Unit=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Demon_Axe_Kill_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Demon_Axe_Kill_Unit,Condition(function Trig_Demon_Axe_Kill_Unit_Conditions))
call TriggerAddAction(gg_trg_Demon_Axe_Kill_Unit,function Trig_Demon_Axe_Kill_Unit_Actions)endfunctionfunction Trig_Boots_Rescue_Remove_Effects_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)call SetUnitLifeAndManaRegeneration(caster,"life",-25)call SetUnitLifeAndManaRegeneration(target,"life",-25)call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset caster=nullset target=nullendfunctionfunction Trig_Boots_Rescue_Destroy_Lightning_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local lightning l=LoadLightningHandle(udg_hash,h,1)call DestroyLightning(l)
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset l=nullendfunctionfunction Trig_Boots_Rescue_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local player p=GetOwningPlayer(caster)local unit dammi=CreateUnit(p,'h00U',xc,yc,.0)local unit dammi2=CreateUnit(p,'h00U',xc,yc,.0)local timer t=CreateTimer()local integer h=GetHandleId(t)local lightning l=AddLightningEx("MBUR",true,xc,yc,50.,xt,yt,50.)local timer t2=CreateTimer()
local integer h2=GetHandleId(t2)
call SetUnitX(caster,xt)
call SetUnitY(caster,yt)
call SetUnitX(target,xc)
call SetUnitY(target,yc)
call SetUnitLifeAndManaRegeneration(caster,"life",25)call SetUnitLifeAndManaRegeneration(target,"life",25)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitApplyTimedLife(dammi2,'BTLF',1.)call UnitAddAbility(dammi,'A0IY')call UnitAddAbility(dammi2,'A0IY')call IssueTargetOrderById(dammi,$D008E,caster)call IssueTargetOrderById(dammi2,$D008E,target)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveLightningHandle(udg_hash,h2,1,l)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl",caster,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl",target,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl",caster,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl",target,"origin"))
call TimerStart(t,6.,false,function Trig_Boots_Rescue_Remove_Effects_Actions)call TimerStart(t2,.5,false,function Trig_Boots_Rescue_Destroy_Lightning_Actions)set caster=nullset target=nullset dammi=nullset dammi2=nullset p=nullset t=nullset l=nullset t2=nullendfunctionfunction Trig_Boots_Rescue_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0JE'endfunctionfunction InitTrig_Boots_Rescue takes nothing returns nothing
local integer index=0set gg_trg_Boots_Rescue=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Boots_Rescue,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Boots_Rescue,Condition(function Trig_Boots_Rescue_Conditions))call TriggerAddAction(gg_trg_Boots_Rescue,function Trig_Boots_Rescue_Actions)endfunctionfunction Trig_Astral_Staff_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local real radius=300.local group g=CreateGroup()local unit Pickedlocal unit dammi
call GroupEnumUnitsInRange(g,x,y,radius,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0IQ')call IssueTargetOrderById(dammi,$D0206,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopset caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
call DestroyGroup(g)
call GroupClear(g)set g=nullset Picked=nullendfunctionfunction Trig_Astral_Staff_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0IP'endfunctionfunction InitTrig_Astral_Staff takes nothing returns nothing
local integer index=0set gg_trg_Astral_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Astral_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Astral_Staff,Condition(function Trig_Astral_Staff_Conditions))call TriggerAddAction(gg_trg_Astral_Staff,function Trig_Astral_Staff_Actions)endfunctionfunction Trig_Healer_Staff_Actions takes nothing returns nothing
local unit target=GetSpellTargetUnit()call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+150.+(2.*GetHeroInt(GetSpellAbilityUnit(),true)))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",target,"origin"))
call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",target,"origin"),2.)set target=nullendfunctionfunction Trig_Healer_Staff_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0IM'endfunctionfunction InitTrig_Healer_Staff takes nothing returns nothing
local integer index=0set gg_trg_Healer_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Healer_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Healer_Staff,Condition(function Trig_Healer_Staff_Conditions))call TriggerAddAction(gg_trg_Healer_Staff,function Trig_Healer_Staff_Actions)endfunctionfunction Trig_Magic_Amulet_Remove_Shield_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local effect ef=LoadEffectHandle(udg_hash,h,2)call SaveReal(udg_hash,GetHandleId(caster),86,.0)call SaveEffectHandle(udg_hash,GetHandleId(caster),87,null)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call DestroyEffect(ef)set t=nullset caster=nullset ef=nullendfunctionfunction Trig_Magic_Amulet_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real shield=200.local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaShield\\ManaShieldCaster.mdl",caster,"origin")
local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveReal(udg_hash,GetHandleId(caster),86,shield)call SaveEffectHandle(udg_hash,GetHandleId(caster),87,ef)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveEffectHandle(udg_hash,h,2,ef)call TimerStart(t,20.,false,function Trig_Magic_Amulet_Remove_Shield_Actions)set caster=nullset ef=nullset t=nullendfunctionfunction Trig_Magic_Amulet_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0IH'endfunctionfunction InitTrig_Magic_Amulet takes nothing returns nothing
local integer index=0set gg_trg_Magic_Amulet=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Magic_Amulet,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Magic_Amulet,Condition(function Trig_Magic_Amulet_Conditions))call TriggerAddAction(gg_trg_Magic_Amulet,function Trig_Magic_Amulet_Actions)endfunctionfunction Trig_Blood_Dagger_Actions takes nothing returns nothing
local unit killer=GetKillingUnit()call SetUnitState(killer,UNIT_STATE_LIFE,GetUnitState(killer,UNIT_STATE_LIFE)+(GetUnitState(GetDyingUnit(),UNIT_STATE_MAX_LIFE)*.1))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPriest.mdl",killer,"chest"))set killer=nullendfunctionfunction Trig_Blood_Dagger_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetKillingUnit(),'A0IG')>=1endfunctionfunction InitTrig_Blood_Dagger takes nothing returns nothing
local integer index=0set gg_trg_Blood_Dagger=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blood_Dagger,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blood_Dagger,Condition(function Trig_Blood_Dagger_Conditions))call TriggerAddAction(gg_trg_Blood_Dagger,function Trig_Blood_Dagger_Actions)endfunctionfunction Trig_Agility_Blade_Remove_Agi_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer bonus=LoadInteger(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)local effect ef2=LoadEffectHandle(udg_hash,h,4)local integer clearagi=GetHeroAgi(caster,false)call SetHeroAgi(caster,clearagi-bonus,true)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call DestroyEffect(ef)call DestroyEffect(ef2)set caster=nullset ef=nullset ef2=null
set t=nullendfunctionfunction Trig_Agility_Blade_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer agi=GetHeroAgi(caster,true)local integer clearagi=GetHeroAgi(caster,false)local integer bonus=R2I(agi/ 2)local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\AcidBomb\\BottleImpact.mdl",caster,"weapon")local effect ef2=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Drain\\DrainCaster.mdl",caster,"head")local timer t=CreateTimer()local integer h=GetHandleId(t)call SetHeroAgi(caster,clearagi+bonus,true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,bonus)
call SaveEffectHandle(udg_hash,h,3,ef)call SaveEffectHandle(udg_hash,h,4,ef2)call TimerStart(t,7.,false,function Trig_Agility_Blade_Remove_Agi_Actions)set caster=nullset ef=nullset ef2=null
set t=nullendfunctionfunction Trig_Agility_Blade_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0IE'endfunctionfunction InitTrig_Agility_Blade takes nothing returns nothinglocal integer index=0set gg_trg_Agility_Blade=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Agility_Blade,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Agility_Blade,Condition(function Trig_Agility_Blade_Conditions))
call TriggerAddAction(gg_trg_Agility_Blade,function Trig_Agility_Blade_Actions)endfunctionfunction Trig_Bone_Staff_Set_Summon_Ability_Level_Func003C takes nothing returns boolean
return(GetUnitTypeId(GetSummonedUnit())=='n01K')or(GetUnitTypeId(GetSummonedUnit())=='n01L')
endfunctionfunction Trig_Bone_Staff_Set_Summon_Ability_Level_Conditions takes nothing returns booleanreturn(Trig_Bone_Staff_Set_Summon_Ability_Level_Func003C())endfunctionfunction Trig_Bone_Staff_Set_Summon_Ability_Level_Func001C takes nothing returns boolean
return(GetUnitTypeId(GetSummonedUnit())=='n01K')
endfunctionfunction Trig_Bone_Staff_Set_Summon_Ability_Level_Func002C takes nothing returns boolean
return(GetUnitTypeId(GetSummonedUnit())=='n01L')
endfunctionfunction Trig_Bone_Staff_Set_Summon_Ability_Level_Actions takes nothing returns nothingif(Trig_Bone_Staff_Set_Summon_Ability_Level_Func001C())thencall SetUnitAbilityLevelSwapped('A0B6',GetSummonedUnit(),2)call SetUnitAbilityLevelSwapped('A0AW',GetSummonedUnit(),2)call SetUnitAbilityLevelSwapped('A0AX',GetSummonedUnit(),2)endifif(Trig_Bone_Staff_Set_Summon_Ability_Level_Func002C())thencall SetUnitAbilityLevelSwapped('A0B6',GetSummonedUnit(),3)call SetUnitAbilityLevelSwapped('A0AW',GetSummonedUnit(),3)call SetUnitAbilityLevelSwapped('A0AX',GetSummonedUnit(),3)endifendfunctionfunction InitTrig_Bone_Staff_Set_Summon_Ability_Level takes nothing returns nothingset gg_trg_Bone_Staff_Set_Summon_Ability_Level=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Bone_Staff_Set_Summon_Ability_Level,EVENT_PLAYER_UNIT_SUMMON)call TriggerAddCondition(gg_trg_Bone_Staff_Set_Summon_Ability_Level,Condition(function Trig_Bone_Staff_Set_Summon_Ability_Level_Conditions))
call TriggerAddAction(gg_trg_Bone_Staff_Set_Summon_Ability_Level,function Trig_Bone_Staff_Set_Summon_Ability_Level_Actions)endfunctionfunction Trig_Novice_Amulet_Conditions takes nothing returns boolean
return(GetSpellAbilityId()=='A0AI')endfunctionfunction Trig_Novice_Amulet_Actions takes nothing returns nothingcall SetUnitManaBJ(GetSpellAbilityUnit(),(GetUnitStateSwap(UNIT_STATE_MANA,GetSpellAbilityUnit())+75.))endfunctionfunction InitTrig_Novice_Amulet takes nothing returns nothingset gg_trg_Novice_Amulet=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Novice_Amulet,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_Novice_Amulet,Condition(function Trig_Novice_Amulet_Conditions))
call TriggerAddAction(gg_trg_Novice_Amulet,function Trig_Novice_Amulet_Actions)endfunctionfunction Trig_Glove_of_Andromat_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real xt=GetUnitX(target)local real yt=GetUnitY(target)local player p=GetOwningPlayer(caster)local integer pnumber=GetPlayerId(p)+1local integer id=GetUnitTypeId(target)local integer gold=R2I(GetRandomInt(LoadInteger(udg_hash,id,70),LoadInteger(udg_hash,id,71))*10.)+60
local integer xp=R2I(LoadInteger(udg_hash,id,82)*7.)
local real mana=75.+(GetUnitState(target,UNIT_STATE_MAX_LIFE)/ 2)call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)+mana)call AddHeroXP(caster,R2I(xp+.5),true)call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+gold)call CreateTexttag(udg_ColorString[23]+"+"+I2S(gold)+"|r",.025,$FF,xt-15.,yt,.0,.0,.035,3.5)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl",xt,yt))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIlm\\AIlmTarget.mdl",xt,yt))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DarkRitual\\DarkRitualTarget.mdl",xt,yt))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",caster,"origin"))
if pnumber<=9 thenset udg_MultiBoard_Player_Kills_Count[pnumber]=udg_MultiBoard_Player_Kills_Count[pnumber]+1call MultiboardSetItemValueBJ(udg_MultiBoard,3,udg_PlayerNumberInMB[pnumber],udg_ColorString[20]+I2S(udg_MultiBoard_Player_Kills_Count[pnumber])+"|r")endifcall SaveBoolean(udg_hash,GetHandleId(target),85,true)call SetUnitExploded(target,true)call KillUnit(target)call SetUnitVertexColor(target,0,0,0,0)call PauseUnit(target,true)set caster=nullset target=nullset p=nullendfunctionfunction Trig_Glove_of_Andromat_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0AN'endfunctionfunction InitTrig_Glove_of_Andromat takes nothing returns nothinglocal integer index=0set gg_trg_Glove_of_Andromat=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Glove_of_Andromat,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Glove_of_Andromat,Condition(function Trig_Glove_of_Andromat_Conditions))
call TriggerAddAction(gg_trg_Glove_of_Andromat,function Trig_Glove_of_Andromat_Actions)endfunctionfunction Trig_Glove_of_Midas_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local unit dammi=LoadUnitHandle(udg_hash,h,3)local integer wait2=LoadInteger(udg_hash,h,5)local real height=LoadReal(udg_hash,h,6)
local effect eflocal integer goldlocal integer xp
local player plocal integer pnumberlocal integer id
local real x=GetUnitX(dammi)
local real y=GetUnitY(dammi)
local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-y,xt-x)local real distlocal boolean destroy=falseif GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset wait2=wait2-1call SaveInteger(udg_hash,h,5,wait2)
if wait2==0 then
call SetUnitFlyHeight(dammi,.0,height*2.25)endifset x=x+20.*Cos(angle*bj_DEGTORAD)set y=y+20.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(dammi,x,y)set dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))
if dist<21. then
set destroy=true
set id=GetUnitTypeId(target)
set p=GetOwningPlayer(caster)set pnumber=GetPlayerId(p)+1
set gold=R2I(GetRandomInt(LoadInteger(udg_hash,id,70),LoadInteger(udg_hash,id,71))*6.)+40set xp=R2I(LoadInteger(udg_hash,id,82)*5.)call SetUnitPosition(dammi,xt,yt)call AddHeroXP(caster,R2I(xp+.5),true)call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+gold)call CreateTexttag(udg_ColorString[23]+"+"+I2S(gold)+"|r",.025,$FF,xt-15.,y,.0,.0,.035,3.5)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl",xt,yt))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIlm\\AIlmTarget.mdl",xt,yt))
if pnumber<=9 thenset udg_MultiBoard_Player_Kills_Count[pnumber]=udg_MultiBoard_Player_Kills_Count[pnumber]+1call MultiboardSetItemValueBJ(udg_MultiBoard,3,udg_PlayerNumberInMB[pnumber],udg_ColorString[20]+I2S(udg_MultiBoard_Player_Kills_Count[pnumber])+"|r")endifcall SaveBoolean(udg_hash,GetHandleId(target),85,true)call SetUnitExploded(target,true)call KillUnit(target)call SetUnitVertexColor(target,0,0,0,0)call PauseUnit(target,true)set p=nullendifelse
set destroy=true
endifif destroy thencall KillUnit(dammi)
set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset target=nullset dammi=nullendfunctionfunction Trig_Glove_of_Midas_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-y,xt-x)local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi
local effect eflocal real dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))local real height=dist/ 3local integer wait2=R2I(dist/ 40)set dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,angle)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,.0,.0)call SetUnitFlyHeight(dammi,height,height*2.25)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\GoldBottleMissile.mdl",dammi,"chest")call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveUnitHandle(udg_hash,h,3,dammi)call SaveEffectHandle(udg_hash,h,4,ef)call SaveInteger(udg_hash,h,5,wait2)
call SaveReal(udg_hash,h,6,height)call TimerStart(t,.03,true,function Trig_Glove_of_Midas_Periodic_Actions)set target=nullset t=nullset dammi=nullset ef=nullendfunctionfunction Trig_Glove_of_Midas_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0A2'endfunctionfunction InitTrig_Glove_of_Midas takes nothing returns nothinglocal integer index=0set gg_trg_Glove_of_Midas=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Glove_of_Midas,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Glove_of_Midas,Condition(function Trig_Glove_of_Midas_Conditions))call TriggerAddAction(gg_trg_Glove_of_Midas,function Trig_Glove_of_Midas_Actions)endfunctionfunction Trig_Heroes_more_attacked_priority_when_guards_Group_Filter takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>=.45)and IsUnitInvulnerable(GetFilterUnit())==false and(GetPlayerId(GetOwningPlayer(GetFilterUnit()))<=8 and(IsPlayerEnemy(GetOwningPlayer(GetAttacker()),GetOwningPlayer(GetFilterUnit())))))
endfunctionfunction Trig_Heroes_more_attacked_priority_when_guards_Actions takes nothing returns nothinglocal group g=CreateGroup()local unit attacked=GetTriggerUnit()
local unit attacker=GetAttacker()local unit allycall GroupEnumUnitsInRange(g,GetUnitX(attacked),GetUnitY(attacked),500.,Filter(function Trig_Heroes_more_attacked_priority_when_guards_Group_Filter))if CountUnitsInGroup(g)>1 thencall FilterMostNearUnit(g,attacked)set ally=udg_Unit_FilterMostNearUnit
endifif ally!=null thencall IssueTargetOrderById(attacker,$D000F,ally)endifset attacked=nullset attacker=nullset ally=nullendfunctionfunction Trig_Heroes_more_attacked_priority_when_guards_Conditions takes nothing returns boolean
return((GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)>=.405)and(IsUnitIllusion(GetTriggerUnit())==false)and(GetPlayerId(GetOwningPlayer(GetAttacker()))>=9))and(GetUnitTypeId(GetTriggerUnit())=='e002' or GetUnitTypeId(GetTriggerUnit())=='h01K' or GetUnitTypeId(GetTriggerUnit())=='n00Y' or GetUnitTypeId(GetTriggerUnit())=='o003')endfunctionfunction InitTrig_Heroes_more_attacked_priority_when_guards takes nothing returns nothinglocal integer index=0set gg_trg_Heroes_more_attacked_priority_when_guards=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Heroes_more_attacked_priority_when_guards,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Heroes_more_attacked_priority_when_guards,Condition(function Trig_Heroes_more_attacked_priority_when_guards_Conditions))
call TriggerAddAction(gg_trg_Heroes_more_attacked_priority_when_guards,function Trig_Heroes_more_attacked_priority_when_guards_Actions)endfunctionfunction Trig_Player_Fast_Purchase_System_Actions takes nothing returns nothinglocal unit caster=GetTriggerUnit()local integer pid=GetPlayerId(GetOwningPlayer(caster))+1
if(GetIssuedOrderId()==$D0057)thenset udg_Boolean_Player_Fast_Purchase[pid]=trueendifif(GetIssuedOrderId()==$D0058)thenset udg_Boolean_Player_Fast_Purchase[pid]=falseendifset caster=nullendfunctionfunction Trig_Player_Fast_Purchase_System_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetTriggerUnit(),'A0MG')>0endfunctionfunction InitTrig_Player_Fast_Purchase_System takes nothing returns nothinglocal integer index=0set gg_trg_Player_Fast_Purchase_System=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Player_Fast_Purchase_System,Player(index),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Player_Fast_Purchase_System,Condition(function Trig_Player_Fast_Purchase_System_Conditions))
call TriggerAddAction(gg_trg_Player_Fast_Purchase_System,function Trig_Player_Fast_Purchase_System_Actions)endfunctionfunction Trig_Show_hint_abount_hints_Actions takes nothing returns nothingcall DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,15.,"Советуем просмотреть все игровые команды в меню Инфо (|Cfffed312F9|r)")endfunctionfunction InitTrig_Show_hint_abount_hints takes nothing returns nothingset gg_trg_Show_hint_abount_hints=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_hints,120.)
call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_hints,600.)
call TriggerAddAction(gg_trg_Show_hint_abount_hints,function Trig_Show_hint_abount_hints_Actions)endfunctionfunction Trig_Show_Hint_Abount_Items_Actions takes nothing returns nothingcall DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,15.,"|cff32cd32Подсказка:|r")call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,15.,"По умолчанию, если вы покупаете рецепт на предмет, то при достаточном количестве золота, вы получите его сразу. В сумму требуемого золота входят ваши предметы, необходимые для сборки!!!")endfunctionfunction InitTrig_Show_Hint_Abount_Items takes nothing returns nothingset gg_trg_Show_Hint_Abount_Items=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Show_Hint_Abount_Items,600.)call TriggerAddAction(gg_trg_Show_Hint_Abount_Items,function Trig_Show_Hint_Abount_Items_Actions)endfunctionfunction Trig_Hint_About_Random_Actions takes nothing returns nothingcall DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"Вы можете выбрать случайного героя, написав в чат |cff99ccff-r/-random/-р/-рандом|r, и получить дополнительно |cFFFFFF00+250|r золота.")
endfunctionfunction InitTrig_Hint_About_Random takes nothing returns nothingset gg_trg_Hint_About_Random=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Hint_About_Random,13.)call TriggerAddAction(gg_trg_Hint_About_Random,function Trig_Hint_About_Random_Actions)endfunctionfunction Trig_Show_hint_abount_reference_panel_Actions takes nothing returns nothing
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,15.,"Вы можете воспользоваться дополнительной информацией в Панели Справки (|Cfffed312F8|r)")endfunctionfunction InitTrig_Show_hint_abount_reference_panel takes nothing returns nothing
set gg_trg_Show_hint_abount_reference_panel=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_reference_panel,200.)call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_reference_panel,1200.)call TriggerAddAction(gg_trg_Show_hint_abount_reference_panel,function Trig_Show_hint_abount_reference_panel_Actions)endfunctionfunction Trig_Show_Ability_Learn_Actions takes nothing returns nothinglocal unit hero=GetLearningUnit()local player p=GetOwningPlayer(hero)
local integer id=GetLearnedSkill()if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)and udg_System_ShowAbil_And_Items_Hint[GetPlayerId(GetLocalPlayer())+1] thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r изучил способность |cff99ccff"+GetObjectName(id)+"|r ( |cFF969696"+I2S(GetUnitAbilityLevel(hero,id)-1)+"|r»»|cff99ccff"+I2S(GetUnitAbilityLevel(hero,id))+"|r )")endifset p=nullset hero=nullendfunctionfunction Trig_Show_Ability_Learn_Conditions takes nothing returns booleanreturn((IsUnitType(GetLearningUnit(),UNIT_TYPE_HERO))and(GetPlayerId(GetOwningPlayer(GetLearningUnit()))<=8))!=nullendfunctionfunction InitTrig_Show_Ability_Learn takes nothing returns nothinglocal integer index=0set gg_trg_Show_Ability_Learn=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Show_Ability_Learn,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Show_Ability_Learn,Condition(function Trig_Show_Ability_Learn_Conditions))call TriggerAddAction(gg_trg_Show_Ability_Learn,function Trig_Show_Ability_Learn_Actions)endfunctionfunction Trig_System_Personal_Items_Buy_Item_Actions takes nothing returns nothinglocal item it=GetSoldItem()local string name=GetItemName(it)local player pif GetItemType(GetSoldItem())==ITEM_TYPE_UNKNOWN thenset p=GetOwningPlayer(GetBuyingUnit())call SetItemUserData(it,GetPlayerId(GetOwningPlayer(GetBuyingUnit()))+1)
if IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)and udg_System_ShowAbil_And_Items_Hint[GetPlayerId(GetLocalPlayer())+1] and GetItemType(GetSoldItem())==ITEM_TYPE_PERMANENT thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,udg_ColorString[GetPlayerId(p)+1]+GetPlayerName(p)+"|r приобрел предмет |cff99ccff"+name+"|r")endifif IsPlayerInForce(GetLocalPlayer(),bj_FORCE_ALL_PLAYERS)and GetLocalPlayer()==p and udg_Count_Item_Tips_Message[GetPlayerId(p)+1]<=2 thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"|cff99ccffВНИМАНИЕ|r: ЛЮБОЙ предмет (даже сборный) вы можете купить |cFFFF0000Одним Нажатием|r (при достаточном количестве золота и места).")
set udg_Count_Item_Tips_Message[GetPlayerId(p)+1]=udg_Count_Item_Tips_Message[GetPlayerId(p)+1]+1endifset it=nullendifset p=nullendfunctionfunction InitTrig_System_Personal_Items_Buy_Item takes nothing returns nothinglocal integer index=0set gg_trg_System_Personal_Items_Buy_Item=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_System_Personal_Items_Buy_Item,Player(index),EVENT_PLAYER_UNIT_SELL_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_System_Personal_Items_Buy_Item,function Trig_System_Personal_Items_Buy_Item_Actions)endfunctionfunction Trig_System_Personal_Items_Pick_Up_Item_Actions takes nothing returns nothinglocal item it=GetManipulatedItem()local integer id=GetItemTypeId(it)local integer cv=GetItemUserData(it)
local real x=GetUnitX(GetManipulatingUnit())
local real y=GetUnitY(GetManipulatingUnit())
if GetItemType(it)!=ITEM_TYPE_CHARGED and GetItemType(it)!=ITEM_TYPE_POWERUP thenif(cv==0)or(cv==(GetPlayerId(GetOwningPlayer(GetManipulatingUnit()))+1))then
else
call SetItemPosition(it,x,y)
call SimError(GetOwningPlayer(GetManipulatingUnit()),"Вы не можете подбирать чужие предметы")endifendifset it=nullendfunctionfunction InitTrig_System_Personal_Items_Pick_Up_Item takes nothing returns nothinglocal integer index=0set gg_trg_System_Personal_Items_Pick_Up_Item=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_System_Personal_Items_Pick_Up_Item,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_System_Personal_Items_Pick_Up_Item,function Trig_System_Personal_Items_Pick_Up_Item_Actions)endfunctionfunction Trig_no_attack_Conditions takes nothing returns boolean
return(IsUnitAlly(GetTriggerUnit(),GetOwningPlayer(GetAttacker())))endfunctionfunction Trig_no_attack_Actions takes nothing returns nothingcall IssueImmediateOrderById(GetAttacker(),$D0004)endfunctionfunction InitTrig_no_attack takes nothing returns nothingset gg_trg_no_attack=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_no_attack,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_no_attack,Condition(function Trig_no_attack_Conditions))
call TriggerAddAction(gg_trg_no_attack,function Trig_no_attack_Actions)endfunctionfunction Trig_Select_Refrence_Panel_Actions takes nothing returns nothingif(GetLocalPlayer()==GetTriggerPlayer())then
call ClearSelection()endifendfunctionfunction Trig_Select_Refrence_Panel_Conditions takes nothing returns boolean
return GetUnitTypeId(GetTriggerUnit())=='h00C' and GetTriggerPlayer()!=GetOwningPlayer(GetTriggerUnit())
endfunctionfunction InitTrig_Select_Refrence_Panel takes nothing returns nothinglocal integer index=0set gg_trg_Select_Refrence_Panel=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Select_Refrence_Panel,Player(index),EVENT_PLAYER_UNIT_SELECTED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Select_Refrence_Panel,Condition(function Trig_Select_Refrence_Panel_Conditions))
call TriggerAddAction(gg_trg_Select_Refrence_Panel,function Trig_Select_Refrence_Panel_Actions)endfunctionfunction Trig_ShopAnimation_Actions takes nothing returns nothinglocal unit shop=GetTriggerUnit()
local integer id=GetUnitTypeId(shop)
local player p=GetTriggerPlayer()local string slocal boolean select=falseif((id=='h00D')or(id=='h000')or(id=='h002'))and GetLocalPlayer()==p then
call SetUnitAnimation(shop,"Stand Work")
set select=trueendifif(id=='h001')and GetLocalPlayer()==p thencall SetUnitAnimation(shop,"Stand Victory")set select=trueendifif(id=='h00S')and GetLocalPlayer()==p thencall SetUnitAnimation(shop,"Stand Work")
set select=trueendifset s=""
if(id=='h003')thenif GetLocalPlayer()==p thenset s="Abilities\\Spells\\Human\\MagicSentry\\MagicSentryCaster.mdl"
endifset udg_ShopEffectSelectedForPlayer[GetPlayerId(p)]=AddSpecialEffectTarget(s,shop,"overhead")set select=trueendifset s=""
if(id=='h00Y')thenif GetLocalPlayer()==p thenset s="Abilities\\Spells\\Orc\\SpiritLink\\SpiritLinkZapTarget.mdl"endifset udg_ShopEffectSelectedForPlayer[GetPlayerId(p)]=AddSpecialEffectTarget(s,shop,"head")set select=trueendifset udg_ShopSelectedForPlayer[GetPlayerId(p)]=shopset shop=nullset p=nullendfunctionfunction Trig_ShopAnimation_Conditions takes nothing returns boolean
return((IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE))and(udg_ShopSelectedForPlayer[GetPlayerId(GetTriggerPlayer())]!=GetTriggerUnit()))!=nullendfunctionfunction InitTrig_ShopAnimation takes nothing returns nothinglocal integer index=0set gg_trg_ShopAnimation=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ShopAnimation,Player(index),EVENT_PLAYER_UNIT_SELECTED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_ShopAnimation,Condition(function Trig_ShopAnimation_Conditions))
call TriggerAddAction(gg_trg_ShopAnimation,function Trig_ShopAnimation_Actions)endfunctionfunction Trig_ShopStopAnimation_Actions takes nothing returns nothinglocal unit shop=GetTriggerUnit()
local integer id=GetUnitTypeId(shop)
local player p=GetTriggerPlayer()if((id=='h00D')or(id=='h000')or(id=='h002')or(id=='h00S')or(id=='h001'))and GetLocalPlayer()==p then
call SetUnitAnimation(shop,"Stand")endifif(id=='h003')or(id=='h00Y')then
call DestroyEffect(udg_ShopEffectSelectedForPlayer[GetPlayerId(p)])endifset shop=nullset p=nullendfunctionfunction Trig_ShopStopAnimation_Conditions takes nothing returns boolean
return(IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE))!=nullendfunctionfunction InitTrig_ShopStopAnimation takes nothing returns nothinglocal integer index=0set gg_trg_ShopStopAnimation=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ShopStopAnimation,Player(index),EVENT_PLAYER_UNIT_DESELECTED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_ShopStopAnimation,Condition(function Trig_ShopStopAnimation_Conditions))
call TriggerAddAction(gg_trg_ShopStopAnimation,function Trig_ShopStopAnimation_Actions)endfunctionfunction Trig_RedMarkToUnit_Periodic_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)local unit mark=LoadUnitHandle(udg_hash,h,2)
if GetUnitState(u,UNIT_STATE_LIFE)>.405 then
call SetUnitX(mark,GetUnitX(u))call SetUnitY(mark,GetUnitY(u))else
call RemoveUnit(mark)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset u=nullset mark=nullendfunctionfunction Trig_RedMarkToUnit_Actions takes nothing returns nothinglocal unit u=GetEnteringUnit()local integer id=GetUnitTypeId(u)local unit marklocal timer tlocal integer hif IsUnitIllusion(u)==false and((id=='n00K')or(id=='n00O')or(id=='u008')or(id=='n00V')or(id=='u00C')or(id=='n015')or(id=='n019')or(id=='n01C')or(id=='n009')or(id=='n00E')or(id=='N000')or(id=='N00J'))thenset mark=CreateUnit(Player($B),'n01M',GetUnitX(u),GetUnitY(u),.0)call SetUnitPathing(mark,false)set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,u)call SaveUnitHandle(udg_hash,h,2,mark)call TimerStart(t,.1,true,function Trig_RedMarkToUnit_Periodic_Move_Actions)
set mark=nullset t=nullendifset u=nullendfunctionfunction InitTrig_RedMarkToUnit takes nothing returns nothinglocal region rectRegion=CreateRegion()set gg_trg_RedMarkToUnit=CreateTrigger()
call RegionAddRect(rectRegion,bj_mapInitialPlayableArea)
call TriggerRegisterEnterRegion(gg_trg_RedMarkToUnit,rectRegion,null)call TriggerAddAction(gg_trg_RedMarkToUnit,function Trig_RedMarkToUnit_Actions)endfunctionfunction Trig_UnSelectedDummyRedMark_Actions takes nothing returns nothingif(GetLocalPlayer()==GetTriggerPlayer())then
call ClearSelection()endifendfunctionfunction Trig_UnSelectedDummyRedMark_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetTriggerUnit())=='n01M'endfunctionfunction InitTrig_UnSelectedDummyRedMark takes nothing returns nothinglocal integer index=0set gg_trg_UnSelectedDummyRedMark=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_UnSelectedDummyRedMark,Player(index),EVENT_PLAYER_UNIT_SELECTED,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_UnSelectedDummyRedMark,Condition(function Trig_UnSelectedDummyRedMark_Conditions))call TriggerAddAction(gg_trg_UnSelectedDummyRedMark,function Trig_UnSelectedDummyRedMark_Actions)endfunctionfunction Trig_SpecEffect_on_Casters_Animation_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster1=LoadUnitHandle(udg_hash,h,1)local unit caster2=LoadUnitHandle(udg_hash,h,2)if GetUnitState(caster1,UNIT_STATE_LIFE)>.405 or GetUnitState(caster2,UNIT_STATE_LIFE)>.405 then
if GetUnitState(caster1,UNIT_STATE_LIFE)>.405 thencall SetUnitAnimation(caster1,"spell")else
call RemoveSavedHandle(udg_hash,h,1)
endifif GetUnitState(caster2,UNIT_STATE_LIFE)>.405 thencall SetUnitAnimation(caster2,"spell")else
call RemoveSavedHandle(udg_hash,h,2)
endifelse
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster1=null
set caster2=null
endfunctionfunction Trig_SpecEffect_on_Casters_Actions takes nothing returns nothinglocal unit array ulocal timer array tlocal integer array hlocal real array timeset u[1]=gg_unit_o003_0028set u[2]=gg_unit_h01K_0109set u[3]=gg_unit_e002_0108set u[4]=gg_unit_n00Y_0101set u[5]=gg_unit_o003_0027set u[6]=gg_unit_h01K_0100set u[7]=gg_unit_e002_0106set u[8]=gg_unit_n00Y_0102set t[1]=CreateTimer()set h[1]=GetHandleId(t[1])set t[2]=CreateTimer()set h[2]=GetHandleId(t[2])set t[3]=CreateTimer()set h[3]=GetHandleId(t[3])set t[4]=CreateTimer()set h[4]=GetHandleId(t[4])set time[1]=.867
set time[2]=1.33
set time[3]=2.666set time[4]=1.167call SaveUnitHandle(udg_hash,h[1],1,u[1])call SaveUnitHandle(udg_hash,h[1],2,u[5])call SaveReal(udg_hash,h[1],3,time[1])call SaveUnitHandle(udg_hash,h[2],1,u[2])call SaveUnitHandle(udg_hash,h[2],2,u[6])call SaveReal(udg_hash,h[2],3,time[2])call SaveUnitHandle(udg_hash,h[3],1,u[3])call SaveUnitHandle(udg_hash,h[3],2,u[7])call SaveReal(udg_hash,h[3],3,time[3])call SaveUnitHandle(udg_hash,h[4],1,u[4])call SaveUnitHandle(udg_hash,h[4],2,u[8])call SaveReal(udg_hash,h[4],3,time[4])call TimerStart(t[1],time[1],true,function Trig_SpecEffect_on_Casters_Animation_Actions)
call TimerStart(t[2],time[2],true,function Trig_SpecEffect_on_Casters_Animation_Actions)
call TimerStart(t[3],time[3],true,function Trig_SpecEffect_on_Casters_Animation_Actions)
call TimerStart(t[4],time[4],true,function Trig_SpecEffect_on_Casters_Animation_Actions)
set u[1]=nullset u[2]=nullset u[3]=nullset u[4]=nullset u[5]=nullset u[6]=nullset u[7]=nullset u[8]=nullset t[1]=nullset t[2]=nullset t[3]=nullset t[4]=nullendfunctionfunction InitTrig_SpecEffect_on_Casters takes nothing returns nothingset gg_trg_SpecEffect_on_Casters=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_SpecEffect_on_Casters,.0,false)call TriggerAddAction(gg_trg_SpecEffect_on_Casters,function Trig_SpecEffect_on_Casters_Actions)endfunctionfunction Trig_PortalSpecEffects_Peridoic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit dummi=LoadUnitHandle(udg_hash,h,1)local unit missile=LoadUnitHandle(udg_hash,h,2)local real angle=LoadReal(udg_hash,h,3)local integer wait=LoadInteger(udg_hash,h,4)
local real x=GetRectCenterX(gg_rct_cast_magi)+310.*Cos(angle*bj_DEGTORAD)local real y=GetRectCenterY(gg_rct_cast_magi)+310.*Sin(angle*bj_DEGTORAD)if wait<50 thenset wait=wait+1call SaveInteger(udg_hash,h,4,wait)else
set wait=0call SaveInteger(udg_hash,h,4,wait)call DestroyEffect(AddSpecialEffectTarget("s_ShadowEruption_Rain.mdl",dummi,"origin"))endifcall SetUnitPosition(missile,x,y)call SetUnitFacing(missile,angle+90.)set angle=angle+7.2call SaveReal(udg_hash,h,3,angle)set dummi=nullset missile=null
set t=nullendfunctionfunction Trig_PortalSpecEffects_Actions takes nothing returns nothinglocal unit dummi=CreateUnit(Player($F),'h00U',GetRectCenterX(gg_rct_cast_magi)+20.,GetRectCenterY(gg_rct_cast_magi)+30.,.0)local unit missile=CreateUnit(Player($F),'h00U',GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi),.0)local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\OrbOfDeath\\OrbOfDeathMissile.mdl",missile,"origin")local timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitScale(dummi,2.,2.,2.)call UnitAddAbility(missile,'Amrf')call UnitRemoveAbility(missile,'Amrf')call SetUnitFlyHeight(missile,150.,.0)call SaveUnitHandle(udg_hash,h,1,dummi)call SaveUnitHandle(udg_hash,h,2,missile)call SaveReal(udg_hash,h,3,.0)call SaveInteger(udg_hash,h,4,0)
call TimerStart(t,.04,true,function Trig_PortalSpecEffects_Peridoic_Actions)
set dummi=nullset missile=null
set ef=nullset t=nullendfunctionfunction InitTrig_PortalSpecEffects takes nothing returns nothingset gg_trg_PortalSpecEffects=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_PortalSpecEffects,2.,false)call TriggerAddAction(gg_trg_PortalSpecEffects,function Trig_PortalSpecEffects_Actions)endfunctionfunction Trig_Gates_Start_Animation_Actions takes nothing returns nothingcall SetDoodadAnimationRect(bj_mapInitialPlayableArea,'D01A',"stand alternate",false)endfunctionfunction InitTrig_Gates_Start_Animation takes nothing returns nothingset gg_trg_Gates_Start_Animation=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Gates_Start_Animation,2.)call TriggerAddAction(gg_trg_Gates_Start_Animation,function Trig_Gates_Start_Animation_Actions)endfunctionfunction Trig_Unstuck_15sec_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local real x=GetRectCenterX(gg_rct_Respawn_Heroes)local real y=GetRectCenterY(gg_rct_Respawn_Heroes)local camerasetup theCam=CreateCameraSetup()
call PauseUnit(hero,false)call SetUnitPosition(hero,x,y)if GetLocalPlayer()==GetOwningPlayer(hero)thencall DisplayTextToPlayer(GetOwningPlayer(hero),0,0,"|cff99ccffВНИМАНИЕ!!!|r|nВаш герой отморозился и был перемещен в центр базы.")
call CameraSetupSetField(theCam,CAMERA_FIELD_TARGET_DISTANCE,GetCameraField(CAMERA_FIELD_TARGET_DISTANCE),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_FARZ,GetCameraField(CAMERA_FIELD_FARZ),0)call CameraSetupSetField(theCam,CAMERA_FIELD_ZOFFSET,GetCameraField(CAMERA_FIELD_ZOFFSET),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_ANGLE_OF_ATTACK,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_FIELD_OF_VIEW,bj_RADTODEG*GetCameraField(CAMERA_FIELD_FIELD_OF_VIEW),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_ROLL,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ROLL),0)call CameraSetupSetField(theCam,CAMERA_FIELD_ROTATION,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ROTATION),0)call CameraSetupSetDestPosition(theCam,x,y,0)call CameraSetupApplyForceDuration(theCam,true,0)call ClearSelection()call SelectUnit(hero,true)endifcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset hero=nullendfunctionfunction Trig_PlayerEnterGameCommand_Actions takes nothing returns nothinglocal player p=GetTriggerPlayer()local string s=GetEventPlayerChatString()local unit herolocal timer tlocal boolean endlocal integer random
if((s=="-r")or(s=="-random")or(s=="-р")or(s=="-рандом"))and udg_Is_Player_Got_Randomed[GetPlayerId(p)+1]==false thenset udg_Is_Player_Got_Randomed[GetPlayerId(p)+1]=trueset random=GetRandomInt(1,udg_Total_Heroes_Count)set udg_Hero_Randomed=CreateUnit(p,udg_Heroes_Types[udg_Heroes_Random_Data[random]],4925.,3900.,.0)set udg_Heroes_Random_Data[random]=udg_Heroes_Random_Data[udg_Total_Heroes_Count]set udg_Total_Heroes_Count=udg_Total_Heroes_Count-1call TriggerExecute(gg_trg_Pick_Hero_Upgrade)endifif((s=="-ms")or(s=="-ск")or(s=="-movespeed")or(s=="-скорость"))and udg_herounit[GetPlayerId(p)+1]!=null thencall DisplayTimedTextToPlayer(p,.0,.0,5.,GetUnitName(udg_herounit[GetPlayerId(p)+1])+" перемещается со скоростью = |cff99ccff"+I2S(R2I(GetUnitMoveSpeed(udg_herounit[GetPlayerId(p)+1])))+"|r")endifif(s=="-c")or(s=="-о")or(s=="-clear")or(s=="-очистить")then
if(GetLocalPlayer()==p)thencall ClearTextMessages()
endifendifif(s=="-us")or(s=="-unstuck")thenif(GetLocalPlayer()==p)thencall DisplayTextToPlayer(p,.0,.0,"|cff99ccffВНИМАНИЕ!!!|r")call DisplayTextToPlayer(p,.0,.0,"Ваш герой заморожен, через 15 секунд он будет перемещен в центр базы.")endifset hero=udg_herounit[GetPlayerId(p)+1]set t=CreateTimer()call PauseUnit(hero,true)call SaveUnitHandle(udg_hash,GetHandleId(t),1,hero)call TimerStart(t,15.,false,function Trig_Unstuck_15sec_Actions)
set hero=nullset t=nullendifif(s=="-shh")or(s=="-show hero hints")thenset end=falseif udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1] then
if GetLocalPlayer()==p thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"Подсказки о покупке предметов и изучении способностей отключены.")endifset end=true
set udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1]=falseendifif udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1]==false and end==false thenif GetLocalPlayer()==p thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"Подсказки о покупке предметов и изучении способностей включены.")endifset udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1]=trueendifendifif(s=="-fast start")or(s=="-fs")or(s=="+")thenif(udg_Is_Player_Fast_Wave_Start[GetPlayerId(p)+1]==false)and(udg_Is_Fast_Wave_Start_On_Off)then
set udg_Count_Players_Fast_Wave_Start=(udg_Count_Players_Fast_Wave_Start+1)set udg_Is_Player_Fast_Wave_Start[GetPlayerId(p)+1]=true
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,(udg_ColorString[GetPlayerId(p)+1]+(GetPlayerName(p)+("|r |cFF969696хочет немедленно начать волну!|r (|Cfffed312"+(I2S(udg_Count_Players_Fast_Wave_Start)+("|r|cFF969696/|r|Cfffed312"+(I2S(CountPlayersInForceBJ(udg_IGRAET))+"|r )")))))))if udg_Count_Players_Fast_Wave_Start>=CountPlayersInForceBJ(udg_IGRAET)thencall StartTimerBJ(udg_Timer_Nomera_Volni,false,1.)endifendifendifset p=nullendfunctionfunction InitTrig_PlayerEnterGameCommand takes nothing returns nothinglocal integer index=0set gg_trg_PlayerEnterGameCommand=CreateTrigger()loop
call TriggerRegisterPlayerChatEvent(gg_trg_PlayerEnterGameCommand,Player(index),"-",false)call TriggerRegisterPlayerChatEvent(gg_trg_PlayerEnterGameCommand,Player(index),"+",true)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_PlayerEnterGameCommand,function Trig_PlayerEnterGameCommand_Actions)endfunctionfunction Trig_Unstuck_Ability_15sec_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local real x=GetRectCenterX(gg_rct_Respawn_Heroes)local real y=GetRectCenterY(gg_rct_Respawn_Heroes)local camerasetup theCam=CreateCameraSetup()
call PauseUnit(hero,false)call SetUnitPosition(hero,x,y)if GetLocalPlayer()==GetOwningPlayer(hero)thencall DisplayTextToPlayer(GetOwningPlayer(hero),0,0,"|cff99ccffВНИМАНИЕ!!!|r|nВаш герой отморозился и был перемещен в центр базы.")
call CameraSetupSetField(theCam,CAMERA_FIELD_TARGET_DISTANCE,GetCameraField(CAMERA_FIELD_TARGET_DISTANCE),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_FARZ,GetCameraField(CAMERA_FIELD_FARZ),0)call CameraSetupSetField(theCam,CAMERA_FIELD_ZOFFSET,GetCameraField(CAMERA_FIELD_ZOFFSET),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_ANGLE_OF_ATTACK,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ANGLE_OF_ATTACK),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_FIELD_OF_VIEW,bj_RADTODEG*GetCameraField(CAMERA_FIELD_FIELD_OF_VIEW),0)
call CameraSetupSetField(theCam,CAMERA_FIELD_ROLL,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ROLL),0)call CameraSetupSetField(theCam,CAMERA_FIELD_ROTATION,bj_RADTODEG*GetCameraField(CAMERA_FIELD_ROTATION),0)call CameraSetupSetDestPosition(theCam,x,y,0)call CameraSetupApplyForceDuration(theCam,true,0)call ClearSelection()call SelectUnit(hero,true)endifcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset hero=nullendfunctionfunction Trig_PlayerUseSpellGameCommand_Actions takes nothing returns nothinglocal player p=GetOwningPlayer(GetSpellAbilityUnit())local integer id=GetSpellAbilityId()
local unit herolocal timer tlocal boolean endif(id=='A0MD')and udg_herounit[GetPlayerId(p)+1]!=null thencall DisplayTimedTextToPlayer(p,.0,.0,5.,GetUnitName(udg_herounit[GetPlayerId(p)+1])+" перемещается со скоростью = |cff99ccff"+I2S(R2I(GetUnitMoveSpeed(udg_herounit[GetPlayerId(p)+1])))+"|r")endifif(id=='A0MB')thenif(GetLocalPlayer()==p)thencall ClearTextMessages()
endifendifif(id=='A0ME')thenif(GetLocalPlayer()==p)thencall DisplayTextToPlayer(p,.0,.0,"|cff99ccffВНИМАНИЕ!!!|r")call DisplayTextToPlayer(p,.0,.0,"Ваш герой заморожен, через 15 секунд он будет перемещен в центр базы.")endifset hero=udg_herounit[GetPlayerId(p)+1]set t=CreateTimer()call PauseUnit(hero,true)call SaveUnitHandle(udg_hash,GetHandleId(t),1,hero)call TimerStart(t,15.,false,function Trig_Unstuck_Ability_15sec_Actions)
set hero=nullset t=nullendifif(id=='A0MF')thenset end=falseif udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1] then
if GetLocalPlayer()==p thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"Подсказки о покупке предметов и изучении способностей отключены.")endifset end=true
set udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1]=falseendifif udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1]==false and end==false thenif GetLocalPlayer()==p thencall DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"Подсказки о покупке предметов и изучении способностей включены.")endifset udg_System_ShowAbil_And_Items_Hint[GetPlayerId(p)+1]=trueendifendifif(id=='A0MH')thenif(udg_Is_Player_Fast_Wave_Start[GetPlayerId(p)+1]==false)and(udg_Is_Fast_Wave_Start_On_Off)then
set udg_Count_Players_Fast_Wave_Start=(udg_Count_Players_Fast_Wave_Start+1)set udg_Is_Player_Fast_Wave_Start[GetPlayerId(p)+1]=true
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,(udg_ColorString[GetPlayerId(p)+1]+(GetPlayerName(p)+("|r |cFF969696хочет немедленно начать волну!|r (|Cfffed312"+(I2S(udg_Count_Players_Fast_Wave_Start)+("|r|cFF969696/|r|Cfffed312"+(I2S(CountPlayersInForceBJ(udg_IGRAET))+"|r )")))))))if udg_Count_Players_Fast_Wave_Start>=CountPlayersInForceBJ(udg_IGRAET)thencall StartTimerBJ(udg_Timer_Nomera_Volni,false,1.)endifendifendifset p=nullendfunctionfunction Trig_PlayerUseSpellGameCommand_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0MD' or GetSpellAbilityId()=='A0MB' or GetSpellAbilityId()=='A0ME' or GetSpellAbilityId()=='A0MF' or GetSpellAbilityId()=='A0MH'endfunctionfunction InitTrig_PlayerUseSpellGameCommand takes nothing returns nothinglocal integer index=0set gg_trg_PlayerUseSpellGameCommand=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_PlayerUseSpellGameCommand,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_PlayerUseSpellGameCommand,Condition(function Trig_PlayerUseSpellGameCommand_Conditions))
call TriggerAddAction(gg_trg_PlayerUseSpellGameCommand,function Trig_PlayerUseSpellGameCommand_Actions)endfunctionfunction Trig_GuardsExorcistDead_Removes_Buffs_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local group g=LoadGroupHandle(udg_hash,h,1)local unit Pickedloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullcall DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(Picked),$83))call SetUnitLifeAndManaRegeneration(Picked,"life",-70)call GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_GuardsExorcistDead_2and5sec_wait_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer lopa=0
loop
exitwhen lopa>8if(GetLocalPlayer()==Player(lopa))thencall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,99999.,"|cff99ccffИгрa завершена. Всем игрокам огромное спасибо за участие!!!!|r")call CreateFogModifierRadiusLocBJ(true,GetLocalPlayer(),FOG_OF_WAR_VISIBLE,GetRectCenter(gg_rct_Center_Vision),650.)
endifcall DestroyFogModifier(udg_BaseVisionFogModifier[GetPlayerId(Player(lopa))+1])set lopa=lopa+1endloopendfunctionfunction Trig_GuardsExorcistDead_3sec_wait_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer lopa=0
local unit dammi=CreateUnit(Player($F),'h00U',GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi),.0)local group g=CreateGroup()local unit Pickedcall GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetPlayerId(GetOwningPlayer(Picked))<=8 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall KillUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endlooploop
exitwhen lopa>8if(GetLocalPlayer()==Player(lopa))thencall ClearTextMessages()
call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,99999.,"|cffff0000Все стражи-чародеи погибли, вы проиграли!!!|r")
call SetCameraTargetController(dammi,.0,.0,false)endifset lopa=lopa+1endloopset t=CreateTimer()call TimerStart(t,2.5,false,function Trig_GuardsExorcistDead_2and5sec_wait_Actions)endfunctionfunction Trig_GuardsExorcistDead_Actions takes nothing returns nothinglocal timer tlocal integer lopa=0
local group glocal group g2local unit Pickedlocal unit dammi
local timer t1local integer h1
if(IsPlayerInForce(GetLocalPlayer(),udg_IGRAET))then
set udg_CountGuardsExorcist=udg_CountGuardsExorcist-1call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"|cff99ccffВНИМАНИЕ!!!|r")call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,"|cffff0000Один Из Стражей-Чародеев погиб!!!|r В живых осталось: |cff99ccff"+I2S(udg_CountGuardsExorcist)+"|r")call PingMinimapEx(GetUnitX(GetDyingUnit()),GetUnitY(GetDyingUnit()),5.,$FE,0,0,true)endifloop
exitwhen lopa>8call SetPlayerState(Player(lopa),PLAYER_STATE_RESOURCE_LUMBER,GetPlayerState(Player(lopa),PLAYER_STATE_RESOURCE_LUMBER)-1)set lopa=lopa+1endloopif udg_CountGuardsExorcist==4 or udg_CountGuardsExorcist==1 then
set dammi=CreateUnit(Player(0),'h00U',1255.,-5700.,.0)call UnitApplyTimedLife(dammi,'BTLF',5.)
call SetUnitScale(dammi,3.,3.,3.)call DestroyEffect(AddSpecialEffect("Effects\\TheHolyBomb.mdl",1255.,-5700.))call DestroyEffect(AddSpecialEffect("Effects\\LightNova.mdl",1255.,-5700.))set g=CreateGroup()call GroupEnumUnitsInRange(g,1255.,-5700.,3000.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and Picked!=null and GetPlayerId(GetOwningPlayer(Picked))>=9 and GetPlayerId(GetOwningPlayer(Picked))!=$F and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall StunUnitTimed(Picked,10.)call DestroyEffect(AddSpecialEffectTarget("Effects\\TheHolyBomb.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdl",Picked,"origin"))call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)*.5)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset g=CreateGroup()set g2=CreateGroup()
call GroupAddGroup(udg_PortalCastersMagi,g2)
loop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and Picked!=null thencall SetUnitLifeAndManaRegeneration(Picked,"life",70)call SaveEffectHandle(udg_hash,GetHandleId(Picked),$83,AddSpecialEffectTarget("Effects\\DivineBarrier.mdl",Picked,"origin"))
call GroupAddUnit(g,Picked)endifcall GroupRemoveUnit(g2,Picked)endloopset t1=CreateTimer()
set h1=GetHandleId(t1)call SaveGroupHandle(udg_hash,h1,1,g)call TimerStart(t1,10.,false,function Trig_GuardsExorcistDead_Removes_Buffs_Actions)
set t1=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset Picked=nullendifif udg_CountGuardsExorcist<=0 thenset lopa=0call DisableTrigger(gg_trg_Hero_Dead)call EnableTrigger(gg_trg_PauseUnitWhenDefeat)set udg_IsGameEnd=trueloop
exitwhen lopa>8if(GetLocalPlayer()==Player(lopa))thencall PanCameraToTimed(GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi),3.)endifset lopa=lopa+1endloopset g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetPlayerId(GetOwningPlayer(Picked))<=8 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall SetUnitPosition(Picked,GetRandomReal((GetRectCenterX(gg_rct_cast_magi)-500.),(GetRectCenterX(gg_rct_cast_magi)+500.)),GetRandomReal((GetRectCenterY(gg_rct_cast_magi)-500.),(GetRectCenterY(gg_rct_cast_magi)+500.)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",GetUnitX(Picked),GetUnitY(Picked)))
call PauseUnit(Picked,true)endifcall GroupRemoveUnit(g,Picked)endloopset t=CreateTimer()call TimerStart(t,3.,false,function Trig_GuardsExorcistDead_3sec_wait_Actions)endifendfunctionfunction Trig_GuardsExorcistDead_Conditions takes nothing returns booleanreturn(GetUnitTypeId(GetDyingUnit())=='h01K')or(GetUnitTypeId(GetDyingUnit())=='e002')or(GetUnitTypeId(GetDyingUnit())=='n00Y')or(GetUnitTypeId(GetDyingUnit())=='o003')
endfunctionfunction InitTrig_GuardsExorcistDead takes nothing returns nothinglocal integer index=0set gg_trg_GuardsExorcistDead=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_GuardsExorcistDead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_GuardsExorcistDead,Condition(function Trig_GuardsExorcistDead_Conditions))call TriggerAddAction(gg_trg_GuardsExorcistDead,function Trig_GuardsExorcistDead_Actions)endfunctionfunction Trig_PauseUnitWhenDefeat_Func001Func001C takes nothing returns booleanreturn((1+GetPlayerId(GetOwningPlayer(GetEnumUnit())))<=9)endfunctionfunction Trig_PauseUnitWhenDefeat_Func001A takes nothing returns nothing
if(Trig_PauseUnitWhenDefeat_Func001Func001C())thencall KillUnit(GetEnumUnit())
endifendfunctionfunction Trig_PauseUnitWhenDefeat_Actions takes nothing returns nothingcall ForGroupBJ(GetUnitsInRectAll(bj_mapInitialPlayableArea),function Trig_PauseUnitWhenDefeat_Func001A)
endfunctionfunction InitTrig_PauseUnitWhenDefeat takes nothing returns nothingset gg_trg_PauseUnitWhenDefeat=CreateTrigger()call DisableTrigger(gg_trg_PauseUnitWhenDefeat)call TriggerRegisterTimerEventPeriodic(gg_trg_PauseUnitWhenDefeat,.05)call TriggerAddAction(gg_trg_PauseUnitWhenDefeat,function Trig_PauseUnitWhenDefeat_Actions)endfunctionfunction Trig_PauseUnitWhenWin_Func001C takes nothing returns booleanreturn((1+GetPlayerId(GetOwningPlayer(GetEnteringUnit())))>=$A)and((1+GetPlayerId(GetOwningPlayer(GetEnteringUnit())))<=$F)endfunctionfunction Trig_PauseUnitWhenWin_Func002C takes nothing returns booleanreturn((1+GetPlayerId(GetOwningPlayer(GetEnteringUnit())))<=9)endfunctionfunction Trig_PauseUnitWhenWin_Actions takes nothing returns nothing
if(Trig_PauseUnitWhenWin_Func001C())then
call KillUnit(GetEnteringUnit())
endifif(Trig_PauseUnitWhenWin_Func002C())then
call PauseUnit(GetEnteringUnit(),true)endifendfunctionfunction InitTrig_PauseUnitWhenWin takes nothing returns nothing
set gg_trg_PauseUnitWhenWin=CreateTrigger()call DisableTrigger(gg_trg_PauseUnitWhenWin)
call TriggerRegisterEnterRectSimple(gg_trg_PauseUnitWhenWin,bj_mapInitialPlayableArea)call TriggerAddAction(gg_trg_PauseUnitWhenWin,function Trig_PauseUnitWhenWin_Actions)endfunctionfunction Trig_GameEndWin_Effects_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local real x=GetRandomReal((GetRectCenterX(gg_rct_cast_magi)-500.),(GetRectCenterX(gg_rct_cast_magi)+500.))local real y=GetRandomReal((GetRectCenterY(gg_rct_cast_magi)-500.),(GetRectCenterY(gg_rct_cast_magi)+500.))local unit dammi=CreateUnit(Player($F),'h00U',x,y,.0)local unit dammi2=CreateUnit(Player($F),'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',11.2)call AddSpecialEffectTarget("Effects\\Win_Fireworks.mdx",dammi,"origin")
call SetUnitScale(dammi2,3.,3.,3.)call DestroyEffect(AddSpecialEffectTarget("Effects\\Fireworksblue.mdl",dammi2,"origin"))
endfunctionfunction Trig_GameEndWin_1and5sec_wait_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer lopa=0
loop
exitwhen lopa>8if(GetLocalPlayer()==Player(lopa))thencall DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,99999.,"|cff99ccffНа этом моменте альфа версия карты заканчивается!!! Игрa завершена. Всем игрокам огромное спасибо за участие!!!!|r")
endifset lopa=lopa+1endloopcall DestroyTimer(t)
set t=CreateTimer()call TimerStart(t,.25,true,function Trig_GameEndWin_Effects_Actions)
endfunctionfunction Trig_GameEndWin_2sec_wait_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer lopa=0
local unit dammi=CreateUnit(Player($F),'h00U',GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi),.0)local group g=CreateGroup()local unit Pickedcall GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetPlayerId(GetOwningPlayer(Picked))<=8 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall SetUnitInvulnerable(Picked,true)if GetUnitTypeId(Picked)=='E004' or GetUnitTypeId(Picked)=='H01I' or GetUnitTypeId(Picked)=='N00W' or GetUnitTypeId(Picked)=='E001' then
call SetUnitAnimation(Picked,"Stand")else
call SetUnitAnimation(Picked,"Stand Victory")endifendifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
loop
exitwhen lopa>8if(GetLocalPlayer()==Player(lopa))thencall ClearTextMessages()
call DisplayTimedTextToPlayer(GetLocalPlayer(),.0,.0,99999.,"|cff00CD00Армия Тьмы уничтожена, чародеи живы и портал открыт...Вы победили!!!!!!|r")call SetCameraTargetController(dammi,.0,.0,false)endifset lopa=lopa+1endloopset t=CreateTimer()call TimerStart(t,1.5,false,function Trig_GameEndWin_1and5sec_wait_Actions)endfunctionfunction Trig_GameEndWin_6and0sec_wait_Actions takes nothing returns nothing
local timer tlocal integer lopalocal group glocal unit Pickedset lopa=0call EnableTrigger(gg_trg_PauseUnitWhenWin)set udg_IsGameEnd=trueloop
exitwhen lopa>8if(GetLocalPlayer()==Player(lopa))thencall PanCameraToTimed(GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi),2.)endifset lopa=lopa+1endloopset g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetPlayerId(GetOwningPlayer(Picked))<=8 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall SetUnitPosition(Picked,GetRandomReal((GetRectCenterX(gg_rct_cast_magi)-500.),(GetRectCenterX(gg_rct_cast_magi)+500.)),GetRandomReal((GetRectCenterY(gg_rct_cast_magi)-500.),(GetRectCenterY(gg_rct_cast_magi)+500.)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl",GetUnitX(Picked),GetUnitY(Picked)))
call PauseUnit(Picked,true)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=CreateGroup()call GroupEnumUnitsInRect(g,bj_mapInitialPlayableArea,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetPlayerId(GetOwningPlayer(Picked))>=9 and GetPlayerId(GetOwningPlayer(Picked))<$F and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall KillUnit(Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)set t=CreateTimer()call TimerStart(t,2.,false,function Trig_GameEndWin_2sec_wait_Actions)endfunctionfunction Trig_GameEndWin_Actions takes nothing returns nothinglocal timer tset t=CreateTimer()call TimerStart(t,6.,false,function Trig_GameEndWin_6and0sec_wait_Actions)endfunctionfunction InitTrig_GameEndWin takes nothing returns nothingset gg_trg_GameEndWin=CreateTrigger()call DisableTrigger(gg_trg_GameEndWin)call TriggerAddAction(gg_trg_GameEndWin,function Trig_GameEndWin_Actions)endfunctionfunction Trig_Respawn_trees_Init_AddTree takes nothing returns nothingif GetDestructableTypeId(GetEnumDestructable())=='ATtr' or GetDestructableTypeId(GetEnumDestructable())=='ATtc' or GetDestructableTypeId(GetEnumDestructable())=='ZTtw' or GetDestructableTypeId(GetEnumDestructable())=='NTtw' or GetDestructableTypeId(GetEnumDestructable())=='WTst' or GetDestructableTypeId(GetEnumDestructable())=='CTtr' then
call TriggerRegisterDeathEvent(gg_trg_Respawn_trees,GetEnumDestructable())endifendfunctionfunction Trig_Respawn_trees_Init_Actions takes nothing returns nothingcall EnumDestructablesInRect(GetWorldBounds(),null,function Trig_Respawn_trees_Init_AddTree)
endfunctionfunction InitTrig_Respawn_trees_Init takes nothing returns nothingset gg_trg_Respawn_trees_Init=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Respawn_trees_Init,5.,false)call TriggerAddAction(gg_trg_Respawn_trees_Init,function Trig_Respawn_trees_Init_Actions)endfunctionfunction Trig_Respawn_trees_With_Wait_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local destructable tree=LoadDestructableHandle(udg_hash,h,1)
call DestructableRestoreLife(tree,GetDestructableMaxLife(tree),true)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset tree=nullendfunctionfunction Trig_Respawn_trees_Actions takes nothing returns nothinglocal destructable tree=GetTriggerDestructable()
local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveDestructableHandle(udg_hash,h,1,tree)call TimerStart(t,120.,false,function Trig_Respawn_trees_With_Wait_Actions)set tree=nullset t=nullendfunctionfunction InitTrig_Respawn_trees takes nothing returns nothingset gg_trg_Respawn_trees=CreateTrigger()
call TriggerAddAction(gg_trg_Respawn_trees,function Trig_Respawn_trees_Actions)endfunctionfunction Trig_Day_Weather_Func003Func005C takes nothing returns booleanreturn(true==false)endfunctionfunction Trig_Day_Weather_Func003C takes nothing returns boolean
return(udg_Temp_Integer[1]==1)endfunctionfunction Trig_Day_Weather_Func004Func004C takes nothing returns booleanreturn(true==false)endfunctionfunction Trig_Day_Weather_Func004C takes nothing returns boolean
return(udg_Temp_Integer[1]==2)endfunctionfunction Trig_Day_Weather_Func005Func001C takes nothing returns booleanreturn(udg_Temp_Integer[1]==3)or(udg_Temp_Integer[1]==4)or(udg_Temp_Integer[1]==5)endfunctionfunction Trig_Day_Weather_Func005C takes nothing returns boolean
return(Trig_Day_Weather_Func005Func001C())endfunctionfunction Trig_Day_Weather_Actions takes nothing returns nothingcall RemoveWeatherEffect(udg_Weather[1])
set udg_Temp_Integer[1]=GetRandomInt(1,5)if(Trig_Day_Weather_Func003C())thencall AddWeatherEffectSaveLast(bj_mapInitialPlayableArea,'RAhr')set udg_Weather[1]=bj_lastCreatedWeatherEffectset udg_Boolean_Is_Rain=true
if(Trig_Day_Weather_Func003Func005C())thencall StartTimerBJ(udg_Timer_Lightning_Strike_Weather,false,(17.+GetRandomReal(0,25.)))endifendifif(Trig_Day_Weather_Func004C())thencall AddWeatherEffectSaveLast(bj_mapInitialPlayableArea,'RAlr')set udg_Weather[1]=bj_lastCreatedWeatherEffectset udg_Boolean_Is_Rain=true
if(Trig_Day_Weather_Func004Func004C())thencall StartTimerBJ(udg_Timer_Lightning_Strike_Weather,false,(17.+GetRandomReal(0,25.)))endifendifif(Trig_Day_Weather_Func005C())thencall AddWeatherEffectSaveLast(bj_mapInitialPlayableArea,'LRaa')set udg_Weather[1]=bj_lastCreatedWeatherEffectset udg_Boolean_Is_Rain=falseendifcall EnableWeatherEffect(udg_Weather[1],true)endfunctionfunction InitTrig_Day_Weather takes nothing returns nothingset gg_trg_Day_Weather=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Day_Weather,EQUAL,6.)
call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Day_Weather,EQUAL,12.)call TriggerAddAction(gg_trg_Day_Weather,function Trig_Day_Weather_Actions)endfunctionfunction Trig_Sky_Morning_Actions takes nothing returns nothingcall SetSkyModel("Environment\\Sky\\LordaeronWinterSkyPink\\LordaeronWinterSkyPink.mdl")
endfunctionfunction InitTrig_Sky_Morning takes nothing returns nothingset gg_trg_Sky_Morning=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Morning,EQUAL,6.)
call TriggerAddAction(gg_trg_Sky_Morning,function Trig_Sky_Morning_Actions)endfunctionfunction Trig_Sky_Day_Actions takes nothing returns nothingcall SetSkyModel("Environment\\Sky\\LordaeronSummerSky\\LordaeronSummerSky.mdl")
endfunctionfunction InitTrig_Sky_Day takes nothing returns nothingset gg_trg_Sky_Day=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Day,EQUAL,12.)call TriggerAddAction(gg_trg_Sky_Day,function Trig_Sky_Day_Actions)endfunctionfunction Trig_Night_Weather_Func003Func004C takes nothing returns booleanreturn(true==false)endfunctionfunction Trig_Night_Weather_Func003C takes nothing returns booleanreturn(udg_Temp_Integer[1]==1)endfunctionfunction Trig_Night_Weather_Func004Func004C takes nothing returns booleanreturn(true==false)endfunctionfunction Trig_Night_Weather_Func004C takes nothing returns booleanreturn(udg_Temp_Integer[1]==2)endfunctionfunction Trig_Night_Weather_Func005Func001C takes nothing returns booleanreturn(udg_Temp_Integer[1]==3)or(udg_Temp_Integer[1]==4)or(udg_Temp_Integer[1]==5)endfunctionfunction Trig_Night_Weather_Func005C takes nothing returns booleanreturn(Trig_Night_Weather_Func005Func001C())
endfunctionfunction Trig_Night_Weather_Actions takes nothing returns nothingcall RemoveWeatherEffect(udg_Weather[1])
set udg_Temp_Integer[1]=GetRandomInt(1,5)if(Trig_Night_Weather_Func003C())thencall AddWeatherEffectSaveLast(bj_mapInitialPlayableArea,'RAhr')set udg_Weather[1]=bj_lastCreatedWeatherEffectset udg_Boolean_Is_Rain=true
if(Trig_Night_Weather_Func003Func004C())then
call StartTimerBJ(udg_Timer_Lightning_Strike_Weather,false,(17.+GetRandomReal(0,25.)))endifendifif(Trig_Night_Weather_Func004C())thencall AddWeatherEffectSaveLast(bj_mapInitialPlayableArea,'RAlr')set udg_Weather[1]=bj_lastCreatedWeatherEffectset udg_Boolean_Is_Rain=true
if(Trig_Night_Weather_Func004Func004C())then
call StartTimerBJ(udg_Timer_Lightning_Strike_Weather,false,(17.+GetRandomReal(0,25.)))endifendifif(Trig_Night_Weather_Func005C())thencall AddWeatherEffectSaveLast(bj_mapInitialPlayableArea,'LRma')set udg_Weather[1]=bj_lastCreatedWeatherEffectset udg_Boolean_Is_Rain=falseendifcall EnableWeatherEffect(udg_Weather[1],true)endfunctionfunction InitTrig_Night_Weather takes nothing returns nothingset gg_trg_Night_Weather=CreateTrigger()
call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Night_Weather,EQUAL,18.)call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Night_Weather,EQUAL,.0)call TriggerAddAction(gg_trg_Night_Weather,function Trig_Night_Weather_Actions)endfunctionfunction Trig_Sky_Evening_Actions takes nothing returns nothingcall SetSkyModel("Environment\\Sky\\LordaeronFallSky\\LordaeronFallSky.mdl")
endfunctionfunction InitTrig_Sky_Evening takes nothing returns nothingset gg_trg_Sky_Evening=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Evening,EQUAL,18.)call TriggerAddAction(gg_trg_Sky_Evening,function Trig_Sky_Evening_Actions)endfunctionfunction Trig_Sky_Night_Actions takes nothing returns nothingcall SetSkyModel("Environment\\Sky\\FelwoodSky\\FelwoodSky.mdl")
endfunctionfunction InitTrig_Sky_Night takes nothing returns nothingset gg_trg_Sky_Night=CreateTrigger()
call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Night,EQUAL,.0)call TriggerAddAction(gg_trg_Sky_Night,function Trig_Sky_Night_Actions)endfunctionfunction Trig_Lightnings_Weather_Effect_Rainy_Conditions takes nothing returns booleanreturn(udg_Boolean_Is_Rain)endfunctionfunction Trig_Lightnings_Weather_Effect_Rainy_Func003A takes nothing returns nothing
call SoundForPlayer(GetEnumPlayer(),17)endfunctionfunction Trig_Lightnings_Weather_Effect_Rainy_Actions takes nothing returns nothingcall CinematicFadeBJ(1,1.,"ReplaceableTextures\\CameraMasks\\Black_mask.blp",60.,60.,65.,15.)call CinematicFadeBJ(0,2.,"ReplaceableTextures\\CameraMasks\\White_mask.blp",60.,60.,65.,15.)call ForForce(bj_FORCE_ALL_PLAYERS,function Trig_Lightnings_Weather_Effect_Rainy_Func003A)call StartTimerBJ(udg_Timer_Lightning_Strike_Weather,false,(10.+GetRandomReal(20.,40.)))
endfunctionfunction InitTrig_Lightnings_Weather_Effect_Rainy takes nothing returns nothingset gg_trg_Lightnings_Weather_Effect_Rainy=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_Lightnings_Weather_Effect_Rainy,udg_Timer_Lightning_Strike_Weather)call TriggerAddCondition(gg_trg_Lightnings_Weather_Effect_Rainy,Condition(function Trig_Lightnings_Weather_Effect_Rainy_Conditions))
call TriggerAddAction(gg_trg_Lightnings_Weather_Effect_Rainy,function Trig_Lightnings_Weather_Effect_Rainy_Actions)endfunctionfunction Trig_Periodic_Rune_Creation_Func001Func002Func002C takes nothing returns booleanreturn(CountPlayersInForceBJ(udg_IGRAET)>=1)
endfunctionfunction Trig_Periodic_Rune_Creation_Func001Func002C takes nothing returns booleanreturn(CountPlayersInForceBJ(udg_IGRAET)>=2)
endfunctionfunction Trig_Periodic_Rune_Creation_Func001C takes nothing returns booleanreturn(CountPlayersInForceBJ(udg_IGRAET)>=3)
endfunctionfunction Trig_Periodic_Rune_Creation_Func002Func002Func001Func002C takes nothing returns boolean
return(udg_Temp_Integer[2]==1)endfunctionfunction Trig_Periodic_Rune_Creation_Func002Func002Func001Func003C takes nothing returns boolean
return(udg_Temp_Integer[2]==2)endfunctionfunction Trig_Periodic_Rune_Creation_Func002Func002Func001Func004C takes nothing returns boolean
return(udg_Temp_Integer[2]==3)endfunctionfunction Trig_Periodic_Rune_Creation_Func002Func002Func001Func005C takes nothing returns boolean
return(udg_Temp_Integer[2]==4)endfunctionfunction Trig_Periodic_Rune_Creation_Func002Func002Func001C takes nothing returns booleanreturn(udg_Is_Rune_On_Position[bj_forLoopAIndex]==false)
endfunctionfunction Trig_Periodic_Rune_Creation_Func002Func003C takes nothing returns booleanreturn(udg_Is_Rune_On_Position[bj_forLoopAIndex]==false)
endfunctionfunction Trig_Periodic_Rune_Creation_Func002C takes nothing returns booleanreturn(Trig_Periodic_Rune_Creation_Func002Func003C())endfunctionfunction Trig_Periodic_Rune_Creation_Actions takes nothing returns nothingif(Trig_Periodic_Rune_Creation_Func001C())thenset udg_Temp_Integer[4]=3else
if(Trig_Periodic_Rune_Creation_Func001Func002C())thenset udg_Temp_Integer[4]=2else
if(Trig_Periodic_Rune_Creation_Func001Func002Func002C())then
set udg_Temp_Integer[4]=1endifendifendifif(Trig_Periodic_Rune_Creation_Func002C())thenset udg_Temp_Integer[3]=4set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=udg_Temp_Integer[4]loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndif(Trig_Periodic_Rune_Creation_Func002Func002Func001C())then
set udg_Temp_Integer[2]=GetRandomInt(1,udg_Temp_Integer[3])if(Trig_Periodic_Rune_Creation_Func002Func002Func001Func002C())thencall CreateItemLoc('I013',Location(I2R(udg_Rune_Position_X[bj_forLoopAIndex]),I2R(udg_Rune_Position_Y[bj_forLoopAIndex])))endifif(Trig_Periodic_Rune_Creation_Func002Func002Func001Func003C())thencall CreateItemLoc('I014',Location(I2R(udg_Rune_Position_X[bj_forLoopAIndex]),I2R(udg_Rune_Position_Y[bj_forLoopAIndex])))endifif(Trig_Periodic_Rune_Creation_Func002Func002Func001Func004C())thencall CreateItemLoc('I016',Location(I2R(udg_Rune_Position_X[bj_forLoopAIndex]),I2R(udg_Rune_Position_Y[bj_forLoopAIndex])))endifif(Trig_Periodic_Rune_Creation_Func002Func002Func001Func005C())thencall CreateItemLoc('I017',Location(I2R(udg_Rune_Position_X[bj_forLoopAIndex]),I2R(udg_Rune_Position_Y[bj_forLoopAIndex])))endifcall AddSpecialEffectLocBJ(Location(I2R(udg_Rune_Position_X[bj_forLoopAIndex]),I2R(udg_Rune_Position_Y[bj_forLoopAIndex])),"Effects\\ShadowAssault.mdx")
call DestroyEffectWithWait(bj_lastCreatedEffect,3.)set udg_Is_Rune_On_Position[bj_forLoopAIndex]=trueendifset bj_forLoopAIndex=bj_forLoopAIndex+1endloopendifendfunctionfunction InitTrig_Periodic_Rune_Creation takes nothing returns nothingset gg_trg_Periodic_Rune_Creation=CreateTrigger()call DisableTrigger(gg_trg_Periodic_Rune_Creation)call TriggerRegisterTimerEventPeriodic(gg_trg_Periodic_Rune_Creation,60.1)call TriggerAddAction(gg_trg_Periodic_Rune_Creation,function Trig_Periodic_Rune_Creation_Actions)endfunctionfunction Trig_Rune_PickedUp_End_Immunity_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
call SetArmorAbilityLevel(hero,-50)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset hero=nullendfunctionfunction Trig_Rune_PickedUp_End_Damage_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local integer damage=LoadInteger(udg_hash,h,6)local effect efset damage=20+5*GetHeroLevel(hero)call SetAttackAbilityLevel(hero,-damage)
set ef=LoadEffectHandle(udg_hash,h,2)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,5)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset hero=nullendfunctionfunction Trig_Rune_PickedUp_End_Regeneration_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local real hp=LoadReal(udg_hash,h,2)
local real mp=LoadReal(udg_hash,h,3)
call SetUnitLifeAndManaRegeneration(hero,"life",R2I(-hp/ 20))call SetUnitLifeAndManaRegeneration(hero,"mana",R2I(-mp/ 20))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset hero=nullendfunctionfunction Trig_Rune_PickedUp_Actions takes nothing returns nothinglocal item rune=GetManipulatedItem()
local unit hero=GetManipulatingUnit()local integer id=GetItemTypeId(rune)
local unit dammi
local real hplocal real mplocal timer tlocal integer hlocal effect eflocal integer damage
local real x=GetUnitX(hero)local real y=GetUnitY(hero)local real dist1=SquareRoot((x-udg_Rune_Position_X[1])*(x-udg_Rune_Position_X[1])+(y-udg_Rune_Position_Y[1])*(y-udg_Rune_Position_Y[1]))
local real dist2=SquareRoot((x-udg_Rune_Position_X[2])*(x-udg_Rune_Position_X[2])+(y-udg_Rune_Position_Y[2])*(y-udg_Rune_Position_Y[2]))
local real dist3=SquareRoot((x-udg_Rune_Position_X[3])*(x-udg_Rune_Position_X[3])+(y-udg_Rune_Position_Y[3])*(y-udg_Rune_Position_Y[3]))
local integer runepos=0if dist1<500. thenset runepos=1endifif dist2<500. thenset runepos=2endifif dist3<500. thenset runepos=3endifif id=='I013' thenset t=CreateTimer()set h=GetHandleId(t)
set dammi=CreateUnit(GetOwningPlayer(hero),'h00U',GetUnitX(hero),GetUnitY(hero),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0O6')call IssueTargetOrderById(dammi,$D00C0,hero)
set hp=GetUnitState(hero,UNIT_STATE_MAX_LIFE)set mp=GetUnitState(hero,UNIT_STATE_MAX_MANA)call SetUnitLifeAndManaRegeneration(hero,"life",R2I(hp/ 20))
call SetUnitLifeAndManaRegeneration(hero,"mana",R2I(mp/ 20))
call SaveUnitHandle(udg_hash,h,1,hero)call SaveReal(udg_hash,h,2,hp)call SaveReal(udg_hash,h,3,mp)call TimerStart(t,10.,false,function Trig_Rune_PickedUp_End_Regeneration_Actions)set t=nullset dammi=nullendifif id=='I014' thenset t=CreateTimer()set h=GetHandleId(t)
set damage=20+5*GetHeroLevel(hero)call SetAttackAbilityLevel(hero,damage)call SaveUnitHandle(udg_hash,h,1,hero)set ef=AddSpecialEffectTarget("Effects\\Prismatic Missile Fixed.mdl",hero,"hand,left")call SaveEffectHandle(udg_hash,h,2,ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\Prismatic Missile Fixed.mdl",hero,"hand,right")call SaveEffectHandle(udg_hash,h,3,ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\Prismatic Missile Fixed.mdl",hero,"weapon")call SaveEffectHandle(udg_hash,h,4,ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\Prismatic Missile Fixed.mdl",hero,"overhead")call SaveEffectHandle(udg_hash,h,5,ef)set ef=nullcall SaveInteger(udg_hash,h,6,damage)call TimerStart(t,20.,false,function Trig_Rune_PickedUp_End_Damage_Actions)set t=nullendifif id=='I016' thenset dammi=CreateUnit(GetOwningPlayer(hero),'h00U',GetUnitX(hero),GetUnitY(hero),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0O7')call IssueTargetOrderById(dammi,$D0132,hero)
set dammi=nullendifif id=='I017' thenset t=CreateTimer()set h=GetHandleId(t)
set dammi=CreateUnit(GetOwningPlayer(hero),'h00U',GetUnitX(hero),GetUnitY(hero),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0O8')call IssueTargetOrderById(dammi,$D00DA,hero)
call SetArmorAbilityLevel(hero,50)call SaveUnitHandle(udg_hash,h,1,hero)call TimerStart(t,12.,false,function Trig_Rune_PickedUp_End_Immunity_Actions)set t=nullset dammi=nullendifset udg_Is_Rune_On_Position[runepos]=falsecall RemoveItem(rune)set hero=nullset rune=nullendfunctionfunction Trig_Rune_PickedUp_Conditions takes nothing returns boolean
return GetItemTypeId(GetManipulatedItem())=='I013' or GetItemTypeId(GetManipulatedItem())=='I014' or GetItemTypeId(GetManipulatedItem())=='I016' or GetItemTypeId(GetManipulatedItem())=='I017'endfunctionfunction InitTrig_Rune_PickedUp takes nothing returns nothinglocal integer index=0set gg_trg_Rune_PickedUp=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Rune_PickedUp,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Rune_PickedUp,Condition(function Trig_Rune_PickedUp_Conditions))
call TriggerAddAction(gg_trg_Rune_PickedUp,function Trig_Rune_PickedUp_Actions)endfunctionfunction Trig_Initialization_MultiBoard_Func002Func001C takes nothing returns booleanreturn(GetPlayerSlotState(Player(-1+(bj_forLoopAIndex)))==PLAYER_SLOT_STATE_PLAYING)
endfunctionfunction Trig_Initialization_MultiBoard_Func029A takes nothing returns nothingcall MultiboardSetItemValueBJ(udg_MultiBoard,2,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[(1+GetPlayerId(GetEnumPlayer()))]+(GetPlayerName(GetEnumPlayer())+"|r")))
call MultiboardSetItemValueBJ(udg_MultiBoard,3,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[20]+("0|r")))
call MultiboardSetItemValueBJ(udg_MultiBoard,4,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[21]+("0|r")))
call MultiboardSetItemValueBJ(udg_MultiBoard,5,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[24]+("0|r")))
call MultiboardSetItemValueBJ(udg_MultiBoard,6,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[22]+("0|r")))
call MultiboardSetItemValueBJ(udg_MultiBoard,7,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[23]+("0|r")))
endfunctionfunction Trig_Initialization_MultiBoard_Actions takes nothing returns nothingset bj_forLoopAIndex=1set bj_forLoopAIndexEnd=9loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndif(Trig_Initialization_MultiBoard_Func002Func001C())then
call ForceAddPlayer(udg_Players_Ally_Group,Player(-1+(bj_forLoopAIndex)))set udg_CountPlayers=(udg_CountPlayers+1)set udg_PlayerNumberInMB[(1+GetPlayerId(Player(-1+(bj_forLoopAIndex))))]=(udg_CountPlayers+1)endifset bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall CreateMultiboardBJ(7,(udg_CountPlayers+3),"Последние Стражи")set udg_MultiBoard=bj_lastCreatedMultiboardcall MultiboardSetItemValueBJ(udg_MultiBoard,1,1,"")
call MultiboardSetItemStyleBJ(udg_MultiBoard,1,1,false,false)call MultiboardSetItemValueBJ(udg_MultiBoard,2,1,"Игрок")call MultiboardSetItemValueBJ(udg_MultiBoard,3,1,(udg_ColorString[20]+("Убийств|r")))
call MultiboardSetItemValueBJ(udg_MultiBoard,4,1,(udg_ColorString[21]+("Cмертей|r")))call MultiboardSetItemValueBJ(udg_MultiBoard,5,1,(udg_ColorString[24]+("Помощи|r")))call MultiboardSetItemValueBJ(udg_MultiBoard,6,1,(udg_ColorString[22]+("Уровень|r")))
call MultiboardSetItemIconBJ(udg_MultiBoard,7,1,"UI\\Feedback\\Resources\\ResourceGold.blp")
set bj_forLoopAIndex=1set bj_forLoopAIndexEnd=(udg_CountPlayers+3)
loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEndcall MultiboardSetItemWidthBJ(udg_MultiBoard,1,bj_forLoopAIndex,2.)call MultiboardSetItemWidthBJ(udg_MultiBoard,2,bj_forLoopAIndex,10.)
call MultiboardSetItemWidthBJ(udg_MultiBoard,3,bj_forLoopAIndex,6.)call MultiboardSetItemWidthBJ(udg_MultiBoard,4,bj_forLoopAIndex,6.)call MultiboardSetItemWidthBJ(udg_MultiBoard,5,bj_forLoopAIndex,6.)call MultiboardSetItemWidthBJ(udg_MultiBoard,6,bj_forLoopAIndex,6.)call MultiboardSetItemWidthBJ(udg_MultiBoard,7,bj_forLoopAIndex,4.)call MultiboardSetItemStyleBJ(udg_MultiBoard,1,bj_forLoopAIndex,false,true)call MultiboardSetItemStyleBJ(udg_MultiBoard,2,bj_forLoopAIndex,true,false)call MultiboardSetItemStyleBJ(udg_MultiBoard,3,bj_forLoopAIndex,true,false)call MultiboardSetItemStyleBJ(udg_MultiBoard,4,bj_forLoopAIndex,true,false)call MultiboardSetItemStyleBJ(udg_MultiBoard,5,bj_forLoopAIndex,true,false)call MultiboardSetItemStyleBJ(udg_MultiBoard,6,bj_forLoopAIndex,true,false)call MultiboardSetItemStyleBJ(udg_MultiBoard,7,bj_forLoopAIndex,true,false)call MultiboardSetItemIconBJ(udg_MultiBoard,1,bj_forLoopAIndex,"ReplaceableTextures\\CommandButtons\\BTNSelectHeroOn.blp")set bj_forLoopAIndex=bj_forLoopAIndex+1endloopcall MultiboardSetItemStyleBJ(udg_MultiBoard,7,1,false,true)
call MultiboardSetItemStyleBJ(udg_MultiBoard,1,1,false,false)call MultiboardSetItemStyleBJ(udg_MultiBoard,1,(udg_CountPlayers+2),false,true)call MultiboardSetItemStyleBJ(udg_MultiBoard,2,(udg_CountPlayers+2),true,false)call MultiboardSetItemIconBJ(udg_MultiBoard,1,(udg_CountPlayers+2),"ReplaceableTextures\\CommandButtons\\ClockTime.blp")
call MultiboardSetItemValueBJ(udg_MultiBoard,2,(udg_CountPlayers+2),"|cff00CD00Время Игры|r")call MultiboardSetItemStyleBJ(udg_MultiBoard,1,(udg_CountPlayers+3),false,false)
call MultiboardSetItemStyleBJ(udg_MultiBoard,2,(udg_CountPlayers+3),true,false)call MultiboardSetItemIconBJ(udg_MultiBoard,1,(udg_CountPlayers+2),"ReplaceableTextures\\CommandButtons\\ClockTime.blp")
call MultiboardSetItemValueBJ(udg_MultiBoard,2,(udg_CountPlayers+3),"|cff99ccffПрогресс волны:|r")call MultiboardSetItemValueBJ(udg_MultiBoard,3,(udg_CountPlayers+3),"|Cfffed3120|r|cFF969696/|r|Cfffed3129|r")call ForForce(udg_Players_Ally_Group,function Trig_Initialization_MultiBoard_Func029A)call MultiboardDisplay(udg_MultiBoard,false)
call MultiboardDisplay(udg_MultiBoard,true)call MultiboardMinimize(udg_MultiBoard,true)
endfunctionfunction InitTrig_Initialization_MultiBoard takes nothing returns nothingset gg_trg_Initialization_MultiBoard=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Initialization_MultiBoard,3.)call TriggerAddAction(gg_trg_Initialization_MultiBoard,function Trig_Initialization_MultiBoard_Actions)endfunctionfunction Trig_Hero_MultiBoard_LvlUp_Conditions takes nothing returns boolean
return((IsUnitType(GetLevelingUnit(),UNIT_TYPE_HERO))and(IsUnitIllusion(GetLevelingUnit())==false)and((1+GetPlayerId(GetOwningPlayer(GetLevelingUnit())))<=9))!=null
endfunctionfunction Trig_Hero_MultiBoard_LvlUp_Actions takes nothing returns nothingcall MultiboardSetItemValueBJ(udg_MultiBoard,6,udg_PlayerNumberInMB[(1+GetPlayerId(GetOwningPlayer(GetLevelingUnit())))],(udg_ColorString[22]+(I2S(GetUnitLevel(GetLevelingUnit()))+"|r")))endfunctionfunction InitTrig_Hero_MultiBoard_LvlUp takes nothing returns nothingset gg_trg_Hero_MultiBoard_LvlUp=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Hero_MultiBoard_LvlUp,EVENT_PLAYER_HERO_LEVEL)
call TriggerAddCondition(gg_trg_Hero_MultiBoard_LvlUp,Condition(function Trig_Hero_MultiBoard_LvlUp_Conditions))
call TriggerAddAction(gg_trg_Hero_MultiBoard_LvlUp,function Trig_Hero_MultiBoard_LvlUp_Actions)endfunctionfunction Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func002C takes nothing returns booleanreturn(udg_Time_second>=60)endfunctionfunction Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func003C takes nothing returns booleanreturn(udg_Time_minuts>=60)endfunctionfunction Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func004C takes nothing returns booleanreturn(udg_Time_hours>0)
endfunctionfunction Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func005A takes nothing returns nothingcall MultiboardSetItemValueBJ(udg_MultiBoard,7,udg_PlayerNumberInMB[(1+GetPlayerId(GetEnumPlayer()))],(udg_ColorString[23]+(I2S(GetPlayerState(GetEnumPlayer(),PLAYER_STATE_RESOURCE_GOLD))+"|r")))endfunctionfunction Trig_Time_Check_and_Player_Gold_for_MultiBoard_Actions takes nothing returns nothingset udg_Time_second=(udg_Time_second+1)if(Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func002C())thenset udg_Time_minuts=(udg_Time_minuts+1)set udg_Time_second=0endifif(Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func003C())thenset udg_Time_hours=(udg_Time_hours+1)set udg_Time_minuts=0endifif(Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func004C())thencall MultiboardSetItemValueBJ(udg_MultiBoard,3,(udg_CountPlayers+2),(("|cff00CD00"+(I2S(udg_Time_hours)+":"))+(I2S(udg_Time_minuts)+(":"+(I2S(udg_Time_second)+"|r")))))
else
call MultiboardSetItemValueBJ(udg_MultiBoard,3,(udg_CountPlayers+2),("|cff00CD00"+(I2S(udg_Time_minuts)+(":"+(I2S(udg_Time_second)+"|r")))))
endifcall ForForce(udg_Players_Ally_Group,function Trig_Time_Check_and_Player_Gold_for_MultiBoard_Func005A)endfunctionfunction InitTrig_Time_Check_and_Player_Gold_for_MultiBoard takes nothing returns nothingset gg_trg_Time_Check_and_Player_Gold_for_MultiBoard=CreateTrigger()
call TriggerRegisterTimerEventPeriodic(gg_trg_Time_Check_and_Player_Gold_for_MultiBoard,1.)call TriggerAddAction(gg_trg_Time_Check_and_Player_Gold_for_MultiBoard,function Trig_Time_Check_and_Player_Gold_for_MultiBoard_Actions)endfunctionfunction Trig_Reincarnation_Skeletons_Conditions takes nothing returns booleanlocal integer id=GetUnitTypeId(GetDyingUnit())return IsUnitIllusion(GetDyingUnit())==false and GetRandomInt(1,7)==1 and(id=='u001' or id=='u002' or id=='u003')endfunctionfunction Trig_Reincarnation_Skeletons_2sec_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,6)call PauseUnit(u,false)if GetUnitState(u,UNIT_STATE_LIFE)>=.405 thencall SetUnitAnimation(u,"stand")
call IssuePointOrderById(u,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))
endifset u=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_Reincarnation_Skeletons_3sec_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer id=LoadInteger(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local player p=LoadPlayerHandle(udg_hash,h,4)local real face=LoadReal(udg_hash,h,5)local unit u=CreateUnit(p,id,x,y,face)call SaveUnitHandle(udg_hash,h,6,u)call PauseUnit(u,true)call SetUnitAnimation(u,"Birth")
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",GetUnitX(u),GetUnitY(u)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",GetUnitX(u),GetUnitY(u)))call TimerStart(t,2.33,false,function Trig_Reincarnation_Skeletons_2sec_Actions)
set t=nullset p=nullset u=nullendfunctionfunction Trig_Reincarnation_Skeletons_Actions takes nothing returns nothinglocal unit u=GetDyingUnit()local integer id=GetUnitTypeId(u)local real x=GetUnitX(u)
local real y=GetUnitY(u)
local player p=GetOwningPlayer(u)local real face=GetUnitFacing(u)
local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveInteger(udg_hash,h,1,id)call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SavePlayerHandle(udg_hash,h,4,p)call SaveReal(udg_hash,h,5,face)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",x,y))call TimerStart(t,3.,false,function Trig_Reincarnation_Skeletons_3sec_Actions)set u=nullset p=nullset t=nullendfunctionfunction InitTrig_Reincarnation_Skeletons takes nothing returns nothinglocal integer index=0set gg_trg_Reincarnation_Skeletons=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Reincarnation_Skeletons,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Reincarnation_Skeletons,Condition(function Trig_Reincarnation_Skeletons_Conditions))
call TriggerAddAction(gg_trg_Reincarnation_Skeletons,function Trig_Reincarnation_Skeletons_Actions)endfunctionfunction Trig_BossSkeletRaise2sec_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,20)local unit skeletlocal integer lop=0local real xr=GetRectCenterX(gg_rct_cast_magi)local real yr=GetRectCenterY(gg_rct_cast_magi)call PauseUnit(caster,false)
call SetUnitTimeScale(caster,1.)
if GetUnitState(caster,UNIT_STATE_LIFE)>=.405 thencall SetUnitAnimation(caster,"stand")call IssuePointOrderById(caster,$D000F,xr,yr)endifloop
exitwhen lop>$Fset skelet=LoadUnitHandle(udg_hash,h,lop)call PauseUnit(skelet,false)
if GetUnitState(skelet,UNIT_STATE_LIFE)>=.405 thencall SetUnitAnimation(skelet,"stand")call IssuePointOrderById(skelet,$D000F,xr,yr)endifset skelet=nullset lop=lop+1endloopset caster=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_BossSkeletRaiseMiniWait_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,20)local player p=GetOwningPlayer(caster)local unit target=LoadUnitHandle(udg_hash,h,21)local real x=GetUnitX(target)local real y=GetUnitY(target)local integer lop=0local unit skeletcall SetUnitAnimationByIndex(caster,3)call SetUnitTimeScale(caster,3.25)call PauseUnit(caster,true)loop
exitwhen lop>$Fset skelet=CreateUnit(p,'u001',x+250.*Cos((lop*22.5)*bj_DEGTORAD),y+250.*Sin((lop*22.5)*bj_DEGTORAD),$B4+lop*22.5)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",x+250.*Cos((lop*22.5)*bj_DEGTORAD),y+250.*Sin((lop*22.5)*bj_DEGTORAD)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",x+250.*Cos((lop*22.5)*bj_DEGTORAD),y+250.*Sin((lop*22.5)*bj_DEGTORAD)))
call SetUnitAnimation(skelet,"Birth")call PauseUnit(skelet,true)call SaveUnitHandle(udg_hash,h,lop,skelet)set skelet=nullset lop=lop+1endloopcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl",x,y))call TimerStart(t,2.33,false,function Trig_BossSkeletRaise2sec_Actions)set caster=nullset p=nullset target=nullset t=nullendfunctionfunction Trig_BossSkeletRaise_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,20,caster)call SaveUnitHandle(udg_hash,h,21,target)call TimerStart(t,.3,false,function Trig_BossSkeletRaiseMiniWait_Actions)set caster=nullset target=nullset t=nullendfunctionfunction Trig_BossSkeletRaise_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A07M'endfunctionfunction InitTrig_BossSkeletRaise takes nothing returns nothinglocal integer index=0set gg_trg_BossSkeletRaise=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BossSkeletRaise,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BossSkeletRaise,Condition(function Trig_BossSkeletRaise_Conditions))
call TriggerAddAction(gg_trg_BossSkeletRaise,function Trig_BossSkeletRaise_Actions)endfunctionfunction Trig_BossSkeletSkillActiv_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetTriggerUnit())=='n00K'endfunctionfunction Trig_BossSkeletSkillActiv_Actions takes nothing returns nothing
call IssueTargetOrderById(GetTriggerUnit(),$D007F,GetAttacker())
endfunctionfunction InitTrig_BossSkeletSkillActiv takes nothing returns nothing
local integer index=0set gg_trg_BossSkeletSkillActiv=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BossSkeletSkillActiv,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BossSkeletSkillActiv,Condition(function Trig_BossSkeletSkillActiv_Conditions))call TriggerAddAction(gg_trg_BossSkeletSkillActiv,function Trig_BossSkeletSkillActiv_Actions)endfunctionfunction Trig_Fire_Arrow_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,5)local unit orb=LoadUnitHandle(udg_hash,h,3)local effect eflocal real x=GetUnitX(orb)local real y=GetUnitY(orb)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real xorblocal real yorblocal real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local player plocal real damagelocal unit dammi
local boolean destroy=falseset xorb=x+24.*Cos(angle*bj_DEGTORAD)set yorb=y+24.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(orb,xorb,yorb)set dist=SquareRoot((xt-xorb)*(xt-xorb)+(yt-yorb)*(yt-yorb))
call SetUnitFacing(orb,angle)if GetUnitState(target,UNIT_STATE_LIFE)<.405 thenset destroy=true
endifif dist<20. and GetUnitState(target,UNIT_STATE_LIFE)>.405 thencall SetUnitPosition(orb,xt,yt)set p=GetOwningPlayer(caster)set damage=LoadReal(udg_hash,h,2)if GetUnitState(target,UNIT_STATE_LIFE)>.0 and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(target)!='h00U' then
call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIfb\\AIfbSpecialArt.mdl",target,"chest"))set dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0NG')call IssueTargetOrderById(dammi,$D02B6,target)set dammi=nullendifset p=nullset destroy=true
endifif destroy thencall KillUnit(orb)set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset orb=null
set target=nullendfunctionfunction Trig_Fire_Arrow_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real damage=25.local unit orb=CreateUnit(p,'h00U',x,y,angle)local effect ef=AddSpecialEffectTarget("Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl",orb,"origin")
local timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitX(orb,x+30.*Cos((angle)*bj_DEGTORAD))call SetUnitY(orb,y+30.*Sin((angle)*bj_DEGTORAD))call SetUnitFlyHeight(orb,60.,.0)call SetUnitScale(orb,1.2,1.2,1.2)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveUnitHandle(udg_hash,h,3,orb)call SaveEffectHandle(udg_hash,h,4,ef)call SaveUnitHandle(udg_hash,h,5,target)
call TimerStart(t,.03,true,function Trig_Fire_Arrow_Move_Actions)set caster=nullset t=nullset orb=null
set ef=nullset p=nullset target=nullendfunctionfunction Trig_Fire_Arrow_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NF'endfunctionfunction InitTrig_Fire_Arrow takes nothing returns nothinglocal integer index=0set gg_trg_Fire_Arrow=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Arrow,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Arrow,Condition(function Trig_Fire_Arrow_Conditions))call TriggerAddAction(gg_trg_Fire_Arrow,function Trig_Fire_Arrow_Actions)endfunctionfunction Trig_Use_UnholyFrenzy_and_Fire_Arrow_Loop_Is_Enemy_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerEnemy(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_UnholyFrenzy_and_Fire_Arrow_Loop_Is_Ally_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerAlly(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_UnholyFrenzy_and_Fire_Arrow_All_Condition takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_UnholyFrenzy_and_Fire_Arrow_Actions takes nothing returns nothinglocal group gall=CreateGroup()local group glocal group g2local unit Pickedlocal unit targetlocal real x
local real y
call GroupEnumUnitsInRect(gall,bj_mapInitialPlayableArea,Condition(function Trig_Use_UnholyFrenzy_and_Fire_Arrow_All_Condition))
set g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08S')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_UnholyFrenzy_and_Fire_Arrow_Loop_Is_Ally_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0085,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0NF')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,575.,Condition(function Trig_Use_UnholyFrenzy_and_Fire_Arrow_Loop_Is_Enemy_Condition))
call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00C1,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gall)call DestroyGroup(gall)set gall=nullendfunctionfunction Trig_Use_UnholyFrenzy_and_Fire_Arrow_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==1)
endfunctionfunction InitTrig_Use_UnholyFrenzy_and_Fire_Arrow takes nothing returns nothingset gg_trg_Use_UnholyFrenzy_and_Fire_Arrow=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Use_UnholyFrenzy_and_Fire_Arrow,1.,true)call TriggerAddCondition(gg_trg_Use_UnholyFrenzy_and_Fire_Arrow,Condition(function Trig_Use_UnholyFrenzy_and_Fire_Arrow_Conditions))
call TriggerAddAction(gg_trg_Use_UnholyFrenzy_and_Fire_Arrow,function Trig_Use_UnholyFrenzy_and_Fire_Arrow_Actions)endfunctionfunction Trig_Create_Tombstone_Wait_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit tomb=LoadUnitHandle(udg_hash,h,1)
local effect ef=LoadEffectHandle(udg_hash,h,2)local real angle=LoadReal(udg_hash,h,3)local real x=GetUnitX(tomb)local real y=GetUnitY(tomb)local unit zombie=CreateUnit(GetOwningPlayer(tomb),'n00H',x,y,angle)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl",x,y))call IssuePointOrderById(zombie,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))call KillUnit(tomb)call DestroyEffect(ef)set ef=nullcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set tomb=nullset zombie=nullset t=nullendfunctionfunction Trig_Create_Tombstone_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real angle=GetRandomReal(-45.,45.)+270.local unit tomb=CreateUnit(p,'h00E',xt,yt,angle)
local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Graveyard\\GraveMarker.mdl",tomb,"origin")local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,tomb)call SaveEffectHandle(udg_hash,h,2,ef)call SaveReal(udg_hash,h,3,angle)call TimerStart(t,4.,false,function Trig_Create_Tombstone_Wait_Actions)set caster=nullset t=nullset tomb=nullset ef=nullset p=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Create_Tombstone_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0O3'endfunctionfunction InitTrig_Create_Tombstone takes nothing returns nothing
local integer index=0set gg_trg_Create_Tombstone=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Create_Tombstone,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Create_Tombstone,Condition(function Trig_Create_Tombstone_Conditions))call TriggerAddAction(gg_trg_Create_Tombstone,function Trig_Create_Tombstone_Actions)endfunctionfunction Trig_ZombieExploadDeathMove_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit meat=LoadUnitHandle(udg_hash,h,1)
local unit target=LoadUnitHandle(udg_hash,h,2)local effect eflocal real xm=GetUnitX(meat)
local real ym=GetUnitY(meat)
local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-ym,xt-xm)local real dist=SquareRoot((xt-xm)*(xt-xm)+(yt-ym)*(yt-ym))if dist<20. or GetUnitState(target,UNIT_STATE_LIFE)<.405 thenif GetOwningPlayer(meat)==GetOwningPlayer(target)thencall SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+60.)else
call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)-25.)endifset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)call KillUnit(meat)set ef=nullset meat=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullelse
if IsTerrainPathable(xm+20.*Cos(angle*bj_DEGTORAD),ym+20.*Sin(angle*bj_DEGTORAD),PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(meat,xm+20.*Cos(angle*bj_DEGTORAD),ym+20.*Sin(angle*bj_DEGTORAD))endifendifset meat=nullset target=nullset t=nullendfunctionfunction Trig_ZombieExploadDeath_Actions takes nothing returns nothinglocal unit zomb=GetDyingUnit()local real x=GetUnitX(zomb)local real y=GetUnitY(zomb)local player p=GetOwningPlayer(zomb)
local timer tlocal integer hlocal group g=CreateGroup()local group grup=CreateGroup()local unit Pickedlocal integer count=0local unit meatlocal effect efcall DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Demon\\DemonLargeDeathExplode\\DemonLargeDeathExplode.mdl",x,y))call GroupEnumUnitsInRange(g,x,y,325.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==null or count>3
if GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call GroupAddUnit(grup,Picked)set count=count+1endifcall GroupRemoveUnit(g,Picked)endloopcall RandomUnitFromGroup(3,grup)
call GroupClear(g)call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set Picked=nullloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullset meat=CreateUnit(p,'h00U',x,y,.0)
call SetUnitTimeScale(meat,2.)set ef=AddSpecialEffectTarget("Abilities\\Weapons\\MeatwagonMissile\\MeatwagonMissile.mdl",meat,"chest")
set t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,meat)call SaveUnitHandle(udg_hash,h,2,Picked)
call SaveEffectHandle(udg_hash,h,3,ef)call TimerStart(t,.04,true,function Trig_ZombieExploadDeathMove_Actions)
set ef=nullset t=nullset meat=nullcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullset meat=nullset ef=nullset t=nullset p=nullset zomb=nullset Picked=nullendfunctionfunction Trig_ZombieExploadDeath_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetDyingUnit())=='n00H' and GetRandomInt(1,$A)<=5endfunctionfunction InitTrig_ZombieExploadDeath takes nothing returns nothinglocal integer index=0set gg_trg_ZombieExploadDeath=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ZombieExploadDeath,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_ZombieExploadDeath,Condition(function Trig_ZombieExploadDeath_Conditions))call TriggerAddAction(gg_trg_ZombieExploadDeath,function Trig_ZombieExploadDeath_Actions)endfunctionfunction Trig_Damned_Soul_move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit soul=LoadUnitHandle(udg_hash,h,1)
local group g=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local real angle=LoadReal(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local unit caster=LoadUnitHandle(udg_hash,h,6)local player p=GetOwningPlayer(caster)local real x=GetUnitX(soul)+14.*Cos(angle*bj_DEGTORAD)local real y=GetUnitY(soul)+14.*Sin(angle*bj_DEGTORAD)local effect eflocal group grup=CreateGroup()local unit Pickedlocal unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(soul,x,y)endifcall GroupEnumUnitsInRange(grup,x,y,125.,null)loop
set Picked=FirstOfGroup(grup)exitwhen Picked==nullif(IsUnitInGroup(Picked,udg_PortalCastersMagi)==false)and IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitInGroup(Picked,g)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',.5)
call UnitAddAbility(dammi,'A0OA')call IssueTargetOrderById(dammi,$D02BC,Picked)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GargoyleMissile\\GargoyleMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl",Picked,"chest"))
call GroupAddUnit(g,Picked)endifcall GroupRemoveUnit(grup,Picked)endloopcall SaveGroupHandle(udg_hash,h,2,g)
else
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',2.5)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitScale(dammi,1.2,1.2,1.2)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Possession\\PossessionMissile.mdl",dammi,"origin"))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",x,y))set dammi=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall KillUnit(soul)call RemoveUnit(soul)call GroupClear(g)call DestroyGroup(g)
set g=nullendifset Picked=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullset t=nullset soul=nullset g=nullset dammi=nullset caster=nullset p=nullendfunctionfunction Trig_Damned_Soul_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local location loclocal real xtlocal real ytlocal unit soullocal group g=CreateGroup()local real damage=50.local integer wait=50local effect eflocal real angle
if GetSpellTargetUnit()==null thenset loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
call RemoveLocation(loc)
set loc=null
else
set xt=GetUnitX(GetSpellTargetUnit())set yt=GetUnitY(GetSpellTargetUnit())endifset angle=bj_RADTODEG*Atan2(yt-y,xt-x)set soul=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,angle)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Possession\\PossessionMissile.mdl",soul,"origin")call UnitAddAbility(soul,'Amrf')
call UnitRemoveAbility(soul,'Amrf')call SetUnitScale(soul,1.2,1.2,1.2)call SetUnitFlyHeight(soul,80,.0)call SaveUnitHandle(udg_hash,h,1,soul)call SaveGroupHandle(udg_hash,h,2,g)
call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,angle)call SaveInteger(udg_hash,h,5,wait)call SaveUnitHandle(udg_hash,h,6,caster)
call SaveEffectHandle(udg_hash,h,7,ef)call TimerStart(t,.03,true,function Trig_Damned_Soul_move_Actions)set caster=nullset t=nullset soul=nullset g=nullset ef=nullendfunctionfunction Trig_Damned_Soul_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0O9'endfunctionfunction InitTrig_Damned_Soul takes nothing returns nothinglocal integer index=0set gg_trg_Damned_Soul=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Damned_Soul,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Damned_Soul,Condition(function Trig_Damned_Soul_Conditions))
call TriggerAddAction(gg_trg_Damned_Soul,function Trig_Damned_Soul_Actions)endfunctionfunction Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerEnemy(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Ally_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerAlly(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_PowerofHorror_and_Curse_and_Slam_All_Condition takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_PowerofHorror_and_Curse_and_Slam_Actions takes nothing returns nothing
local group gall=CreateGroup()local group glocal group g2local unit Pickedlocal unit targetlocal real x
local real y
local real distlocal real angle
call GroupEnumUnitsInRect(gall,bj_mapInitialPlayableArea,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_All_Condition))set g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A07X')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00DE,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08B')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,575.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Ally_Condition))
call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0062,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08C')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0062,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08F')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,300.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueImmediateOrderById(Picked,$D011D)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08S')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Ally_Condition))
call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00F1,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullif GetRandomInt(1,40)==1 and(udg_Is_Fast_Wave_Start_On_Off==false)thenset g2=CreateGroup()
call GroupAddGroup(udg_Gruppa_HeroUnitov_Geroev,g2)loop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullset target=CreateUnit(Player(9),'h00E',GetUnitX(Picked),GetUnitY(Picked),270.)set dist=GetRandomReal(100.,125.)set angle=GetRandomReal(.0,360.)
call UnitAddAbility(target,'A0O3')call UnitApplyTimedLife(target,'BTLF',2.)call IssuePointOrderById(target,$D00FA,GetUnitX(Picked)+dist*Cos(angle*bj_DEGTORAD),GetUnitY(Picked)+dist*Sin(angle*bj_DEGTORAD))set target=nullcall GroupRemoveUnit(g2,Picked)endloopcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset Picked=nullendifset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0O9')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00FA,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0PI')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,700.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D021B,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08F')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,200.,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueImmediateOrderById(Picked,$D00FB)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gall)call DestroyGroup(gall)set gall=nullendfunctionfunction Trig_Use_PowerofHorror_and_Curse_and_Slam_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==2)
endfunctionfunction InitTrig_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul takes nothing returns nothing
set gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul,1.,true)call TriggerAddCondition(gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Conditions))call TriggerAddAction(gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul,function Trig_Use_PowerofHorror_and_Curse_and_Slam_Actions)endfunctionfunction Trig_Throw_Meat_Move2_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,1)call PauseUnit(u,false)if GetUnitState(u,UNIT_STATE_LIFE)>=.405 thencall SetUnitAnimation(u,"stand")
call IssuePointOrderById(u,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))
endifset u=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_Throw_Meat_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit casterlocal unit target=LoadUnitHandle(udg_hash,h,4)local real damagelocal real stuntimelocal real angle
local unit dagger=LoadUnitHandle(udg_hash,h,7)local real x=GetUnitX(dagger)local real y=GetUnitY(dagger)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real distlocal unit zombielocal integer h2
local timer t2set angle=bj_RADTODEG*Atan2(yt-y,xt-x)set dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))
call SetUnitPosition(dagger,x+21.*Cos((angle)*bj_DEGTORAD),y+21.*Sin((angle)*bj_DEGTORAD))if dist<50. or GetUnitState(target,UNIT_STATE_LIFE)<.405 thenset caster=LoadUnitHandle(udg_hash,h,1)set damage=LoadReal(udg_hash,h,2)set stuntime=LoadReal(udg_hash,h,3)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\MeatwagonMissile\\MeatwagonMissile.mdl",target,"chest"))call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(target,stuntime)call DestroyEffect(LoadEffectHandle(udg_hash,h,8))set zombie=CreateUnit(GetOwningPlayer(caster),'n00H',xt+GetRandomReal(30.,100.),yt+GetRandomReal(30.,100.),GetRandomReal(.0,360.))set t2=CreateTimer()
set h2=GetHandleId(t2)call PauseUnit(zombie,true)call SetUnitAnimation(zombie,"Birth")call SaveUnitHandle(udg_hash,h2,1,zombie)call TimerStart(t2,2.33,false,function Trig_Throw_Meat_Move2_Actions)set t2=nullset zombie=nullcall RemoveUnit(dagger)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set caster=nullendifset t=nullset target=nullset dagger=nullendfunctionfunction Trig_Throw_Meat_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real tx=GetUnitX(target)local real ty=GetUnitY(target)local real damage=100.local real stuntime=2.local real angle
local real distlocal unit daggerlocal timer t=CreateTimer()local integer h=GetHandleId(t)local effect efset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
set dagger=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,angle)call SetUnitX(dagger,x+150.*Cos((angle+90.)*bj_DEGTORAD))call SetUnitY(dagger,y+150.*Sin((angle+90.)*bj_DEGTORAD))call UnitAddAbility(dagger,'Amrf')call UnitRemoveAbility(dagger,'Amrf')call SetUnitScale(dagger,1.5,1.5,1.5)call SetUnitPathing(dagger,false)call SetUnitFlyHeight(dagger,200.,.0)call SetUnitFlyHeight(dagger,25.,(($AF*700)/ dist))set ef=AddSpecialEffectTarget("Abilities\\Weapons\\MeatwagonMissile\\MeatwagonMissile.mdl",dagger,"origin")call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveReal(udg_hash,h,3,stuntime)
call SaveUnitHandle(udg_hash,h,4,target)
call SaveUnitHandle(udg_hash,h,7,dagger)
call SaveEffectHandle(udg_hash,h,8,ef)call TimerStart(t,.03,true,function Trig_Throw_Meat_Move_Actions)set caster=nullset target=nullset t=nullset dagger=nullset ef=nullendfunctionfunction Trig_Throw_Meat_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0PI'endfunctionfunction InitTrig_Throw_Meat takes nothing returns nothinglocal integer index=0set gg_trg_Throw_Meat=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Throw_Meat,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Throw_Meat,Condition(function Trig_Throw_Meat_Conditions))call TriggerAddAction(gg_trg_Throw_Meat,function Trig_Throw_Meat_Actions)endfunctionfunction Trig_Earth_Clap_WAIT_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit dammi
local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local player p=GetOwningPlayer(caster)local real damage=100.local group g=CreateGroup()local unit Pickedcall GroupEnumUnitsInRange(g,xc,yc,200.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitInGroup(Picked,udg_PortalCastersMagi)==false)and IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0FE')call IssueTargetOrderById(dammi,$D006B,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopcall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",xc,yc))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set caster=nullset t=nullset dammi=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullendfunctionfunction Trig_Earth_Clap_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,caster)
call TimerStart(t,.5,false,function Trig_Earth_Clap_WAIT_Actions)set caster=nullset t=nullendfunctionfunction Trig_Earth_Clap_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A08F'endfunctionfunction InitTrig_Earth_Clap takes nothing returns nothinglocal integer index=0set gg_trg_Earth_Clap=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Earth_Clap,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Earth_Clap,Condition(function Trig_Earth_Clap_Conditions))call TriggerAddAction(gg_trg_Earth_Clap,function Trig_Earth_Clap_Actions)endfunctionfunction Trig_Ghoul_Jump_Move_Dest_Actions takes nothing returns nothing
call KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Ghoul_Jump_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,5)
local real face=LoadReal(udg_hash,h,6)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local rect r
if wait>0 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 then
set wait=wait-1call SaveInteger(udg_hash,h,5,wait)call SetUnitFacing(caster,face)else
call SetUnitAnimation(caster,"stand")set r=Rect(x-100.,y-100.,x+100.,y+100.)call EnumDestructablesInRect(r,null,function Trig_Ghoul_Jump_Move_Dest_Actions)call SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call RemoveRect(r)set r=nullendifset t=nullset caster=nullendfunctionfunction Trig_Ghoul_Jump_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,$A)if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
set time=dist/ 500.call SetUnitTimeScale(caster,(1/ time))call MoveUnit(caster,time,500.,.0,angle,(dist/ 3),true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,5,R2I(dist/ 15.))call SaveReal(udg_hash,h,6,angle)call TimerStart(t,.03,true,function Trig_Ghoul_Jump_Move_Actions)set caster=nullset target=nullcall RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Ghoul_Jump_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NH'endfunctionfunction InitTrig_Ghoul_Jump takes nothing returns nothinglocal integer index=0set gg_trg_Ghoul_Jump=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ghoul_Jump,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ghoul_Jump,Condition(function Trig_Ghoul_Jump_Conditions))call TriggerAddAction(gg_trg_Ghoul_Jump,function Trig_Ghoul_Jump_Actions)endfunctionfunction Trig_BurrowStrike_Move_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_BurrowStrike_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local integer wait3=LoadInteger(udg_hash,h,3)local integer wait2=LoadInteger(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local real face=LoadReal(udg_hash,h,6)local real time=LoadReal(udg_hash,h,7)local integer rewait=LoadInteger(udg_hash,h,8)local integer impale=LoadInteger(udg_hash,h,9)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local player p=GetOwningPlayer(caster)local group glocal unit Pickedlocal real angle
local real angle2local unit dammi
local boolean alife=true
local rect r
local unit dammiefif GetUnitState(caster,UNIT_STATE_LIFE)<.405 thenset alife=falseendifif wait3>0 thenset wait3=wait3-1call SaveInteger(udg_hash,h,3,wait3)
endifif wait3<=0 and wait>0 thenif wait==rewait then
call MoveUnit(caster,time,400.,.0,face,.0,true)call PauseUnit(caster,true)endifset wait=wait-1call SaveInteger(udg_hash,h,5,wait)if impale<5 then
set impale=impale+1else
set impale=0
set dammief=CreateUnit(p,'h00U',x+100.*Cos(face*bj_DEGTORAD),y+100.*Sin(face*bj_DEGTORAD),GetRandomReal(.0,360.))call UnitApplyTimedLife(dammief,'BTLF',1.)call SetUnitScale(dammief,2.,2.,2.5)
call DestroyEffect(AddSpecialEffectTarget("Effects\\ImpaleMissTarget.mdl",dammief,"origin"))
set dammief=null
endifcall SaveInteger(udg_hash,h,9,impale)set r=Rect(x-100.,y-100.,x+100.,y+100.)set g=CreateGroup()call EnumDestructablesInRect(r,null,function Trig_BurrowStrike_Move_Dest_Actions)call GroupEnumUnitsInRange(g,x,y,125.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A01U')call IssueTargetOrderById(dammi,$D007F,Picked)set dammi=nullif GetOwningPlayer(Picked)!=Player($F)thenset angle=bj_RADTODEG*Atan2(GetUnitY(Picked)-y,GetUnitX(Picked)-x)set angle2=(Atan2(y-GetUnitY(Picked),x-GetUnitX(Picked))*bj_RADTODEG)+360.if(angle2<=(GetUnitFacing(caster)+210.)and angle2>=(GetUnitFacing(caster)+180.))then
set angle=angle+30.endifif(angle2<=(GetUnitFacing(caster)+180.)and angle2>=(GetUnitFacing(caster)+150.))then
set angle=angle-30.endifcall MoveUnit(Picked,1.,400.,400.,angle,200.,false)endifendifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RemoveRect(r)set r=nullset Picked=nullcall SaveGroupHandle(udg_hash,h,2,gdamage)endifif wait<=0 and wait2>0 thenif wait2==$F thencall SetUnitAnimationByIndex(caster,$A)endifset wait2=wait2-1call SaveInteger(udg_hash,h,4,wait2)
endifif wait2<=0 or alife==false then
if alife thencall SetUnitAnimation(caster,"stand")endifcall PauseUnit(caster,false)
call SetUnitPathing(caster,true)
call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset gdamage=null
set p=nullset Picked=nullset dammi=nullendfunctionfunction Trig_BurrowStrike_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer waitlocal integer wait2=27local integer wait3=30local integer impale=0call SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,8)call SetUnitTimeScale(caster,1.)
call UnitPeriodicPostionMove(caster,.03,.5)if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
if target==caster thenset angle=GetUnitFacing(caster)set dist=800.endifset time=dist/ 400.set wait=R2I(dist/ 12.)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveInteger(udg_hash,h,3,wait3)
call SaveInteger(udg_hash,h,4,wait2)
call SaveInteger(udg_hash,h,5,wait)call SaveReal(udg_hash,h,6,angle)call SaveReal(udg_hash,h,7,time)
call SaveInteger(udg_hash,h,8,wait)call SaveInteger(udg_hash,h,9,impale)call TimerStart(t,.03,true,function Trig_BurrowStrike_Move_Actions)call SetUnitAnimationByIndex(caster,8)call PauseUnit(caster,true)call SetUnitAnimationByIndex(caster,8)set caster=nullset target=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_BurrowStrike_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NO'endfunctionfunction InitTrig_BurrowStrike takes nothing returns nothing
local integer index=0set gg_trg_BurrowStrike=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BurrowStrike,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BurrowStrike,Condition(function Trig_BurrowStrike_Conditions))call TriggerAddAction(gg_trg_BurrowStrike,function Trig_BurrowStrike_Actions)endfunctionfunction Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Raise_Dead_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)<.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(GetUnitTypeId(GetFilterUnit())!='h00U'))!=nullendfunctionfunction Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Enemy_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerEnemy(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Ally_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerAlly(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_All_Condition takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Actions takes nothing returns nothinglocal group gall=CreateGroup()local group glocal group g2local unit Pickedlocal unit targetlocal real x
local real y
local real angle
call GroupEnumUnitsInRect(gall,bj_mapInitialPlayableArea,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_All_Condition))set g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A086')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Raise_Dead_Condition))
call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueImmediateOrderById(Picked,$D00E5)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08K')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,800.,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00FE,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08K')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,800.,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Ally_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00FE,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08M')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueImmediateOrderById(Picked,$D009E)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0NO')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,900.,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
set angle=bj_RADTODEG*Atan2(GetUnitY(target)-GetUnitY(Picked),GetUnitX(target)-GetUnitX(Picked))
call IssuePointOrderById(Picked,$D00FA,GetUnitX(target)+175.*Cos(angle*bj_DEGTORAD),GetUnitY(target)+175.*Sin(angle*bj_DEGTORAD))endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0NH')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,800.,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00FA,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gall)call DestroyGroup(gall)set gall=nullendfunctionfunction Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==3)
endfunctionfunction InitTrig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump takes nothing returns nothingset gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump,1.,true)
call TriggerAddCondition(gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Conditions))
call TriggerAddAction(gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump,function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Actions)endfunctionfunction Trig_BeetleCorpseBurrowCast_Actions takes nothing returns nothingcall IssueImmediateOrderById(GetTriggerUnit(),$D0235)endfunctionfunction Trig_BeetleCorpseBurrowCast_Conditions takes nothing returns booleanreturn(GetUnitTypeId(GetTriggerUnit())=='u004' or GetUnitTypeId(GetTriggerUnit())=='u00D')and 50.>(GetUnitState(GetTriggerUnit(),UNIT_STATE_LIFE)/ GetUnitState(GetTriggerUnit(),UNIT_STATE_MAX_LIFE)*'d')endfunctionfunction InitTrig_BeetleCorpseBurrowCast takes nothing returns nothinglocal integer index=0set gg_trg_BeetleCorpseBurrowCast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BeetleCorpseBurrowCast,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BeetleCorpseBurrowCast,Condition(function Trig_BeetleCorpseBurrowCast_Conditions))call TriggerAddAction(gg_trg_BeetleCorpseBurrowCast,function Trig_BeetleCorpseBurrowCast_Actions)endfunctionfunction Trig_BeetleCorpseBurrowAttackBase_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit beetle=LoadUnitHandle(udg_hash,h,1)call IssuePointOrderById(beetle,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset beetle=nullendfunctionfunction Trig_BeetleCorpseBurrowPeriodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit beetle=LoadUnitHandle(udg_hash,h,1)call SetUnitState(beetle,UNIT_STATE_MANA,GetUnitState(beetle,UNIT_STATE_MANA)+60.)call IssueImmediateOrderById(beetle,$D0236)call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\ImpaleTargetDust\\ImpaleTargetDust.mdl",GetUnitX(beetle),GetUnitY(beetle)))call TimerStart(t,1.75,false,function Trig_BeetleCorpseBurrowAttackBase_Actions)
set t=nullset beetle=nullendfunctionfunction Trig_BeetleCorpseBurrow_Actions takes nothing returns nothinglocal unit beetle=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,beetle)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\ImpaleTargetDust\\ImpaleTargetDust.mdl",GetUnitX(beetle),GetUnitY(beetle)))call TimerStart(t,GetRandomReal(3.5,7.5),false,function Trig_BeetleCorpseBurrowPeriodic_Actions)
set beetle=nullset t=nullendfunctionfunction Trig_BeetleCorpseBurrow_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A07Z' and GetUnitTypeId(GetSpellAbilityUnit())=='u004')or(GetSpellAbilityId()=='A081' and GetUnitTypeId(GetSpellAbilityUnit())=='u00D')
endfunctionfunction InitTrig_BeetleCorpseBurrow takes nothing returns nothinglocal integer index=0set gg_trg_BeetleCorpseBurrow=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BeetleCorpseBurrow,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BeetleCorpseBurrow,Condition(function Trig_BeetleCorpseBurrow_Conditions))call TriggerAddAction(gg_trg_BeetleCorpseBurrow,function Trig_BeetleCorpseBurrow_Actions)endfunctionfunction Trig_Cocoon_periodic_Creation_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit cocoon=LoadUnitHandle(udg_hash,h,1)local integer check=LoadInteger(udg_hash,h,2)local real scale=.75+(check*.0375)local unit spiderif check<20 and GetUnitState(cocoon,UNIT_STATE_LIFE)>.405 thenset check=check+1call SaveInteger(udg_hash,h,2,check)
call SetUnitScale(cocoon,scale,scale,scale)else
if check>=20 thenset spider=CreateUnit(GetOwningPlayer(cocoon),'n00R',GetUnitX(cocoon),GetUnitY(cocoon),GetUnitFacing(cocoon))call IssuePointOrderById(spider,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Demon\\DemonLargeDeathExplode\\DemonLargeDeathExplode.mdl",GetUnitX(cocoon),GetUnitY(cocoon)))set spider=nullendifcall KillUnit(cocoon)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set cocoon=nullset t=nullendifset t=nullset cocoon=nullendfunctionfunction Trig_Cocoon_Creation_Actions takes nothing returns nothinglocal unit spider=GetDyingUnit()
local real x=GetUnitX(spider)local real y=GetUnitY(spider)local unit cocoon=CreateUnit(GetOwningPlayer(spider),'n011',x,y,GetRandomReal(.0,360.))local timer t=CreateTimer()local integer h=GetHandleId(t)local integer check=0call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Demon\\DemonLargeDeathExplode\\DemonLargeDeathExplode.mdl",x,y))call SaveUnitHandle(udg_hash,h,1,cocoon)
call SaveInteger(udg_hash,h,2,check)
call TimerStart(t,.5,true,function Trig_Cocoon_periodic_Creation_Actions)set spider=nullset cocoon=nullset t=nullendfunctionfunction Trig_Cocoon_Creation_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetDyingUnit())=='n00R' and GetRandomInt(1,3)==1endfunctionfunction InitTrig_Cocoon_Creation takes nothing returns nothinglocal integer index=0set gg_trg_Cocoon_Creation=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Cocoon_Creation,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Cocoon_Creation,Condition(function Trig_Cocoon_Creation_Conditions))
call TriggerAddAction(gg_trg_Cocoon_Creation,function Trig_Cocoon_Creation_Actions)endfunctionfunction Trig_Poisonous_Spittle_Cast_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetAttacker())=='n00R' and GetRandomInt(1,6)==1
endfunctionfunction Trig_Poisonous_Spittle_Cast_Actions takes nothing returns nothingcall IssueTargetOrderById(GetAttacker(),$D02B6,GetTriggerUnit())
endfunctionfunction InitTrig_Poisonous_Spittle_Cast takes nothing returns nothinglocal integer index=0set gg_trg_Poisonous_Spittle_Cast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Poisonous_Spittle_Cast,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Poisonous_Spittle_Cast,Condition(function Trig_Poisonous_Spittle_Cast_Conditions))call TriggerAddAction(gg_trg_Poisonous_Spittle_Cast,function Trig_Poisonous_Spittle_Cast_Actions)endfunctionfunction Trig_Holes_Of_Grave_Diggers_Debug_Kill_Actions takes nothing returns nothingcall RemoveUnit(GetDyingUnit())call FlushChildHashtable(udg_hash,GetHandleId(GetDyingUnit()))endfunctionfunction Trig_Holes_Of_Grave_Diggers_Debug_Kill_Conditions takes nothing returns boolean
return GetUnitTypeId(GetDyingUnit())=='u00H'
endfunctionfunction InitTrig_Holes_Of_Grave_Diggers_Debug_Kill takes nothing returns nothinglocal integer index=0set gg_trg_Holes_Of_Grave_Diggers_Debug_Kill=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Holes_Of_Grave_Diggers_Debug_Kill,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Holes_Of_Grave_Diggers_Debug_Kill,Condition(function Trig_Holes_Of_Grave_Diggers_Debug_Kill_Conditions))
call TriggerAddAction(gg_trg_Holes_Of_Grave_Diggers_Debug_Kill,function Trig_Holes_Of_Grave_Diggers_Debug_Kill_Actions)endfunctionfunction Trig_Holes_Of_Grave_Diggers_AttackBase_Actions takes nothing returns nothinglocal timer tsp=GetExpiredTimer()local integer hsp=GetHandleId(tsp)local unit spider=LoadUnitHandle(udg_hash,hsp,1)
call SetUnitAnimation(spider,"stand")call SetUnitMoveSpeed(spider,GetUnitDefaultMoveSpeed(spider))call IssuePointOrderById(spider,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))set spider=nullcall FlushChildHashtable(udg_hash,hsp)call DestroyTimer(tsp)set tsp=null
endfunctionfunction Trig_Holes_Of_Grave_Diggers_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local real x=LoadReal(udg_hash,h,1)local real y=LoadReal(udg_hash,h,2)local unit hole=LoadUnitHandle(udg_hash,h,3)
local unit dammi
local effect eflocal integer check=LoadInteger(udg_hash,h,6)local player p=LoadPlayerHandle(udg_hash,h,7)local unit spiderlocal timer tsplocal integer hspif GetUnitState(hole,UNIT_STATE_LIFE)>.405 and check>0 thenset check=check-1call SaveInteger(udg_hash,h,6,check)
set tsp=CreateTimer()set hsp=GetHandleId(tsp)
set spider=CreateUnit(p,'u00D',x,y,GetRandomReal(.0,360.))call SetUnitAnimationByIndex(spider,9)call SetUnitMoveSpeed(spider,.0)
call SaveUnitHandle(udg_hash,hsp,1,spider)call TimerStart(tsp,1.,false,function Trig_Holes_Of_Grave_Diggers_AttackBase_Actions)set spider=nullset tsp=null
else
set dammi=LoadUnitHandle(udg_hash,h,4)set ef=LoadEffectHandle(udg_hash,h,5)call DestroyEffect(ef)set ef=nullcall KillUnit(dammi)
set dammi=nullcall KillUnit(hole)set hole=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifset t=nullset hole=nullset p=nullendfunctionfunction Trig_Holes_Of_Grave_Diggers_Cast_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local unit hole=CreateUnit(GetOwningPlayer(caster),'u00H',x,y,GetRandomReal(.0,360.))local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)local timer t=CreateTimer()local integer h=GetHandleId(t)local effect eflocal integer check=$Acall SetUnitAnimationByIndex(hole,8)
call SetUnitScale(dammi,2.,2.,2.)call SetUnitVertexColor(dammi,$C8,$C8,$C8,$AF)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\Web\\WebTarget.mdl",dammi,"chest")
call SaveReal(udg_hash,h,1,x)call SaveReal(udg_hash,h,2,y)call SaveUnitHandle(udg_hash,h,3,hole)call SaveUnitHandle(udg_hash,h,4,dammi)call SaveEffectHandle(udg_hash,h,5,ef)call SaveInteger(udg_hash,h,6,check)
call SavePlayerHandle(udg_hash,h,7,GetOwningPlayer(caster))call TimerStart(t,1.5,true,function Trig_Holes_Of_Grave_Diggers_periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set hole=nullset dammi=nullset t=nullset ef=nullendfunctionfunction Trig_Holes_Of_Grave_Diggers_Cast_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0E2'endfunctionfunction InitTrig_Holes_Of_Grave_Diggers_Cast takes nothing returns nothinglocal integer index=0set gg_trg_Holes_Of_Grave_Diggers_Cast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Holes_Of_Grave_Diggers_Cast,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Holes_Of_Grave_Diggers_Cast,Condition(function Trig_Holes_Of_Grave_Diggers_Cast_Conditions))
call TriggerAddAction(gg_trg_Holes_Of_Grave_Diggers_Cast,function Trig_Holes_Of_Grave_Diggers_Cast_Actions)endfunctionfunction Trig_Nerub_Spider_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real xtlocal player p=GetOwningPlayer(caster)local real ytlocal location loclocal unit target=GetSpellTargetUnit()local unit dammi
if target!=null then
set xt=GetUnitX(target)set yt=GetUnitY(target)else
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
endifset dammi=CreateUnit(p,'n00Z',xt,yt,GetRandomReal(.0,360.))call IssuePointOrderById(dammi,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))
set dammi=nullset dammi=CreateUnit(p,'n00Z',xt,yt,GetRandomReal(.0,360.))call IssuePointOrderById(dammi,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))
set dammi=nullset caster=nullset p=nullset target=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Nerub_Spider_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A08U'endfunctionfunction InitTrig_Nerub_Spider takes nothing returns nothing
local integer index=0set gg_trg_Nerub_Spider=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Nerub_Spider,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Nerub_Spider,Condition(function Trig_Nerub_Spider_Conditions))call TriggerAddAction(gg_trg_Nerub_Spider,function Trig_Nerub_Spider_Actions)endfunctionfunction Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Dead_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)<.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(GetUnitTypeId(GetFilterUnit())!='h00U'))!=nullendfunctionfunction Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Enemy_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerEnemy(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Ally_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerAlly(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_All_Condition takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Actions takes nothing returns nothinglocal group gall=CreateGroup()local group glocal group g2local unit Pickedlocal unit targetlocal real x
local real y
local real angle
call GroupEnumUnitsInRect(gall,bj_mapInitialPlayableArea,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_All_Condition))set g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0DY')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Ally_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0062,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0E2')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,700.,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssuePointOrderById(Picked,$D009D,GetUnitX(target),GetUnitY(target))endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08U')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,900.,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssuePointOrderById(Picked,$D0278,GetUnitX(target),GetUnitY(target))endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A082')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,250.,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D022F,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08Q')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,500.,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00F3,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A08T')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,650.,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D02B6,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gall)call DestroyGroup(gall)set gall=nullendfunctionfunction Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==4)
endfunctionfunction InitTrig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger takes nothing returns nothingset gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger,1.,true)
call TriggerAddCondition(gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Conditions))
call TriggerAddAction(gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger,function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Actions)endfunctionfunction Trig_Damned_Ents_Reincarnation_End_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit damnedent=LoadUnitHandle(udg_hash,h,4)call SetUnitTimeScale(damnedent,1.)call PauseUnit(damnedent,false)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset damnedent=nullendfunctionfunction Trig_Damned_Ents_Reincarnation_Recovery_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit ent=LoadUnitHandle(udg_hash,h,1)local unit damnedent=LoadUnitHandle(udg_hash,h,4)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local group g=CreateGroup()local unit Pickedcall SetUnitVertexColor(damnedent,$FF,$FF,$FF,$FF)call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",x,y))
call SetUnitTimeScale(damnedent,-.1)
call SetUnitAnimation(damnedent,"Death")
call GroupEnumUnitsInRange(g,x,y,250.,null)call UnitRemoveAbility(damnedent,'Avul')
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,GetOwningPlayer(damnedent))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+125.)endifif IsUnitEnemy(Picked,GetOwningPlayer(damnedent))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(damnedent,Picked,80.,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopcall TimerStart(t,1.5,false,function Trig_Damned_Ents_Reincarnation_End_Actions)
call RemoveUnit(ent)
set t=nullset ent=null
set damnedent=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Damned_Ents_Reincarnation_Actions takes nothing returns nothinglocal unit ent=GetDyingUnit()local real x=GetUnitX(ent)local real y=GetUnitY(ent)local timer t=CreateTimer()local integer h=GetHandleId(t)local unit damnedent=CreateUnit(GetOwningPlayer(ent),GetUnitTypeId(ent),x,y,GetUnitFacing(ent))call PauseUnit(damnedent,true)call SetUnitAnimation(damnedent,"Death")
call UnitAddAbility(damnedent,'Avul')call SaveUnitHandle(udg_hash,h,1,ent)call SaveUnitHandle(udg_hash,h,4,damnedent)call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SetUnitVertexColor(damnedent,$FF,$FF,$FF,0)
call TimerStart(t,1.75,false,function Trig_Damned_Ents_Reincarnation_Recovery_Actions)set ent=null
set t=nullendfunctionfunction Trig_Damned_Ents_Reincarnation_Conditions takes nothing returns boolean
return GetUnitAbilityLevel(GetDyingUnit(),'A0E1')>0 and GetRandomInt(1,4)==1
endfunctionfunction InitTrig_Damned_Ents_Reincarnation takes nothing returns nothinglocal integer index=0set gg_trg_Damned_Ents_Reincarnation=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Damned_Ents_Reincarnation,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Damned_Ents_Reincarnation,Condition(function Trig_Damned_Ents_Reincarnation_Conditions))
call TriggerAddAction(gg_trg_Damned_Ents_Reincarnation,function Trig_Damned_Ents_Reincarnation_Actions)endfunctionfunction Trig_Rage_of_Decay_ent_attack_base_Actions takes nothing returns nothinglocal timer tsp=GetExpiredTimer()local integer hsp=GetHandleId(tsp)local unit ent=LoadUnitHandle(udg_hash,hsp,1)if ent!=null thencall SetUnitAnimation(ent,"Stand")call PauseUnit(ent,false)call IssuePointOrderById(ent,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))endifcall FlushChildHashtable(udg_hash,hsp)call DestroyTimer(tsp)set tsp=null
set ent=null
endfunctionfunction Trig_Rage_of_Decay_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local player p=GetOwningPlayer(caster)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local integer order=GetUnitCurrentOrder(caster)local unit dammi
local group glocal unit Pickedlocal real rx=0local real ry=0local unit entlocal integer entid=0local integer random=GetRandomInt(1,$F)local integer efrandom=GetRandomInt(2,4)
local integer orderIdlocal timer tsplocal integer hspset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId thenset rx=GetRandomReal((x-425.),(x+425.))set ry=GetRandomReal((y-425.),(y+425.))set g=CreateGroup()call GroupEnumUnitsInRange(g,rx,ry,125.,null)if random<=8 thenset entid='u009'
endifif random>=9 and random<=$D then
set entid='u00B'
endifif random>=$E thenset entid='u00A'
endifset ent=CreateUnit(p,entid,rx,ry,GetRandomReal(.0,360.))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl",ent,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",ent,"chest"))
call PauseUnit(ent,true)
call SetUnitAnimation(ent,"Attack Spell")set tsp=CreateTimer()set hsp=GetHandleId(tsp)
call SaveUnitHandle(udg_hash,hsp,1,ent)call TimerStart(tsp,1.6,false,function Trig_Rage_of_Decay_ent_attack_base_Actions)loop
exitwhen efrandom<0call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\EntanglingRoots\\EntanglingRootsTarget.mdl",GetRandomReal(rx-GetRandomReal(20.,125.),rx+GetRandomReal(20.,125.)),GetRandomReal(ry-GetRandomReal(20.,125.),ry+GetRandomReal(20.,125.))))set efrandom=efrandom-1endlooploop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,150.,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GreenDragonMissile\\GreenDragonMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A08Z')call IssueTargetOrderById(dammi,$D00CB,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopelse
call SetUnitTimeScale(caster,1.)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",x,y))
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifset t=nullset caster=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset ent=null
set tsp=null
set Picked=nullset dammi=nullendfunctionfunction Trig_Rage_of_Decay_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitTimeScale(caster,3.)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl",GetUnitX(caster),GetUnitY(caster)))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdl",caster,"chest"))call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call TimerStart(t,.3,true,function Trig_Rage_of_Decay_periodic_Actions)set caster=nullset t=nullendfunctionfunction Trig_Rage_of_Decay_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A091'endfunctionfunction InitTrig_Rage_of_Decay takes nothing returns nothinglocal integer index=0set gg_trg_Rage_of_Decay=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Rage_of_Decay,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Rage_of_Decay,Condition(function Trig_Rage_of_Decay_Conditions))
call TriggerAddAction(gg_trg_Rage_of_Decay,function Trig_Rage_of_Decay_Actions)endfunctionfunction Trig_Use_ThrowStone_and_TurnIntoEnt_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==5)
endfunctionfunction Trig_Use_ThrowStone_and_TurnIntoEnt_Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A094',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_ThrowStone_and_TurnIntoEnt_Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A094',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_ThrowStone_and_TurnIntoEnt_Actions takes nothing returns nothingif(Trig_Use_ThrowStone_and_TurnIntoEnt_Func002C())thencall IssueTargetOrderById(GetTriggerUnit(),$D011C,GetAttacker())
endifif(Trig_Use_ThrowStone_and_TurnIntoEnt_Func003C())thencall IssueTargetOrderById(GetAttacker(),$D011C,GetTriggerUnit())
endifendfunctionfunction InitTrig_Use_ThrowStone_and_TurnIntoEnt takes nothing returns nothingset gg_trg_Use_ThrowStone_and_TurnIntoEnt=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_ThrowStone_and_TurnIntoEnt,EVENT_PLAYER_UNIT_ATTACKED)
call TriggerAddCondition(gg_trg_Use_ThrowStone_and_TurnIntoEnt,Condition(function Trig_Use_ThrowStone_and_TurnIntoEnt_Conditions))call TriggerAddAction(gg_trg_Use_ThrowStone_and_TurnIntoEnt,function Trig_Use_ThrowStone_and_TurnIntoEnt_Actions)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==5)
endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003001002 takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003002002 takes nothing returns booleanreturn(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003002001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003002002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A090',GetEnumUnit())>0)and(GetRandomInt(1,2)==3)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002001001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002001002 takes nothing returns booleanreturn(GetUnitStateSwap(UNIT_STATE_LIFE,GetFilterUnit())<(GetUnitStateSwap(UNIT_STATE_MAX_LIFE,GetFilterUnit())*.6))
endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002001 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002001001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002001002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002002 takes nothing returns booleanreturn(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A08Y',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003002001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003002002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('S000',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003002001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003002002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003001(),Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003002())endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A091',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003A takes nothing returns nothingif(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(700.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func001002001003)))if(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func001Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D0213,udg_Temp_Unit)endifendifif(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(800.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func001002001003)))if(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func002Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D00C0,udg_Temp_Unit)endifendifif(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(225.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func001002001003)))if(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func003Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D00DD,udg_Temp_Unit)endifendifif(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(600.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func001002001003)))if(Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003Func004Func002C())thencall IssueImmediateOrderById(GetEnumUnit(),$D0278)endifendifendfunctionfunction Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Actions takes nothing returns nothingcall ForGroupBJ(GetUnitsInRectMatching(bj_mapInitialPlayableArea,Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003001002)),function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Func003A)
endfunctionfunction InitTrig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay takes nothing returns nothingset gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay=CreateTrigger()
call TriggerRegisterTimerEventPeriodic(gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay,1.)call TriggerAddCondition(gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay,Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Conditions))
call TriggerAddAction(gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay,function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Actions)endfunctionfunction Trig_Troll_Dead_Remove_Bugs_Actions takes nothing returns nothinglocal integer h=GetHandleId(GetDyingUnit())local effect ef=LoadEffectHandle(udg_hash,h,55)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,56)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,57)call DestroyEffect(ef)set ef=nullendfunctionfunction Trig_Troll_Dead_Remove_Bugs_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetDyingUnit(),'A09E')>0endfunctionfunction InitTrig_Troll_Dead_Remove_Bugs takes nothing returns nothinglocal integer index=0set gg_trg_Troll_Dead_Remove_Bugs=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Troll_Dead_Remove_Bugs,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Troll_Dead_Remove_Bugs,Condition(function Trig_Troll_Dead_Remove_Bugs_Conditions))call TriggerAddAction(gg_trg_Troll_Dead_Remove_Bugs,function Trig_Troll_Dead_Remove_Bugs_Actions)endfunctionfunction Trig_Boss_Troll_Entangle_Throw_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local real angle=LoadReal(udg_hash,h,1)local integer stage=LoadInteger(udg_hash,h,2)local unit entangle=LoadUnitHandle(udg_hash,h,3)
local player plocal real x=GetUnitX(entangle)+40.*Cos(angle*bj_DEGTORAD)local real y=GetUnitY(entangle)+40.*Sin(angle*bj_DEGTORAD)local effect eflocal group glocal unit Pickedlocal unit dammi
if stage>0 thenset stage=stage-1call SaveInteger(udg_hash,h,2,stage)
if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(entangle,x,y)endifelse
set p=GetOwningPlayer(entangle)set g=CreateGroup()call GroupEnumUnitsInRange(g,x,y,250.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A096')call IssueTargetOrderById(dammi,$D008A,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset p=nullset ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall KillUnit(entangle)set entangle=nullcall DestroyTimer(t)
endifset t=nullset entangle=nullendfunctionfunction Trig_Boss_Troll_Entangle_Throw_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real ux=GetUnitX(caster)local real uy=GetUnitY(caster)local real x=GetLocationX(loc)local real y=GetLocationY(loc)local real angle=bj_RADTODEG*Atan2(y-uy,x-ux)local integer stage=R2I(SquareRoot((x-ux)*(x-ux)+(y-uy)*(y-uy))/ 40.)local timer t=CreateTimer()local integer h=GetHandleId(t)local unit entangle=CreateUnit(GetOwningPlayer(caster),'h00U',ux+25.*Cos(angle*bj_DEGTORAD),uy+25.*Sin(angle*bj_DEGTORAD),angle)
local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Ensnare\\EnsnareMissile.mdl",entangle,"chest")call SetUnitScale(entangle,2.,2.,2.)
call UnitAddAbility(entangle,'Amrf')
call UnitRemoveAbility(entangle,'Amrf')call SetUnitFlyHeight(entangle,50.,.0)call SetUnitFlyHeight(entangle,.0,.04*stage)
call SaveReal(udg_hash,h,1,angle)call SaveInteger(udg_hash,h,2,stage)
call SaveUnitHandle(udg_hash,h,3,entangle)call SaveEffectHandle(udg_hash,h,4,ef)call TimerStart(t,.04,true,function Trig_Boss_Troll_Entangle_Throw_periodic_Actions)
set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset entangle=nullset ef=nullendfunctionfunction Trig_Boss_Troll_Entangle_Throw_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0E8'endfunctionfunction InitTrig_Boss_Troll_Entangle_Throw takes nothing returns nothinglocal integer index=0set gg_trg_Boss_Troll_Entangle_Throw=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Boss_Troll_Entangle_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Boss_Troll_Entangle_Throw,Condition(function Trig_Boss_Troll_Entangle_Throw_Conditions))
call TriggerAddAction(gg_trg_Boss_Troll_Entangle_Throw,function Trig_Boss_Troll_Entangle_Throw_Actions)endfunctionfunction Trig_Use_Berserk_and_BerserkBoss_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==6)
endfunctionfunction Trig_Use_Berserk_and_BerserkBoss_Func002C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A098',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Berserk_and_BerserkBoss_Func003C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A098',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Berserk_and_BerserkBoss_Func004C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A0EC',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Berserk_and_BerserkBoss_Func005C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A0EC',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Berserk_and_BerserkBoss_Actions takes nothing returns nothingif(Trig_Use_Berserk_and_BerserkBoss_Func002C())thencall IssueImmediateOrderById(GetTriggerUnit(),$D0084)endifif(Trig_Use_Berserk_and_BerserkBoss_Func003C())thencall IssueImmediateOrderById(GetAttacker(),$D0084)endifif(Trig_Use_Berserk_and_BerserkBoss_Func004C())thencall IssueImmediateOrderById(GetTriggerUnit(),$D0084)endifif(Trig_Use_Berserk_and_BerserkBoss_Func005C())thencall IssueImmediateOrderById(GetAttacker(),$D0084)endifendfunctionfunction InitTrig_Use_Berserk_and_BerserkBoss takes nothing returns nothingset gg_trg_Use_Berserk_and_BerserkBoss=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_Berserk_and_BerserkBoss,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_Use_Berserk_and_BerserkBoss,Condition(function Trig_Use_Berserk_and_BerserkBoss_Conditions))
call TriggerAddAction(gg_trg_Use_Berserk_and_BerserkBoss,function Trig_Use_Berserk_and_BerserkBoss_Actions)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==6)
endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002001002 takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002001001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002001002 takes nothing returns booleanreturn(GetUnitStateSwap(UNIT_STATE_LIFE,GetFilterUnit())<(GetUnitStateSwap(UNIT_STATE_MAX_LIFE,GetFilterUnit())*.9))
endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002001 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002001001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002001002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002002 takes nothing returns boolean
return(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A097',GetEnumUnit())>0)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002001001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002001002 takes nothing returns booleanreturn(GetUnitStateSwap(UNIT_STATE_LIFE,GetFilterUnit())<(GetUnitStateSwap(UNIT_STATE_MAX_LIFE,GetFilterUnit())*.6))
endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002001 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002001001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002001002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002002 takes nothing returns boolean
return(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A099',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003002002 takes nothing returns boolean
return(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003002001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003002002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A09C',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003002002 takes nothing returns boolean
return(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003002001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003002002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003001(),Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003002())endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0E8',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002A takes nothing returns nothing
if(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(500.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func001002001003)))if(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func001Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D005F,udg_Temp_Unit)endifendifif(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(700.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func001002001003)))if(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func002Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D0215,udg_Temp_Unit)endifendifif(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(700.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func001002001003)))if(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func003Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D0062,udg_Temp_Unit)endifendifif(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(800.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func001002001003)))if(Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002Func004Func002C())thencall IssuePointOrderById(GetEnumUnit(),$D0079,GetUnitX(udg_Temp_Unit),GetUnitY(udg_Temp_Unit))endifendifendfunctionfunction Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Actions takes nothing returns nothingcall ForGroupBJ(GetUnitsInRectMatching(bj_mapInitialPlayableArea,Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002001002)),function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Func002A)
endfunctionfunction InitTrig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle takes nothing returns nothingset gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle,1.)call TriggerAddCondition(gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle,Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Conditions))
call TriggerAddAction(gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle,function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Actions)endfunctionfunction Trig_Aspect_of_Magic_Protection_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,GetHandleId(t),1)call SaveTimerHandle(udg_hash,GetHandleId(target),$A6,null)call SaveBoolean(udg_hash,GetHandleId(target),$A5,false)
call DestroyEffect(LoadEffectHandle(udg_hash,h,2))call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset target=nullendfunctionfunction Trig_Aspect_of_Magic_Protection_Actions takes nothing returns nothinglocal unit target=GetSpellTargetUnit()local timer t=LoadTimerHandle(udg_hash,GetHandleId(target),$A6)local integer h=GetHandleId(t)if t==null thenset t=CreateTimer()set h=GetHandleId(t)
call SaveTimerHandle(udg_hash,GetHandleId(target),$A6,t)
call SaveBoolean(udg_hash,GetHandleId(target),$A5,true)else
call DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(t),2))endifcall SaveUnitHandle(udg_hash,h,1,target)
call SaveEffectHandle(udg_hash,h,2,AddSpecialEffectTarget("Effects\\MagicShieldBlue.mdx",target,"origin"))call TimerStart(t,6.,false,function Trig_Aspect_of_Magic_Protection_Move_Actions)set t=nullset target=nullendfunctionfunction Trig_Aspect_of_Magic_Protection_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A09J'endfunctionfunction InitTrig_Aspect_of_Magic_Protection takes nothing returns nothinglocal integer index=0set gg_trg_Aspect_of_Magic_Protection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Aspect_of_Magic_Protection,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Aspect_of_Magic_Protection,Condition(function Trig_Aspect_of_Magic_Protection_Conditions))call TriggerAddAction(gg_trg_Aspect_of_Magic_Protection,function Trig_Aspect_of_Magic_Protection_Actions)endfunctionfunction Trig_Remove_Effects_From_Bosses_Actions takes nothing returns nothinglocal integer h=GetHandleId(GetDyingUnit())if LoadEffectHandle(udg_hash,h,$A8)!=null thencall DestroyEffect(LoadEffectHandle(udg_hash,h,$A8))
endifif LoadEffectHandle(udg_hash,h,$A9)!=null thencall DestroyEffect(LoadEffectHandle(udg_hash,h,$A9))
endifendfunctionfunction Trig_Remove_Effects_From_Bosses_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetDyingUnit(),'A09L')>0endfunctionfunction InitTrig_Remove_Effects_From_Bosses takes nothing returns nothinglocal integer index=0set gg_trg_Remove_Effects_From_Bosses=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Remove_Effects_From_Bosses,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Remove_Effects_From_Bosses,Condition(function Trig_Remove_Effects_From_Bosses_Conditions))call TriggerAddAction(gg_trg_Remove_Effects_From_Bosses,function Trig_Remove_Effects_From_Bosses_Actions)endfunctionfunction Trig_Metka_Dreneev_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local unit Pickedlocal player p=GetOwningPlayer(caster)local group g=CreateGroup()call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),1000.,null)call GroupRemoveUnit(g,caster)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitAlly(Picked,p) and GetUnitTypeId(Picked)!='h00U' then
call IssueTargetOrderById(Picked,$D000F,target)if GetUnitAbilityLevel(Picked,'A0FC')>0 then
call IssueTargetOrderById(Picked,$D02B2,target)endifendifcall GroupRemoveUnit(g,Picked)endloopset caster=nullset target=nullset p=nullcall DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_Metka_Dreneev_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0FA'endfunctionfunction InitTrig_Metka_Dreneev takes nothing returns nothinglocal integer index=0set gg_trg_Metka_Dreneev=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Metka_Dreneev,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Metka_Dreneev,Condition(function Trig_Metka_Dreneev_Conditions))
call TriggerAddAction(gg_trg_Metka_Dreneev,function Trig_Metka_Dreneev_Actions)endfunctionfunction Trig_Fast_Attack_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,4)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-y,xt-x)local real dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))local integer wait=LoadInteger(udg_hash,h,2)
if dist>100. and GetUnitState(target,UNIT_STATE_LIFE)>.405 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 thencall SetUnitPosition(caster,x+20.*Cos((angle)*bj_DEGTORAD),y+20.*Sin((angle)*bj_DEGTORAD))set wait=wait+1call SaveInteger(udg_hash,h,2,wait)if wait==1 thencall SetUnitAnimationByIndex(caster,2)endifelse
if GetUnitState(caster,UNIT_STATE_LIFE)>.405 thenif GetUnitState(target,UNIT_STATE_LIFE)>.405 thencall IssueTargetOrderById(caster,$D000F,target)endifcall SetUnitAnimation(caster,"stand")endifcall SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call DestroyEffect(LoadEffectHandle(udg_hash,h,8))call DestroyEffect(LoadEffectHandle(udg_hash,h,9))call DestroyEffect(LoadEffectHandle(udg_hash,h,$A))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset target=nullset caster=nullendfunctionfunction Trig_Fast_Attack_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local effect efcall SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,2)call SetUnitTimeScale(caster,2.)
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\Tornado_Target.mdl",caster,"origin")call SaveEffectHandle(udg_hash,h,8,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\Tornado_Target.mdl",caster,"chest")call SaveEffectHandle(udg_hash,h,9,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Tornado\\Tornado_Target.mdl",caster,"head")
call SaveEffectHandle(udg_hash,h,$A,ef)set ef=nullcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,4,target)
call SaveInteger(udg_hash,h,2,0)
call TimerStart(t,.03,true,function Trig_Fast_Attack_Move_Actions)set caster=nullset target=nullset t=nullendfunctionfunction Trig_Fast_Attack_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0FC'endfunctionfunction InitTrig_Fast_Attack takes nothing returns nothinglocal integer index=0set gg_trg_Fast_Attack=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fast_Attack,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fast_Attack,Condition(function Trig_Fast_Attack_Conditions))
call TriggerAddAction(gg_trg_Fast_Attack,function Trig_Fast_Attack_Actions)endfunctionfunction Trig_Bash_Attack_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local effect efif GetUnitTypeId(caster)=='n016' thencall StunUnitTimed(target,1.)call UnitDamageTarget(caster,target,75.,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
endifif GetUnitTypeId(caster)=='n018' thencall StunUnitTimed(target,1.5)call UnitDamageTarget(caster,target,125.,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl",target,"chest"))set caster=nullset target=nullset t=nullendfunctionfunction Trig_Bash_Attack_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0FD'endfunctionfunction InitTrig_Bash_Attack takes nothing returns nothinglocal integer index=0set gg_trg_Bash_Attack=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Bash_Attack,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Bash_Attack,Condition(function Trig_Bash_Attack_Conditions))
call TriggerAddAction(gg_trg_Bash_Attack,function Trig_Bash_Attack_Actions)endfunctionfunction Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Dead_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)<.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(GetUnitTypeId(GetFilterUnit())!='h00U'))!=nullendfunctionfunction Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Enemy_Condition takes nothing returns booleanreturn((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerEnemy(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Ally_Condition takes nothing returns boolean
return((GetUnitState(GetFilterUnit(),UNIT_STATE_LIFE)>.405)and(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)and(IsPlayerAlly(udg_Temp_Player[1],GetOwningPlayer(GetFilterUnit()))))!=nullendfunctionfunction Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_All_Condition takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Actions takes nothing returns nothinglocal group gall=CreateGroup()local group glocal group g2local unit Pickedlocal unit targetlocal real x
local real y
local real angle
call GroupEnumUnitsInRect(gall,bj_mapInitialPlayableArea,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_All_Condition))set g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A09J')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,700.,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Ally_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0113,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A09H')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,600.,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Ally_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0085,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0FA')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,1000.,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D00B5,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0FD')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,250.,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D0077,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()call GroupToGroup(gall,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(GetUnitAbilityLevel(Picked,'A0FC')>0)and GetRandomInt(1,2)==1 thenset g2=CreateGroup()
set x=GetUnitX(Picked)set y=GetUnitY(Picked)set udg_Temp_Player[1]=GetOwningPlayer(Picked)call GroupEnumUnitsInRange(g2,x,y,1200.,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Loop_Is_Enemy_Condition))call RandomUnitFromGroup(1,g2)set g2=CreateGroup()
call GroupToGroup(udg_GroupRandomUnitFromGroup,g2)set target=FirstOfGroup(g2)if(target!=null)then
call IssueTargetOrderById(Picked,$D02B2,target)endifset udg_Temp_Player[1]=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullset target=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gall)call DestroyGroup(gall)set gall=nullendfunctionfunction Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==7)
endfunctionfunction InitTrig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack takes nothing returns nothingset gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack,1.,true)
call TriggerAddCondition(gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Conditions))
call TriggerAddAction(gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack,function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Actions)endfunctionfunction Trig_Blink_Strike_Remove_Buff_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local effect efset ef=LoadEffectHandle(udg_hash,h,2)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullcall SetAttackSpeedAbilityLevel(caster,-$C8)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_Blink_Strike_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)local effect efcall SetAttackSpeedAbilityLevel(caster,$C8)call SetUnitPosition(caster,xt-75.*Cos(angle*bj_DEGTORAD),yt-75.*Sin(angle*bj_DEGTORAD))
call IssueTargetOrderById(caster,$D000F,target)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",target,"origin"))set ef=AddSpecialEffectTarget("Abilities\\Weapons\\DruidoftheTalonMissile\\DruidoftheTalonMissile.mdl",caster,"hand,left")call SaveEffectHandle(udg_hash,h,2,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Weapons\\DruidoftheTalonMissile\\DruidoftheTalonMissile.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,h,3,ef)set ef=nullcall SaveUnitHandle(udg_hash,h,1,caster)
call TimerStart(t,2.,false,function Trig_Blink_Strike_Remove_Buff_Actions)set caster=nullset caster=nullset t=nullendfunctionfunction Trig_Blink_Strike_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A09P'endfunctionfunction InitTrig_Blink_Strike takes nothing returns nothing
local integer index=0set gg_trg_Blink_Strike=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blink_Strike,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blink_Strike,Condition(function Trig_Blink_Strike_Conditions))call TriggerAddAction(gg_trg_Blink_Strike,function Trig_Blink_Strike_Actions)endfunctionfunction Trig_Victim_Search_Stand2_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer addas=LoadInteger(udg_hash,h,2)if GetUnitState(caster,UNIT_STATE_LIFE)>.405 and caster!=null thencall SetAttackSpeedAbilityLevel(caster,-addas)endifcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullendfunctionfunction Trig_Victim_Search_Stand_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer addas=LoadInteger(udg_hash,h,2)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',GetUnitX(caster),GetUnitY(caster),270.)local real wait=10.if GetUnitState(caster,UNIT_STATE_LIFE)>.405 and caster!=null thencall PauseUnit(caster,false)
endifif GetUnitState(caster,UNIT_STATE_LIFE)>.405 thencall SetUnitAnimation(caster,"stand")else
call SetUnitAnimation(caster,"death")endifcall UnitRemoveAbility(caster,'A0HD')call SetArmorAbilityLevel(caster,30)
call SetAttackSpeedAbilityLevel(caster,addas)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0HE')call IssueTargetOrderById(dammi,$D0085,caster)if IsPlayerInForce(GetOwningPlayer(caster),udg_Players_Enemy_Group) then
call IssuePointOrderById(caster,$D000F,GetRectCenterX(gg_rct_cast_magi),GetRectCenterY(gg_rct_cast_magi))endifcall TimerStart(t,wait,false,function Trig_Victim_Search_Stand2_Actions)
set t=nullset caster=nullset dammi=nullendfunctionfunction Trig_Victim_Search_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local integer addas=80local real wait=2.4call PauseUnit(caster,true)call SetUnitAnimation(caster,"stand")call SetUnitAnimationByIndex(caster,1)call UnitAddAbility(caster,'A0HD')call SetArmorAbilityLevel(caster,-30)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,addas)
call TimerStart(t,wait,false,function Trig_Victim_Search_Stand_Actions)set caster=nullset t=nullendfunctionfunction Trig_Victim_Search_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0HC'endfunctionfunction InitTrig_Victim_Search takes nothing returns nothinglocal integer index=0set gg_trg_Victim_Search=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Victim_Search,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Victim_Search,Condition(function Trig_Victim_Search_Conditions))
call TriggerAddAction(gg_trg_Victim_Search,function Trig_Victim_Search_Actions)endfunctionfunction Trig_Black_Hole_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damage=LoadReal(udg_hash,h,2)
local unit dammi=LoadUnitHandle(udg_hash,h,3)local integer wait=LoadInteger(udg_hash,h,5)
local group gdamage=LoadGroupHandle(udg_hash,h,6)local real angledammi=LoadReal(udg_hash,h,7)
local real xstart=LoadReal(udg_hash,h,8)
local real ystart=LoadReal(udg_hash,h,9)
local real periodicdamage=LoadReal(udg_hash,h,35)local effect eflocal group g=CreateGroup()local real x=GetUnitX(dammi)
local real y=GetUnitY(dammi)
local real xtlocal real ytlocal real xt2local real yt2local real xdammilocal real ydammilocal real distlocal real angle
local player p=GetOwningPlayer(dammi)local unit Pickedlocal integer lopa=0
local unit dammiefif wait>=0 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)set angledammi=angledammi+5.5call SaveReal(udg_hash,h,7,angledammi)loop
exitwhen lopa>$A
set dammief=LoadUnitHandle(udg_hash,h,lopa+$A)if IsTerrainPathable(xstart+500.*Cos((angledammi+36.*lopa)*bj_DEGTORAD),ystart+500.*Sin((angledammi+36.*lopa)*bj_DEGTORAD),PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(dammief,xstart+500.*Cos((angledammi+36.*lopa)*bj_DEGTORAD),ystart+500.*Sin((angledammi+36.*lopa)*bj_DEGTORAD))endifcall SetUnitFacing(dammief,angledammi+90.)set dammief=null
set lopa=lopa+1endloopset xdammi=xstart+50.*Cos(angledammi*bj_DEGTORAD)set ydammi=ystart+50.*Sin(angledammi*bj_DEGTORAD)if IsTerrainPathable(xdammi,ydammi,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(dammi,xdammi,ydammi)endifcall GroupEnumUnitsInRange(g,x,y,500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitInGroup(Picked,udg_PortalCastersMagi)==false)and GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitInGroup(Picked,udg_PortalCastersMagi)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset xt=GetUnitX(Picked)set yt=GetUnitY(Picked)set dist=SquareRoot((xt-xstart)*(xt-xstart)+(yt-ystart)*(yt-ystart))
set angle=bj_RADTODEG*Atan2(ystart-yt,xstart-xt)
set xt2=xt+(1.5+((500-dist)/ $96))*Cos(angle*bj_DEGTORAD)set yt2=yt+(1.5+((500-dist)/ $96))*Sin(angle*bj_DEGTORAD)if IsTerrainPathable(xt2,yt2,PATHING_TYPE_FLYABILITY)==false and dist>50 thencall SetUnitX(Picked,xt2)call SetUnitY(Picked,yt2)endifif dist<'d' and IsUnitInGroup(Picked,gdamage)==false thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,3.25)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\CarrionSwarm\\CarrionSwarmDamage.mdl",Picked,"chest"))
call GroupAddUnit(gdamage,Picked)endifif dist<'d' then
call UnitDamageTarget(caster,Picked,periodicdamage*.03,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifendifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,6,gdamage)else
if wait==-1 then
set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",dammi,"origin"))set lopa=0loop
exitwhen lopa>$A
set dammief=LoadUnitHandle(udg_hash,h,lopa+$A)set ef=LoadEffectHandle(udg_hash,h,lopa+20)call DestroyEffect(ef)call RemoveUnit(dammief)
set dammief=null
set ef=nullset lopa=lopa+1endloopendifif wait>=-66 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)else
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call GroupClear(gdamage)
call DestroyGroup(gdamage)call RemoveUnit(dammi)endifendifset t=nullset caster=nullset dammi=nullset ef=nullset gdamage=null
set Picked=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullendfunctionfunction Trig_Black_Hole_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local timer t=CreateTimer()local integer h=GetHandleId(t)local real damage=500.local real periodicdamage=150.local integer wait=R2I($A/ .03)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x+50.,y+50.,270.)
local real angledammi=270.local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DarkSummoning\\DarkSummonMissile.mdl",dammi,"chest")local group gdamage=CreateGroup()local unit dammieflocal effect dammieffect
local integer lopa=0
loop
exitwhen lopa>$A
set dammief=CreateUnit(GetOwningPlayer(caster),'h00U',x+500.*Cos(36.*lopa*bj_DEGTORAD),y+500.*Sin(36.*lopa*bj_DEGTORAD),(36.*lopa)+90.)set dammieffect=AddSpecialEffectTarget("Effects\\DarkVortex2.mdl",dammief,"chest")call SetUnitScale(dammief,1.5,1.5,1.5)call SaveUnitHandle(udg_hash,h,$A+lopa,dammief)call SaveEffectHandle(udg_hash,h,20+lopa,dammieffect)set dammief=null
set dammieffect=null
set lopa=lopa+1endloopcall UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitFlyHeight(dammi,200.,.0)
call SetUnitScale(dammi,2.,2.,2.)call SetUnitTimeScale(dammi,2.)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveUnitHandle(udg_hash,h,3,dammi)call SaveEffectHandle(udg_hash,h,4,ef)call SaveInteger(udg_hash,h,5,wait)call SaveGroupHandle(udg_hash,h,6,gdamage)call SaveReal(udg_hash,h,7,angledammi)call SaveReal(udg_hash,h,8,x)call SaveReal(udg_hash,h,9,y)call SaveReal(udg_hash,h,35,periodicdamage)call TimerStart(t,.03,true,function Trig_Black_Hole_Periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset dammi=nullset ef=nullset gdamage=null
endfunctionfunction Trig_Black_Hole_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0HA'endfunctionfunction InitTrig_Black_Hole takes nothing returns nothinglocal integer index=0set gg_trg_Black_Hole=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Black_Hole,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Black_Hole,Condition(function Trig_Black_Hole_Conditions))call TriggerAddAction(gg_trg_Black_Hole,function Trig_Black_Hole_Actions)endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==8)
endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A09N',GetTriggerUnit())>0)and(GetRandomInt(1,2)==3)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))and(false)endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A09N',GetAttacker())>0)and(GetRandomInt(1,2)==3)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))and(false)endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func004C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0H0',GetTriggerUnit())>0)and(GetRandomInt(1,3)==4)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func005C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0H0',GetAttacker())>0)and(GetRandomInt(1,3)==4)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func006C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0H7',GetTriggerUnit())>0)and(GetRandomInt(1,2)==3)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func007C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0H7',GetAttacker())>0)and(GetRandomInt(1,2)==3)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func008C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HB',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func009C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HB',GetAttacker())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func010C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A09R',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func011C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A09R',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Actions takes nothing returns nothingif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func002C())thencall IssueTargetOrderById(GetTriggerUnit(),$D0201,GetAttacker())
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func003C())thencall IssueTargetOrderById(GetAttacker(),$D0201,GetTriggerUnit())
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func004C())thencall IssueTargetOrderById(GetTriggerUnit(),$D027C,GetAttacker())
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func005C())thencall IssueTargetOrderById(GetAttacker(),$D027C,GetTriggerUnit())
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func006C())thencall IssueTargetOrderById(GetTriggerUnit(),$D0244,GetAttacker())
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func007C())thencall IssueTargetOrderById(GetAttacker(),$D0244,GetTriggerUnit())
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func008C())thencall IssuePointOrderById(GetTriggerUnit(),$D00FD,GetUnitX(GetAttacker()),GetUnitY(GetAttacker()))endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func009C())thencall IssuePointOrderById(GetAttacker(),$D00FD,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()))
endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func010C())thencall IssueImmediateOrderById(GetTriggerUnit(),$D00C4)endifif(Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Func011C())thencall IssueImmediateOrderById(GetAttacker(),$D00C4)endifendfunctionfunction InitTrig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar takes nothing returns nothingset gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar,Condition(function Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Conditions))
call TriggerAddAction(gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar,function Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Actions)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==8)
endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002001002 takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003002001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003002002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A09P',GetEnumUnit())>0)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003002001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003002002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A0H0',GetEnumUnit())>0)and(GetRandomInt(1,3)==4)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003002001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003002002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A0H1',GetEnumUnit())>0)and(GetRandomInt(1,3)==4)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003002001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003002002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func003C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A0HC',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003001001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003001002 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_HERO))!=null
endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003001 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003001001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003001002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003002001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003002002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003001(),Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003002())endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005C takes nothing returns boolean
return(GetUnitAbilityLevelSwapped('A0HA',GetEnumUnit())>0)endfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002A takes nothing returns nothingif(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(700.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func001002001003)))
if(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func001Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D0258,udg_Temp_Unit)endifendifif(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(800.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func002Func001002001003)))
call IssueTargetOrderById(GetEnumUnit(),$D027C,udg_Temp_Unit)endifif(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(1000.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func003Func001002001003)))call IssueTargetOrderById(GetEnumUnit(),$D000C,udg_Temp_Unit)endifif(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004C())thenset udg_Temp_Unit=nullset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(650.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func002002001003)))
if(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func004Func003C())thencall IssueImmediateOrderById(GetEnumUnit(),$D00F3)endifendifif(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(1000.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func001002001003)))if(Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002Func005Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D00E4,udg_Temp_Unit)endifendifendfunctionfunction Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Actions takes nothing returns nothing
call ForGroupBJ(GetUnitsInRectMatching(bj_mapInitialPlayableArea,Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002001002)),function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Func002A)endfunctionfunction InitTrig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH takes nothing returns nothing
set gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH,1.)call TriggerAddCondition(gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH,Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Conditions))call TriggerAddAction(gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH,function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Actions)endfunctionfunction Trig_Weakness_10second_last_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local string s=LoadStr(udg_hash,h,2)
if s=="str" then
call SetUnitMaxState(target,UNIT_STATE_MAX_LIFE,'d')
call SetUnitLifeAndManaRegeneration(target,"life",$A)endifif s=="agi" then
call SetAttackAbilityLevel(target,$F)call SetAttackSpeedAbilityLevel(target,$A)endifif s=="int" then
call SetUnitMaxState(target,UNIT_STATE_MAX_MANA,50)call SetUnitLifeAndManaRegeneration(target,"mana",5)
endifif s=="mob" then
call SetArmorAbilityLevel(target,7)endifcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset target=nullendfunctionfunction Trig_Weakness_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local string smainstatlocal string slocal timer t=CreateTimer()local integer h=GetHandleId(t)if IsUnitType(target,UNIT_TYPE_HERO) thenset smainstat=LoadStr(udg_hash,GetUnitTypeId(target),70)
if smainstat=="str" then
call SetUnitMaxState(target,UNIT_STATE_MAX_LIFE,-'d')call SetUnitLifeAndManaRegeneration(target,"life",-$A)set s="str"endifif smainstat=="agi" then
call SetAttackAbilityLevel(target,-$F)call SetAttackSpeedAbilityLevel(target,-$A)set s="agi"endifif smainstat=="int" then
call SetUnitMaxState(target,UNIT_STATE_MAX_MANA,-50)
call SetUnitLifeAndManaRegeneration(target,"mana",-5)set s="int"endifelse
call SetArmorAbilityLevel(target,-7)
set s="mob"endifcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl",target,"hand,left"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl",target,"hand,right"))
call SaveUnitHandle(udg_hash,h,1,target)
call SaveStr(udg_hash,h,2,s)
call TimerStart(t,12.,false,function Trig_Weakness_10second_last_Actions)set caster=nullset target=nullset t=nullendfunctionfunction Trig_Weakness_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0ES'endfunctionfunction InitTrig_Weakness takes nothing returns nothing
local integer index=0set gg_trg_Weakness=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Weakness,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Weakness,Condition(function Trig_Weakness_Conditions))call TriggerAddAction(gg_trg_Weakness,function Trig_Weakness_Actions)endfunctionfunction Trig_Astral_Dispersal_Periodic_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Astral_Dispersal_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damage=LoadReal(udg_hash,h,3)
local integer waitstand=LoadInteger(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local real face=LoadReal(udg_hash,h,6)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real angle
local unit dammi
local boolean alife=true
local boolean endgroupcheck=falselocal effect eflocal rect r
if waitstand>0 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 thenset waitstand=waitstand-1call SaveInteger(udg_hash,h,4,waitstand)
endifif waitstand<=0 and wait>0 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)set r=Rect(x-100.,y-100.,x+100.,y+100.)call EnumDestructablesInRect(r,null,function Trig_Astral_Dispersal_Periodic_Dest_Actions)if IsTerrainPathable(x+25.*Cos(face*bj_DEGTORAD),y+25.*Sin(face*bj_DEGTORAD),PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(caster,x+25.*Cos(face*bj_DEGTORAD),y+25.*Sin(face*bj_DEGTORAD))
endifcall SetUnitFacing(caster,face)call GroupEnumUnitsInRange(g,x+50.*Cos(face*bj_DEGTORAD),y+50.*Sin(face*bj_DEGTORAD),125.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==null or endgroupcheckif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset endgroupcheck=trueset wait=-1call SaveInteger(udg_hash,h,5,wait)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\OrbOfDeath\\AnnihilationMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',.5)
call UnitAddAbility(dammi,'A0GG')call IssueTargetOrderById(dammi,$D007F,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopendifif wait<=0 or GetUnitState(caster,UNIT_STATE_LIFE)<.405 then
call SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call PauseUnit(caster,false)
set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullset dammi=nullcall RemoveRect(r)set r=nullendfunctionfunction Trig_Astral_Dispersal_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local real damage=400.local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)local effect ef=AddSpecialEffectTarget("Abilities\\Weapons\\AvengerMissile\\AvengerMissile.mdl",caster,"chest")if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifcall SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitTimeScale(caster,4.)
call PauseUnit(caster,true)call SetUnitAnimationByIndex(caster,1)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\OrbOfDeath\\AnnihilationMissile.mdl",tx,ty))
set angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))+100.call SetUnitFacing(caster,angle)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,66)call SaveInteger(udg_hash,h,5,R2I(dist/ 25.))call SaveReal(udg_hash,h,6,angle)call SaveEffectHandle(udg_hash,h,7,ef)call TimerStart(t,.03,true,function Trig_Astral_Dispersal_Periodic_Actions)set caster=nullset target=nullcall RemoveLocation(loc)
set loc=null
set t=nullset ef=nullendfunctionfunction Trig_Astral_Dispersal_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0GF'endfunctionfunction InitTrig_Astral_Dispersal takes nothing returns nothing
local integer index=0set gg_trg_Astral_Dispersal=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Astral_Dispersal,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Astral_Dispersal,Condition(function Trig_Astral_Dispersal_Conditions))call TriggerAddAction(gg_trg_Astral_Dispersal,function Trig_Astral_Dispersal_Actions)endfunctionfunction Trig_Infernal_Ram_Periodic_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Infernal_Ram_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damage=LoadReal(udg_hash,h,3)
local group gdamage=LoadGroupHandle(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local real face=LoadReal(udg_hash,h,6)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xzahvat=x+50.*Cos(face*bj_DEGTORAD)local real yzahvat=y+50.*Sin(face*bj_DEGTORAD)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real angle
local unit dammi
local boolean alife=true
local effect eflocal rect r
if wait>0 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 then
set wait=wait-1call SaveInteger(udg_hash,h,5,wait)set r=Rect(xzahvat-125.,yzahvat-125.,xzahvat+125.,yzahvat+125.)call EnumDestructablesInRect(r,null,function Trig_Infernal_Ram_Periodic_Dest_Actions)if IsTerrainPathable(x+25.*Cos(face*bj_DEGTORAD),y+25.*Sin(face*bj_DEGTORAD),PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(caster,x+25.*Cos(face*bj_DEGTORAD),y+25.*Sin(face*bj_DEGTORAD))
endifcall SetUnitFacing(caster,face)call GroupEnumUnitsInRange(g,x+75.*Cos(face*bj_DEGTORAD),y+75.*Sin(face*bj_DEGTORAD),110.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitInGroup(Picked,udg_PortalCastersMagi)==false)and IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitPeriodicPostionMove(Picked,.03,wait*.03)call GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Undead\\UndeadBlood\\UndeadBloodNecromancer.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"chest"))call SetUnitPathing(Picked,false)call MoveUnit(Picked,wait*.03,833.3,.0,face,.0,true)
endifcall GroupRemoveUnit(g,Picked)endloopendifset Picked=nullif wait<=0 or GetUnitState(caster,UNIT_STATE_LIFE)<.405 then
loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullcall SetUnitPosition(Picked,GetUnitX(Picked),GetUnitY(Picked))set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0GJ')call IssueTargetOrderById(dammi,$D006B,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call SetUnitPathing(Picked,true)
set dammi=nullcall GroupRemoveUnit(gdamage,Picked)
endloopcall SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call PauseUnit(caster,false)
set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,8)call DestroyEffect(ef)set ef=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call IssuePointOrderById(caster,$D0079,x+50.*Cos(face*bj_DEGTORAD),y+50.*Sin(face*bj_DEGTORAD))endifset t=nullset caster=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gdamage=null
set p=nullset Picked=nullset dammi=nullcall RemoveRect(r)set r=nullendfunctionfunction Trig_Infernal_Ram_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local real damage=800.local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)local effect eflocal group gdamage=CreateGroup()if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifcall SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitTimeScale(caster,3.25)call PauseUnit(caster,true)call SetUnitAnimationByIndex(caster,1)set angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))+100.call SetUnitFacing(caster,angle)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,3,damage)call SaveGroupHandle(udg_hash,h,4,gdamage)call SaveInteger(udg_hash,h,5,R2I(dist/ 25.))call SaveReal(udg_hash,h,6,angle)set ef=AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",caster,"chest")call SaveEffectHandle(udg_hash,h,7,ef)set ef=nullset ef=AddSpecialEffectTarget("Environment\\LargeBuildingFire\\LargeBuildingFire1.mdl",caster,"head")call SaveEffectHandle(udg_hash,h,8,ef)call TimerStart(t,.03,true,function Trig_Infernal_Ram_Periodic_Actions)set caster=nullset target=nullcall RemoveLocation(loc)
set loc=null
set t=nullset ef=nullset gdamage=null
endfunctionfunction Trig_Infernal_Ram_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0GI'endfunctionfunction InitTrig_Infernal_Ram takes nothing returns nothing
local integer index=0set gg_trg_Infernal_Ram=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Infernal_Ram,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Infernal_Ram,Condition(function Trig_Infernal_Ram_Conditions))call TriggerAddAction(gg_trg_Infernal_Ram,function Trig_Infernal_Ram_Actions)endfunctionfunction Trig_Fiery_Blow_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local real radius=250.local real damage=350.local unit dammi
local unit Pickedlocal group g=CreateGroup()local player p=GetOwningPlayer(caster)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",x,y))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",x,y))call GroupEnumUnitsInRange(g,x,y,radius,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl",Picked,"origin"))
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0GL')call IssueTargetOrderById(dammi,$D007F,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopset caster=nullcall RemoveLocation(loc)
set loc=null
set dammi=nullset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullendfunctionfunction Trig_Fiery_Blow_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0GK'endfunctionfunction InitTrig_Fiery_Blow takes nothing returns nothinglocal integer index=0set gg_trg_Fiery_Blow=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fiery_Blow,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fiery_Blow,Condition(function Trig_Fiery_Blow_Conditions))call TriggerAddAction(gg_trg_Fiery_Blow,function Trig_Fiery_Blow_Actions)endfunctionfunction Trig_Bloody_Jump_Delete_Dammi_Actions takes nothing returns nothing
local timer tvoid=GetExpiredTimer()local integer hvoid=GetHandleId(tvoid)local unit dammivoid=LoadUnitHandle(udg_hash,hvoid,1)call RemoveUnit(dammivoid)call FlushChildHashtable(udg_hash,hvoid)
call DestroyTimer(tvoid)
set tvoid=nullset dammivoid=nullendfunctionfunction Trig_Bloody_Jump_Periodic_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Bloody_Jump_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer waitef=LoadInteger(udg_hash,h,2)local integer wait=LoadInteger(udg_hash,h,3)
local real face=LoadReal(udg_hash,h,4)local group gdamage=LoadGroupHandle(udg_hash,h,5)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xnew=x+30.*Cos(face*bj_DEGTORAD)local real ynew=y+30.*Sin(face*bj_DEGTORAD)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real angle
local unit dammi
local unit dammivoid
local rect r
local timer tvoidlocal integer hvoidif wait>0 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 then
set wait=wait-1call SaveInteger(udg_hash,h,3,wait)set r=Rect(x-75.,y-75.,x+75.,y+75.)call EnumDestructablesInRect(r,null,function Trig_Bloody_Jump_Periodic_Dest_Actions)
if IsTerrainPathable(x+30.*Cos(face*bj_DEGTORAD),y+30.*Sin(face*bj_DEGTORAD),PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(caster,x+30.*Cos(face*bj_DEGTORAD),y+30.*Sin(face*bj_DEGTORAD))
endifif waitef==7 thenset waitef=0
set tvoid=CreateTimer()set hvoid=GetHandleId(tvoid)
set dammivoid=CreateUnit(Player(0),'n008',x-50.*Cos(face*bj_DEGTORAD),y-50.*Sin(face*bj_DEGTORAD),face)call SetUnitAnimation(dammivoid,"stand")
call SetUnitPathing(dammivoid,false)
call SetUnitTimeScale(dammivoid,2.)call PauseUnit(dammivoid,true)call SetUnitMoveSpeed(dammivoid,.0)call UnitAddAbility(dammivoid,'Aloc')call SetUnitVertexColor(dammivoid,$9B,$FF,$FF,75)call SetUnitAnimationByIndex(dammivoid,6)call SaveUnitHandle(udg_hash,hvoid,1,dammivoid)call TimerStart(tvoid,.7,false,function Trig_Bloody_Jump_Delete_Dammi_Actions)set tvoid=nullset dammivoid=nullcall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",dammivoid,"chest"))
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",GetUnitX(caster),GetUnitY(caster)))
else
set waitef=waitef+1endifcall SaveInteger(udg_hash,h,2,waitef)call SetUnitFacing(caster,face)call GroupEnumUnitsInRange(g,x+50.*Cos(face*bj_DEGTORAD),y+50.*Sin(face*bj_DEGTORAD),200.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodRifleman.mdl",Picked,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodSorceress.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',xnew,ynew,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0GN')call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullset dammi=CreateUnit(p,'h00U',xnew,ynew,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0GO')call IssueTargetOrderById(dammi,$D007F,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,5,gdamage)endifif wait<=0 or GetUnitState(caster,UNIT_STATE_LIFE)<.405 then
call SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call PauseUnit(caster,false)
call SetUnitVertexColor(caster,$9B,$FF,$FF,$FF)call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call IssueImmediateOrderById(caster,$D0080)endifset t=nullset caster=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gdamage=null
set p=nullset Picked=nullset dammi=nullcall RemoveRect(r)set r=nullendfunctionfunction Trig_Bloody_Jump_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)local group gdamage=CreateGroup()if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifcall SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitTimeScale(caster,3.)
call PauseUnit(caster,true)call SetUnitVertexColor(caster,$9B,$FF,$FF,$96)call SetUnitAnimationByIndex(caster,0)set angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))+200.call SetUnitFacing(caster,angle)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,6)
call SaveInteger(udg_hash,h,3,R2I(dist/ 30.))call SaveReal(udg_hash,h,4,angle)call SaveGroupHandle(udg_hash,h,5,gdamage)call TimerStart(t,.03,true,function Trig_Bloody_Jump_Periodic_Actions)set caster=nullset target=nullcall RemoveLocation(loc)
set loc=null
set t=nullset gdamage=null
endfunctionfunction Trig_Bloody_Jump_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0GM'endfunctionfunction InitTrig_Bloody_Jump takes nothing returns nothinglocal integer index=0set gg_trg_Bloody_Jump=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Bloody_Jump,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Bloody_Jump,Condition(function Trig_Bloody_Jump_Conditions))
call TriggerAddAction(gg_trg_Bloody_Jump,function Trig_Bloody_Jump_Actions)endfunctionfunction Trig_Blood_Absorption_Destroy_Effects_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local effect efset ef=LoadEffectHandle(udg_hash,h,1)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,2)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendfunctionfunction Trig_Blood_Absorption_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real radius=200.local real damage=200.local real heal=300.
local unit Pickedlocal group g=CreateGroup()local player p=GetOwningPlayer(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local effect efcall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HeroBloodElfBlood.mdl",caster,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",caster,"chest"))set ef=AddSpecialEffect("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",x+radius*Cos(120.*bj_DEGTORAD),y+radius*Sin(120.*bj_DEGTORAD))call SaveEffectHandle(udg_hash,h,1,ef)set ef=nullset ef=AddSpecialEffect("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",x+radius*Cos(240.*bj_DEGTORAD),y+radius*Sin(240.*bj_DEGTORAD))call SaveEffectHandle(udg_hash,h,2,ef)set ef=nullset ef=AddSpecialEffect("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",x+radius*Cos(360.*bj_DEGTORAD),y+radius*Sin(360.*bj_DEGTORAD))call SaveEffectHandle(udg_hash,h,3,ef)set ef=nullcall TimerStart(t,1.2,false,function Trig_Blood_Absorption_Destroy_Effects_Actions)call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)+heal)call GroupEnumUnitsInRange(g,x,y,radius,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodSorceress.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\VampiricPotion\\VampPotionCaster.mdl",Picked,"origin"))
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_LIFE)+damage/ 2)
endifcall GroupRemoveUnit(g,Picked)endloopset caster=nullset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullendfunctionfunction Trig_Blood_Absorption_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0GQ'endfunctionfunction InitTrig_Blood_Absorption takes nothing returns nothing
local integer index=0set gg_trg_Blood_Absorption=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blood_Absorption,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blood_Absorption,Condition(function Trig_Blood_Absorption_Conditions))call TriggerAddAction(gg_trg_Blood_Absorption,function Trig_Blood_Absorption_Actions)endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==9)
endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0ES',GetTriggerUnit())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0ES',GetAttacker())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func004C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0FJ',GetTriggerUnit())>0)and(GetRandomInt(1,3)==4)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func005C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0FJ',GetAttacker())>0)and(GetRandomInt(1,3)==4)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func006C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GK',GetTriggerUnit())>0)and(GetRandomInt(1,5)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func007C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GK',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func008C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GQ',GetTriggerUnit())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func009C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GQ',GetAttacker())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Actions takes nothing returns nothingif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func002C())thencall IssueTargetOrderById(GetTriggerUnit(),$D00DE,GetAttacker())
endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func003C())thencall IssueTargetOrderById(GetAttacker(),$D00DE,GetTriggerUnit())
endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func004C())thencall IssueTargetOrderById(GetTriggerUnit(),$D0079,GetAttacker())
endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func005C())thencall IssueTargetOrderById(GetAttacker(),$D0079,GetTriggerUnit())
endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func006C())thencall IssueTargetOrderById(GetTriggerUnit(),$D0079,GetAttacker())
endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func007C())thencall IssueTargetOrderById(GetAttacker(),$D0079,GetTriggerUnit())
endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func008C())thencall IssueImmediateOrderById(GetTriggerUnit(),$D0080)endifif(Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Func009C())thencall IssueImmediateOrderById(GetAttacker(),$D0080)endifendfunctionfunction InitTrig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u takes nothing returns nothingset gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u,EVENT_PLAYER_UNIT_ATTACKED)
call TriggerAddCondition(gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u,Condition(function Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Conditions))call TriggerAddAction(gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u,function Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Actions)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==9)
endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002001002 takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003002001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003002002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GF',GetEnumUnit())>0)and(GetRandomInt(1,1)==1)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003001001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003001002 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false)!=null
endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003001 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003001001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003001002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003002001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003002002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GM',GetEnumUnit())>0)and(GetRandomInt(1,1)==1)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003001001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003001002 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_STRUCTURE)==false)!=null
endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003001 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003001001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003001002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003002001 takes nothing returns booleanreturn(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003002002 takes nothing returns booleanreturn(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003002001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003002002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003 takes nothing returns boolean
return GetBooleanAnd(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003001(),Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003002())endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func002C takes nothing returns boolean
return(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GI',GetEnumUnit())>0)and(GetRandomInt(1,1)==1)endfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002A takes nothing returns nothingif(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(1200.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func001002001003)))if(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func001Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D0296,udg_Temp_Unit)endifendifif(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(1000.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func001002001003)))if(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func002Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D010E,udg_Temp_Unit)endifendifif(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003C())then
set udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(1200.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func001002001003)))if(Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002Func003Func002C())thencall IssueTargetOrderById(GetEnumUnit(),$D007D,udg_Temp_Unit)endifendifendfunctionfunction Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Actions takes nothing returns nothingcall ForGroupBJ(GetUnitsInRectMatching(bj_mapInitialPlayableArea,Condition(function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002001002)),function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Func002A)
endfunctionfunction InitTrig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4 takes nothing returns nothingset gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4=CreateTrigger()
call TriggerRegisterTimerEventPeriodic(gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4,1.)call TriggerAddCondition(gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4,Condition(function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Conditions))
call TriggerAddAction(gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4,function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Actions)endfunctionfunction Trig_Hatred_of_fire_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0A0')endfunctionfunction timeout11 takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,40)call UnitRemoveAbility(u,'A0GY')
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset u=nullendfunctionfunction Trig_Hatred_of_fire_Actions takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)call TimerStart(t,12.,false,function timeout11)call SaveUnitHandle(udg_hash,h,40,u)
set t=nullset u=nullendfunctionfunction InitTrig_Hatred_of_fire takes nothing returns nothingset gg_trg_Hatred_of_fire=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Hatred_of_fire,EVENT_PLAYER_UNIT_SPELL_EFFECT)
call TriggerAddCondition(gg_trg_Hatred_of_fire,Condition(function Trig_Hatred_of_fire_Conditions))call TriggerAddAction(gg_trg_Hatred_of_fire,function Trig_Hatred_of_fire_Actions)endfunctionfunction firess takes nothing returns booleanreturn(GetSpellAbilityId()=='A0GZ')and GetUnitAbilityLevel(GetSpellAbilityUnit(),'A0GZ')==1endfunctionfunction timeout15 takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer wait=LoadInteger(udg_hash,h,42)local unit u=LoadUnitHandle(udg_hash,h,41)local unit z=LoadUnitHandle(udg_hash,h,43)local texttag txtif wait>0 and GetUnitAbilityLevel(u,'A09Y')==1 thenset wait=wait-1set txt=CreateTextTagUnitBJ(I2S((1*GetUnitAbilityLevel(u,'A0GZ'))),u,0,16,'d',$A,$A,0)call SetTextTagPermanent(txt,false)call SetTextTagVelocityBJ(txt,64,90)
call SetTextTagLifespan(txt,.6)call SaveInteger(udg_hash,h,42,wait)
call SetUnitAnimation(u,"Spell")
call SetUnitAbilityLevel(u,'A0GZ',GetUnitAbilityLevel(u,'A0GZ')+1)else
call IssueTargetOrderById(u,$D02B6,z)call UnitRemoveAbility(u,'A09Y')
call PauseUnit(u,false)call SetUnitAnimation(u,"stand")
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset txt=null
set t=nullset u=nullset z=nullendfunctionfunction fires takes nothing returns nothing
local unit u=GetSpellAbilityUnit()local unit z=GetSpellTargetUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=4
call PauseUnit(u,true)call TimerStart(t,.9,true,function timeout15)call SaveInteger(udg_hash,h,42,wait)
call SaveUnitHandle(udg_hash,h,41,u)
call SaveUnitHandle(udg_hash,h,43,z)
call UnitAddAbility(u,'A09Y')set t=nullset u=nullset z=nullendfunctionfunction InitTrig_set_fire takes nothing returns nothing
set gg_trg_set_fire=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_set_fire,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_set_fire,Condition(function firess))
call TriggerAddAction(gg_trg_set_fire,function fires)endfunctionfunction firess2 takes nothing returns booleanreturn(GetSpellAbilityId()=='A0GZ')and GetUnitAbilityLevel(GetSpellAbilityUnit(),'A0GZ')>1endfunctionfunction timeout16 takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,43)call SetUnitAbilityLevel(u,'A0GZ',1)
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set u=nullset t=nullendfunctionfunction fires2 takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)call UnitRemoveAbility(u,'A09Y')
call SaveUnitHandle(udg_hash,h,43,u)
call TimerStart(t,.5,false,function timeout16)set u=nullset t=nullendfunctionfunction InitTrig_set_fire_2 takes nothing returns nothingset gg_trg_set_fire_2=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_set_fire_2,EVENT_PLAYER_UNIT_SPELL_EFFECT)
call TriggerAddCondition(gg_trg_set_fire_2,Condition(function firess2))call TriggerAddAction(gg_trg_set_fire_2,function fires2)
endfunctionfunction Trig_the_creation_of_the_image_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0HG'endfunctionfunction timeout17 takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit u=LoadUnitHandle(udg_hash,h,46)local unit dammi=LoadUnitHandle(udg_hash,h,47)local unit dammi2local real x=LoadReal(udg_hash,h,44)
local real y=LoadReal(udg_hash,h,45)
local group g=CreateGroup()local unit Pickedcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl",dammi,"origin"))call GroupEnumUnitsInRange(g,x,y,380,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(u))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false then
call UnitDamageTargetBJ(u,Picked,($C8),ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",Picked,"origin"))else
if IsUnitAlly(Picked,GetOwningPlayer(u))and GetUnitTypeId(Picked)=='n01D' and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 thenset dammi2=CreateUnit(GetOwningPlayer(u),'h013',x,y,0)call UnitAddAbility(dammi2,'A0HI')call UnitApplyTimedLife(dammi2,'BTLF',1.)call IssueTargetOrderById(dammi2,$D0062,Picked)endifendifcall GroupRemoveUnit(g,Picked)endloopcall SetUnitTimeScalePercent(dammi,'d')call KillUnit(dammi)
call DestroyGroup(g)
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set g=nullset dammi=nullset dammi2=nullset Picked=nullset u=nullset t=nullendfunctionfunction Trig_the_creation_of_the_image_Actions takes nothing returns nothinglocal unit u=GetSpellAbilityUnit()local location locs=GetSpellTargetLoc()local real x=GetLocationX(locs)local real y=GetLocationY(locs)local unit dammi=CreateUnit(GetOwningPlayer(u),'n00I',x,y,GetUnitFacing(u))local timer t=CreateTimer()local integer h=GetHandleId(t)call UnitAddAbility(dammi,'Aloc')call TimerStart(t,2.07,false,function timeout17)
call SaveReal(udg_hash,h,44,x)call SaveReal(udg_hash,h,45,y)call SaveUnitHandle(udg_hash,h,46,u)
call SaveUnitHandle(udg_hash,h,47,dammi)
call SetUnitVertexColor(dammi,$FF,$FF,$FF,90)call SetUnitTimeScalePercent(dammi,80)call PauseUnit(dammi,true)call UnitApplyTimedLife(dammi,'BTLF',1.85)call SetUnitAnimation(dammi,"Spell Slam")set dammi=nullset u=nullcall RemoveLocation(locs)set locs=nullset t=nullendfunctionfunction InitTrig_the_creation_of_the_image takes nothing returns nothingset gg_trg_the_creation_of_the_image=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_the_creation_of_the_image,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_the_creation_of_the_image,Condition(function Trig_the_creation_of_the_image_Conditions))
call TriggerAddAction(gg_trg_the_creation_of_the_image,function Trig_the_creation_of_the_image_Actions)endfunctionfunction Trig_fiery_explosions_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0HK'endfunctionfunction timeout18 takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer wait=LoadInteger(udg_hash,h,50)local unit u=LoadUnitHandle(udg_hash,h,48)local unit j=LoadUnitHandle(udg_hash,h,49)local real x=GetUnitX(j)
local real y=GetUnitY(j)
local group g=CreateGroup()local unit Pickedif GetUnitState(j,UNIT_STATE_LIFE)>.0 thencall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl",x,y))endifcall GroupEnumUnitsInRange(g,x,y,300,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(u))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false then
call UnitDamageTargetBJ(u,Picked,(80),ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL)
endifcall GroupRemoveUnit(g,Picked)endloopcall DestroyGroup(g)
if wait<0 thencall DestroyTimer(t)
call UnitRemoveAbility(j,'B03J')
call FlushChildHashtable(udg_hash,h)
else
set wait=wait-1call SaveInteger(udg_hash,h,50,wait)
endifset t=nullset g=nullset Picked=nullset u=nullset j=nullendfunctionfunction Trig_fiery_explosions_Actions takes nothing returns nothing
local unit u=GetSpellAbilityUnit()local unit j=GetSpellTargetUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=GetRandomInt(3,8)
call TimerStart(t,1.,true,function timeout18)call SaveUnitHandle(udg_hash,h,48,u)
call SaveUnitHandle(udg_hash,h,49,j)
call SaveInteger(udg_hash,h,50,wait)
set u=nullset j=nullset t=nullendfunctionfunction InitTrig_fiery_explosions takes nothing returns nothing
set gg_trg_fiery_explosions=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_fiery_explosions,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_fiery_explosions,Condition(function Trig_fiery_explosions_Conditions))call TriggerAddAction(gg_trg_fiery_explosions,function Trig_fiery_explosions_Actions)endfunctionfunction Trig_Breathoffire_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit dammi=LoadUnitHandle(udg_hash,h,2)local real xt=LoadReal(udg_hash,h,3)
local real yt=LoadReal(udg_hash,h,4)
local boolean first=LoadBoolean(udg_hash,h,5)local integer order=GetUnitCurrentOrder(caster)local integer orderIdset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId thencall IssuePointOrderById(dammi,$D0264,xt,yt)
if first thenset first=falsecall SaveBoolean(udg_hash,h,5,first)
call TimerStart(t,1.,true,function Trig_Breathoffire_Periodic_Actions)endifelse
call RemoveUnit(dammi)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset dammi=nullendfunctionfunction Trig_Breathoffire_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loclocal real xtlocal real ytlocal unit target=GetSpellTargetUnit()local real angle
local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi
local boolean first=true
if target!=null then
set xt=GetUnitX(target)set yt=GetUnitY(target)else
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
endifset angle=bj_RADTODEG*Atan2(yt-y,xt-x)call SetUnitFacing(caster,angle)
set dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x+50.*Cos(angle*bj_DEGTORAD),y+50.*Sin(angle*bj_DEGTORAD),angle)
call UnitAddAbility(dammi,'A0HM')call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,dammi)call SaveReal(udg_hash,h,3,xt)call SaveReal(udg_hash,h,4,yt)call SaveBoolean(udg_hash,h,5,first)
call TimerStart(t,.04,true,function Trig_Breathoffire_Periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set target=nullset t=nullset dammi=nullendfunctionfunction Trig_Breathoffire_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0HL'endfunctionfunction InitTrig_Breathoffire takes nothing returns nothing
local integer index=0set gg_trg_Breathoffire=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Breathoffire,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Breathoffire,Condition(function Trig_Breathoffire_Conditions))call TriggerAddAction(gg_trg_Breathoffire,function Trig_Breathoffire_Actions)endfunctionfunction Trig_Fire_Explosions_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real xt=LoadReal(udg_hash,h,2)
local real yt=LoadReal(udg_hash,h,3)
local real damage=LoadReal(udg_hash,h,4)
local integer order=GetUnitCurrentOrder(caster)local player p=GetOwningPlayer(caster)local real xnewlocal real ynewlocal unit dammi
local integer orderIdlocal group glocal unit Pickedset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId thenset xnew=xt+GetRandomReal(-400.,400.)set ynew=yt+GetRandomReal(-400.,400.)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",xnew,ynew))set g=CreateGroup()call GroupEnumUnitsInRange(g,xnew,ynew,200.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,1.5)set dammi=CreateUnit(GetOwningPlayer(caster),'h00U',xnew,ynew,270.)call UnitAddAbility(dammi,'A0HR')call UnitApplyTimedLife(dammi,'BTLF',1.5)call IssueTargetOrderById(dammi,$D02B6,Picked)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl ",Picked,"chest"))
set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopelse
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset t=nullset caster=nullset dammi=nullendfunctionfunction Trig_Fire_Explosions_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local timer t=CreateTimer()local integer h=GetHandleId(t)local real damage=225.call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,xt)call SaveReal(udg_hash,h,3,yt)call SaveReal(udg_hash,h,4,damage)call TimerStart(t,.2,true,function Trig_Fire_Explosions_Periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Fire_Explosions_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0HQ'endfunctionfunction InitTrig_Fire_Explosions takes nothing returns nothinglocal integer index=0set gg_trg_Fire_Explosions=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Explosions,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Explosions,Condition(function Trig_Fire_Explosions_Conditions))
call TriggerAddAction(gg_trg_Fire_Explosions,function Trig_Fire_Explosions_Actions)endfunctionfunction Trig_BossStomp_Remove_DisArmor_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local group gdamage=LoadGroupHandle(udg_hash,h,1)local unit Pickedloop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullcall SetArmorAbilityLevel(Picked,16)
call GroupRemoveUnit(gdamage,Picked)
endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
set Picked=nullendfunctionfunction Trig_BossStomp_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real radius=400.local timer t=CreateTimer()local integer h=GetHandleId(t)local real damage=250.local player p=GetOwningPlayer(caster)local group g=CreateGroup()local group gdamage=CreateGroup()local unit Pickedlocal real distlocal real angle
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",x,y))
call GroupEnumUnitsInRange(g,x,y,radius,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,1.75)set dist=SquareRoot((GetUnitX(Picked)-x)*(GetUnitX(Picked)-x)+(GetUnitY(Picked)-y)*(GetUnitY(Picked)-y))
set angle=bj_RADTODEG*Atan2(GetUnitY(Picked)-y,GetUnitX(Picked)-x)call MoveUnit(Picked,(400.-dist)/ 400.+.25,(600.-dist),.0,angle,.0,false)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FireBallMissile\\FireBallMissile.mdl",Picked,"head"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FireBallMissile\\FireBallMissile.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"hand,left"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl",Picked,"hand,right"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl",Picked,"chest"))call SetArmorAbilityLevel(Picked,-16)call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,1,gdamage)call TimerStart(t,12.,false,function Trig_BossStomp_Remove_DisArmor_Actions)
set caster=nullset t=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gdamage=null
set Picked=nullendfunctionfunction Trig_BossStomp_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0HS'endfunctionfunction InitTrig_BossStomp takes nothing returns nothinglocal integer index=0set gg_trg_BossStomp=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BossStomp,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BossStomp,Condition(function Trig_BossStomp_Conditions))
call TriggerAddAction(gg_trg_BossStomp,function Trig_BossStomp_Actions)endfunctionfunction Trig_Mark_of_Fire_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit dammi=LoadUnitHandle(udg_hash,h,2)local effect eflocal integer wait=LoadInteger(udg_hash,h,4)
local group glocal unit Pickedlocal player plocal real scale
local real x
local real y
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,4,wait)set scale=1.+('d'-wait)*.015
call SetUnitScale(dammi,scale,scale,1.)else
set g=CreateGroup()set p=GetOwningPlayer(caster)set x=GetUnitX(dammi)set y=GetUnitY(dammi)call GroupEnumUnitsInRange(g,x,y,250.,null)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",x+100.*Cos(120.*bj_DEGTORAD),y+100.*Sin(120.*bj_DEGTORAD)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",x+100.*Cos(240.*bj_DEGTORAD),y+100.*Sin(240.*bj_DEGTORAD)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl",x+100.*Cos(360.*bj_DEGTORAD),y+100.*Sin(360.*bj_DEGTORAD)))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,GetUnitState(Picked,UNIT_STATE_MAX_LIFE)/ 2,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl ",Picked,"chest"))
endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullset ef=LoadEffectHandle(udg_hash,h,3)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,5)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,6)call DestroyEffect(ef)set ef=nullcall RemoveUnit(dammi)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset dammi=nullendfunctionfunction Trig_Mark_of_Fire_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',xt,yt,270.)local effect eflocal integer wait=$85local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,dammi)call SaveInteger(udg_hash,h,4,wait)set ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl",dammi,"origin")call SaveEffectHandle(udg_hash,h,3,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl",dammi,"origin")call SaveEffectHandle(udg_hash,h,5,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Doom\\DoomTarget.mdl",dammi,"origin")call SaveEffectHandle(udg_hash,h,6,ef)set ef=nullcall TimerStart(t,.03,true,function Trig_Mark_of_Fire_Periodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set dammi=nullset ef=nullset t=nullendfunctionfunction Trig_Mark_of_Fire_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0HT'endfunctionfunction InitTrig_Mark_of_Fire takes nothing returns nothing
local integer index=0set gg_trg_Mark_of_Fire=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Mark_of_Fire,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Mark_of_Fire,Condition(function Trig_Mark_of_Fire_Conditions))call TriggerAddAction(gg_trg_Mark_of_Fire,function Trig_Mark_of_Fire_Actions)endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Conditions takes nothing returns boolean
return(udg_Nomer_samoi_volni==$A)endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0A0',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0A0',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func004C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HL',GetTriggerUnit())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func005C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HL',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func006C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HP',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func007C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HP',GetAttacker())>0)and(GetRandomInt(1,3)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func008C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HT',GetTriggerUnit())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetTriggerUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func009C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HT',GetAttacker())>0)and(GetRandomInt(1,2)==1)and(IsPlayerInForce(GetOwningPlayer(GetAttacker()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Actions takes nothing returns nothingif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func002C())thencall IssueImmediateOrderById(GetTriggerUnit(),$D00C4)endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func003C())thencall IssueImmediateOrderById(GetAttacker(),$D00C4)endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func004C())thencall IssueTargetOrderById(GetTriggerUnit(),$D0278,GetAttacker())
endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func005C())thencall IssueTargetOrderById(GetAttacker(),$D0278,GetTriggerUnit())
endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func006C())thencall IssueTargetOrderById(GetTriggerUnit(),$D02BC,GetAttacker())
endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func007C())thencall IssueTargetOrderById(GetAttacker(),$D02BC,GetTriggerUnit())
endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func008C())thencall IssuePointOrderById(GetTriggerUnit(),$D00EA,GetUnitX(GetAttacker()),GetUnitY(GetAttacker()))endifif(Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Func009C())thencall IssuePointOrderById(GetAttacker(),$D00EA,GetUnitX(GetTriggerUnit()),GetUnitY(GetTriggerUnit()))
endifendfunctionfunction InitTrig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire takes nothing returns nothingset gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire,Condition(function Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Conditions))
call TriggerAddAction(gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire,function Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Actions)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Conditions takes nothing returns booleanreturn(udg_Nomer_samoi_volni==$A)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002001002 takes nothing returns booleanreturn(IsPlayerInForce(GetOwningPlayer(GetFilterUnit()),udg_Players_Enemy_Group))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003002002 takes nothing returns boolean
return(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003002001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003002002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0GZ',GetEnumUnit())>0)and(GetRandomInt(1,2)==3)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003002002 takes nothing returns boolean
return(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003002001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003002002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HH',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003002001 takes nothing returns boolean
return(GetUnitTypeId(GetFilterUnit())=='n01D')endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003002002 takes nothing returns boolean
return(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003002001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003002002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func004C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HG',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func003002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func003002001003002 takes nothing returns booleanreturn(IsPlayerAlly(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func003002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func003002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func003002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func004C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HJ',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003002002 takes nothing returns boolean
return(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003002001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003002002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HO',GetEnumUnit())>0)and(GetRandomInt(1,2)==3)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003002002 takes nothing returns boolean
return(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003002001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003002002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HQ',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003001 takes nothing returns booleanreturn(IsUnitAliveBJ(GetFilterUnit()))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003002001 takes nothing returns boolean
return(IsUnitType(GetFilterUnit(),UNIT_TYPE_MAGIC_IMMUNE)==false)!=nullendfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003002002 takes nothing returns boolean
return(IsPlayerEnemy(GetOwningPlayer(GetFilterUnit()),GetOwningPlayer(GetEnumUnit())))endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003002 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003002001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003002002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003 takes nothing returns booleanreturn GetBooleanAnd(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003001(),Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003002())endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func002C takes nothing returns booleanreturn(udg_Temp_Unit!=null)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007C takes nothing returns booleanreturn(GetUnitAbilityLevelSwapped('A0HS',GetEnumUnit())>0)and(GetRandomInt(1,2)==1)endfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002A takes nothing returns nothing
if(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(600.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func001Func001002001003)))call IssueTargetOrderById(GetEnumUnit(),$D02B6,udg_Temp_Unit)endifif(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(800.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func001002001003)))if(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func002Func002C())thencall IssueImmediateOrderById(GetEnumUnit(),$D0081)endifendifif(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(700.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func003002001003)))if(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func003Func004C())thencall IssuePointOrderById(GetEnumUnit(),$D00FA,GetUnitX(udg_Temp_Unit),GetUnitY(udg_Temp_Unit))endifendifif(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(700.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func003002001003)))if(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func004Func004C())thencall IssueTargetOrderById(GetEnumUnit(),$D0062,udg_Temp_Unit)endifendifif(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(900.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func005Func001002001003)))call IssueTargetOrderById(GetEnumUnit(),$D0255,udg_Temp_Unit)endifif(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(900.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func006Func001002001003)))call IssueTargetOrderById(GetEnumUnit(),$D0278,udg_Temp_Unit)endifif(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007C())thenset udg_Temp_Unit=GroupPickRandomUnit(GetUnitsInRangeOfLocMatching(300.,GetUnitLoc(GetEnumUnit()),Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func001002001003)))if(Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002Func007Func002C())thencall IssueImmediateOrderById(GetEnumUnit(),$D0105)endifendifendfunctionfunction Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Actions takes nothing returns nothingcall ForGroupBJ(GetUnitsInRectMatching(bj_mapInitialPlayableArea,Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002001002)),function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Func002A)
endfunctionfunction InitTrig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp takes nothing returns nothingset gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp,1.)call TriggerAddCondition(gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp,Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Conditions))
call TriggerAddAction(gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp,function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Actions)endfunctionfunction Trig_Power_of_Skeletons_Remove_Bonuses_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer damagebonus=LoadInteger(udg_hash,h,1)local integer asbonus=LoadInteger(udg_hash,h,2)local integer regenbonus=LoadInteger(udg_hash,h,3)local unit target=LoadUnitHandle(udg_hash,h,4)call SetAttackAbilityLevel(target,-damagebonus)call SetAttackSpeedAbilityLevel(target,-asbonus)
call SetUnitLifeAndManaRegeneration(target,"life",-regenbonus)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset target=nullendfunctionfunction Trig_Power_of_Skeletons_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local integer lvl=GetUnitAbilityLevel(caster,'A0B6')
local timer t=CreateTimer()local integer h=GetHandleId(t)local real time=14.local integer damagebonus=$A+5*lvllocal integer asbonus=$F+5*lvllocal integer regenbonus=3+5*lvl
if IsUnitType(target,UNIT_TYPE_HERO) thenset damagebonus=$F+$A*lvlset asbonus=20+$A*lvlendifcall SetAttackAbilityLevel(target,damagebonus)call SetAttackSpeedAbilityLevel(target,asbonus)call SetUnitLifeAndManaRegeneration(target,"life",regenbonus)call SaveInteger(udg_hash,h,1,damagebonus)call SaveInteger(udg_hash,h,2,asbonus)call SaveInteger(udg_hash,h,3,regenbonus)call SaveUnitHandle(udg_hash,h,4,target)
call TimerStart(t,time,false,function Trig_Power_of_Skeletons_Remove_Bonuses_Actions)set caster=nullset target=nullset t=nullendfunctionfunction Trig_Power_of_Skeletons_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0B6'endfunctionfunction InitTrig_Power_of_Skeletons takes nothing returns nothinglocal integer index=0set gg_trg_Power_of_Skeletons=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Power_of_Skeletons,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Power_of_Skeletons,Condition(function Trig_Power_of_Skeletons_Conditions))call TriggerAddAction(gg_trg_Power_of_Skeletons,function Trig_Power_of_Skeletons_Actions)endfunctionfunction Trig_Water_Elemental_Load_Actions takes nothing returns nothing
call AbilityPreload('A071',6)call AbilityPreload('A072',6)call AbilityPreload('A06Z',6)call AbilityPreload('A078',3)call AbilityPreload('A06V',6)call AbilityPreload('A06X',1)call AbilityPreload('A07L',1)call AbilityPreload('A07K',1)call AbilityPreload('A07J',1)call EffectPreload("war3mapImported\\s_WateryAura.mdx")call EffectPreload("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl")call EffectPreload("war3mapImported\\AquaSpike.mdx")
call EffectPreload("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl")
call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodFootman.mdl")
call UnitPreload('h017')
call UnitPreload('h01D')
call UnitPreload('h01E')
call UnitPreload('h01F')
call UnitPreload('h01G')
call UnitPreload('h01H')
call EnableTrigger(gg_trg_spirits_of_water_dead)
call EnableTrigger(gg_trg_Skill_Gertva)call EnableTrigger(gg_trg_Opening_Streams)call EnableTrigger(gg_trg_Tsunami)call EnableTrigger(gg_trg_Water_Explosion)endfunctionfunction InitTrig_Water_Elemental_Load takes nothing returns nothing
set gg_trg_Water_Elemental_Load=CreateTrigger()call TriggerAddAction(gg_trg_Water_Elemental_Load,function Trig_Water_Elemental_Load_Actions)endfunctionfunction Trig_Init_kreeps_Actions takes nothing returns nothingset udg_spirits_of_water[1]='h017'set udg_spirits_of_water[2]='h01D'set udg_spirits_of_water[3]='h01E'set udg_spirits_of_water[4]='h01F'set udg_spirits_of_water[5]='h01G'set udg_spirits_of_water[6]='h01H'set udg_Integer_spirits_of_water=0endfunctionfunction InitTrig_Init_kreeps takes nothing returns nothingset gg_trg_Init_kreeps=CreateTrigger()call TriggerAddAction(gg_trg_Init_kreeps,function Trig_Init_kreeps_Actions)endfunctionfunction Trig_spirits_of_water_dead_Conditions takes nothing returns boolean
local integer id=GetUnitTypeId(GetDyingUnit())return(id=='h017' or id=='h01D' or id=='h01E' or id=='h01F' or id=='h01G' or id=='h01H')and IsUnitIllusion(GetDyingUnit())==falseendfunctionfunction Trig_spirits_of_water_dead_Actions takes nothing returns nothinglocal unit elemental=GetDyingUnit()local unit hero=LoadUnitHandle(udg_hash,GetHandleId(elemental),63)call SaveInteger(udg_hash,GetHandleId(hero),64,LoadInteger(udg_hash,GetHandleId(hero),64)-1)
call DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(elemental),'{'))call FlushChildHashtable(udg_hash,GetHandleId(elemental))endfunctionfunction InitTrig_spirits_of_water_dead takes nothing returns nothinglocal integer index=0set gg_trg_spirits_of_water_dead=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_spirits_of_water_dead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_spirits_of_water_dead,Condition(function Trig_spirits_of_water_dead_Conditions))
call TriggerAddAction(gg_trg_spirits_of_water_dead,function Trig_spirits_of_water_dead_Actions)endfunctionfunction Trig_Skill_Gertva_Conditions takes nothing returns booleanlocal integer id=GetUnitTypeId(GetSpellTargetUnit())
return GetSpellAbilityId()=='A06X' and IsUnitIllusion(GetSpellTargetUnit())==false and(id=='H01I' or id=='h017' or id=='h01D' or id=='h01E' or id=='h01F' or id=='h01G' or id=='h01H')endfunctionfunction Trig_Skill_Gertva_Actions takes nothing returns nothing
call DestroyEffect(AddSpecialEffectTarget("units\\human\\WaterElemental\\WaterElemental.mdl",GetSpellTargetUnit(),"chest"))call SetUnitState(GetSpellTargetUnit(),UNIT_STATE_LIFE,GetUnitState(GetSpellTargetUnit(),UNIT_STATE_LIFE)+(.66*GetUnitState(GetSpellAbilityUnit(),UNIT_STATE_LIFE))+.1*GetUnitState(GetSpellTargetUnit(),UNIT_STATE_MAX_LIFE))call KillUnit(GetSpellAbilityUnit())
endfunctionfunction InitTrig_Skill_Gertva takes nothing returns nothing
local integer index=0set gg_trg_Skill_Gertva=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Skill_Gertva,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Skill_Gertva,Condition(function Trig_Skill_Gertva_Conditions))call TriggerAddAction(gg_trg_Skill_Gertva,function Trig_Skill_Gertva_Actions)endfunctionfunction Trig_Opening_Streams_Destructables takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Opening_Streams_unit_Actions takes nothing returns nothing
local timer tu=GetExpiredTimer()
local integer ht=GetHandleId(tu)
local unit pilot=LoadUnitHandle(udg_hash,ht,1)local real dist=LoadReal(udg_hash,ht,2)local real speed=LoadReal(udg_hash,ht,3)
local real angleu=LoadReal(udg_hash,ht,4)local real waitu=LoadReal(udg_hash,ht,5)
local real waitucheck=LoadReal(udg_hash,ht,6)local unit caster=LoadUnitHandle(udg_hash,ht,7)local real damage=LoadReal(udg_hash,ht,8)local real x=GetUnitX(pilot)+speed*Cos(angleu*bj_DEGTORAD)local real y=GetUnitY(pilot)+speed*Sin(angleu*bj_DEGTORAD)local rect r
if waitu>0 thenset waitu=waitu-1call SaveReal(udg_hash,ht,5,waitu)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false and GetTerrainCliffLevel(x,y)==GetTerrainCliffLevel(GetUnitX(pilot),GetUnitY(pilot))thencall SetUnitX(pilot,x)call SetUnitY(pilot,y)endifif waitu<=waitucheck thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",pilot,"chest"))call SetUnitFlyHeight(pilot,0,2*(dist+50))endifelse
set r=Rect(x-175.,y-175.,x+175.,y+175.)call EnumDestructablesInRect(r,null,function Trig_Opening_Streams_Destructables)
call UnitDamageTarget(caster,pilot,damage/ 2,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodFootman.mdl",pilot,"origin"))call SetUnitPathing(pilot,true)call RemoveRect(r)set r=nullcall FlushChildHashtable(udg_hash,ht)call DestroyTimer(tu)endifset tu=nullset pilot=nullset caster=nullendfunctionfunction Trig_Opening_Streams_periodic_Actions takes nothing returns nothing
local timer tper=GetExpiredTimer()local integer hper=GetHandleId(tper)
local unit caster=LoadUnitHandle(udg_hash,hper,1)local real xloc=LoadReal(udg_hash,hper,2)local real yloc=LoadReal(udg_hash,hper,3)local integer wait=LoadInteger(udg_hash,hper,4)local real damage=LoadReal(udg_hash,hper,5)local real angle=10.*waitlocal unit array waterlocal integer lop=1local effect eflocal real x
local real y
local timer tulocal integer ht
local group glocal unit Pickedlocal real distlocal real angleulocal real speed
local real waitu
if wait<50 thenloop
exitwhen lop>18set x=xloc+(350.-(wait*5.))*Cos(angle*bj_DEGTORAD)set y=yloc+(350.-(wait*5.))*Sin(angle*bj_DEGTORAD)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thenset water[lop]=LoadUnitHandle(udg_hash,hper,5+lop)call SetUnitPosition(water[lop],x,y)
endifset angle=angle+20.set lop=lop+1set water[lop]=nullendloopset wait=wait+1call SaveInteger(udg_hash,hper,4,wait)else
set angle=72.loop
set lop=lop+1exitwhen lop>6set x=xloc+125.*Cos(angle*bj_DEGTORAD)set y=yloc+125.*Sin(angle*bj_DEGTORAD)call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",x,y))
call DestroyEffect(AddSpecialEffect("war3mapImported\\AquaSpike.mdx",x,y))set angle=angle+72.endloopset lop=1loop
exitwhen lop>18set water[lop]=LoadUnitHandle(udg_hash,hper,5+lop)set ef=LoadEffectHandle(udg_hash,GetHandleId(water[lop]),1)call DestroyEffect(ef)call FlushChildHashtable(udg_hash,GetHandleId(water[lop]))call UnitApplyTimedLife(water[lop],'BTLF',.5)call KillUnit(water[lop])set water[lop]=nullset ef=nullset lop=lop+1endloopset g=CreateGroup()call GroupEnumUnitsInRange(g,xloc,yloc,350.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(caster))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_GROUND) and GetUnitTypeId(Picked)!='h00U' thenset tu=CreateTimer()
set ht=GetHandleId(tu)call UnitAddAbility(Picked,'Amrf')call UnitRemoveAbility(Picked,'Amrf')call SetUnitPathing(Picked,false)set dist=300.-(SquareRoot((GetUnitX(Picked)-xloc)*(GetUnitX(Picked)-xloc)+(GetUnitY(Picked)-yloc)*(GetUnitY(Picked)-yloc)))set speed=(2*dist)/ 80.+3.125set angleu=bj_RADTODEG*Atan2(GetUnitY(Picked)-yloc,GetUnitX(Picked)-xloc)set waitu=((2*dist)+50.)/(speed*2)call SetUnitFlyHeight(Picked,dist+50,2*(dist+50))call SaveUnitHandle(udg_hash,ht,1,Picked)call SaveReal(udg_hash,ht,2,dist)call SaveReal(udg_hash,ht,3,speed)call SaveReal(udg_hash,ht,4,angleu)call SaveReal(udg_hash,ht,5,waitu)call SaveReal(udg_hash,ht,6,(waitu/ 2))call SaveUnitHandle(udg_hash,ht,7,caster)call SaveReal(udg_hash,ht,8,damage)call UnitDamageTarget(caster,Picked,damage/ 2,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",Picked,"chest"))call TimerStart(tu,.025,true,function Trig_Opening_Streams_unit_Actions)
set tu=nullendifcall GroupRemoveUnit(g,Picked)endloopcall FlushChildHashtable(udg_hash,hper)call DestroyTimer(tper)endifset wait=wait+1call SaveInteger(udg_hash,hper,4,wait)call DestroyGroup(g)
set g=nullset Picked=nullset tper=nullset caster=nullendfunctionfunction Trig_Opening_Streams_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real xloc=GetLocationX(loc)local real yloc=GetLocationY(loc)local real angle=.0local integer wait=0
local unit array waterlocal integer lop=1local real x
local real y
local timer tper=CreateTimer()local integer hper=GetHandleId(tper)
local effect eflocal integer lvl=GetUnitAbilityLevel(caster,'A072')
local real damage=($F*lvl)+(5*lvl*lvl)+20.loop
exitwhen lop>18set x=xloc+350.*Cos(angle*bj_DEGTORAD)set y=yloc+350.*Sin(angle*bj_DEGTORAD)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thenset water[lop]=CreateUnit(p,'h00U',x,y,.0)call SaveUnitHandle(udg_hash,hper,5+lop,water[lop])set ef=AddSpecialEffectTarget("war3mapImported\\s_WateryAura.mdx",water[lop],"chest")call SaveEffectHandle(udg_hash,GetHandleId(water[lop]),1,ef)
set ef=nullendifset angle=angle+20.set lop=lop+1set water[lop]=nullendloopcall SaveUnitHandle(udg_hash,hper,1,caster)call SaveReal(udg_hash,hper,2,xloc)call SaveReal(udg_hash,hper,3,yloc)call SaveInteger(udg_hash,hper,4,wait)call SaveReal(udg_hash,hper,5,damage)call TimerStart(tper,.04,true,function Trig_Opening_Streams_periodic_Actions)set caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
set tper=nullendfunctionfunction Trig_Opening_Streams_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A072'endfunctionfunction InitTrig_Opening_Streams takes nothing returns nothinglocal integer index=0set gg_trg_Opening_Streams=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Opening_Streams,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Opening_Streams,Condition(function Trig_Opening_Streams_Conditions))
call TriggerAddAction(gg_trg_Opening_Streams,function Trig_Opening_Streams_Actions)endfunctionfunction Trig_water_explosion_Dest_Actions takes nothing returns nothing
call KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_water_explosion_periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer amount=LoadInteger(udg_hash,h,1)local unit caster=LoadUnitHandle(udg_hash,h,2)local real xloc=LoadReal(udg_hash,h,3)local real yloc=LoadReal(udg_hash,h,4)local real damage=LoadReal(udg_hash,h,5)
local real stuntime=LoadReal(udg_hash,h,6)local unit u
local real angle=0local real angle2=0local real dist=0local real x=0local real y=0local group glocal group gmain=CreateGroup()local player p=GetOwningPlayer(caster)local unit Pickedlocal rect r
if amount==7 thenset angle=51.43set angle2=51.43
set dist=$AF
endifif amount==1 thenset angle=120.set angle2=120.set dist=0endifif amount==$D thenset angle=27.69set angle2=27.69
set dist=350
endifset bj_forLoopAIndex=1loop
exitwhen bj_forLoopAIndex>amount
set g=CreateGroup()set x=xloc+dist*Cos(angle*bj_DEGTORAD)set y=yloc+dist*Sin(angle*bj_DEGTORAD)set r=Rect(x-100.,y-100.,x+100.,y+100.)call EnumDestructablesInRect(r,null,function Trig_water_explosion_Dest_Actions)call RemoveRect(r)set r=nullcall DestroyEffect(AddSpecialEffect("war3mapImported\\s_WateryAura.mdx",x,y))call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",x,y))
call GroupEnumUnitsInRange(g,x,y,100.,null)call GroupAddGroup(g,gmain)call GroupClear(g)call DestroyGroup(g)
set g=nullset bj_forLoopAIndex=bj_forLoopAIndex+1set angle=angle+angle2endlooploop
set Picked=FirstOfGroup(gmain)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,stuntime)endifcall GroupRemoveUnit(gmain,Picked)endloopcall SaveInteger(udg_hash,h,1,amount-6)if amount<-1 thencall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
else
call TimerStart(t,.75,false,function Trig_water_explosion_periodic_Actions)endifset t=nullset caster=nullcall GroupClear(gmain)call DestroyGroup(gmain)
set gmain=nullset p=nullset Picked=nullendfunctionfunction Trig_water_explosion_Actions takes nothing returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer amount=$Dlocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real xloc=GetLocationX(loc)local real yloc=GetLocationY(loc)local integer lvl=GetUnitAbilityLevel(caster,'A071')
local real damagelocal real stuntime=1.35+(.15*lvl)if lvl==1 thenset damage=30.endifif lvl==2 thenset damage=55.endifif lvl==3 thenset damage=75.endifif lvl==4 thenset damage=110.endifif lvl==5 thenset damage=145.endifif lvl==6 thenset damage=190.endifcall SaveInteger(udg_hash,h,1,amount)call SaveUnitHandle(udg_hash,h,2,caster)
call SaveReal(udg_hash,h,3,xloc)
call SaveReal(udg_hash,h,4,yloc)
call SaveReal(udg_hash,h,5,damage)call SaveReal(udg_hash,h,6,stuntime)
call TimerStart(t,.06,false,function Trig_water_explosion_periodic_Actions)set t=nullset caster=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_water_explosion_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A071'endfunctionfunction InitTrig_Water_Explosion takes nothing returns nothinglocal integer index=0set gg_trg_Water_Explosion=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Water_Explosion,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Water_Explosion,Condition(function Trig_water_explosion_Conditions))
call TriggerAddAction(gg_trg_Water_Explosion,function Trig_water_explosion_Actions)endfunctionfunction Trig_Tsunami_periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local real damage=LoadReal(udg_hash,h,3)
local group g=LoadGroupHandle(udg_hash,h,4)local unit array waterlocal integer lop=1local group grup=CreateGroup()local unit Pickedlocal real x
local real y
local boolean create
local integer countlocal integer lopalocal unit dammi
if wait>0 thenloop
exitwhen lop>60set water[lop]=LoadUnitHandle(udg_hash,h,5+lop)set x=GetUnitX(water[lop])+25.*Cos(GetUnitFacing(water[lop])*bj_DEGTORAD)set y=GetUnitY(water[lop])+25.*Sin(GetUnitFacing(water[lop])*bj_DEGTORAD)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(water[lop],x,y)
endifcall GroupEnumUnitsInRange(grup,x,y,'}',null)loop
set Picked=FirstOfGroup(grup)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(caster))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitInGroup(Picked,g)==false thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call AddSpecialEffectTarget("Abilities\\Spells\\Other\\CrushingWave\\CrushingWaveDamage.mdl",Picked,"chest")
call GroupAddUnit(g,Picked)endifcall GroupRemoveUnit(grup,Picked)endloopset Picked=nullset water[lop]=nullset lop=lop+1endloopset wait=wait-1call SaveInteger(udg_hash,h,2,wait)call SaveGroupHandle(udg_hash,h,4,g)
else
set create=LoadBoolean(udg_hash,h,5)
if create thenset count=(GetUnitAbilityLevel(caster,'A06Z')+2)-LoadInteger(udg_hash,GetHandleId(caster),64)call SaveInteger(udg_hash,GetHandleId(caster),64,GetUnitAbilityLevel(caster,'A06Z')+2)set lopa=1loop
exitwhen lopa>countset water[lop]=LoadUnitHandle(udg_hash,h,5+GetRandomInt(1,60))set dammi=CreateUnit(GetOwningPlayer(caster),udg_spirits_of_water[GetUnitAbilityLevel(caster,'A06Z')],GetUnitX(water[lop]),GetUnitY(water[lop]),GetRandomReal(0,360))call SaveUnitHandle(udg_hash,GetHandleId(dammi),63,caster)set dammi=nullset water[lop]=nullset lopa=lopa+1endloopendifloop
exitwhen lop>60set water[lop]=LoadUnitHandle(udg_hash,h,5+lop)set x=GetUnitX(water[lop])set y=GetUnitY(water[lop])if lop-(lop/ 2)*2==0 thencall AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",x,y)endifif lop-(lop/ 4)*4==0 thencall AddSpecialEffect("war3mapImported\\AquaSpike.mdx",x,y)endifcall DestroyEffect(LoadEffectHandle(udg_hash,GetHandleId(water[lop]),1))
call KillUnit(water[lop])set water[lop]=nullcall FlushChildHashtable(udg_hash,GetHandleId(water[lop]))set lop=lop+1endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifcall DestroyGroup(grup)set grup=nullset t=nullset caster=nullset g=nullendfunctionfunction Trig_Tsunami_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real xloc=GetLocationX(loc)local real yloc=GetLocationY(loc)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local unit array waterlocal integer lopa=1
local integer lopb=1
local real anglecaster=bj_RADTODEG*Atan2(yloc-GetUnitY(caster),xloc-GetUnitX(caster))local real xsmec=xc-400.*Cos(anglecaster*bj_DEGTORAD)local real ysmec=yc-400.*Sin(anglecaster*bj_DEGTORAD)local real anglesmec=.0local real xp=xsmec+630.*Cos((anglecaster-90.)*bj_DEGTORAD)local real yp=ysmec+630.*Sin((anglecaster-90.)*bj_DEGTORAD)local timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=40local integer lvl=GetUnitAbilityLevel(caster,'A078')
local integer lvlup=GetUnitAbilityLevel(caster,'A0Q9')local boolean create
local real damagelocal group g=CreateGroup()local effect efif lvl>0 thenset damage=lvl*(2.*(62.5+GetHeroInt(caster,true)))set create=false
endifif lvlup>0 thenset damage=lvlup*(2.*(87.5+GetHeroInt(caster,true)))+25.
set create=trueendifloop
exitwhen lopa>3set xp=xp+80.*Cos(anglecaster*bj_DEGTORAD)set yp=yp+80.*Sin(anglecaster*bj_DEGTORAD)set lopb=1loop
exitwhen lopb>20
if IsTerrainPathable(xp-(lopb*60.)*Cos((anglecaster-90.)*bj_DEGTORAD),yp-(lopb*60.)*Sin((anglecaster-90.)*bj_DEGTORAD),PATHING_TYPE_FLYABILITY)==false thenset water[(20*lopa)+lopb-20]=CreateUnit(p,'h00U',xp-(lopb*60.)*Cos((anglecaster-90.)*bj_DEGTORAD),yp-(lopb*60.)*Sin((anglecaster-90.)*bj_DEGTORAD),anglecaster)set ef=AddSpecialEffectTarget("war3mapImported\\s_WateryAura.mdx",water[(20*lopa)+lopb-20],"chest")call SaveUnitHandle(udg_hash,h,5+(20*lopa)+lopb-20,water[(20*lopa)+lopb-20])
call SaveEffectHandle(udg_hash,GetHandleId(water[(20*lopa)+lopb-20]),1,ef)set ef=nullset water[(20*lopa)+lopb-20]=nullendifset lopb=lopb+1endloopset lopa=lopa+1endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,wait)call SaveReal(udg_hash,h,3,damage)call SaveBoolean(udg_hash,h,5,create)call SaveGroupHandle(udg_hash,h,4,g)
call TimerStart(t,.04,true,function Trig_Tsunami_periodic_Actions)set caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
set t=nullset g=nullendfunctionfunction Trig_Tsunami_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A078' or GetSpellAbilityId()=='A0Q9')endfunctionfunction InitTrig_Tsunami takes nothing returns nothinglocal integer index=0set gg_trg_Tsunami=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Tsunami,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Tsunami,Condition(function Trig_Tsunami_Conditions))
call TriggerAddAction(gg_trg_Tsunami,function Trig_Tsunami_Actions)endfunctionfunction Trig_Guardsman_Load_Actions takes nothing returns nothingcall AbilityPreload('A0EZ',6)call AbilityPreload('A0ET',6)call AbilityPreload('A0EU',6)call AbilityPreload('A0EY',3)call AbilityPreload('A0EV',1)call AbilityPreload('A0EX',2)call AbilityPreload('A0F0',6)call AbilityPreload('B02I',1)call AbilityPreload('B02J',1)call EffectPreload("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl")call EffectPreload("Abilities\\Spells\\Human\\Defend\\DefendCaster.mdl")
call EffectPreload("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl")call EffectPreload("Abilities\\Spells\\Orc\\Bloodlust\\BloodlustTarget.mdl")
call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl")call EffectPreload("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl")call EnableTrigger(gg_trg_Protective_Stand_Switch)call EnableTrigger(gg_trg_Learn_Fighting_Skills)
call EnableTrigger(gg_trg_Ram_Board)
call EnableTrigger(gg_trg_Warcry)endfunctionfunction InitTrig_Guardsman_Load takes nothing returns nothingset gg_trg_Guardsman_Load=CreateTrigger()call TriggerAddAction(gg_trg_Guardsman_Load,function Trig_Guardsman_Load_Actions)endfunctionfunction Trig_Protective_Stand_Switch_Actions takes nothing returns nothinglocal unit caster=GetTriggerUnit()local integer h=GetHandleId(caster)local integer bonus=5+5*GetUnitAbilityLevel(caster,'A0EU')if caster==GetDyingUnit()thencall SaveBoolean(udg_hash,GetHandleId(caster),3,true)else
if LoadBoolean(udg_hash,GetHandleId(caster),3)==false thenif(GetIssuedOrderId()==$D0057)thenif GetUnitAbilityLevel(caster,'A0EU')>0 then
call SetAttackSpeedAbilityLevel(caster,-(bonus))
endifcall SaveBoolean(udg_hash,GetHandleId(caster),1,true)endifif(GetIssuedOrderId()==$D0058)thenif GetUnitAbilityLevel(caster,'A0EU')>0 then
call SetAttackSpeedAbilityLevel(caster,bonus)endifcall SaveBoolean(udg_hash,GetHandleId(caster),1,false)endifelse
call SaveBoolean(udg_hash,GetHandleId(caster),3,false)endifendifset caster=nullendfunctionfunction Trig_Protective_Stand_Switch_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetTriggerUnit(),'A0ET')>0endfunctionfunction InitTrig_Protective_Stand_Switch takes nothing returns nothinglocal integer index=0set gg_trg_Protective_Stand_Switch=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Protective_Stand_Switch,Player(index),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)call TriggerRegisterPlayerUnitEvent(gg_trg_Protective_Stand_Switch,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Protective_Stand_Switch,Condition(function Trig_Protective_Stand_Switch_Conditions))
call TriggerAddAction(gg_trg_Protective_Stand_Switch,function Trig_Protective_Stand_Switch_Actions)endfunctionfunction Trig_Learn_Fighting_Skills_Actions takes nothing returns nothinglocal unit u=GetLearningUnit()local integer h=GetHandleId(u)local integer lvl=GetUnitAbilityLevel(u,'A0EU')if lvl==1 thencall SaveInteger(udg_hash,h,2,$A)call SetAttackAbilityLevel(u,$A)
call SetArmorAbilityLevel(u,2)if LoadBoolean(udg_hash,h,1)==false then
call SetAttackSpeedAbilityLevel(u,$A)endifelse
call SetAttackAbilityLevel(u,5)call SetArmorAbilityLevel(u,1)if LoadBoolean(udg_hash,h,1)==false then
call SetAttackSpeedAbilityLevel(u,5)
endifendifset u=nullendfunctionfunction Trig_Learn_Fighting_Skills_Conditions takes nothing returns boolean
return GetLearnedSkill()=='A0EU' and GetUnitTypeId(GetLearningUnit())!='h00U'endfunctionfunction InitTrig_Learn_Fighting_Skills takes nothing returns nothinglocal integer index=0set gg_trg_Learn_Fighting_Skills=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Fighting_Skills,Player(index),EVENT_PLAYER_HERO_SKILL,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Fighting_Skills,Condition(function Trig_Learn_Fighting_Skills_Conditions))
call TriggerAddAction(gg_trg_Learn_Fighting_Skills,function Trig_Learn_Fighting_Skills_Actions)endfunctionfunction Trig_Ram_Board_Move_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Ram_Board_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local integer lvlstun=LoadInteger(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local real face=LoadReal(udg_hash,h,6)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real angle
local real angle2local unit dammi
local boolean alife=true
local rect r=Rect(x-100.,y-100.,x+100.,y+100.)call EnumDestructablesInRect(r,null,function Trig_Ram_Board_Move_Dest_Actions)if GetUnitState(caster,UNIT_STATE_LIFE)<.405 thenset alife=falseendifif wait>0 and alife then
set wait=wait-1call SaveInteger(udg_hash,h,5,wait)call SetUnitFacing(caster,face)call SetUnitAnimationByIndex(caster,8)call GroupEnumUnitsInRange(g,x,y,125.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\StormBolt\\StormBoltMissile.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',.5)
call UnitAddAbility(dammi,'A0EX')call SetUnitAbilityLevel(dammi,'A0EX',lvlstun)call IssueTargetOrderById(dammi,$D007F,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullset angle=bj_RADTODEG*Atan2(GetUnitY(Picked)-y,GetUnitX(Picked)-x)set angle2=(Atan2(y-GetUnitY(Picked),x-GetUnitX(Picked))*bj_RADTODEG)+360.if(angle2<=(GetUnitFacing(caster)+210.)and angle2>=(GetUnitFacing(caster)+180.))then
set angle=angle+30.endifif(angle2<=(GetUnitFacing(caster)+180.)and angle2>=(GetUnitFacing(caster)+150.))then
set angle=angle-30.endifcall MoveUnit(Picked,1.,400.,400.,angle,.0,false)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,2,gdamage)else
if alife thenif LoadBoolean(udg_hash,GetHandleId(caster),1) thencall SetUnitAnimation(caster,"Stand Defend")
else
call SetUnitAnimation(caster,"stand")endifendifcall SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset gdamage=null
call GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullset dammi=nullcall RemoveRect(r)set r=nullendfunctionfunction Trig_Ram_Board_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local integer lvlstun=1local integer lvl=GetUnitAbilityLevel(caster,'A0EZ')
local integer stuck=0local timer tstucklocal real damage=(15.+(35.*lvl))+(GetHeroStr(caster,true)*(.5+.25*lvl))
local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,8)call SetUnitTimeScale(caster,2.)
if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
if target==caster thenset angle=GetUnitFacing(caster)set dist=750.endifset time=dist/ 500.call MoveUnit(caster,time,500.,.0,angle,.0,true)
if GetUnitAbilityLevel(caster,'A0ET')>0 then
if LoadBoolean(udg_hash,GetHandleId(caster),1)==false thenset damage=damage*1.3else
set lvlstun=2endifendifif HaveSavedHandle(udg_hash,GetHandleId(caster),59) then
set tstuck=LoadTimerHandle(udg_hash,GetHandleId(caster),59)set stuck=LoadInteger(udg_hash,GetHandleId(tstuck),1)if GetRandomInt(1,$A)<=stuck thencall UnitRemoveAbility(caster,'A0EZ')call UnitAddAbility(caster,'A0EZ')call SetUnitAbilityLevel(caster,'A0EZ',lvl)call CreateTexttag("|cFFFF4B00Refresh Ability|r",.023,$FF,x-75.,y,.0,.0,.035,3.5)endifset tstuck=nullendifcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,lvlstun)call SaveInteger(udg_hash,h,5,R2I(dist/ 15.))call SaveReal(udg_hash,h,6,angle)call TimerStart(t,.03,true,function Trig_Ram_Board_Move_Actions)
set caster=nullset target=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Ram_Board_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0EZ'endfunctionfunction InitTrig_Ram_Board takes nothing returns nothinglocal integer index=0set gg_trg_Ram_Board=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ram_Board,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ram_Board,Condition(function Trig_Ram_Board_Conditions))
call TriggerAddAction(gg_trg_Ram_Board,function Trig_Ram_Board_Actions)endfunctionfunction Trig_Warcry_Buff_Removes_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,2)local integer stuck=LoadInteger(udg_hash,h,1)call SetAttackSpeedAbilityLevel(target,(-stuck*$A))call SetArmorAbilityLevel(target,(-stuck*3))
call SetAttackAbilityLevel(target,(-stuck*7))if GetUnitAbilityLevel(target,'A0EY')>0 then
call SetUnitLifeAndManaRegeneration(target,"life",-(3*stuck))call SetHeroStr(target,GetHeroStr(target,false)-($A*stuck),true)
endifcall SaveInteger(udg_hash,h,1,0)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset target=nullendfunctionfunction Trig_Warcry_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0EY')*2local integer stuck=0local group g=CreateGroup()local unit Pickedlocal unit dammi
local timer tlocal integer hcall GroupEnumUnitsInRange(g,x,y,500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
set t=LoadTimerHandle(udg_hash,GetHandleId(Picked),59)set stuck=LoadInteger(udg_hash,GetHandleId(t),1)
if t==null thenset t=CreateTimer()set stuck=0call SaveUnitHandle(udg_hash,GetHandleId(t),2,Picked)call SaveTimerHandle(udg_hash,GetHandleId(Picked),59,t)endifset h=GetHandleId(t)
if stuck<lvl thenif Picked==caster thencall SetHeroStr(caster,GetHeroStr(caster,false)+$A,true)
call SetUnitLifeAndManaRegeneration(caster,"life",3)
endifcall SetAttackSpeedAbilityLevel(Picked,$A)call SetArmorAbilityLevel(Picked,3)call SetAttackAbilityLevel(Picked,7)
set stuck=stuck+1call SaveInteger(udg_hash,h,1,stuck)
endifset dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A0F0')call SetUnitAbilityLevel(dammi,'A0F0',stuck)
call UnitRemoveAbility(Picked,'B02J')call IssueTargetOrderById(dammi,$D0085,Picked)set dammi=nullcall TimerStart(t,10.,false,function Trig_Warcry_Buff_Removes_Actions)set t=nullendifcall GroupRemoveUnit(g,Picked)endloopset caster=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset dammi=nullset t=nullendfunctionfunction Trig_Warcry_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0EY'endfunctionfunction InitTrig_Warcry takes nothing returns nothinglocal integer index=0set gg_trg_Warcry=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Warcry,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Warcry,Condition(function Trig_Warcry_Conditions))call TriggerAddAction(gg_trg_Warcry,function Trig_Warcry_Actions)endfunctionfunction Trig_Drenor_Bull_Load_Actions takes nothing returns nothing
call AbilityPreload('A0B1',6)call AbilityPreload('A0B0',6)call AbilityPreload('A0B2',6)call AbilityPreload('A0AZ',3)call AbilityPreload('A075',1)call AbilityPreload('A0AY',1)call EffectPreload("Abilities\\Spells\\Orc\\WarDrums\\DrumsCasterHeal.mdl")call EffectPreload("Abilities\\Spells\\Orc\\StasisTrap\\StasisTotemTarget.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPriest.mdl")call EffectPreload("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl")call EffectPreload("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl")call EnableTrigger(gg_trg_Axe_Throw)
call EnableTrigger(gg_trg_Violent_Roar)call EnableTrigger(gg_trg_upgrade_Berserk)call EnableTrigger(gg_trg_Learn_Spell_Rage)call EnableTrigger(gg_trg_Drenor_Bull_Show_Hint)
call EnableTrigger(gg_trg_Drenor_Bull_Show_Rage)
endfunctionfunction InitTrig_Drenor_Bull_Load takes nothing returns nothing
set gg_trg_Drenor_Bull_Load=CreateTrigger()call TriggerAddAction(gg_trg_Drenor_Bull_Load,function Trig_Drenor_Bull_Load_Actions)endfunctionfunction Trig_Drenor_Bull_Show_Hint_Actions takes nothing returns nothingcall DisplayTextToForce(udg_Drenor_Bull_Hint_Player_Group,"Чтобы узнать количество накопленной Грог'Таром ярости, введи в чат команду \"|cff99ccff-rage/-r|r\".")endfunctionfunction InitTrig_Drenor_Bull_Show_Hint takes nothing returns nothingset gg_trg_Drenor_Bull_Show_Hint=CreateTrigger()
call DisableTrigger(gg_trg_Drenor_Bull_Show_Hint)call TriggerRegisterTimerEventPeriodic(gg_trg_Drenor_Bull_Show_Hint,120.)call TriggerAddAction(gg_trg_Drenor_Bull_Show_Hint,function Trig_Drenor_Bull_Show_Hint_Actions)endfunctionfunction Trig_Drenor_Bull_Show_Rage_Conditions takes nothing returns boolean
return(IsPlayerInForce(GetTriggerPlayer(),udg_Drenor_Bull_Hint_Player_Group))endfunctionfunction Trig_Drenor_Bull_Show_Rage_Func001C takes nothing returns booleanreturn(udg_GrorTar!=null)and(GetUnitAbilityLevelSwapped('A0B2',udg_GrorTar)>0)endfunctionfunction Trig_Drenor_Bull_Show_Rage_Actions takes nothing returns nothingif(Trig_Drenor_Bull_Show_Rage_Func001C())thencall DisplayTextToForce(GetForceOfPlayer(GetTriggerPlayer()),("Ярость Грог'Тара: |cFFF0692D"+(I2S(udg_DrenorBugaiRage)+("|r ( максимум: |cFFF0692D"+(I2S(((GetUnitAbilityLevelSwapped('A0B2',udg_GrorTar)*'}')+(GetUnitAbilityLevelSwapped('A0AZ',udg_GrorTar)*75)))+"|r)")))))else
call DisplayTextToForce(GetForceOfPlayer(GetTriggerPlayer()),("Ярость Грог'Тара: |cFFF0692D"+("0"+("|r ( максимум: |cFFF0692D"+("0|r)")))))endifendfunctionfunction InitTrig_Drenor_Bull_Show_Rage takes nothing returns nothinglocal integer index=0set gg_trg_Drenor_Bull_Show_Rage=CreateTrigger()
call DisableTrigger(gg_trg_Drenor_Bull_Show_Rage)loop
call TriggerRegisterPlayerChatEvent(gg_trg_Drenor_Bull_Show_Rage,Player(index),"-rage",true)
call TriggerRegisterPlayerChatEvent(gg_trg_Drenor_Bull_Show_Rage,Player(index),"-r",true)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Drenor_Bull_Show_Rage,Condition(function Trig_Drenor_Bull_Show_Rage_Conditions))
call TriggerAddAction(gg_trg_Drenor_Bull_Show_Rage,function Trig_Drenor_Bull_Show_Rage_Actions)endfunctionfunction Trig_Axe_Throw_move_2 takes nothing returns nothing
call KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Axe_Throw_move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit axe=LoadUnitHandle(udg_hash,h,1)local group g=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local unit caster=LoadUnitHandle(udg_hash,h,6)local player p=GetOwningPlayer(caster)local integer wait=LoadInteger(udg_hash,h,5)
local real x=GetUnitX(axe)+32.*Cos(GetUnitFacing(axe)*bj_DEGTORAD)local real y=GetUnitY(axe)+32.*Sin(GetUnitFacing(axe)*bj_DEGTORAD)local rect r=Rect(x-130.,y-130.,x+130.,y+130.)local group grup=CreateGroup()local unit Pickedlocal unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)call EnumDestructablesInRect(r,null,function Trig_Axe_Throw_move_2)if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(axe,x,y)endifif wait==20 or wait==16 or wait==$C or wait==8 or wait==4 thencall DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\ImpaleTargetDust\\ImpaleTargetDust.mdl",x,y))
endifcall GroupEnumUnitsInRange(grup,x,y,'}',null)loop
set Picked=FirstOfGroup(grup)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(axe))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitInGroup(Picked,g)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',.5)
call UnitAddAbility(dammi,'A0F1')call IssueTargetOrderById(dammi,$D007F,Picked)set dammi=nullcall DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPriest.mdl",Picked,"chest"))call GroupAddUnit(g,Picked)endifcall GroupRemoveUnit(grup,Picked)endloopcall SaveGroupHandle(udg_hash,h,2,g)
else
call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",x,y))
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\ImpaleTargetDust\\ImpaleTargetDust.mdl",x,y))
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call KillUnit(axe)call RemoveUnit(dammi)call GroupClear(g)call DestroyGroup(g)
set g=nullendifset Picked=nullcall DestroyGroup(grup)set grup=nullset t=nullset axe=null
set g=nullset dammi=nullcall RemoveRect(r)set r=nullset caster=nullset p=nullendfunctionfunction Trig_Axe_Throw_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)local location loclocal real xtlocal real ytlocal unit axelocal group g=CreateGroup()local real damage3=10.+(50.*I2R(GetUnitAbilityLevel(caster,'A0B1')))
local real damage2=I2R(udg_DrenorBugaiRage)/ 3.local real damage=(1.+(.2*I2R(GetUnitAbilityLevel(caster,'A0AZ'))))*(damage2+damage3)local integer wait=20if GetSpellTargetUnit()==null thenset loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
call RemoveLocation(loc)
set loc=null
else
set xt=GetUnitX(GetSpellTargetUnit())set yt=GetUnitY(GetSpellTargetUnit())endifif(udg_DrenorBugaiRage<=((('}'*GetUnitAbilityLevel(caster,'A0B2')+(75*GetUnitAbilityLevel(caster,'A0AZ')))-30)))then
set udg_DrenorBugaiRage=udg_DrenorBugaiRage+30call SetAttackSpeedAbilityLevel(udg_GrorTar,6)endifcall DisableTrigger(gg_trg_Sniatie_Rage)
call TimerStart(udg_GrogTarRageTimer,4.,false,null)set axe=CreateUnit(GetOwningPlayer(caster),'h01J',x,y,bj_RADTODEG*Atan2(yt-y,xt-x))call UnitAddAbility(axe,'Amrf')call UnitRemoveAbility(axe,'Amrf')call SetUnitTimeScale(axe,2.5)call SetUnitFlyHeight(axe,15.,80.)call SaveUnitHandle(udg_hash,h,1,axe)call SaveGroupHandle(udg_hash,h,2,g)
call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,5,wait)call SaveUnitHandle(udg_hash,h,6,caster)
call TimerStart(t,.03,true,function Trig_Axe_Throw_move_Actions)
set caster=nullset t=nullset axe=null
set g=nullendfunctionfunction Trig_Axe_Throw_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0B1'endfunctionfunction InitTrig_Axe_Throw takes nothing returns nothinglocal integer index=0set gg_trg_Axe_Throw=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Axe_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Axe_Throw,Condition(function Trig_Axe_Throw_Conditions))
call TriggerAddAction(gg_trg_Axe_Throw,function Trig_Axe_Throw_Actions)endfunctionfunction Trig_Violent_Roar_periodic takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real xc=LoadReal(udg_hash,h,2)
local real yc=LoadReal(udg_hash,h,3)
local real damage=LoadReal(udg_hash,h,4)
local integer wait=LoadInteger(udg_hash,h,5)
local group g=CreateGroup()local unit Pickedlocal unit dammi
local real angle
local real x
local real y
local real distif wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)if wait==$E then
call GroupEnumUnitsInRange(g,xc,yc,400.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(caster))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thenset dammi=CreateUnit(GetOwningPlayer(caster),'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A075')call IssueTargetOrderById(dammi,$D00DD,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifcall GroupEnumUnitsInRange(g,xc,yc,400.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(caster))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thenset x=GetUnitX(Picked)set y=GetUnitY(Picked)set angle=bj_RADTODEG*Atan2(y-yc,x-xc)set dist=SquareRoot((x-xc)*(x-xc)+(y-yc)*(y-yc))
set x=GetUnitX(Picked)+(21.-(dist/ 20.))*Cos(angle*bj_DEGTORAD)set y=GetUnitY(Picked)+(21.-(dist/ 20.))*Sin(angle*bj_DEGTORAD)if IsTerrainPathable(x,y,PATHING_TYPE_WALKABILITY)==false and GetTerrainCliffLevel(x,y)==GetTerrainCliffLevel(GetUnitX(Picked)-(21.-(dist/ 20.))*Cos(angle*bj_DEGTORAD),GetUnitY(Picked)-(21.-(dist/ 20.))*Sin(angle*bj_DEGTORAD))thencall SetUnitX(Picked,x)call SetUnitY(Picked,y)endifif wait==$E then
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))endifcall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullelse
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullcall DestroyGroup(g)
set g=nullendfunctionfunction Trig_Violent_Roar_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local integer wait=$Flocal real ultalvl=1.+(.2*I2R(GetUnitAbilityLevel(caster,'A0AZ')))local real abilitylvl=15.+(20.*I2R(GetUnitAbilityLevel(caster,'A0B0')))local real udgrage=I2R(udg_DrenorBugaiRage)/ 20.
local real herostr=I2R(GetUnitAbilityLevel(caster,'A0B0'))*(.2*GetHeroStr(caster,true))local real damage=(ultalvl*(abilitylvl+udgrage+herostr))/ waitlocal timer t=CreateTimer()local integer h=GetHandleId(t)if(udg_DrenorBugaiRage<=((('}'*GetUnitAbilityLevel(caster,'A0B2')+(75*GetUnitAbilityLevel(caster,'A0AZ')))-30)))then
set udg_DrenorBugaiRage=udg_DrenorBugaiRage+30call SetAttackSpeedAbilityLevel(udg_GrorTar,6)endifcall DisableTrigger(gg_trg_Sniatie_Rage)
call TimerStart(udg_GrogTarRageTimer,4.,false,null)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SaveReal(udg_hash,h,4,damage)call SaveInteger(udg_hash,h,5,wait)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl",x,y))call TimerStart(t,.04,true,function Trig_Violent_Roar_periodic)endfunctionfunction Trig_Violent_Roar_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0B0'endfunctionfunction InitTrig_Violent_Roar takes nothing returns nothing
local integer index=0set gg_trg_Violent_Roar=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Violent_Roar,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Violent_Roar,Condition(function Trig_Violent_Roar_Conditions))call TriggerAddAction(gg_trg_Violent_Roar,function Trig_Violent_Roar_Actions)endfunctionfunction Trig_upgrade_Berserk_Conditions takes nothing returns booleanreturn GetLearnedSkill()=='A0AZ'
endfunctionfunction Trig_upgrade_Berserk_Actions takes nothing returns nothingcall SetPlayerTechResearched(GetOwningPlayer(GetTriggerUnit()),'R007',GetLearnedSkillLevel())endfunctionfunction InitTrig_upgrade_Berserk takes nothing returns nothinglocal integer index=0set gg_trg_upgrade_Berserk=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_upgrade_Berserk,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_upgrade_Berserk,Condition(function Trig_upgrade_Berserk_Conditions))
call TriggerAddAction(gg_trg_upgrade_Berserk,function Trig_upgrade_Berserk_Actions)endfunctionfunction Trig_Learn_Spell_Rage_Actions_Timer takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local texttag txt=LoadTextTagHandle(udg_hash,h,2)local real x=GetUnitX(hero)local real y=GetUnitY(hero)local boolean alife=LoadBoolean(udg_hash,h,3)if(GetUnitState(hero,UNIT_STATE_LIFE)<.405 and alife)thenset alife=falsecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagVisibility(txt,false)
endifif(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife==false)then
set alife=truecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagVisibility(txt,true)endifif(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife)thenset alife=truecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagText(txt,"|cFFF0692D"+I2S(udg_DrenorBugaiRage)+"|r|cFF969696/|r|cFFF0692D"+I2S(((('}'*GetUnitAbilityLevel(hero,'A0B2')+(75*GetUnitAbilityLevel(hero,'A0AZ'))))))+"|r",.027)call SetTextTagPos(txt,GetUnitX(hero)-40.,GetUnitY(hero)+100.,.0)endifset t=nullset hero=nullset txt=null
endfunctionfunction Trig_Learn_Spell_Rage_Actions takes nothing returns nothing
local integer lvl=GetUnitAbilityLevel(GetLearningUnit(),'A0B2')local timer tlocal integer hlocal texttag txtlocal unit heroif lvl==1 thenset udg_GrorTar=GetLearningUnit()set udg_DrenorBugaiRage=0call EnableTrigger(gg_trg_attack_hero_Rage)call EnableTrigger(gg_trg_kill_hero_Rage)call EnableTrigger(gg_trg_Timer_Rage)call EnableTrigger(gg_trg_GrogTarDead)set t=CreateTimer()set h=GetHandleId(t)
set txt=CreateTextTag()set hero=GetLearningUnit()call SetTextTagText(txt,"|cFFF0692D"+I2S(udg_DrenorBugaiRage)+"|r|cFF969696/|r|cFFF0692D"+I2S(((('}'*GetUnitAbilityLevel(hero,'A0B2')+(75*GetUnitAbilityLevel(hero,'A0AZ'))))))+"|r",.027)call SetTextTagColor(txt,$FF,$FF,$FF,$FF)call SetTextTagPos(txt,GetUnitX(hero)-40.,GetUnitY(hero)+50.,.0)
call SetTextTagPermanent(txt,true)call SaveUnitHandle(udg_hash,h,1,hero)call SaveTextTagHandle(udg_hash,h,2,txt)
call SaveBoolean(udg_hash,h,3,true)call TimerStart(t,.03,true,function Trig_Learn_Spell_Rage_Actions_Timer)
set t=nullset hero=nullset txt=null
endifendfunctionfunction Trig_Learn_Spell_Rage_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetLearningUnit(),'A0B2')>=1 and GetUnitTypeId(GetLearningUnit())!='h00U' and GetLearnedSkill()=='A0B2'endfunctionfunction InitTrig_Learn_Spell_Rage takes nothing returns nothing
local integer index=0set gg_trg_Learn_Spell_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Spell_Rage,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Spell_Rage,Condition(function Trig_Learn_Spell_Rage_Conditions))call TriggerAddAction(gg_trg_Learn_Spell_Rage,function Trig_Learn_Spell_Rage_Actions)endfunctionfunction Trig_GrogTarDead_Actions takes nothing returns nothingcall SetAttackSpeedAbilityLevel(udg_GrorTar,-udg_DrenorBugaiRage/ 5)
set udg_DrenorBugaiRage=0call DisableTrigger(gg_trg_Sniatie_Rage)
endfunctionfunction Trig_GrogTarDead_Conditions takes nothing returns booleanreturn GetDyingUnit()==udg_GrorTarendfunctionfunction InitTrig_GrogTarDead takes nothing returns nothinglocal integer index=0set gg_trg_GrogTarDead=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_GrogTarDead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_GrogTarDead,Condition(function Trig_GrogTarDead_Conditions))
call TriggerAddAction(gg_trg_GrogTarDead,function Trig_GrogTarDead_Actions)endfunctionfunction Trig_attack_hero_Rage_Conditions takes nothing returns booleanreturn IsUnitEnemy(GetAttacker(),GetOwningPlayer(GetTriggerUnit()))and(GetUnitAbilityLevel(GetTriggerUnit(),'A0B2')>=1)endfunctionfunction Trig_attack_hero_Rage_Actions takes nothing returns nothing
local integer addrage=0if(GetRandomInt(1,2)==1)then
if udg_DrenorBugaiRage<=((('}'*(GetUnitAbilityLevel(GetTriggerUnit(),'A0B2')))+(75*(GetUnitAbilityLevel(GetTriggerUnit(),'A0AZ'))))-1)thenset udg_DrenorBugaiRage=udg_DrenorBugaiRage+1set addrage=addrage+1if(udg_DrenorBugaiRage/ 5)*5>=udg_DrenorBugaiRage thencall SetAttackSpeedAbilityLevel(udg_GrorTar,1)endifelse
set udg_DrenorBugaiRage=(((('}'*(GetUnitAbilityLevel(GetTriggerUnit(),'A0B2'))))+(75*(GetUnitAbilityLevel(GetTriggerUnit(),'A0AZ')))))endifendifcall DisableTrigger(gg_trg_Sniatie_Rage)
call TimerStart(udg_GrogTarRageTimer,4.,false,null)endfunctionfunction InitTrig_attack_hero_Rage takes nothing returns nothing
local integer index=0set gg_trg_attack_hero_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_attack_hero_Rage,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)set index=index+1exitwhen index==16endloopcall DisableTrigger(gg_trg_attack_hero_Rage)
call TriggerAddCondition(gg_trg_attack_hero_Rage,Condition(function Trig_attack_hero_Rage_Conditions))call TriggerAddAction(gg_trg_attack_hero_Rage,function Trig_attack_hero_Rage_Actions)endfunctionfunction Trig_kill_hero_Rage_Conditions takes nothing returns booleanreturn(GetUnitAbilityLevel(GetKillingUnit(),'A0B2')>=1)endfunctionfunction Trig_kill_hero_Rage_Actions takes nothing returns nothinglocal integer addrage=0if(udg_DrenorBugaiRage<=((('}'*GetUnitAbilityLevel(GetKillingUnit(),'A0B2')))+(75*GetUnitAbilityLevel(GetKillingUnit(),'A0AZ')))-5)thenset udg_DrenorBugaiRage=udg_DrenorBugaiRage+5set addrage=addrage+5call SetAttackSpeedAbilityLevel(udg_GrorTar,1)if(IsUnitType(GetDyingUnit(),UNIT_TYPE_ANCIENT)or IsUnitType(GetDyingUnit(),UNIT_TYPE_HERO))and(udg_DrenorBugaiRage<=((('}'*GetUnitAbilityLevel(GetKillingUnit(),'A0B2')))+(75*GetUnitAbilityLevel(GetKillingUnit(),'A0AZ')))-85)thenset udg_DrenorBugaiRage=udg_DrenorBugaiRage+85set addrage=addrage+85call SetAttackSpeedAbilityLevel(udg_GrorTar,9)endifendifcall DisableTrigger(gg_trg_Sniatie_Rage)
call TimerStart(udg_GrogTarRageTimer,4.,false,null)endfunctionfunction InitTrig_kill_hero_Rage takes nothing returns nothinglocal integer index=0set gg_trg_kill_hero_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_kill_hero_Rage,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall DisableTrigger(gg_trg_kill_hero_Rage)call TriggerAddCondition(gg_trg_kill_hero_Rage,Condition(function Trig_kill_hero_Rage_Conditions))call TriggerAddAction(gg_trg_kill_hero_Rage,function Trig_kill_hero_Rage_Actions)endfunctionfunction Trig_Sniatie_Rage_Action takes nothing returns nothingif udg_DrenorBugaiRage>=20 thenset udg_DrenorBugaiRage=udg_DrenorBugaiRage-20call SetAttackSpeedAbilityLevel(udg_GrorTar,-4)else
set udg_Temp_Integer[0]=('}'*(GetUnitAbilityLevel(udg_GrorTar,'A0B2')))+(75*(GetUnitAbilityLevel(udg_GrorTar,'A0AZ')))call SetAttackSpeedAbilityLevel(udg_GrorTar,-udg_DrenorBugaiRage/ 5)
set udg_DrenorBugaiRage=0endifendfunctionfunction InitTrig_Sniatie_Rage takes nothing returns nothing
set gg_trg_Sniatie_Rage=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Sniatie_Rage,3.,true)call TriggerAddAction(gg_trg_Sniatie_Rage,function Trig_Sniatie_Rage_Action)
call DisableTrigger(gg_trg_Sniatie_Rage)
endfunctionfunction Trig_Timer_last_Actions takes nothing returns nothingcall EnableTrigger(gg_trg_Sniatie_Rage)endfunctionfunction InitTrig_Timer_Rage takes nothing returns nothingset gg_trg_Timer_Rage=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_Timer_Rage,udg_GrogTarRageTimer)
call TriggerAddAction(gg_trg_Timer_Rage,function Trig_Timer_last_Actions)endfunctionfunction Trig_Illusionist_Load_Actions takes nothing returns nothing
call AbilityPreload('A0F6',6)call AbilityPreload('A0F5',6)call AbilityPreload('A0F3',6)call AbilityPreload('A0F2',3)call AbilityPreload('A0F7',6)call AbilityPreload('A0AY',4)call AbilityPreload('A0F4',6)call AbilityPreload('B02L',1)call AbilityPreload('B02K',1)call AbilityPreload('B02M',1)call EffectPreload("Abilities\\Spells\\Orc\\Devour\\DevourEffectArt.mdl")call EffectPreload("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageDeathCaster.mdl")call EffectPreload("Abilities\\Spells\\Undead\\Curse\\CurseTarget.mdl")call EffectPreload("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageMissile.mdl")call EffectPreload("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl")
call EffectPreload("Abilities\\Spells\\Other\\Levelup\\LevelupCaster.mdl")call EffectPreload("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl")call EffectPreload("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl")call EffectPreload("Abilities\\Spells\\Undead\\DeathPact\\DeathPactCaster.mdl")call EffectPreload("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl")call EnableTrigger(gg_trg_Reflection)call EnableTrigger(gg_trg_Illusory_Attack)call EnableTrigger(gg_trg_Summon_Illusions_with_Reflection)call EnableTrigger(gg_trg_Illusions_with_Phantoms_Dead)endfunctionfunction InitTrig_Illusionist_Load takes nothing returns nothing
set gg_trg_Illusionist_Load=CreateTrigger()call TriggerAddAction(gg_trg_Illusionist_Load,function Trig_Illusionist_Load_Actions)endfunctionfunction Trig_Reflection_perodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local rect r=LoadRectHandle(udg_hash,h,2)local real x=GetRectCenterX(r)local real y=GetRectCenterY(r)local real txlocal real tylocal integer wait=LoadInteger(udg_hash,h,3)
local real damage=LoadReal(udg_hash,h,4)
local player p=GetOwningPlayer(caster)local integer order=GetUnitCurrentOrder(caster)local group g=CreateGroup()local group gdamage=CreateGroup()local unit Pickedlocal unit dammi
local unit dammi2local unit targetlocal integer orderIdset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId and wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,3,wait)call GroupEnumUnitsInRect(g,r,null)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl",caster,"chest"))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and(GetPlayerId(GetOwningPlayer(Picked))!=$D)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call RandomUnitFromGroup(1,gdamage)call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set target=FirstOfGroup(g)set tx=GetUnitX(target)set ty=GetUnitY(target)set dammi2=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi2,'BTLF',1.)call UnitAddAbility(dammi2,'A0F4')call SetUnitAbilityLevel(dammi2,'A0F4',GetUnitAbilityLevel(caster,'A0F6'))call IssueTargetOrderById(dammi2,$D006B,target)set dammi=CreateUnit(p,'h00U',x,y,.0)call SaveUnitHandle(udg_hash,GetHandleId(dammi),2,target)call SaveBoolean(udg_hash,GetHandleId(dammi),3,true)
call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0AY')call SetUnitAbilityLevel(dammi,'A0AY',1+GetUnitAbilityLevel(caster,'A0F2'))call IssueTargetOrderById(dammi,$D0132,caster)call GroupClear(gdamage)
call GroupEnumUnitsInRange(gdamage,tx,ty,150.,null)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactCaster.mdl",target,"origin"))loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",Picked,"origin"))endifcall GroupRemoveUnit(gdamage,Picked)
endloopelse
call SetUnitVertexColor(caster,$FF,$FF,$FF,$FF)call RemoveRect(r)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))endifset t=nullset caster=nullset r=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
set Picked=nullset dammi=nullset dammi2=nullset target=nullendfunctionfunction Trig_Reflection_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer lvl=GetUnitAbilityLevel(caster,'A0F6')
local integer wait=lvl+2
local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local rect r=Rect(x-350.,y-350.,x+350.,y+350.)local real damage=$A+5*lvl+(.1+(.05*lvl))*GetHeroAgi(caster,true)local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveRectHandle(udg_hash,h,2,r)call SaveInteger(udg_hash,h,3,wait)call SaveReal(udg_hash,h,4,damage)call AddProgressBar(caster,215.+(1.5*lvl),(.9+.1*lvl),(.3*wait),false,true,'u',$B4,$96,$AF)call SetUnitVertexColor(caster,$C8,$C8,$C8,'d')call TimerStart(t,.3,true,function Trig_Reflection_perodic_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set r=nullset t=nullendfunctionfunction Trig_Reflection_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0F6'endfunctionfunction InitTrig_Reflection takes nothing returns nothinglocal integer index=0set gg_trg_Reflection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Reflection,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Reflection,Condition(function Trig_Reflection_Conditions))call TriggerAddAction(gg_trg_Reflection,function Trig_Reflection_Actions)endfunctionfunction Trig_Illusory_Attack_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real angle=GetRandomReal(.0,360.)local real x=GetUnitX(target)+50.*Cos(angle*bj_DEGTORAD)
local real y=GetUnitY(target)+50.*Sin(angle*bj_DEGTORAD)
local integer lvl=GetUnitAbilityLevel(caster,'A0F5')
local real damage=(GetHeroAgi(caster,true)*(.25*lvl+.5))+(lvl*25+$F)
local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)local unit dammi2=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)call SaveUnitHandle(udg_hash,GetHandleId(dammi),4,target)call SaveBoolean(udg_hash,GetHandleId(dammi),5,true)
call SaveReal(udg_hash,GetHandleId(dammi),6,(angle+180.))call SetUnitPosition(caster,x,y)
call UnitApplyTimedLife(dammi2,'BTLF',1.)call UnitAddAbility(dammi2,'A0F7')call SetUnitAbilityLevel(dammi2,'A0F7',lvl)call IssueTargetOrderById(dammi2,$D007F,target)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0AY')call SetUnitAbilityLevel(dammi,'A0AY',1+GetUnitAbilityLevel(caster,'A0F2'))call IssueTargetOrderById(dammi,$D0132,caster)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",target,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\FreezingBreath\\FreezingBreathMissile.mdl",target,"overhead"))
call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call IssueTargetOrderById(caster,$D000F,target)set caster=nullset target=nullset dammi=nullset dammi2=nullendfunctionfunction Trig_Illusory_Attack_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0F5'endfunctionfunction InitTrig_Illusory_Attack takes nothing returns nothinglocal integer index=0set gg_trg_Illusory_Attack=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Illusory_Attack,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Illusory_Attack,Condition(function Trig_Illusory_Attack_Conditions))
call TriggerAddAction(gg_trg_Illusory_Attack,function Trig_Illusory_Attack_Actions)endfunctionfunction Trig_Summon_Illusions_with_Reflection_Actions takes nothing returns nothing
local unit illusion=GetSummonedUnit()local unit dammi=GetSummoningUnit()local unit targetlocal integer idhero=GetHandleId(udg_herounit[GetPlayerId(GetOwningPlayer(illusion))+1])
if LoadBoolean(udg_hash,GetHandleId(dammi),3) thenset target=LoadUnitHandle(udg_hash,GetHandleId(dammi),2)
if target!=null then
call SetUnitPosition(illusion,GetUnitX(target),GetUnitY(target))
call SetUnitPosition(illusion,GetUnitX(target)+75.*Cos(GetRandomReal(.0,360.)*bj_DEGTORAD),GetUnitY(target)+75.*Sin(GetRandomReal(.0,360.)*bj_DEGTORAD))
call UnitApplyTimedLife(illusion,'BTLF',5.)call UnitAddAbility(illusion,'Aloc')
call UnitRemoveAbility(illusion,'A0F3')call SetUnitVertexColor(illusion,$96,$96,$96,'d')call IssueTargetOrderById(illusion,$D000F,target)else
call RemoveUnit(illusion)endifelse
if LoadBoolean(udg_hash,GetHandleId(dammi),5) thenset target=LoadUnitHandle(udg_hash,GetHandleId(dammi),4)
call SetUnitPosition(illusion,GetUnitX(target)+50.*Cos(LoadReal(udg_hash,GetHandleId(dammi),6)*bj_DEGTORAD),GetUnitY(target)+50.*Sin(LoadReal(udg_hash,GetHandleId(dammi),6)*bj_DEGTORAD))call IssueTargetOrderById(illusion,$D000F,target)else
call SaveInteger(udg_hash,idhero,60,LoadInteger(udg_hash,idhero,60)+1)call SaveInteger(udg_hash,GetHandleId(illusion),1,$A)endifendifset dammi=nullset illusion=nullset target=nullendfunctionfunction Trig_Summon_Illusions_with_Reflection_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetSummonedUnit())=='E004' and GetUnitAbilityLevel(GetSummoningUnit(),'A0AY')>0
endfunctionfunction InitTrig_Summon_Illusions_with_Reflection takes nothing returns nothing
local integer index=0set gg_trg_Summon_Illusions_with_Reflection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Summon_Illusions_with_Reflection,Player(index),EVENT_PLAYER_UNIT_SUMMON,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Summon_Illusions_with_Reflection,Condition(function Trig_Summon_Illusions_with_Reflection_Conditions))call TriggerAddAction(gg_trg_Summon_Illusions_with_Reflection,function Trig_Summon_Illusions_with_Reflection_Actions)endfunctionfunction Trig_Illusions_with_Phantoms_Dead_Actions takes nothing returns nothing
local integer idhero=GetHandleId(udg_herounit[GetPlayerId(GetOwningPlayer(GetDyingUnit()))+1])local integer count=LoadInteger(udg_hash,idhero,60)if count>0 thencall SaveInteger(udg_hash,idhero,60,count-1)
endifendfunctionfunction Trig_Illusions_with_Phantoms_Dead_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetDyingUnit())=='E004' and IsUnitIllusion(GetDyingUnit()) and HaveSavedInteger(udg_hash,GetHandleId(GetDyingUnit()),1)
endfunctionfunction InitTrig_Illusions_with_Phantoms_Dead takes nothing returns nothing
local integer index=0set gg_trg_Illusions_with_Phantoms_Dead=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Illusions_with_Phantoms_Dead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Illusions_with_Phantoms_Dead,Condition(function Trig_Illusions_with_Phantoms_Dead_Conditions))call TriggerAddAction(gg_trg_Illusions_with_Phantoms_Dead,function Trig_Illusions_with_Phantoms_Dead_Actions)endfunctionfunction Trig_BladeMaster_Load_Actions takes nothing returns nothing
call AbilityPreload('A0FG',6)call AbilityPreload('A0FH',6)call AbilityPreload('A0FF',6)call AbilityPreload('A0G2',3)call AbilityPreload('A0G1',4)call AbilityPreload('A0G3',1)call AbilityPreload('A0GH',1)call AbilityPreload('B02W',1)call AbilityPreload('B02X',1)call EffectPreload("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl")call EffectPreload("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl")call EffectPreload("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")call EffectPreload("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl")call EffectPreload("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl")call EffectPreload("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodMortarTeam.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodFootman.mdl")
call EnableTrigger(gg_trg_Dissection)call EnableTrigger(gg_trg_Whirlwind)
call EnableTrigger(gg_trg_Imboweling)endfunctionfunction InitTrig_BladeMaster_Load takes nothing returns nothing
set gg_trg_BladeMaster_Load=CreateTrigger()call TriggerAddAction(gg_trg_BladeMaster_Load,function Trig_BladeMaster_Load_Actions)endfunctionfunction Trig_Dissection_Periodic_Damage_Target_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit Picked=LoadUnitHandle(udg_hash,h,1)local unit caster=LoadUnitHandle(udg_hash,h,2)local real periodicdamage=LoadReal(udg_hash,h,3)
local integer wait=LoadInteger(udg_hash,h,4)
if wait>0 and GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and GetUnitAbilityLevel(Picked,'B02W')>0 thenset wait=wait-1call SaveInteger(udg_hash,h,4,wait)call UnitDamageTarget(caster,Picked,(periodicdamage/ 40),false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)if wait==30 or wait==20 or wait==$A then
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodMortarTeam.mdl",Picked,"origin"))endifelse
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset t=nullset Picked=nullset caster=nullendfunctionfunction Trig_Dissection_Periodic_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local real xt=LoadReal(udg_hash,h,2)
local real yt=LoadReal(udg_hash,h,3)
local real angle=LoadReal(udg_hash,h,4)local real xnext=xc+400.*Cos(angle*bj_DEGTORAD)local real ynext=yc+400.*Sin(angle*bj_DEGTORAD)local real damage=LoadReal(udg_hash,h,5)
local group gdamage=LoadGroupHandle(udg_hash,h,6)local boolean pravo=LoadBoolean(udg_hash,h,9)local boolean first=LoadBoolean(udg_hash,h,$A)local integer jumps=LoadInteger(udg_hash,h,$B)local real periodicdamage=LoadReal(udg_hash,h,$C)local real xcenter=(xnext+xc)/ 2
local real ycenter=(ynext+yc)/ 2
local real radiuslocal group g=CreateGroup()local unit Pickedlocal unit dammi
local timer tPickedlocal integer hPickedlocal boolean lastslashlocal real cxlocal real cylocal real axlocal real aylocal real bxlocal real bylocal player p=GetOwningPlayer(caster)set jumps=jumps-1call SaveInteger(udg_hash,h,$B,jumps)if first thenset xnext=xc+200.*Cos(angle*bj_DEGTORAD)
set ynext=yc+200.*Sin(angle*bj_DEGTORAD)
set xcenter=(xnext+xc)/ 2set ycenter=(ynext+yc)/ 2set first=falsecall SaveBoolean(udg_hash,h,$A,first)endifif jumps<=0 then
set lastslash=trueendifif jumps>0 thenset lastslash=falseif not((xnext>-5. and xnext<5.)and(ynext>-5. and ynext<5.))thencall SetUnitPosition(caster,xnext,ynext)
endifif GetRandomInt(1,2)==1 then
call SetUnitAnimationByIndex(caster,8)else
call SetUnitAnimationByIndex(caster,2)endifset radius=((SquareRoot((xnext-xc)*(xnext-xc)+(ynext-yc)*(ynext-yc)))/ 2)+200.set cx=xc+200.*Cos((angle+90.)*bj_DEGTORAD)set cy=yc+200.*Sin((angle+90.)*bj_DEGTORAD)set ax=xc+200.*Cos((angle-90.)*bj_DEGTORAD)set ay=yc+200.*Sin((angle-90.)*bj_DEGTORAD)set bx=xnext+200.*Cos((angle+90.)*bj_DEGTORAD)set by=ynext+200.*Sin((angle+90.)*bj_DEGTORAD)if pravo thenset angle=angle+120.
call SaveBoolean(udg_hash,h,9,false)
else
set angle=angle-120.
call SaveBoolean(udg_hash,h,9,true)endifcall SaveReal(udg_hash,h,4,angle)call SaveGroupHandle(udg_hash,h,6,gdamage)endifif lastslash thenset cx=-11000.set cy=-11000.set ax=-10000.set ay=5000.
set bx=6000.
set by=-11000.call GroupEnumUnitsInRange(g,xt,yt,175.,null)else
call GroupEnumUnitsInRange(g,xcenter,ycenter,radius,null)endifloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitInGroup(Picked,gdamage)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' and IsPointInRect(GetUnitX(Picked),GetUnitY(Picked),cx,cy,ax,ay,bx,by) then
call GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0G1')call SetUnitAbilityLevel(dammi,'A0G1',R2I(5-((4*GetUnitState(Picked,UNIT_STATE_LIFE)-.1)/ GetUnitState(Picked,UNIT_STATE_MAX_LIFE))))call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 thenset tPicked=CreateTimer()set hPicked=GetHandleId(tPicked)
call SaveUnitHandle(udg_hash,hPicked,1,Picked)call SaveUnitHandle(udg_hash,hPicked,2,caster)call SaveReal(udg_hash,hPicked,3,periodicdamage*(.6+.4*GetUnitAbilityLevel(dammi,'A0G1')))call SaveInteger(udg_hash,hPicked,4,40)call TimerStart(tPicked,.1,true,function Trig_Dissection_Periodic_Damage_Target_Actions)
set tPicked=null
endifendifcall GroupRemoveUnit(g,Picked)endloopif jumps<=0 then
call PauseUnit(caster,false)
call SetUnitInvulnerable(caster,false)call SetUnitPathing(caster,true)
call SetUnitAnimation(caster,"stand")call SetUnitTimeScale(caster,1.)
call SetUnitTurnSpeed(caster,.6)
call SetUnitPosition(caster,xt,yt)call DestroyEffect(LoadEffectHandle(udg_hash,h,7))call DestroyEffect(LoadEffectHandle(udg_hash,h,8))call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset gdamage=null
call GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset dammi=nullset tPicked=null
set p=nullendfunctionfunction Trig_Dissection_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local real xtlocal real ytlocal real distlocal real angle
local integer lvl=GetUnitAbilityLevel(caster,'A0FG')
local real damage=-5.+40.*lvllocal real periodicdamage=4.+16.*lvl
local group gdamage=CreateGroup()local timer t=CreateTimer()local integer h=GetHandleId(t)local unit target=GetSpellTargetUnit()local location loclocal effect eflocal integer jumpsif target!=null then
set xt=GetUnitX(target)set yt=GetUnitY(target)else
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
endifset angle=(bj_RADTODEG*Atan2(yt-yc,xt-xc))-60.set dist=SquareRoot((xt-xc)*(xt-xc)+(yt-yc)*(yt-yc))
set jumps=R2I(dist/ 200.)call SetUnitInvulnerable(caster,true)call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,2)call SetUnitTimeScale(caster,13.33)call SetUnitTurnSpeed(caster,3.)
if GetRandomInt(1,2)==1 then
call SetUnitAnimationByIndex(caster,8)else
call SetUnitAnimationByIndex(caster,2)endifset ef=AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,h,7,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,h,8,ef)set ef=nullcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,xt)call SaveReal(udg_hash,h,3,yt)call SaveReal(udg_hash,h,4,angle)call SaveReal(udg_hash,h,5,damage)call SaveGroupHandle(udg_hash,h,6,gdamage)call SaveBoolean(udg_hash,h,9,true)call SaveBoolean(udg_hash,h,$A,true)
call SaveInteger(udg_hash,h,$B,jumps+1)call SaveReal(udg_hash,h,$C,periodicdamage)call UnitPeriodicPostionMove(caster,.02,jumps*.075)call TimerStart(t,.075,true,function Trig_Dissection_Periodic_Move_Actions)set caster=nullset gdamage=null
set t=nullset target=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Dissection_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0FG'endfunctionfunction InitTrig_Dissection takes nothing returns nothinglocal integer index=0set gg_trg_Dissection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dissection,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dissection,Condition(function Trig_Dissection_Conditions))call TriggerAddAction(gg_trg_Dissection,function Trig_Dissection_Actions)endfunctionfunction Trig_Whirlwind_Periodic_Damage_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damage=LoadReal(udg_hash,h,2)
local integer wait=LoadInteger(udg_hash,h,3)
local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local group g=CreateGroup()local player p=GetOwningPlayer(caster)local unit Pickedlocal effect efif wait>0 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 then
set wait=wait-1call SaveInteger(udg_hash,h,3,wait)call GroupEnumUnitsInRange(g,xc,yc,200.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
if wait-(wait/ $A)*$A==0 thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Picked,"chest"))endifcall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopelse
set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullendfunctionfunction Trig_Whirlwind_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer wait=80local integer lvl=GetUnitAbilityLevel(caster,'A0FH')
local real damage=((20*lvl)+((-.4+.4*lvl)*GetHeroAgi(caster,true)))/ 20.
local timer t=CreateTimer()local integer h=GetHandleId(t)local effect ef=AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",caster,"weapon")call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveInteger(udg_hash,h,3,wait)call SaveEffectHandle(udg_hash,h,4,ef)call TimerStart(t,.05,true,function Trig_Whirlwind_Periodic_Damage_Actions)set caster=nullset t=nullset ef=nullendfunctionfunction Trig_Whirlwind_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0FH'endfunctionfunction InitTrig_Whirlwind takes nothing returns nothinglocal integer index=0set gg_trg_Whirlwind=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Whirlwind,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Whirlwind,Condition(function Trig_Whirlwind_Conditions))
call TriggerAddAction(gg_trg_Whirlwind,function Trig_Whirlwind_Actions)endfunctionfunction Trig_Imboweling_Periodic_Damage_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real xt=LoadReal(udg_hash,h,2)
local real yt=LoadReal(udg_hash,h,3)
local real angle=LoadReal(udg_hash,h,4)+GetRandomReal(75.,285.)local real damage=LoadReal(udg_hash,h,5)
local group gdamage=LoadGroupHandle(udg_hash,h,6)local real anglejump=LoadReal(udg_hash,h,7)local real damagejump=LoadReal(udg_hash,h,8)
local integer jumps=LoadInteger(udg_hash,h,9)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local real x=xt+GetRandomReal(150.,250.)*Cos(angle*bj_DEGTORAD)local real y=yt+GetRandomReal(150.,250.)*Sin(angle*bj_DEGTORAD)local group g=CreateGroup()local real dist=SquareRoot((xt-xc)*(xt-xc)+(yt-yc)*(yt-yc))local integer lop=R2I(dist/ 100.)+1local unit Pickedlocal unit dammi
local player p=GetOwningPlayer(caster)call SaveReal(udg_hash,h,4,angle)set jumps=jumps-1call SaveInteger(udg_hash,h,9,jumps)
if jumps>0 thenif jumps!=1 and jumps!=$B and jumps!=21 and jumps!=2 and jumps!=$C and jumps!=22 thencall SetUnitFacing(caster,angle)
call SetUnitTimeScale(caster,7.5)if GetRandomInt(1,2)==1 then
call SetUnitAnimationByIndex(caster,8)else
call SetUnitAnimationByIndex(caster,2)endifif IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitX(caster,x)call SetUnitY(caster,y)endifcall SetUnitFacing(caster,angle)
loop
exitwhen lop<0call GroupEnumUnitsInRange(g,x+((100.*lop)*Cos(angle*bj_DEGTORAD)),y+((100.*lop)*Sin(angle*bj_DEGTORAD)),175.,null)set lop=lop-1endlooploop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitInGroup(Picked,gdamage)==false and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0G3')call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall TimerStart(t,.1,false,function Trig_Imboweling_Periodic_Damage_Actions)
endifcall SaveGroupHandle(udg_hash,h,6,gdamage)if jumps==2 or jumps==$C or jumps==22 thenset anglejump=anglejump+120.
call SaveReal(udg_hash,h,7,anglejump)set x=xt+200.*Cos(anglejump*bj_DEGTORAD)
set y=yt+200.*Sin(anglejump*bj_DEGTORAD)
if IsTerrainPathable(x,y,PATHING_TYPE_FLYABILITY)==false thencall SetUnitX(caster,x)call SetUnitY(caster,y)endifcall SetUnitFacing(caster,anglejump)
call SetUnitTimeScale(caster,1.4)call SetUnitAnimationByIndex(caster,3)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl",caster,"chest"))
call TimerStart(t,.6,false,function Trig_Imboweling_Periodic_Damage_Actions)
endifif jumps==1 or jumps==$B or jumps==21 thencall GroupEnumUnitsInRange(g,xc+100.*Cos(anglejump*bj_DEGTORAD),yc+100.*Sin(anglejump*bj_DEGTORAD),225.,null)set p=GetOwningPlayer(caster)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damagejump,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0G4')call IssueTargetOrderById(dammi,$D007F,Picked)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl",xc+100.*Cos(anglejump*bj_DEGTORAD),yc+100.*Sin(anglejump*bj_DEGTORAD)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl",xc+100.*Cos(anglejump*bj_DEGTORAD),yc+100.*Sin(anglejump*bj_DEGTORAD)))call TimerStart(t,.1,false,function Trig_Imboweling_Periodic_Damage_Actions)
call GroupClear(gdamage)
call SaveGroupHandle(udg_hash,h,6,gdamage)endifelse
call DestroyEffect(LoadEffectHandle(udg_hash,h,$A))call DestroyEffect(LoadEffectHandle(udg_hash,h,$B))call SetUnitInvulnerable(caster,false)call SetUnitPathing(caster,true)
call SetUnitAnimation(caster,"Stand")call SetUnitTimeScale(caster,1.)
call SetUnitTurnSpeed(caster,GetUnitDefaultTurnSpeed(caster))call IssueImmediateOrderById(caster,$D0004)call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset gdamage=null
call GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullset dammi=nullset p=nullendfunctionfunction Trig_Imboweling_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real distlocal real angle=.0local real anglejump=(bj_RADTODEG*Atan2(yt-yc,xt-xc))local integer lvl=GetUnitAbilityLevel(caster,'A0G2')
local real damage=5.+(25.*lvl)+((.1+.1*lvl)*GetHeroAgi(caster,true))
local real damagejump=(50+GetHeroAgi(caster,true))*1.5*lvllocal group gdamage=CreateGroup()local timer t=CreateTimer()local integer h=GetHandleId(t)local effect eflocal integer jumps=($A*3)+1
call SetUnitInvulnerable(caster,true)call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,2)call SetUnitTimeScale(caster,20.)call SetUnitTurnSpeed(caster,3.)
if GetRandomInt(1,2)==1 then
call SetUnitAnimationByIndex(caster,8)else
call SetUnitAnimationByIndex(caster,2)endifset ef=AddSpecialEffectTarget("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile_mini.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,h,$A,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Weapons\\ZigguratMissile\\ZigguratMissile.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,h,$B,ef)set ef=nullcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,xt)call SaveReal(udg_hash,h,3,yt)call SaveReal(udg_hash,h,4,angle)call SaveReal(udg_hash,h,5,damage)call SaveGroupHandle(udg_hash,h,6,gdamage)call SaveReal(udg_hash,h,7,anglejump)call SaveReal(udg_hash,h,8,damagejump)call SaveInteger(udg_hash,h,9,jumps)
call UnitPeriodicPostionMove(caster,.02,jumps*.1+1.5)call TimerStart(t,.1,false,function Trig_Imboweling_Periodic_Damage_Actions)
set caster=nullset gdamage=null
set t=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Imboweling_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0G2'endfunctionfunction InitTrig_Imboweling takes nothing returns nothinglocal integer index=0set gg_trg_Imboweling=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Imboweling,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Imboweling,Condition(function Trig_Imboweling_Conditions))call TriggerAddAction(gg_trg_Imboweling,function Trig_Imboweling_Actions)endfunctionfunction Trig_Master_of_Lightnings_Load_Actions takes nothing returns nothingcall AbilityPreload('A07N',6)call AbilityPreload('A07O',6)call AbilityPreload('A07Q',6)call AbilityPreload('A07P',3)call AbilityPreload('A07S',6)call EffectPreload("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl")call EffectPreload("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl")call EffectPreload("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl")
call EffectPreload("Abilities\\Spells\\Items\\AIlb\\AIlbTarget.mdl")
call EffectPreload("Abilities\\Weapons\\Bolt\\BoltImpact.mdl")call EffectPreload("Abilities\\Spells\\Items\\AIlb\\AIlbSpecialArt.mdl")
call EffectPreload("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldBuff.mdl")call EffectPreload("war3mapImported\\OutlandStorm.mdx")call EffectPreload("Abilities\\Spells\\Orc\\Purge\\PurgeBuffTarget.mdl")
call EffectPreload("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl")
call EnableTrigger(gg_trg_Thundercloud)call EnableTrigger(gg_trg_Power_of_Lightnings)call EnableTrigger(gg_trg_Electric_Field)call EnableTrigger(gg_trg_Storm)
endfunctionfunction InitTrig_Master_of_Lightnings_Load takes nothing returns nothingset gg_trg_Master_of_Lightnings_Load=CreateTrigger()
call TriggerAddAction(gg_trg_Master_of_Lightnings_Load,function Trig_Master_of_Lightnings_Load_Actions)endfunctionfunction Trig_Thundercloud_lightning_Actions takes nothing returns nothinglocal timer tl=GetExpiredTimer()
local integer hl=GetHandleId(tl)
local integer lop=0local lightning lloop
exitwhen lop>5set l=LoadLightningHandle(udg_hash,hl,lop)call DestroyLightning(l)
set l=nullset lop=lop+1endloopcall FlushChildHashtable(udg_hash,hl)call DestroyTimer(tl)set tl=nullendfunctionfunction Trig_Thundercloud_move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit cloud=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local real angle=LoadReal(udg_hash,h,4)local integer stage=LoadInteger(udg_hash,h,5)local unit caster=LoadUnitHandle(udg_hash,h,7)local real xp=LoadReal(udg_hash,h,8)
local real yp=LoadReal(udg_hash,h,9)
local real damage=LoadReal(udg_hash,h,$A)local player p=LoadPlayerHandle(udg_hash,h,$B)local integer lop=0local real xu=GetUnitX(cloud)local real yu=GetUnitY(cloud)local real distance=SquareRoot((xp-xu)*(xp-xu)+(yp-yu)*(yp-yu))local real xtlocal real ytlocal unit slowerlocal timer tllocal integer hl
local group glocal unit Pickedlocal lightning llocal real betweenlocal effect efcloud
local location loczlocal location loccloudz=GetUnitLoc(cloud)if distance<3.75 thenset stage=stage+1call SaveInteger(udg_hash,h,5,stage)
set tl=CreateTimer()
set hl=GetHandleId(tl)loop
exitwhen lop>4set xt=xp+150.*Cos((lop*72.)*bj_DEGTORAD)set yt=yp+150.*Sin((lop*72.)*bj_DEGTORAD)set locz=Location(xt,yt)
set l=AddLightningEx("FORK",true,xu,yu,425.+GetLocationZ(loccloudz),xt,yt,-50.+GetLocationZ(locz))call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",xt,yt))call SaveLightningHandle(udg_hash,hl,lop,l)set l=nullset lop=lop+1call RemoveLocation(locz)set locz=nullendloopset l=nullset locz=Location(xt,yt)
set l=AddLightningEx("FORK",true,xu,yu,425.+GetLocationZ(loccloudz),xp,yp,-50.+GetLocationZ(locz))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ThunderClap\\ThunderClapCaster.mdl",xp,yp))call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",xp,yp))call SaveLightningHandle(udg_hash,hl,5,l)set l=nullcall RemoveLocation(locz)set locz=nullset g=CreateGroup()call GroupEnumUnitsInRange(g,xp,yp,$E1,null)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set slower=CreateUnit(p,'h00U',xp,yp,.0)
call UnitApplyTimedLife(slower,'BTLF',.75)call UnitAddAbility(slower,'A07S')call SetUnitAbilityLevel(slower,'A07S',GetUnitAbilityLevel(caster,'A07N'))call IssueTargetOrderById(slower,$D006B,Picked)set slower=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIlb\\AIlbSpecialArt.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldBuff.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall TimerStart(tl,.6,false,function Trig_Thundercloud_lightning_Actions)set xp=x+GetRandomReal(200.,250.)*Cos(((stage*120.)+angle)*bj_DEGTORAD)set yp=y+GetRandomReal(200.,250.)*Sin(((stage*120.)+angle)*bj_DEGTORAD)call SaveReal(udg_hash,h,8,xp)call SaveReal(udg_hash,h,9,yp)set tl=nullset Picked=nullcall DestroyGroup(g)
set g=nullif stage>=4 then
set efcloud=LoadEffectHandle(udg_hash,h,6)call DestroyEffect(efcloud)set efcloud=null
call KillUnit(cloud)
set cloud=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifelse
set between=bj_RADTODEG*Atan2(yp-yu,xp-xu)set xu=xu+5.*Cos(between*bj_DEGTORAD)set yu=yu+5.*Sin(between*bj_DEGTORAD)if IsTerrainPathable(xu,yu,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(cloud,xu,yu)else
set efcloud=LoadEffectHandle(udg_hash,h,6)call DestroyEffect(efcloud)set efcloud=null
call KillUnit(cloud)
set cloud=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifendifset t=nullset cloud=nullset caster=nullset p=nullcall RemoveLocation(loccloudz)set loccloudz=nullendfunctionfunction Trig_Thundercloud_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local unit caster2local integer lvl=GetUnitAbilityLevel(caster,'A07N')
local integer lvlult=GetUnitAbilityLevel(caster,'A07P')local integer lvlultup=GetUnitAbilityLevel(caster,'A0Q6')local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local integer stage=0local unit cloud=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,.0)local effect efcloud
local real angle=GetRandomReal(.0,360.)local real damage=(.12*GetUnitAbilityLevel(caster,'A07P')+1.)*((5.+(25.*lvl)+((.1+.05*lvl)*GetHeroInt(caster,true))))local timer t=CreateTimer()local integer h=GetHandleId(t)local player pif lvlult>0 then
set damage=(.12*lvlult+1.)*((5.+(25.*lvl)+((.1+.05*lvl)*GetHeroInt(caster,true))))endifif lvlultup>0 thenset damage=(.17*lvlultup+1.)*((5.+(25.*lvl)+((.1+.05*lvl)*GetHeroInt(caster,true))))
endifif GetOwningPlayer(caster)==Player($F)thenset p=LoadPlayerHandle(udg_hash,GetHandleId(caster),1)set caster2=LoadUnitHandle(udg_hash,GetHandleId(caster),2)call FlushChildHashtable(udg_hash,GetHandleId(caster))else
set p=GetOwningPlayer(caster)set caster2=casterendifcall UnitAddAbility(cloud,'Amrf')call UnitRemoveAbility(cloud,'Amrf')
call SetUnitFlyHeight(cloud,350.+GetLocationZ(loc),.0)call SetUnitScale(cloud,1.35,1.35,1.35)call SetUnitPosition(cloud,x,y)set efcloud=AddSpecialEffectTarget("war3mapImported\\OutlandStorm.mdx",cloud,"origin")call SaveUnitHandle(udg_hash,h,1,cloud)call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SaveReal(udg_hash,h,4,angle)call SaveInteger(udg_hash,h,5,stage)
call SaveEffectHandle(udg_hash,h,6,efcloud)call SaveUnitHandle(udg_hash,h,7,caster2)call SaveReal(udg_hash,h,8,x)call SaveReal(udg_hash,h,9,y)call SaveReal(udg_hash,h,$A,damage)call SavePlayerHandle(udg_hash,h,$B,p)call TimerStart(t,.04,true,function Trig_Thundercloud_move_Actions)set caster=nullset caster2=null
call RemoveLocation(loc)
set loc=null
set cloud=nullset efcloud=null
set t=nullset p=nullendfunctionfunction Trig_Thundercloud_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A07N'endfunctionfunction InitTrig_Thundercloud takes nothing returns nothing
local integer index=0set gg_trg_Thundercloud=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Thundercloud,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Thundercloud,Condition(function Trig_Thundercloud_Conditions))call TriggerAddAction(gg_trg_Thundercloud,function Trig_Thundercloud_Actions)endfunctionfunction Trig_Power_of_Lightnings_periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit ward=LoadUnitHandle(udg_hash,h,$A)local real x=GetUnitX(ward)local real y=GetUnitY(ward)local integer stage=LoadInteger(udg_hash,h,$B)local integer adddamage=LoadInteger(udg_hash,h,18)local integer addas=LoadInteger(udg_hash,h,19)local unit array targetlocal effect array eflocal real txlocal real tylocal lightning array llocal integer second=LoadInteger(udg_hash,h,$D)local integer bonuslocal integer lop=1local effect wef
local integer count=LoadInteger(udg_hash,h,$F)local boolean destroy=falselocal location locwardz=GetUnitLoc(ward)
local location loczloop
exitwhen lop>countset target[lop]=LoadUnitHandle(udg_hash,h,lop)set l[lop]=LoadLightningHandle(udg_hash,h,3+lop)
set lop=lop+1endloopset lop=1if stage>=25 thenset stage=0set second=second+1call SaveInteger(udg_hash,h,$D,second)set bonus=LoadInteger(udg_hash,h,$C)
loop
exitwhen lop>countcall SetAttackAbilityLevel(target[lop],adddamage)call SetAttackSpeedAbilityLevel(target[lop],addas)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",target[lop],"weapon"))set lop=lop+1endloopelse
set stage=stage+1set lop=1loop
exitwhen lop>countif target[lop]!=null thenset tx=GetUnitX(target[lop])-xset ty=GetUnitY(target[lop])-yif SquareRoot(tx*tx+ty*ty)<500 and GetUnitState(target[lop],UNIT_STATE_LIFE)>.405 and second<$F then
set locz=GetUnitLoc(target[lop])
call MoveLightningEx(l[lop],true,x,y,150.+GetLocationZ(locwardz),GetUnitX(target[lop]),GetUnitY(target[lop]),GetUnitFlyHeight(target[lop])+60.+GetLocationZ(locz))call RemoveLocation(locz)set locz=nullelse
set destroy=true
endifendifset lop=lop+1endloopendifif destroy thenset lop=1set bonus=LoadInteger(udg_hash,h,$C)
set wef=LoadEffectHandle(udg_hash,h,$E)call DestroyEffect(wef)set wef=null
call KillUnit(ward)loop
exitwhen lop>countcall SetAttackAbilityLevel(target[lop],-1*adddamage*second)call SetAttackSpeedAbilityLevel(target[lop],-second*addas)set ef[lop]=LoadEffectHandle(udg_hash,h,6+lop)call DestroyEffect(ef[lop])call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",target[lop],"weapon"))call DestroyLightning(l[lop])set ef[lop]=null
set lop=lop+1endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifcall SaveInteger(udg_hash,h,$B,stage)set lop=1loop
exitwhen lop>countset target[lop]=null
set l[lop]=nullset lop=lop+1endloopset t=nullset ward=nullcall RemoveLocation(locwardz)set locwardz=nullendfunctionfunction Trig_Power_of_Lightnings_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local unit ward=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,GetRandomReal(.0,360.))local unit array targetlocal real xw=GetUnitX(ward)
local real yw=GetUnitY(ward)
local lightning array llocal integer lop=1local timer t=CreateTimer()local integer h=GetHandleId(t)local group g=CreateGroup()local group grup=CreateGroup()local unit Pickedlocal integer stage=0local integer second=0local integer bonus=2+GetUnitAbilityLevel(caster,'A07O')
local effect array eflocal effect wef=AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",ward,"chest")local integer count=R2I((I2R(GetUnitAbilityLevel(caster,'A07O'))/ 2)+.5)
local location loczlocal integer adddamage=2+GetUnitAbilityLevel(caster,'A07O')
local integer addas=R2I(adddamage/ 2)call UnitAddAbility(ward,'Amrf')
call UnitRemoveAbility(ward,'Amrf')call SetUnitFlyHeight(ward,50.,.0)call SetUnitScale(ward,2.5,2.5,2.5)call GroupEnumUnitsInRange(g,x,y,450.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitAlly(Picked,GetOwningPlayer(caster))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall RandomUnitFromGroup(R2I((I2R(GetUnitAbilityLevel(caster,'A07O'))/ 2)+.5),grup)loop
exitwhen lop>countset target[lop]=FirstOfGroup(udg_GroupRandomUnitFromGroup)if target[lop]!=null thenset locz=GetUnitLoc(target[lop])
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",target[lop],"chest"))
set ef[lop]=AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",target[lop],"weapon")set l[lop]=AddLightningEx("CLPB",true,x,y,150.+GetLocationZ(loc),GetUnitX(target[lop]),GetUnitY(target[lop]),GetUnitFlyHeight(target[lop])+50.+GetLocationZ(locz))call SaveUnitHandle(udg_hash,h,lop,target[lop])call SaveLightningHandle(udg_hash,h,lop+3,l[lop])call SaveEffectHandle(udg_hash,h,lop+6,ef[lop])call RemoveLocation(locz)set locz=nullendifcall GroupRemoveUnit(udg_GroupRandomUnitFromGroup,target[lop])set lop=lop+1endloopcall SaveUnitHandle(udg_hash,h,$A,ward)call SaveInteger(udg_hash,h,$B,stage)call SaveInteger(udg_hash,h,$C,bonus)call SaveInteger(udg_hash,h,$D,second)call SaveEffectHandle(udg_hash,h,$E,wef)
call SaveInteger(udg_hash,h,$F,count)call SaveInteger(udg_hash,h,18,adddamage)call SaveInteger(udg_hash,h,19,addas)call TimerStart(t,.04,true,function Trig_Power_of_Lightnings_periodic_Actions)set lop=1loop
exitwhen lop>countset target[lop]=null
set l[lop]=nullset ef[lop]=null
set lop=lop+1endloopset caster=nullcall RemoveLocation(loc)
set loc=null
set ward=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullset Picked=nullset wef=null
set t=nullendfunctionfunction Trig_Power_of_Lightnings_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A07O'endfunctionfunction InitTrig_Power_of_Lightnings takes nothing returns nothinglocal integer index=0set gg_trg_Power_of_Lightnings=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Power_of_Lightnings,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Power_of_Lightnings,Condition(function Trig_Power_of_Lightnings_Conditions))
call TriggerAddAction(gg_trg_Power_of_Lightnings,function Trig_Power_of_Lightnings_Actions)endfunctionfunction Trig_Electric_Field_periodic_lightning_move_Actions takes nothing returns nothinglocal timer tl=GetExpiredTimer()
local integer hl=GetHandleId(tl)
local integer check=LoadInteger(udg_hash,hl,20)local unit caster=LoadUnitHandle(udg_hash,hl,21)
local integer lvl=GetUnitAbilityLevel(caster,'A07Q')
local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loccasterz=GetUnitLoc(caster)
local location loczlocal lightning array llocal unit array targetlocal integer lop=0local integer count=LoadInteger(udg_hash,hl,22)if check<$F then
set check=check+1call SaveInteger(udg_hash,hl,20,check)loop
exitwhen lop+1>count
set l[lop]=LoadLightningHandle(udg_hash,hl,lop)set target[lop]=LoadUnitHandle(udg_hash,hl,lop+$A)if GetUnitState(target[lop],UNIT_STATE_LIFE)>.405 and target[lop]!=null then
set locz=GetUnitLoc(target[lop])
call MoveLightningEx(l[lop],true,x,y,GetUnitFlyHeight(caster)+215.+GetLocationZ(loccasterz),GetUnitX(target[lop]),GetUnitY(target[lop]),GetUnitFlyHeight(target[lop])+25.+GetLocationZ(locz))call RemoveLocation(locz)set locz=nullendifset l[lop]=nullset target[lop]=null
set lop=lop+1endloopelse
set lop=0loop
exitwhen lop>countset l[lop]=LoadLightningHandle(udg_hash,hl,lop)call DestroyLightning(l[lop])set l[lop]=nullset lop=lop+1endloopcall FlushChildHashtable(udg_hash,hl)call DestroyTimer(tl)endifset tl=nullset caster=nullcall RemoveLocation(loccasterz)set loccasterz=nullendfunctionfunction Trig_Electric_Field_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer lvl=GetUnitAbilityLevel(caster,'A07Q')
local real x=GetUnitX(caster)local real y=GetUnitY(caster)local group glocal group grup
local unit Pickedlocal integer lop=0local unit targetlocal lightning array llocal location loccasterzlocal location loczlocal timer tllocal integer hl
local integer check=0local real damagelocal integer count=0if GetUnitState(caster,UNIT_STATE_LIFE)>.405 thenset damage=10.+(lvl*$F)+GetRandomReal(.0,lvl*10.)set tl=CreateTimer()
set hl=GetHandleId(tl)set loccasterz=GetUnitLoc(caster)set g=CreateGroup()set grup=CreateGroup()call GroupEnumUnitsInRange(g,x,y,500.,null)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",caster,"overhead"))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,GetOwningPlayer(caster))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall RandomUnitFromGroup(1+lvl,grup)
call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)loop
set target=FirstOfGroup(g)exitwhen lop>lvl+1 or target==nullset count=count+1set locz=GetUnitLoc(target)set l[lop]=AddLightningEx("CLPB",true,x,y,GetUnitFlyHeight(caster)+215.+GetLocationZ(loccasterz),GetUnitX(target),GetUnitY(target),GetUnitFlyHeight(target)+25.+GetLocationZ(locz))call SaveLightningHandle(udg_hash,hl,lop,l[lop])
call SaveUnitHandle(udg_hash,hl,lop+$A,target)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIlb\\AIlbSpecialArt.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",target,"origin"))call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call GroupRemoveUnit(g,target)call RemoveLocation(locz)set locz=nullset l[lop]=nullset target=nullset lop=lop+1endloopcall SaveInteger(udg_hash,hl,20,check)call SaveUnitHandle(udg_hash,hl,21,caster)call SaveInteger(udg_hash,hl,22,count)call TimerStart(tl,.04,true,function Trig_Electric_Field_periodic_lightning_move_Actions)call RemoveLocation(loccasterz)set loccasterz=nullset tl=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullset Picked=nullset target=nullendifset t=nullset caster=nullendfunctionfunction Trig_Learn_Skill_Electric_Field_Actions takes nothing returns nothinglocal unit caster=GetLearningUnit()local integer lvl=GetUnitAbilityLevel(caster,'A07Q')
local timer tlocal integer hif lvl==1 thenset t=CreateTimer()set h=GetHandleId(t)
call SaveTimerHandle(udg_hash,GetHandleId(caster),$B,t)endifset t=LoadTimerHandle(udg_hash,GetHandleId(caster),$B)call SaveUnitHandle(udg_hash,h,1,caster)
call TimerStart(t,4.-(.25*lvl),true,function Trig_Electric_Field_periodic_Actions)set caster=nullset t=nullendfunctionfunction Trig_Learn_Skill_Electric_Field_Conditions takes nothing returns booleanreturn GetLearnedSkill()=='A07Q' and GetUnitTypeId(GetLearningUnit())!='h00U'endfunctionfunction InitTrig_Electric_Field takes nothing returns nothinglocal integer index=0set gg_trg_Electric_Field=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Electric_Field,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Electric_Field,Condition(function Trig_Learn_Skill_Electric_Field_Conditions))call TriggerAddAction(gg_trg_Electric_Field,function Trig_Learn_Skill_Electric_Field_Actions)endfunctionfunction Trig_Thundercloud_lightning2_Actions takes nothing returns nothinglocal timer tl=GetExpiredTimer()
local integer hl=GetHandleId(tl)
local integer lop=0local lightning lloop
exitwhen lop>5set l=LoadLightningHandle(udg_hash,hl,lop)call DestroyLightning(l)
set l=nullset lop=lop+1endloopcall FlushChildHashtable(udg_hash,hl)call DestroyTimer(tl)set tl=nullendfunctionfunction Trig_Thundercloud2_move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit cloud=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local real angle=LoadReal(udg_hash,h,4)local integer stage=LoadInteger(udg_hash,h,5)local unit caster=LoadUnitHandle(udg_hash,h,7)local real xp=LoadReal(udg_hash,h,8)
local real yp=LoadReal(udg_hash,h,9)
local real damage=LoadReal(udg_hash,h,$A)local player p=LoadPlayerHandle(udg_hash,h,$B)local integer lop=0local real xu=GetUnitX(cloud)local real yu=GetUnitY(cloud)local real distance=SquareRoot((xp-xu)*(xp-xu)+(yp-yu)*(yp-yu))local real xtlocal real ytlocal unit slowerlocal timer tllocal integer hl
local group glocal unit Pickedlocal lightning llocal real betweenlocal effect efcloud
local location loczlocal location loccloudz=GetUnitLoc(cloud)if distance<3.75 thenset stage=stage+1call SaveInteger(udg_hash,h,5,stage)
set tl=CreateTimer()
set hl=GetHandleId(tl)loop
exitwhen lop>4set xt=xp+150.*Cos((lop*72.)*bj_DEGTORAD)set yt=yp+150.*Sin((lop*72.)*bj_DEGTORAD)set locz=Location(xt,yt)
set l=AddLightningEx("FORK",true,xu,yu,425.+GetLocationZ(loccloudz),xt,yt,-50.+GetLocationZ(locz))call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",xt,yt))call SaveLightningHandle(udg_hash,hl,lop,l)set l=nullset lop=lop+1call RemoveLocation(locz)set locz=nullendloopset l=nullset locz=Location(xt,yt)
set l=AddLightningEx("FORK",true,xu,yu,425.+GetLocationZ(loccloudz),xp,yp,-50.+GetLocationZ(locz))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ThunderClap\\ThunderClapCaster.mdl",xp,yp))call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",xp,yp))call SaveLightningHandle(udg_hash,hl,5,l)set l=nullcall RemoveLocation(locz)set locz=nullset g=CreateGroup()call GroupEnumUnitsInRange(g,xp,yp,$E1,null)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' then
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set slower=CreateUnit(p,'h00U',xp,yp,.0)
call UnitApplyTimedLife(slower,'BTLF',.75)call UnitAddAbility(slower,'A07S')call SetUnitAbilityLevel(slower,'A07S',GetUnitAbilityLevel(caster,'A07N'))call IssueTargetOrderById(slower,$D006B,Picked)set slower=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIlb\\AIlbSpecialArt.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldBuff.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",Picked,"chest"))endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall TimerStart(tl,.6,false,function Trig_Thundercloud_lightning2_Actions)set xp=x+GetRandomReal(200.,250.)*Cos(((stage*120.)+angle)*bj_DEGTORAD)set yp=y+GetRandomReal(200.,250.)*Sin(((stage*120.)+angle)*bj_DEGTORAD)call SaveReal(udg_hash,h,8,xp)call SaveReal(udg_hash,h,9,yp)set tl=nullset Picked=nullcall DestroyGroup(g)
set g=nullif stage>=4 then
set efcloud=LoadEffectHandle(udg_hash,h,6)call DestroyEffect(efcloud)set efcloud=null
call KillUnit(cloud)
set cloud=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifelse
set between=bj_RADTODEG*Atan2(yp-yu,xp-xu)set xu=xu+5.*Cos(between*bj_DEGTORAD)set yu=yu+5.*Sin(between*bj_DEGTORAD)if IsTerrainPathable(xu,yu,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(cloud,xu,yu)else
set efcloud=LoadEffectHandle(udg_hash,h,6)call DestroyEffect(efcloud)set efcloud=null
call KillUnit(cloud)
set cloud=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifendifset t=nullset cloud=nullset caster=nullset p=nullcall RemoveLocation(loccloudz)set loccloudz=nullendfunctionfunction Trig_Storm_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local integer lvl=LoadInteger(udg_hash,h,5)local integer order=GetUnitCurrentOrder(caster)local integer lvlult=GetUnitAbilityLevel(caster,'A07P')local integer lvlultup=GetUnitAbilityLevel(caster,'A0Q6')local unit dammi
local real pxlocal real pylocal integer orderIdlocal unit cloud
local player plocal real damagelocal real angle
local effect efcloud
local location loclocal timer t2local integer h2
set orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId and(lvl>0)then
set t2=CreateTimer()
set h2=GetHandleId(t2)set p=GetOwningPlayer(caster)if lvlult>0 then
set damage=(.12*lvlult+1.)*((5.+(25.*lvl)+((.1+.05*lvl)*GetHeroInt(caster,true))))endifif lvlultup>0 thenset damage=(.17*lvlultup+1.)*((5.+(25.*lvl)+((.1+.05*lvl)*GetHeroInt(caster,true))))
endifset angle=GetRandomReal(.0,360.)
set px=x+GetRandomReal(200.,400.)*Cos(angle*bj_DEGTORAD)
set py=y+GetRandomReal(200.,400.)*Sin(angle*bj_DEGTORAD)
set cloud=CreateUnit(GetOwningPlayer(caster),'h00U',px,py,.0)set efcloud=AddSpecialEffectTarget("war3mapImported\\OutlandStorm.mdx",cloud,"origin")call UnitAddAbility(cloud,'Amrf')call UnitRemoveAbility(cloud,'Amrf')
set loc=Location(px,py)call SetUnitFlyHeight(cloud,350.+GetLocationZ(loc),.0)call SetUnitScale(cloud,1.35,1.35,1.35)call SetUnitPosition(cloud,px,py)call SaveUnitHandle(udg_hash,h2,1,cloud)
call SaveReal(udg_hash,h2,2,px)call SaveReal(udg_hash,h2,3,py)call SaveReal(udg_hash,h2,4,angle)call SaveInteger(udg_hash,h2,5,0)call SaveEffectHandle(udg_hash,h2,6,efcloud)
call SaveUnitHandle(udg_hash,h2,7,caster)call SaveReal(udg_hash,h2,8,px)call SaveReal(udg_hash,h2,9,py)call SaveReal(udg_hash,h2,$A,damage)
call SavePlayerHandle(udg_hash,h2,$B,p)call TimerStart(t2,.04,true,function Trig_Thundercloud2_move_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set cloud=nullset efcloud=null
set t2=nullset p=nullcall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Purge\\PurgeBuffTarget.mdl",caster,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",caster,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl",caster,"overhead"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl",caster,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",caster,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",caster,"hand,right"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\FarseerMissile\\FarseerMissile.mdl",caster,"weapon"))
else
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))endifset t=nullset caster=nullendfunctionfunction Trig_Storm_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer lvl=GetUnitAbilityLevel(caster,'A07N')
local integer lvlult=GetUnitAbilityLevel(caster,'A07P')local integer lvlultup=GetUnitAbilityLevel(caster,'A0Q6')local real x=GetUnitX(caster)local real y=GetUnitY(caster)local timer t=CreateTimer()local integer h=GetHandleId(t)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,x)call SaveReal(udg_hash,h,3,y)call SaveInteger(udg_hash,h,5,lvl)if lvlult>0 then
call AddProgressBar(caster,240.+(3.*lvlult),(.9+.1*lvl),(.5*3*lvlult),false,true,'u',$96,$96,$AF)endifif lvlultup>0 thencall AddProgressBar(caster,240.+(3.*lvlultup),(.9+.1*lvl),(.5*4*lvlultup),false,true,'u',$96,$96,$AF)endifcall TimerStart(t,.5,true,function Trig_Storm_periodic_Actions)set caster=nullset t=nullendfunctionfunction Trig_Storm_Conditions takes nothing returns boolean
return(GetSpellAbilityId()=='A07P' or GetSpellAbilityId()=='A0Q6')endfunctionfunction InitTrig_Storm takes nothing returns nothinglocal integer index=0set gg_trg_Storm=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Storm,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Storm,Condition(function Trig_Storm_Conditions))
call TriggerAddAction(gg_trg_Storm,function Trig_Storm_Actions)endfunctionfunction Trig_Respawnlol_Actions takes nothing returns nothingcall ConditionalTriggerExecute(gg_trg_Ranger_Load)endfunctionfunction InitTrig_Respawnlol takes nothing returns nothingset gg_trg_Respawnlol=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Respawnlol,5)call TriggerAddAction(gg_trg_Respawnlol,function Trig_Respawnlol_Actions)endfunctionfunction Trig_Ranger_Load_Actions takes nothing returns nothingcall AbilityPreload('A0EE',6)call AbilityPreload('A0ED',4)call AbilityPreload('A0EF',1)call AbilityPreload('A0EH',6)call AbilityPreload('A0EK',6)call AbilityPreload('A0EL',6)call AbilityPreload('A0EG',6)call AbilityPreload('A0EN',6)call AbilityPreload('A0EO',1)call AbilityPreload('A0EP',3)call AbilityPreload('A0EM',6)call AbilityPreload('A0EI',6)call AbilityPreload('A0EJ',6)call EffectPreload("Abilities\\Spells\\Other\\BreathOfFire\\BreathOfFireDamage.mdl")
call EffectPreload("Abilities\\Spells\\Other\\FrostDamage\\FrostDamage.mdl")
call EffectPreload("Abilities\\Weapons\\ZigguratFrostMissile\\ZigguratFrostMissile.mdl")
call EffectPreload("Abilities\\Spells\\Undead\\Curse\\CurseTarget.mdl")call EffectPreload("Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl")call EffectPreload("Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl")
call EffectPreload("Abilities\\Spells\\Undead\\OrbOfDeath\\AnnihilationMissile.mdl")
call EffectPreload("Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl")call EffectPreload("Abilities\\Weapons\\ColdArrow\\ColdArrowMissile.mdl")call EffectPreload("Abilities\\Spells\\Other\\BlackArrow\\BlackArrowMissile.mdl")call EffectPreload("Abilities\\Spells\\Other\\Drain\\ManaDrainCaster.mdl")call EnableTrigger(gg_trg_MultiShotSwitch)call EnableTrigger(gg_trg_Learn_Release_of_Arrows)call EnableTrigger(gg_trg_Release_of_Arrows)
call EnableTrigger(gg_trg_Dexterity_of_the_Ranger)endfunctionfunction InitTrig_Ranger_Load takes nothing returns nothingset gg_trg_Ranger_Load=CreateTrigger()call TriggerAddAction(gg_trg_Ranger_Load,function Trig_Ranger_Load_Actions)endfunctionfunction Trig_MultiShotSwitch_Actions takes nothing returns nothinglocal unit caster=GetTriggerUnit()local unit death=GetDyingUnit()local integer id='A0EF'local integer orderIdif GetUnitAbilityLevel(death,id)>0 thencall UnitRemoveAbility(death,id)
endifset orderId=$D0057if(GetIssuedOrderId()==orderId)thencall UnitAddAbility(caster,id)call SetUnitAbilityLevel(caster,'A0ED',1+GetUnitAbilityLevel(caster,'A0EP'))
call UnitMakeAbilityPermanent(caster,true,id)call UnitMakeAbilityPermanent(caster,true,'A0ED')endifset orderId=$D0058if(GetIssuedOrderId()==orderId)thencall UnitRemoveAbility(caster,id)endifset caster=nullset death=nullendfunctionfunction Trig_MultiShotSwitch_Conditions takes nothing returns booleanreturn GetUnitAbilityLevel(GetTriggerUnit(),'A0EE')>0 or GetUnitAbilityLevel(GetDyingUnit(),'A0EE')>0endfunctionfunction InitTrig_MultiShotSwitch takes nothing returns nothinglocal integer index=0set gg_trg_MultiShotSwitch=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_MultiShotSwitch,Player(index),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)call TriggerRegisterPlayerUnitEvent(gg_trg_MultiShotSwitch,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_MultiShotSwitch,Condition(function Trig_MultiShotSwitch_Conditions))
call TriggerAddAction(gg_trg_MultiShotSwitch,function Trig_MultiShotSwitch_Actions)endfunctionfunction Trig_Learn_Release_of_Arrows_Actions takes nothing returns nothinglocal unit u=GetLearningUnit()local integer lvl=GetUnitAbilityLevel(u,'A0EH')if lvl==1 thencall UnitAddAbility(u,'A0EK')call UnitAddAbility(u,'A0EL')call UnitAddAbility(u,'A0EG')call UnitMakeAbilityPermanent(u,true,'A0EK')
call UnitMakeAbilityPermanent(u,true,'A0EL')
call UnitMakeAbilityPermanent(u,true,'A0EG')
else
call SetUnitAbilityLevel(u,'A0EK',lvl)call SetUnitAbilityLevel(u,'A0EL',lvl)call SetUnitAbilityLevel(u,'A0EG',lvl)endifset u=nullendfunctionfunction Trig_Learn_Release_of_Arrows_Conditions takes nothing returns booleanreturn GetLearnedSkill()=='A0EH' and GetUnitTypeId(GetLearningUnit())!='h00U'endfunctionfunction InitTrig_Learn_Release_of_Arrows takes nothing returns nothinglocal integer index=0set gg_trg_Learn_Release_of_Arrows=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Release_of_Arrows,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Release_of_Arrows,Condition(function Trig_Learn_Release_of_Arrows_Conditions))
call TriggerAddAction(gg_trg_Learn_Release_of_Arrows,function Trig_Learn_Release_of_Arrows_Actions)endfunctionfunction Trig_Release_of_Arrows_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,20)local integer count=LoadInteger(udg_hash,h,21)local real damage=LoadReal(udg_hash,h,22)local integer check=LoadInteger(udg_hash,h,23)local integer abiltype=LoadInteger(udg_hash,h,24)local group gdamage=LoadGroupHandle(udg_hash,h,25)local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0EH')
local unit arrow
local real axlocal real aylocal real facelocal integer lop=0local effect eflocal unit dammi
local string sef
local string orderlocal integer rawcodelocal group g=CreateGroup()local group gr=CreateGroup()
local unit Pickedif check<25 then
set check=check+1call SaveInteger(udg_hash,h,23,check)if abiltype==1 thenset sef="Abilities\\Weapons\\RedDragonBreath\\RedDragonMissile.mdl"set rawcode='A0EM'set order="acidbomb"
endifif abiltype==2 thenset sef="Abilities\\Weapons\\FrostWyrmMissile\\FrostWyrmMissile.mdl"
set rawcode='A0EI'set order="slow"
endifif abiltype==3 thenset sef="Abilities\\Spells\\Undead\\OrbOfDeath\\AnnihilationMissile.mdl"
set rawcode='A0EJ'set order="innerfire"endifloop
exitwhen lop>=countset arrow=LoadUnitHandle(udg_hash,h,lop)
set face=GetUnitFacing(arrow)set ax=GetUnitX(arrow)+36.*Cos(face*bj_DEGTORAD)
set ay=GetUnitY(arrow)+36.*Sin(face*bj_DEGTORAD)
if IsTerrainPathable(ax,ay,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(arrow,ax,ay)call GroupEnumUnitsInRange(g,ax,ay,100.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call GroupAddUnit(gr,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifset arrow=nullset lop=lop+1endlooploop
set Picked=FirstOfGroup(gr)exitwhen Picked==nullset dammi=CreateUnit(p,'h00U',ax,ay,.0)call UnitApplyTimedLife(dammi,'BTLF',.34)call UnitAddAbility(dammi,rawcode)call SetUnitAbilityLevel(dammi,rawcode,lvl)call IssueTargetOrder(dammi,order,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget(sef,Picked,"chest"))set dammi=nullcall GroupRemoveUnit(gr,Picked)endloopelse
loop
exitwhen lop>=countset arrow=LoadUnitHandle(udg_hash,h,lop)
set ef=LoadEffectHandle(udg_hash,h,$A+lop)call KillUnit(arrow)
call DestroyEffect(ef)set arrow=nullset ef=nullset lop=lop+1endloopcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifset t=nullset caster=nullset gdamage=null
set p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gr)call DestroyGroup(gr)set gr=nullset Picked=nullendfunctionfunction Trig_Release_of_Arrows_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real txlocal real tylocal location loclocal real angle
local real angle1local player p=GetOwningPlayer(caster)local integer abilityid=GetSpellAbilityId()local integer abiltypelocal integer count=GetUnitAbilityLevel(caster,GetSpellAbilityId())+2local integer lop=0local real damage=((count*25.)-35.)local integer lvlult=GetUnitAbilityLevel(caster,'A0EP')local unit arrow
local integer check=0local effect eflocal string slocal group gdamage=CreateGroup()local timer t=CreateTimer()local integer h=GetHandleId(t)local boolean perekluchatelangle=falselocal integer counterangle=0
local integer hcaster=GetHandleId(caster)local integer agilitylocal integer bonusif lvlult>0 then
set damage=damage*(1.+.15*GetUnitAbilityLevel(caster,'A0EP')+.05)endifif target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=(bj_RADTODEG*Atan2(ty-y,tx-x))
if target==caster thenset angle=GetUnitFacing(caster)endifif count-((count/ 2)*2)==0 thenset angle=angle+6.endifif abilityid=='A0EK' thenset abiltype=1set s="Abilities\\Weapons\\SearingArrow\\SearingArrowMissile.mdl"endifif abilityid=='A0EL' thenset abiltype=2set s="Abilities\\Weapons\\ColdArrow\\ColdArrowMissile.mdl"endifif abilityid=='A0EG' thenset abiltype=3set s="Abilities\\Spells\\Other\\BlackArrow\\BlackArrowMissile.mdl"endifloop
exitwhen lop>=countif perekluchatelangle thenset perekluchatelangle=false
set angle=angle-(counterangle*12.)else
set perekluchatelangle=trueset angle=angle+(counterangle*12.)endifset arrow=CreateUnit(p,'h00U',x,y,angle)
call SetUnitScale(arrow,1.2,1.2,1.2)
set ef=AddSpecialEffectTarget(s,arrow,"chest")call SaveUnitHandle(udg_hash,h,lop,arrow)call SaveEffectHandle(udg_hash,h,$A+lop,ef)set arrow=nullset ef=nullset lop=lop+1set counterangle=counterangle+1endloopif GetUnitAbilityLevel(caster,'A0EO')>0 then
set hcaster=GetHandleId(caster)set agility=LoadInteger(udg_hash,hcaster,52)
set bonus=LoadInteger(udg_hash,hcaster,53)if agility<=30*GetUnitAbilityLevel(caster,'A0EN')-5-(count*bonus)thenset agility=agility+(count*bonus)call SetHeroAgi(caster,GetHeroAgi(caster,false)+(count*bonus),true)call SaveInteger(udg_hash,hcaster,52,agility)call ProgressBarAddPercentComplete(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'),(((count*bonus)*100.)/(30*GetUnitAbilityLevel(caster,'A0EN')-5-(count*bonus))))else
call SetHeroAgi(caster,GetHeroAgi(caster,false)-agility+(30*GetUnitAbilityLevel(caster,'A0EN'))-5,true)set agility=30*GetUnitAbilityLevel(caster,'A0EN')-5call SaveInteger(udg_hash,hcaster,52,agility)endifendifcall SaveUnitHandle(udg_hash,h,20,caster)call SaveInteger(udg_hash,h,21,count)call SaveReal(udg_hash,h,22,damage)call SaveInteger(udg_hash,h,23,check)call SaveInteger(udg_hash,h,24,abiltype)
call SaveGroupHandle(udg_hash,h,25,gdamage)call TimerStart(t,.04,true,function Trig_Release_of_Arrows_periodic_Actions)
set caster=nullset target=nullcall RemoveLocation(loc)
set loc=null
set p=nullset gdamage=null
set t=nullendfunctionfunction Trig_Release_of_Arrows_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0EK' or GetSpellAbilityId()=='A0EL' or GetSpellAbilityId()=='A0EG'
endfunctionfunction InitTrig_Release_of_Arrows takes nothing returns nothinglocal integer index=0set gg_trg_Release_of_Arrows=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Release_of_Arrows,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Release_of_Arrows,Condition(function Trig_Release_of_Arrows_Conditions))
call TriggerAddAction(gg_trg_Release_of_Arrows,function Trig_Release_of_Arrows_Actions)endfunctionfunction Trig_Dexterity_of_the_Ranger_Remove_Agility_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local effect ef=LoadEffectHandle(udg_hash,h,2)local integer agility=LoadInteger(udg_hash,GetHandleId(caster),52)call SetHeroAgi(caster,GetHeroAgi(caster,false)-agility,true)call UnitRemoveAbility(caster,'A0EO')call DestroyEffect(ef)call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset ef=nullset caster=nullendfunctionfunction Trig_Dexterity_of_the_Ranger_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real time=10.+2*GetUnitAbilityLevel(caster,'A0EP')
local timer t=CreateTimer()local integer h=GetHandleId(t)local integer lvl=GetUnitAbilityLevel(caster,'A0EN')
local integer agility=6+4*lvllocal integer chetnost=((lvl/ 2)*2)-lvllocal integer bonuslocal effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\Drain\\ManaDrainCaster.mdl",caster,"overhead")
if chetnost==0 thenset bonus=(lvl/ 2)else
set bonus=(lvl/ 2)+1
endifcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveEffectHandle(udg_hash,h,2,ef)call SaveInteger(udg_hash,GetHandleId(caster),52,agility)call SaveInteger(udg_hash,GetHandleId(caster),53,bonus)call SetHeroAgi(caster,GetHeroAgi(caster,false)+agility,true)call UnitAddAbility(caster,'A0EO')call TimerStart(t,10.,false,function Trig_Dexterity_of_the_Ranger_Remove_Agility_Actions)call AddProgressBar(caster,150.+(2.*lvl),(.9+.05*lvl),1.,true,false,'u',20,'n',$E6)call ProgressBarAddPercentComplete(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'),(agility*100./(30*GetUnitAbilityLevel(caster,'A0EN')-5)))set caster=nullset ef=nullset t=nullendfunctionfunction Trig_Dexterity_of_the_Ranger_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0EN'endfunctionfunction InitTrig_Dexterity_of_the_Ranger takes nothing returns nothinglocal integer index=0set gg_trg_Dexterity_of_the_Ranger=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dexterity_of_the_Ranger,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dexterity_of_the_Ranger,Condition(function Trig_Dexterity_of_the_Ranger_Conditions))
call TriggerAddAction(gg_trg_Dexterity_of_the_Ranger,function Trig_Dexterity_of_the_Ranger_Actions)endfunctionfunction Trig_Healer_Load_Actions takes nothing returns nothingcall AbilityPreload('A006',6)call AbilityPreload('A04P',6)call AbilityPreload('A0AC',6)call AbilityPreload('A0AE',3)call UnitPreload('h01O')
call AbilityPreload('A0EQ',6)call AbilityPreload('A0ER',6)call AbilityPreload('A032',6)call AbilityPreload('A0A8',6)call AbilityPreload('A0AD',1)call AbilityPreload('B020',1)call AbilityPreload('B022',1)call AbilityPreload('B023',1)call AbilityPreload('B025',1)call AbilityPreload('B028',1)call EffectPreload("Abilities\\Spells\\Items\\StaffOfSanctuary\\Staff_Sanctuary_Target.mdl")
call EffectPreload("Abilities\\Spells\\Items\\PotionOfOmniscience\\CrystalBallCaster.mdl")call EffectPreload("Abilities\\Spells\\Human\\InnerFire\\InnerFireTarget.mdl")call EffectPreload("Abilities\\Spells\\Other\\ANrm\\ANrmTarget.mdl")
call EffectPreload("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl")
call EffectPreload("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl")call EffectPreload("war3mapImported\\Curing_Light_Effect.mdx")call EffectPreload("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl")call EffectPreload("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdl")call EffectPreload("war3mapImported\\Retribution.mdx")call EnableTrigger(gg_trg_Good_Healing)call EnableTrigger(gg_trg_Spiritual_Communication)call EnableTrigger(gg_trg_Curing_Light)call EnableTrigger(gg_trg_Guardian_Angel)endfunctionfunction InitTrig_Healer_Load takes nothing returns nothingset gg_trg_Healer_Load=CreateTrigger()call TriggerAddAction(gg_trg_Healer_Load,function Trig_Healer_Load_Actions)endfunctionfunction Trig_Good_Healing_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local integer lvl=GetUnitAbilityLevel(caster,'A006')
local real damage=((5*lvl*lvl)+20)+(20.*lvl)+(GetHeroInt(caster,true)*.2*lvl)local real heal=(($A*lvl*lvl)+40)+(40.*lvl)+(GetHeroInt(caster,true)*.4*lvl)
local group g=CreateGroup()local unit Pickedlocal unit dammi
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",x,y))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl",x,y))
set dammi=CreateUnit(p,'h00U',x,y,.0)call SetUnitX(dammi,x)call SetUnitY(dammi,y)call UnitApplyTimedLife(dammi,'BTLF',2.)
call UnitAddAbility(dammi,'A0EQ')call SetUnitAbilityLevel(dammi,'A0EQ',lvl)call IssueImmediateOrderById(dammi,$D00C4)call GroupEnumUnitsInRange(g,x,y,300.+10.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",Picked,"origin"))
endifif IsUnitAlly(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+heal)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",Picked,"origin"))
endifcall GroupRemoveUnit(g,Picked)endloopset dammi=nullset caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
set Picked=nullset dammi=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullendfunctionfunction Trig_Good_Healing_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A006'endfunctionfunction InitTrig_Good_Healing takes nothing returns nothing
local integer index=0set gg_trg_Good_Healing=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Good_Healing,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Good_Healing,Condition(function Trig_Good_Healing_Conditions))call TriggerAddAction(gg_trg_Good_Healing,function Trig_Good_Healing_Actions)endfunctionfunction Trig_Spiritual_Communication_Ligtning_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local lightning l=LoadLightningHandle(udg_hash,h,3)local real time=LoadReal(udg_hash,h,4)local location locc=GetUnitLoc(caster)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local location loct=GetUnitLoc(target)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real dx=xc-xtlocal real dy=yc-ytlocal real dist=SquareRoot(dx*dx+dy*dy)local integer liferegenlocal integer manaregenif GetUnitState(caster,UNIT_STATE_LIFE)>.405 and GetUnitState(target,UNIT_STATE_LIFE)>.0 and dist<=700. and time>.0 then
set time=time-.04call SaveReal(udg_hash,h,4,time)
call MoveLightningEx(l,true,xc,yc,50.+GetLocationZ(locc),xt,yt,50.+GetLocationZ(loct))else
call UnitRemoveAbility(caster,'B022')call UnitRemoveAbility(target,'B022')call UnitRemoveAbility(caster,'B023')call UnitRemoveAbility(target,'B023')set liferegen=LoadInteger(udg_hash,h,5)set manaregen=LoadInteger(udg_hash,h,6)call SetUnitLifeAndManaRegeneration(caster,"life",-1*liferegen)call SetUnitLifeAndManaRegeneration(target,"life",-1*liferegen)call SetUnitLifeAndManaRegeneration(caster,"mana",-1*manaregen)call SetUnitLifeAndManaRegeneration(target,"mana",-1*manaregen)call DestroyLightning(l)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset target=nullset l=nullcall RemoveLocation(locc)set locc=nullcall RemoveLocation(loct)set loct=nullendfunctionfunction Trig_Spiritual_Communication_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local unit dammi
local location locc=GetUnitLoc(caster)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local location loct=GetUnitLoc(target)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local lightning l=AddLightningEx("SPLK",true,xc,yc,50.+GetLocationZ(locc),xt,yt,50.+GetLocationZ(loct))local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A04P')
local timer t=CreateTimer()local integer h=GetHandleId(t)local real time=10.+(.05*GetHeroInt(caster,true))local integer liferegen=$A+($A*lvl)local integer manaregen=(5*lvl)call SetUnitLifeAndManaRegeneration(caster,"life",liferegen)
call SetUnitLifeAndManaRegeneration(target,"life",liferegen)
call SetUnitLifeAndManaRegeneration(caster,"mana",manaregen)
call SetUnitLifeAndManaRegeneration(target,"mana",manaregen)
set dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A0ER')call SetUnitAbilityLevel(dammi,'A0ER',lvl)call IssueTargetOrderById(dammi,$D0085,caster)set dammi=nullif GetOwningPlayer(target)!=Player($D)thenset dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A0ER')call SetUnitAbilityLevel(dammi,'A0ER',lvl)call IssueTargetOrderById(dammi,$D0085,target)set dammi=nullendifset dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A032')call SetUnitAbilityLevel(dammi,'A032',lvl)call IssueTargetOrderById(dammi,$D0062,caster)set dammi=nullset dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A032')call SetUnitAbilityLevel(dammi,'A032',lvl)call IssueTargetOrderById(dammi,$D0062,target)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveLightningHandle(udg_hash,h,3,l)
call SaveReal(udg_hash,h,4,time)
call SaveInteger(udg_hash,h,5,liferegen)
call SaveInteger(udg_hash,h,6,manaregen)
call TimerStart(t,.04,true,function Trig_Spiritual_Communication_Ligtning_Move_Actions)set caster=nullset target=nullset dammi=nullcall RemoveLocation(locc)set locc=nullcall RemoveLocation(loct)set loct=nullset l=nullset p=nullset t=nullendfunctionfunction Trig_Spiritual_Communication_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A04P' and IsUnitType(GetSpellAbilityUnit(),UNIT_TYPE_HERO))!=nullendfunctionfunction InitTrig_Spiritual_Communication takes nothing returns nothinglocal integer index=0set gg_trg_Spiritual_Communication=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Spiritual_Communication,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Spiritual_Communication,Condition(function Trig_Spiritual_Communication_Conditions))
call TriggerAddAction(gg_trg_Spiritual_Communication,function Trig_Spiritual_Communication_Actions)endfunctionfunction Trig_Curing_Light_Heal_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local integer wait=LoadInteger(udg_hash,h,1)
local group gheal=LoadGroupHandle(udg_hash,h,2)local unit sphere=LoadUnitHandle(udg_hash,h,3)local integer heal=LoadInteger(udg_hash,h,4)
local integer lvl=LoadInteger(udg_hash,h,5)local effect ef=LoadEffectHandle(udg_hash,h,6)local player p=GetOwningPlayer(sphere)local real x=GetUnitX(sphere)local real y=GetUnitY(sphere)local group maingroup=CreateGroup()local group g=CreateGroup()local group gcurrent=CreateGroup()local group copygheal=CreateGroup()local unit Pickedlocal unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,1,wait)call GroupEnumUnitsInRange(g,x,y,300.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitAlly(Picked,p)or GetOwningPlayer(Picked)==Player($D))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gcurrent,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupAddGroup(gheal,maingroup)call GroupAddGroup(gcurrent,maingroup)loop
set Picked=FirstOfGroup(maingroup)exitwhen Picked==nullif IsUnitInGroup(Picked,gheal) and IsUnitInGroup(Picked,gcurrent)==false thencall GroupRemoveUnit(gheal,Picked)call SetUnitLifeAndManaRegeneration(Picked,"life",-1*heal)endifif IsUnitInGroup(Picked,gheal)==false and IsUnitInGroup(Picked,gcurrent) thencall GroupAddUnit(gheal,Picked)call SetUnitLifeAndManaRegeneration(Picked,"life",heal)endifcall GroupRemoveUnit(maingroup,Picked)endloopset Picked=nullcall SaveGroupHandle(udg_hash,h,2,gheal)
call GroupAddGroup(gheal,copygheal)call RandomUnitFromGroup(1,copygheal)set Picked=FirstOfGroup(udg_GroupRandomUnitFromGroup)call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+(lvl*.01)*GetUnitState(Picked,UNIT_STATE_MAX_LIFE))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl",Picked,"origin"))
else
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call DestroyEffect(ef)set dammi=CreateUnit(Player($C),'h00U',x,y,GetRandomReal(.0,360.))call SetUnitScale(dammi,3.1,3.1,3.1)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl",dammi,"chest"))call RemoveUnit(sphere)loop
set Picked=FirstOfGroup(gheal)exitwhen Picked==nullcall SetUnitLifeAndManaRegeneration(Picked,"life",-1*heal)call GroupRemoveUnit(gheal,Picked)endloopendifset t=nullset ef=nullset sphere=nullset p=nullset gheal=nullcall GroupClear(maingroup)call DestroyGroup(maingroup)
set maingroup=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(gcurrent)call DestroyGroup(gcurrent)set gcurrent=nullcall GroupClear(copygheal)call DestroyGroup(copygheal)
set copygheal=nullset dammi=nullset Picked=nullendfunctionfunction Trig_Curing_Light_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0AC')
local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local unit sphere=CreateUnit(p,'h01O',x,y,GetRandomReal(.0,360.))local group g=CreateGroup()local group gheal=CreateGroup()local unit Pickedlocal integer constheal=8+(8*lvl)+R2I((((.06*lvl)+.06)*GetHeroInt(caster,true)))
local integer wait=$Clocal effect ef=AddSpecialEffectTarget("war3mapImported\\Curing_Light_Effect.mdx",sphere,"origin")local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi=CreateUnit(p,'h00U',x,y,GetRandomReal(.0,360.))
call SetUnitScale(dammi,3.1,3.1,3.1)
call UnitAddAbility(sphere,'A0A8')call SetUnitAbilityLevel(sphere,'A0A8',lvl)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl",dammi,"chest"))call GroupEnumUnitsInRange(g,x,y,300.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitAlly(Picked,p)or GetOwningPlayer(Picked)==Player($D))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gheal,Picked)call SetUnitLifeAndManaRegeneration(Picked,"life",constheal)
endifcall GroupRemoveUnit(g,Picked)endloopcall SaveInteger(udg_hash,h,1,wait)call SaveGroupHandle(udg_hash,h,2,gheal)
call SaveUnitHandle(udg_hash,h,3,sphere)
call SaveInteger(udg_hash,h,4,constheal)
call SaveInteger(udg_hash,h,5,lvl)call SaveEffectHandle(udg_hash,h,6,ef)call TimerStart(t,1.,true,function Trig_Curing_Light_Heal_Actions)set caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
set sphere=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gheal=nullset Picked=nullset ef=nullset t=nullset dammi=nullendfunctionfunction Trig_Curing_Light_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0AC'endfunctionfunction InitTrig_Curing_Light takes nothing returns nothing
local integer index=0set gg_trg_Curing_Light=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Curing_Light,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Curing_Light,Condition(function Trig_Curing_Light_Conditions))call TriggerAddAction(gg_trg_Curing_Light,function Trig_Curing_Light_Actions)endfunctionfunction Trig_Guardian_Angel_10sec_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local group gheal=LoadGroupHandle(udg_hash,h,1)local integer adddamage=LoadInteger(udg_hash,h,2)local integer addarmor=LoadInteger(udg_hash,h,3)
local effect ef=LoadEffectHandle(udg_hash,h,4)local integer liferegen=LoadInteger(udg_hash,h,5)local unit Pickedcall DestroyEffect(ef)set ef=nullloop
set Picked=FirstOfGroup(gheal)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),66)
if ef!=null then
call DestroyEffect(ef)set ef=nullendifcall SetAttackAbilityLevel(Picked,-adddamage)call SetArmorAbilityLevel(Picked,-addarmor)call SetUnitLifeAndManaRegeneration(Picked,"life",-liferegen)call UnitRemoveAbility(Picked,'A0AD')call GroupRemoveUnit(gheal,Picked)call SaveEffectHandle(udg_hash,GetHandleId(Picked),66,null)call SaveReal(udg_hash,GetHandleId(Picked),65,.0)endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullcall GroupClear(gheal)call DestroyGroup(gheal)
set gheal=nullset ef=nullset Picked=nullendfunctionfunction Trig_Guardian_Angel_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0AE')
local integer lvlup=GetUnitAbilityLevel(caster,'A0Q3')local real x=GetUnitX(caster)local real y=GetUnitY(caster)local group g=CreateGroup()local group gheal=CreateGroup()local unit Pickedlocal integer adddamagelocal integer addarmorlocal real shieldlocal integer liferegenlocal effect eflocal timer t=CreateTimer()local integer h=GetHandleId(t)local real aoeif lvl>0 thenset adddamage=40*lvl+$Aset addarmor=7*lvl+3
set shield=300.*lvl+100.
set liferegen=lvl*$C+4set aoe=750.
endifif lvlup>0 thenset adddamage=40*lvlup+$Aset addarmor=7*lvlup+3set shield=450.*lvlup+150.set liferegen=lvlup*$C+4
set aoe=999999.endifset ef=AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdl",caster,"origin")call SaveEffectHandle(udg_hash,h,4,ef)call GroupEnumUnitsInRange(g,x,y,aoe,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitAlly(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset ef=AddSpecialEffectTarget("war3mapImported\\Retribution.mdx",Picked,"origin")call SaveEffectHandle(udg_hash,GetHandleId(Picked),66,ef)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl",Picked,"origin"))call GroupAddUnit(gheal,Picked)call UnitAddAbility(Picked,'A0AD')call SetAttackAbilityLevel(Picked,adddamage)
call SetArmorAbilityLevel(Picked,addarmor)call SetUnitLifeAndManaRegeneration(Picked,"life",liferegen)
call SaveReal(udg_hash,GetHandleId(Picked),65,shield)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,1,gheal)
call SaveInteger(udg_hash,h,2,adddamage)
call SaveInteger(udg_hash,h,3,addarmor)call SaveInteger(udg_hash,h,5,liferegen)
call TimerStart(t,12.,false,function Trig_Guardian_Angel_10sec_Actions)set caster=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gheal=nullset Picked=nullset ef=nullset t=nullendfunctionfunction Trig_Guardian_Angel_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0AE' or GetSpellAbilityId()=='A0Q3')endfunctionfunction InitTrig_Guardian_Angel takes nothing returns nothinglocal integer index=0set gg_trg_Guardian_Angel=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Guardian_Angel,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Guardian_Angel,Condition(function Trig_Guardian_Angel_Conditions))call TriggerAddAction(gg_trg_Guardian_Angel,function Trig_Guardian_Angel_Actions)endfunctionfunction Trig_Paladin_Load_Actions takes nothing returns nothing
call AbilityPreload('A0M6',6)call AbilityPreload('A0M7',6)call AbilityPreload('A0M8',6)call AbilityPreload('A0MA',3)call AbilityPreload('A0M9',6)call AbilityPreload('B04G',1)call AbilityPreload('B04H',1)call EffectPreload("Effects\\Consecrate.mdx")call EffectPreload("Effects\\Holy Nova.mdx")
call EffectPreload("Effects\\HolyArmor.MDX")
call EffectPreload("Effects\\HolyAurora.MDX")call EffectPreload("Effects\\HolyAwakening.mdx")
call EffectPreload("Effects\\HolyPhoenixMissle.mdx")
call EffectPreload("Effects\\DivineRage.mdx")call EffectPreload("Effects\\HolySpiral.MDX")call EffectPreload("Effects\\LifeHigh.mdx")call EffectPreload("Effects\\LightNova.mdx")
call EffectPreload("Effects\\MegaHeal.mdx")call EffectPreload("Effects\\OrbLightX.mdx")
call EffectPreload("Effects\\RunicShield.mdx")call EnableTrigger(gg_trg_Spiral_of_Light)call EnableTrigger(gg_trg_Keeper_Seal)call EnableTrigger(gg_trg_Light_Hammer)call EnableTrigger(gg_trg_God_Hand)endfunctionfunction InitTrig_Paladin_Load takes nothing returns nothing
set gg_trg_Paladin_Load=CreateTrigger()call TriggerAddAction(gg_trg_Paladin_Load,function Trig_Paladin_Load_Actions)endfunctionfunction Trig_Spiral_of_Light_Remove_Bonus_Armor_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local integer armor=LoadInteger(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)call SetArmorAbilityLevel(target,-armor)
call DestroyEffect(ef)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset target=nullset ef=nullendfunctionfunction Trig_Spiral_of_Light_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit targetlocal unit dammi
local integer stage=LoadInteger(udg_hash,h,5)local effect eflocal player plocal group gdammilocal group gdammi2local group glocal unit Pickedlocal unit dammi2local real x
local real y
local real xtlocal real ytlocal real angle
local real angle2local real distlocal real damagelocal real heallocal boolean destroy1=false
local boolean destroy2=false
local boolean remove
local integer armorlocal timer tarmorlocal integer harmor
local real timeif stage==0 then
set target=LoadUnitHandle(udg_hash,h,2)set dammi=LoadUnitHandle(udg_hash,h,3)set x=GetUnitX(dammi)set y=GetUnitY(dammi)set xt=GetUnitX(target)set yt=GetUnitY(target)set angle=bj_RADTODEG*Atan2(yt-y,xt-x)if GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset x=x+22.*Cos(angle*bj_DEGTORAD)set y=y+22.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(dammi,x,y)set dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))
if dist<23. then
set destroy1=truecall SetUnitPosition(dammi,xt,yt)call DestroyEffect(AddSpecialEffect("Effects\\Holy Nova.mdl",xt,yt))
endifelse
set destroy1=trueendifendifif destroy1 then
call KillUnit(dammi)
set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullset stage=1call SaveInteger(udg_hash,h,5,stage)
set heal=LoadReal(udg_hash,h,6)call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+heal)call DestroyEffect(AddSpecialEffectTarget("Effects\\MegaHeal.mdx",target,"origin"))call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",target,"origin"),2.)set armor=R2I(GetUnitState(target,UNIT_STATE_MAX_LIFE)*.02)set tarmor=CreateTimer()
set harmor=GetHandleId(tarmor)call SetArmorAbilityLevel(target,armor)set time=LoadReal(udg_hash,h,$A)
set ef=AddSpecialEffectTarget("Effects\\RunicShield.mdx",target,"chest")
call SaveUnitHandle(udg_hash,harmor,1,target)call SaveInteger(udg_hash,harmor,2,armor)call SaveEffectHandle(udg_hash,harmor,3,ef)call TimerStart(tarmor,time,false,function Trig_Spiral_of_Light_Remove_Bonus_Armor_Actions)set ef=nullset tarmor=nullset p=GetOwningPlayer(caster)set g=CreateGroup()set gdammi=CreateGroup()
call GroupEnumUnitsInRange(g,xt,yt,400.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenif IsUnitEnemy(Picked,p) thenset angle2=bj_RADTODEG*Atan2(GetUnitY(Picked)-yt,GetUnitX(Picked)-xt)set dammi2=CreateUnit(p,'h00U',xt,yt,angle2)
call UnitAddAbility(dammi2,'Amrf')call UnitRemoveAbility(dammi2,'Amrf')call SetUnitFlyHeight(dammi2,50.,.0)
set ef=AddSpecialEffectTarget("Effects\\HolyPhoenixMissle.mdx",dammi2,"chest")call GroupAddUnit(gdammi,dammi2)
call SaveUnitHandle(udg_hash,GetHandleId(dammi2),1,Picked)call SaveStr(udg_hash,GetHandleId(dammi2),2,"damage")call SaveEffectHandle(udg_hash,GetHandleId(dammi2),3,ef)
set ef=nullset dammi2=nullendifif IsUnitAlly(Picked,p) and Picked!=target thenset angle2=bj_RADTODEG*Atan2(GetUnitY(Picked)-yt,GetUnitX(Picked)-xt)set dammi2=CreateUnit(p,'h00U',xt,yt,angle2)
call UnitAddAbility(dammi2,'Amrf')call UnitRemoveAbility(dammi2,'Amrf')call SetUnitFlyHeight(dammi2,50.,.0)
set ef=AddSpecialEffectTarget("Effects\\HolyPhoenixMissle.mdx",dammi2,"chest")call GroupAddUnit(gdammi,dammi2)
call SaveUnitHandle(udg_hash,GetHandleId(dammi2),1,Picked)call SaveStr(udg_hash,GetHandleId(dammi2),2,"heal")call SaveEffectHandle(udg_hash,GetHandleId(dammi2),3,ef)
set ef=nullset dammi2=nullendifendifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,9,gdammi)call GroupClear(g)call DestroyGroup(g)
set g=nullset gdammi=nullset p=nullendifif stage==1 then
set p=GetOwningPlayer(caster)set gdammi=LoadGroupHandle(udg_hash,h,9)
set gdammi2=CreateGroup()call GroupAddGroup(gdammi,gdammi2)loop
set dammi2=FirstOfGroup(gdammi2)
exitwhen dammi2==nullset remove=false
set target=LoadUnitHandle(udg_hash,GetHandleId(dammi2),1)set x=GetUnitX(dammi2)set y=GetUnitY(dammi2)set xt=GetUnitX(target)set yt=GetUnitY(target)set angle=bj_RADTODEG*Atan2(yt-y,xt-x)set x=x+22.*Cos(angle*bj_DEGTORAD)set y=y+22.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(dammi2,x,y)
set dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))
if dist<23. or GetUnitState(target,UNIT_STATE_LIFE)<.405 thencall SetUnitScale(dammi2,.6,.6,.6)set ef=LoadEffectHandle(udg_hash,GetHandleId(dammi2),3)call DestroyEffect(ef)set ef=nullif GetUnitState(target,UNIT_STATE_LIFE)>.405 thenif LoadStr(udg_hash,GetHandleId(dammi2),2)=="damage" thenset damage=LoadReal(udg_hash,h,8)set remove=truecall DestroyEffect(AddSpecialEffectTarget("Effects\\HolyPhoenixMissle.mdx",target,"origin"))
call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)else
set heal=LoadReal(udg_hash,h,7)call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+heal)call DestroyEffect(AddSpecialEffectTarget("Effects\\MegaHeal.mdx",target,"origin"))call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",target,"origin"),2.)set remove=trueendifelse
set remove=truecall DestroyEffect(AddSpecialEffect("Effects\\HolyPhoenixMissle.mdx",x,y))endifcall GroupRemoveUnit(gdammi,dammi2)call FlushChildHashtable(udg_hash,GetHandleId(dammi2))if remove thencall RemoveUnit(dammi2)endifendifcall GroupRemoveUnit(gdammi2,dammi2)
set target=nullendloopset dammi2=nullcall SaveGroupHandle(udg_hash,h,9,gdammi)if CountUnitsInGroup(gdammi)==0 then
set stage=2call SaveInteger(udg_hash,h,5,stage)
endifset p=nullset gdammi=nullcall GroupClear(gdammi2)
call DestroyGroup(gdammi2)set gdammi2=null
endifif stage==2 then
set gdammi=LoadGroupHandle(udg_hash,h,9)
call GroupClear(gdammi)call DestroyGroup(gdammi)set gdammi=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullendfunctionfunction Trig_Spiral_of_Light_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2(yt-y,xt-x)local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi
local effect eflocal real dist=SquareRoot((xt-x)*(xt-x)+(yt-y)*(yt-y))local integer lvl=GetUnitAbilityLevel(caster,'A0M6')
local real healmain=50+(70*lvl)+((GetHeroStr(caster,true)+GetHeroInt(caster,true))/ 2)local real heal=30+(50*lvl)local real damage=$A+(30*lvl)local real time=2.+(1.*lvl)local integer stage=0local integer hcaster=GetHandleId(caster)local effect hammerefset dammi=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,angle)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
call SetUnitScale(dammi,1.25,1.25,1.25)set ef=AddSpecialEffectTarget("Effects\\HolySpiral.mdl",dammi,"chest")if GetRandomInt(1,'d')<=(6+(GetUnitAbilityLevel(caster,'A0M8')*4))and GetUnitAbilityLevel(caster,'A0M8')>0 and LoadBoolean(udg_hash,hcaster,'q')==false then
call SaveReal(udg_hash,hcaster,'p',.0)call SaveBoolean(udg_hash,hcaster,'q',true)set hammeref=AddSpecialEffectTarget("Abilities\\Spells\\Human\\slow\\slowtarget.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,hcaster,'r',hammeref)
set hammeref=nullset hammeref=AddSpecialEffectTarget("Effects\\LifeHigh.mdx",caster,"weapon")
call SaveEffectHandle(udg_hash,hcaster,'s',hammeref)
set hammeref=nullendifcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveUnitHandle(udg_hash,h,3,dammi)call SaveEffectHandle(udg_hash,h,4,ef)call SaveInteger(udg_hash,h,5,stage)
call SaveReal(udg_hash,h,6,healmain)
call SaveReal(udg_hash,h,7,heal)
call SaveReal(udg_hash,h,8,damage)call SaveReal(udg_hash,h,$A,time)call TimerStart(t,.03,true,function Trig_Spiral_of_Light_Periodic_Actions)set caster=nullset target=nullset t=nullset dammi=nullset ef=nullendfunctionfunction Trig_Spiral_of_Light_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0M6'endfunctionfunction InitTrig_Spiral_of_Light takes nothing returns nothinglocal integer index=0set gg_trg_Spiral_of_Light=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Spiral_of_Light,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Spiral_of_Light,Condition(function Trig_Spiral_of_Light_Conditions))
call TriggerAddAction(gg_trg_Spiral_of_Light,function Trig_Spiral_of_Light_Actions)endfunctionfunction Trig_Keeper_Seal_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local unit dammi=LoadUnitHandle(udg_hash,h,3)local effect eflocal integer wait=LoadInteger(udg_hash,h,7)
local real angle=LoadReal(udg_hash,h,8)local integer bonushplocal integer bonusregen
local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real xt=x+125.*Cos(angle*bj_DEGTORAD)local real yt=y+125.*Sin(angle*bj_DEGTORAD)if wait>0 and GetUnitState(target,UNIT_STATE_LIFE)>.405 and GetUnitState(caster,UNIT_STATE_LIFE)>.405 thenset wait=wait-1call SaveInteger(udg_hash,h,7,wait)set angle=angle+5.call SaveReal(udg_hash,h,8,angle)call SetUnitPosition(dammi,xt,yt)else
set bonushp=LoadInteger(udg_hash,h,5)set bonusregen=LoadInteger(udg_hash,h,6)
call SetUnitMaxState(caster,UNIT_STATE_MAX_LIFE,-bonushp)call SetUnitLifeAndManaRegeneration(caster,"life",-bonusregen)call SaveReal(udg_hash,GetHandleId(target),'n',.0)call SaveUnitHandle(udg_hash,GetHandleId(target),'o',null)set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,$B)call DestroyEffect(ef)set ef=nullcall KillUnit(dammi)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset target=nullset dammi=nullendfunctionfunction Trig_Keeper_Seal_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local real x
local real y
local timer tlocal integer hlocal player p=GetOwningPlayer(caster)local unit dammi
local effect eflocal integer lvl=GetUnitAbilityLevel(caster,'A0M7')
local integer bonushplocal integer bonusregen
local real resistlocal integer waitlocal real angle
local integer hcaster=GetHandleId(caster)local effect hammerefif LoadReal(udg_hash,GetHandleId(target),'n')>.0 thencall UnitRemoveAbility(caster,'A0M7')call UnitAddAbility(caster,'A0M7')call SetUnitAbilityLevel(caster,'A0M7',lvl)call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)+120.+(5.*lvl))
call SimError(p,"На этого воина уже наложена печать хранителя.")else
set t=CreateTimer()set h=GetHandleId(t)
set x=GetUnitX(caster)set y=GetUnitY(caster)set bonushp='d'+(50*lvl)
set resist=(.1*lvl)+.3set wait=500
set angle=270.call SetUnitMaxState(caster,UNIT_STATE_MAX_LIFE,bonushp)
set bonusregen=R2I(GetUnitState(caster,UNIT_STATE_MAX_LIFE)*(.005+(.005*lvl)))call SetUnitLifeAndManaRegeneration(caster,"life",bonusregen)call SaveReal(udg_hash,GetHandleId(target),'n',resist)call SaveUnitHandle(udg_hash,GetHandleId(target),'o',caster)
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitAddAbility(dammi,'Amrf')call UnitRemoveAbility(dammi,'Amrf')
set ef=AddSpecialEffectTarget("Effects\\OrbLightX.mdx",dammi,"chest")call SaveEffectHandle(udg_hash,h,4,ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\HolyArmor.MDX",target,"chest")call SaveEffectHandle(udg_hash,h,$B,ef)set ef=nullif GetRandomInt(1,'d')<=(6+(GetUnitAbilityLevel(caster,'A0M8')*4))and GetUnitAbilityLevel(caster,'A0M8')>0 and LoadBoolean(udg_hash,hcaster,'q')==false then
call SaveReal(udg_hash,hcaster,'p',.0)call SaveBoolean(udg_hash,hcaster,'q',true)set hammeref=AddSpecialEffectTarget("Abilities\\Spells\\Human\\slow\\slowtarget.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,hcaster,'r',hammeref)
set hammeref=nullset hammeref=AddSpecialEffectTarget("Effects\\LifeHigh.mdx",caster,"weapon")
call SaveEffectHandle(udg_hash,hcaster,'s',hammeref)
set hammeref=nullendifcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveUnitHandle(udg_hash,h,3,dammi)call SaveInteger(udg_hash,h,5,bonushp)call SaveInteger(udg_hash,h,6,bonusregen)call SaveInteger(udg_hash,h,7,wait)call SaveReal(udg_hash,h,8,angle)call TimerStart(t,.03,true,function Trig_Keeper_Seal_Periodic_Actions)endifset caster=nullset target=nullset t=nullset dammi=nullset p=nullendfunctionfunction Trig_Keeper_Seal_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0M7'endfunctionfunction InitTrig_Keeper_Seal takes nothing returns nothinglocal integer index=0set gg_trg_Keeper_Seal=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Keeper_Seal,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Keeper_Seal,Condition(function Trig_Keeper_Seal_Conditions))
call TriggerAddAction(gg_trg_Keeper_Seal,function Trig_Keeper_Seal_Actions)endfunctionfunction Trig_Light_Hammer_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local integer damage=LoadInteger(udg_hash,h,2)local boolean first=LoadBoolean(udg_hash,h,3)local integer lvl=GetUnitAbilityLevel(hero,'A0M8')local integer newdamage=R2I(GetUnitState(hero,UNIT_STATE_MAX_LIFE)*.01*lvl)if first thenset first=falsecall SaveBoolean(udg_hash,h,3,first)
call TimerStart(t,1.,true,function Trig_Light_Hammer_Periodic_Actions)endifif damage!=newdamage thencall SetAttackAbilityLevel(hero,-damage)
call SetAttackAbilityLevel(hero,newdamage)call SaveInteger(udg_hash,h,2,newdamage)
endifset hero=nullset t=nullendfunctionfunction Trig_Light_Hammer_Actions takes nothing returns nothing
local unit hero=GetLearningUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local integer damage=0local boolean first=true
call SaveUnitHandle(udg_hash,h,1,hero)call SaveInteger(udg_hash,h,2,damage)call SaveBoolean(udg_hash,h,3,first)
call TimerStart(t,.0,false,function Trig_Light_Hammer_Periodic_Actions)call AddProgressBar(hero,235.+(3.),(.9+.05),1.,true,false,'v',$F8,$9A,0)
set hero=nullset t=nullendfunctionfunction Trig_Light_Hammer_Conditions takes nothing returns booleanreturn GetLearnedSkill()=='A0M8' and GetUnitAbilityLevel(GetLearningUnit(),'A0M8')==1 and GetUnitTypeId(GetLearningUnit())!='h00U'endfunctionfunction InitTrig_Light_Hammer takes nothing returns nothing
local integer index=0set gg_trg_Light_Hammer=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Light_Hammer,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Light_Hammer,Condition(function Trig_Light_Hammer_Conditions))call TriggerAddAction(gg_trg_Light_Hammer,function Trig_Light_Hammer_Actions)endfunctionfunction Trig_God_Hand_Remove_Bonus_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local integer regen=LoadInteger(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)local integer stage=LoadInteger(udg_hash,h,4)if stage==0 then
call SaveReal(udg_hash,GetHandleId(target),'t',.0)call SetUnitLifeAndManaRegeneration(target,"life",-regen)call DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdl",target,"origin"))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
else
call DestroyEffect(ef)set ef=nullcall SaveInteger(udg_hash,h,4,0)
call TimerStart(t,4.5,false,function Trig_God_Hand_Remove_Bonus_Actions)
endifset t=nullset target=nullset ef=nullendfunctionfunction Trig_God_Hand_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local real heallocal real manalocal integer wait=LoadInteger(udg_hash,h,5)
local integer delay=LoadInteger(udg_hash,h,6)local real hpc=GetUnitState(caster,UNIT_STATE_LIFE)local real hpt=GetUnitState(target,UNIT_STATE_LIFE)local boolean alifelocal integer regenlocal integer order=GetUnitCurrentOrder(caster)local integer orderIdlocal timer tbonuslocal integer hbonus
local effect efset orderId=$D0079if(orderId!=0)thenelse
set orderId=UnitId("blizzard")if(orderId!=0)thenendifendifif hpc>.405 and hpt>.405 thenset alife=trueelse
set alife=falseendifif order==orderId and wait>0 and alife thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)else
if wait==0 and delay==$A and alife thencall DestroyEffect(AddSpecialEffectTarget("Effects\\HolyAwakening.mdl",target,"origin"))
endifif wait<=0 and delay>0 and alife thenset delay=delay-1call SaveInteger(udg_hash,h,6,delay)
endifif wait==0 and delay==0 and(hpt>.405)thenset heal=LoadReal(udg_hash,h,3)set mana=LoadReal(udg_hash,h,4)set regen=LoadInteger(udg_hash,h,7)call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+heal)call SetUnitState(target,UNIT_STATE_MANA,GetUnitState(target,UNIT_STATE_MANA)+mana)call DestroyEffect(AddSpecialEffectTarget("Effects\\MegaHeal.mdx",target,"origin"))call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",target,"origin"),2.)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",target,"origin"))
call SetUnitLifeAndManaRegeneration(target,"life",regen)
set tbonus=CreateTimer()
set hbonus=GetHandleId(tbonus)set ef=AddSpecialEffectTarget("Effects\\HolyAurora.mdl",target,"origin")
call SaveUnitHandle(udg_hash,hbonus,1,target)call SaveInteger(udg_hash,hbonus,2,regen)call SaveEffectHandle(udg_hash,hbonus,3,ef)call SaveInteger(udg_hash,hbonus,4,1)set ef=nullcall TimerStart(tbonus,2.5,false,function Trig_God_Hand_Remove_Bonus_Actions)set tbonus=nullendifif(order!=orderId and wait>0)or(wait<=0 and delay<=0)thencall RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifendifset t=nullset caster=nullset target=nullendfunctionfunction Trig_God_Hand_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local integer lvl=GetUnitAbilityLevel(caster,'A0MA')
local real heal=(GetUnitState(target,UNIT_STATE_MAX_LIFE)*(.1+(.1*lvl)))+(100.+(125.*lvl))local real mana=(GetUnitState(target,UNIT_STATE_MAX_MANA)*(.1+(.1*lvl)))+(50.+(75.*lvl))
local integer regenlocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer wait=70-(lvl*$A)local integer delay=$Alocal real fastresp=.05+(.15*lvl)local integer hcaster=GetHandleId(caster)local effect hammerefif IsUnitType(target,UNIT_TYPE_HERO) thenset regen=R2I((GetHeroStr(caster,true)+GetHeroStr(target,true))*(.1+(.1*lvl)))else
set regen=R2I(GetHeroStr(caster,true)*(.1+(.1*lvl)))
endifif GetRandomInt(1,'d')<=(6+(GetUnitAbilityLevel(caster,'A0M8')*4))and GetUnitAbilityLevel(caster,'A0M8')>0 and LoadBoolean(udg_hash,hcaster,'q')==false then
call SaveReal(udg_hash,hcaster,'p',.0)call SaveBoolean(udg_hash,hcaster,'q',true)set hammeref=AddSpecialEffectTarget("Abilities\\Spells\\Human\\slow\\slowtarget.mdl",caster,"weapon")call SaveEffectHandle(udg_hash,hcaster,'r',hammeref)
set hammeref=nullset hammeref=AddSpecialEffectTarget("Effects\\LifeHigh.mdx",caster,"weapon")
call SaveEffectHandle(udg_hash,hcaster,'s',hammeref)
set hammeref=nullendifcall SaveReal(udg_hash,GetHandleId(target),'t',fastresp)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveReal(udg_hash,h,3,heal)
call SaveReal(udg_hash,h,4,mana)
call SaveInteger(udg_hash,h,5,wait)call SaveInteger(udg_hash,h,6,delay)
call SaveInteger(udg_hash,h,7,regen)
call DestroyEffect(AddSpecialEffectTarget("Effects\\Consecrate.mdl",caster,"origin"))call DestroyEffect(AddSpecialEffectTarget("Effects\\Consecrate.mdl",target,"origin"))call TimerStart(t,.05,true,function Trig_God_Hand_periodic_Actions)call AddProgressBar(caster,185.+(3.*lvl),(.9+.1*lvl),(wait*.05),false,true,'u',$F8,$9A,0)set caster=nullset target=nullset t=nullendfunctionfunction Trig_God_Hand_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0MA'endfunctionfunction InitTrig_God_Hand takes nothing returns nothing
local integer index=0set gg_trg_God_Hand=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_God_Hand,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_God_Hand,Condition(function Trig_God_Hand_Conditions))call TriggerAddAction(gg_trg_God_Hand,function Trig_God_Hand_Actions)endfunctionfunction Trig_Stone_Guard_Load_Actions takes nothing returns nothing
call AbilityPreload('A0MI',6)call AbilityPreload('A0ML',6)call AbilityPreload('A0MK',6)call AbilityPreload('A0MM',3)call AbilityPreload('A0MJ',6)call AbilityPreload('B04I',1)call AbilityPreload('B04J',1)call EffectPreload("Effects\\Stone Shield.mdx")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodMortarTeam.mdl")call EffectPreload("Effects\\RockV4.mdl")call EffectPreload("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl")call EffectPreload("Effects\\StoneSmall.mdl")call EffectPreload("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl")
call EffectPreload("Effects\\Stonespear.mdl")call EffectPreload("Abilities\\Spells\\Other\\Volcano\\VolcanoDeath.mdl")call EffectPreload("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl")call EffectPreload("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl")call EnableTrigger(gg_trg_Boulder_Throw)
call EnableTrigger(gg_trg_Earth_Shiver)call EnableTrigger(gg_trg_Learn_Stone_Armor)
call EnableTrigger(gg_trg_Rock_Strike)endfunctionfunction InitTrig_Stone_Guard_Load takes nothing returns nothing
set gg_trg_Stone_Guard_Load=CreateTrigger()call TriggerAddAction(gg_trg_Stone_Guard_Load,function Trig_Stone_Guard_Load_Actions)endfunctionfunction Trig_Boulder_Throw_Move_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Boulder_Throw_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damagelocal real damage2local integer wait=LoadInteger(udg_hash,h,4)
local real angle
local unit stone
local effect eflocal integer anim=LoadInteger(udg_hash,h,8)
local integer wait2=LoadInteger(udg_hash,h,9)local real xtlocal real ytlocal integer lvllocal real banglelocal real speed
local player plocal group glocal unit Pickedlocal unit dammi
local unit array boulder
local integer ilocal real distlocal unit dammieflocal rect r
if wait>0 and(wait2==33)then
set stone=LoadUnitHandle(udg_hash,h,6)set wait=wait-1call SaveInteger(udg_hash,h,4,wait)set anim=anim+$A
if anim>=$AA thenset anim=0endifcall SaveInteger(udg_hash,h,8,anim)call SetUnitFacing(stone,GetUnitFacing(stone)+30.)call SetUnitAnimationByIndex(stone,anim)
if wait==0 and wait2==33 thenset damage=LoadReal(udg_hash,h,3)set xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)set p=GetOwningPlayer(caster)set lvl=GetUnitAbilityLevel(caster,'A0MI')set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,250.,null)set dammief=CreateUnit(p,'h00U',xt,yt,.0)call SetUnitFlyHeight(dammief,40.,.0)call SetUnitScale(dammief,2.,2.,2.)call UnitApplyTimedLife(dammief,'BTLF',2.)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",dammief,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl",dammief,"chest"))
set r=Rect(xt-250.,yt-250.,xt+250.,yt+250.)call EnumDestructablesInRect(r,null,function Trig_Boulder_Throw_Move_Dest_Actions)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and Picked!=null and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"chest"))set dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0MJ')call SetUnitAbilityLevel(dammi,'A0MJ',lvl)call IssueTargetOrderById(dammi,$D006B,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullset angle=bj_RADTODEG*Atan2(GetUnitY(Picked)-yt,GetUnitX(Picked)-xt)
set dist=SquareRoot(((GetUnitX(Picked)-xt)*(GetUnitX(Picked)-xt))+((GetUnitY(Picked)-yt)*(GetUnitY(Picked)-yt)))
call MoveUnit(Picked,.4,500.-dist,625.,angle,.0,false)endifcall GroupRemoveUnit(g,Picked)endloopcall RemoveUnit(stone)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RemoveRect(r)set r=nullendifset stone=nullendifif wait2>0 and wait<=0 thenset wait2=wait2-1call SaveInteger(udg_hash,h,9,wait2)
set anim=anim+$A
if anim>=$AA thenset anim=0endifcall SaveInteger(udg_hash,h,8,anim)if wait2==32 thenset xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)set p=GetOwningPlayer(caster)set i=1loop
exitwhen i>=$Bif i>=1 and i<=7 thenset bangle=(360./ 7)*iset speed=225.endifif i>=8 and i<=$A thenset bangle=(360./ 3)*(i-7)set speed=100.endifset boulder[i]=CreateUnit(p,'h00E',xt,yt,bangle)
set ef=AddSpecialEffectTarget("Effects\\StoneSmall.mdl",boulder[i],"chest")call SetUnitScale(boulder[i],1.5,1.5,1.5)call UnitAddAbility(boulder[i],'Amrf')call UnitRemoveAbility(boulder[i],'Amrf')call MoveUnit(boulder[i],1.,speed,.0,bangle,500.,true)call SaveUnitHandle(udg_hash,h,$F+i,boulder[i])call SaveEffectHandle(udg_hash,h,30+i,ef)set ef=nullset boulder[i]=nullset i=i+1endloopendifset i=1loop
exitwhen i>=$Bset boulder[i]=LoadUnitHandle(udg_hash,h,$F+i)call SetUnitFacing(boulder[i],GetUnitFacing(boulder[i])+30.)
set boulder[i]=nullset i=i+1endloopif wait2<=0 then
set i=1loop
exitwhen i>=$Bset boulder[i]=LoadUnitHandle(udg_hash,h,$F+i)set ef=LoadEffectHandle(udg_hash,h,30+i)
call DestroyEffect(ef)call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",GetUnitX(boulder[i]),GetUnitY(boulder[i])))call RemoveUnit(boulder[i])set ef=nullset boulder[i]=nullset i=i+1endloopset damage2=LoadReal(udg_hash,h,$A)set xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)set p=GetOwningPlayer(caster)set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,250.,null)set r=Rect(xt-250.,yt-250.,xt+250.,yt+250.)call EnumDestructablesInRect(r,null,function Trig_Boulder_Throw_Move_Dest_Actions)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"chest"))call UnitDamageTarget(caster,Picked,damage2,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call StunUnitTimed(Picked,.5)endifcall GroupRemoveUnit(g,Picked)endloopset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RemoveRect(r)set r=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifendifset t=nullset caster=nullendfunctionfunction Trig_Boulder_Throw_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local integer lvl=GetUnitAbilityLevel(caster,'A0MI')
local real damage=(35.*lvl)+(GetHeroStr(caster,true)*(.3+.2*lvl))local real damage2=20.*lvllocal real time=dist/ 800.local integer time2=33local real height=dist/ 2local unit stone=CreateUnit(GetOwningPlayer(caster),'h00E',x,y,angle)local effect ef=AddSpecialEffectTarget("Effects\\RockV4.mdl",stone,"chest")local timer t=CreateTimer()local integer h=GetHandleId(t)if dist<50. then
set time=1.set angle=GetUnitFacing(caster)set dist=100.set height=dist/ 2set time=dist/ 800.endifcall SetUnitX(stone,x+50.*Cos((angle-30.)*bj_DEGTORAD))call SetUnitY(stone,y+50.*Sin((angle-30.)*bj_DEGTORAD))call SetUnitScale(stone,1.7,1.7,1.7)
call SetUnitFlyHeight(stone,40.,.0)call MoveUnit(stone,time,800.,.0,angle,height,true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,R2I(time/ .03))call SaveReal(udg_hash,h,5,angle)call SaveUnitHandle(udg_hash,h,6,stone)call SaveEffectHandle(udg_hash,h,7,ef)call SaveInteger(udg_hash,h,8,1)
call SaveInteger(udg_hash,h,9,time2)
call SaveReal(udg_hash,h,$A,damage2)
call SaveReal(udg_hash,h,$B,xt)call SaveReal(udg_hash,h,$C,yt)call TimerStart(t,.03,true,function Trig_Boulder_Throw_Move_Actions)
set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset stone=nullset ef=nullendfunctionfunction Trig_Boulder_Throw_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0MI'endfunctionfunction InitTrig_Boulder_Throw takes nothing returns nothinglocal integer index=0set gg_trg_Boulder_Throw=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Boulder_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Boulder_Throw,Condition(function Trig_Boulder_Throw_Conditions))
call TriggerAddAction(gg_trg_Boulder_Throw,function Trig_Boulder_Throw_Actions)endfunctionfunction Trig_Boulder_Earth_Shiver_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Boulder_Earth_Shiver_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local real xt=LoadReal(udg_hash,h,4)
local real yt=LoadReal(udg_hash,h,5)
local unit dammief=LoadUnitHandle(udg_hash,h,6)local unit Pickedlocal rect r=Rect(xt-325.,yt-325.,xt+325.,yt+325.)call EnumDestructablesInRect(r,null,function Trig_Boulder_Earth_Shiver_Dest_Actions)
loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"chest"))call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(gdamage,Picked)
endloopcall RemoveUnit(dammief)
set dammief=null
call GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call RemoveRect(r)set r=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullset Picked=nullendfunctionfunction Trig_Earth_Shiver_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local integer lvl=GetUnitAbilityLevel(caster,'A0ML')
local real damage=((30.*lvl)+GetUnitState(caster,UNIT_STATE_MAX_LIFE)*(.01+.01*lvl))/ 2local real time=1.local real stuntime=time+.5local real height=350.local timer t=CreateTimer()local integer h=GetHandleId(t)local group g=CreateGroup()local group gdamage=CreateGroup()local unit Pickedlocal rect r=Rect(xt-325.,yt-325.,xt+325.,yt+325.)local unit dammief=CreateUnit(p,'h00U',xt,yt,.0)
call SetUnitScale(dammief,2.,2.,2.)call DestroyEffect(AddSpecialEffectTarget("Effects\\Stonespear.mdl",dammief,"origin"))call EnumDestructablesInRect(r,null,function Trig_Boulder_Earth_Shiver_Dest_Actions)
call GroupEnumUnitsInRange(g,xt,yt,325.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffect("Effects\\Stonespear.mdl",GetUnitX(Picked),GetUnitY(Picked)))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"chest"))call StunUnitTimed(Picked,stuntime)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call MoveUnit(Picked,time,.0,.0,.0,height,false)
call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,xt)call SaveReal(udg_hash,h,5,yt)call SaveUnitHandle(udg_hash,h,6,dammief)call TimerStart(t,time,false,function Trig_Boulder_Earth_Shiver_Actions)
set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullcall RemoveRect(r)set r=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset gdamage=null
set Picked=nullset dammief=null
endfunctionfunction Trig_Earth_Shiver_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0ML'endfunctionfunction InitTrig_Earth_Shiver takes nothing returns nothing
local integer index=0set gg_trg_Earth_Shiver=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Earth_Shiver,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Earth_Shiver,Condition(function Trig_Earth_Shiver_Conditions))call TriggerAddAction(gg_trg_Earth_Shiver,function Trig_Earth_Shiver_Actions)endfunctionfunction Trig_Learn_Stone_Armor_Actions takes nothing returns nothinglocal unit u=GetLearningUnit()if GetUnitAbilityLevel(u,'A0MK')==1 then
call SetArmorAbilityLevel(u,3)else
call SetArmorAbilityLevel(u,2)endifset u=nullendfunctionfunction Trig_Learn_Stone_Armor_Conditions takes nothing returns boolean
return GetLearnedSkill()=='A0MK' and GetUnitTypeId(GetLearningUnit())!='h00U'endfunctionfunction InitTrig_Learn_Stone_Armor takes nothing returns nothinglocal integer index=0set gg_trg_Learn_Stone_Armor=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Stone_Armor,Player(index),EVENT_PLAYER_HERO_SKILL,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Stone_Armor,Condition(function Trig_Learn_Stone_Armor_Conditions))
call TriggerAddAction(gg_trg_Learn_Stone_Armor,function Trig_Learn_Stone_Armor_Actions)endfunctionfunction Trig_Rock_Strike_Move_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Rock_Strike_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local integer wait=LoadInteger(udg_hash,h,3)
local integer wait2=LoadInteger(udg_hash,h,4)local integer anim=LoadInteger(udg_hash,h,6)
local real damagelocal real damage2local real angle
local real angle2local real angle3local unit stone
local effect eflocal real x
local real y
local real xtlocal real ytlocal player plocal group glocal unit Pickedlocal real distlocal unit dammieflocal rect r
local real stuntimeif wait>0 and(wait2==44)and GetUnitState(caster,UNIT_STATE_LIFE)>.405 thenset wait=wait-1call SaveInteger(udg_hash,h,3,wait)if wait==0 and wait2==44 thenset damage=LoadReal(udg_hash,h,9)set xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)set stuntime=LoadReal(udg_hash,h,$F)
set angle=LoadReal(udg_hash,h,5)
set p=GetOwningPlayer(caster)set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,175.,null)call SetUnitTimeScale(caster,1.)
set dammief=CreateUnit(p,'h00U',xt,yt,.0)call SetUnitScale(dammief,1.3,1.3,1.3)call UnitApplyTimedLife(dammief,'BTLF',4.)call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",xt,yt))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",dammief,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl",dammief,"chest"))
call DestroyEffectWithWait(AddSpecialEffect("Abilities\\Spells\\Orc\\EarthQuake\\EarthQuakeTarget.mdl",xt,yt),2.)set dammief=null
set r=Rect(xt-175.,yt-175.,xt+175.,yt+175.)call EnumDestructablesInRect(r,null,function Trig_Rock_Strike_Move_Dest_Actions)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"chest"))call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call StunUnitTimed(Picked,stuntime)set angle2=bj_RADTODEG*Atan2(GetUnitY(Picked)-yt,GetUnitX(Picked)-xt)set dist=SquareRoot(((GetUnitX(Picked)-xt)*(GetUnitX(Picked)-xt))+((GetUnitY(Picked)-yt)*(GetUnitY(Picked)-yt)))
call MoveUnit(Picked,.5,(600.-(dist*1.5))/ 2,100.,angle,.0,true)
endifcall GroupRemoveUnit(g,Picked)endloopset stone=CreateUnit(p,'h00E',xt,yt,angle)set ef=AddSpecialEffectTarget("Effects\\RockV4.mdl",stone,"chest")call SaveUnitHandle(udg_hash,h,$D,stone)
call SaveEffectHandle(udg_hash,h,$E,ef)call SetUnitScale(stone,2.2,2.2,2.2)
call SetUnitFlyHeight(stone,50.,.0)call MoveUnit(stone,1.32,800.,.0,angle,.0,true)set p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RemoveRect(r)set r=nullset stone=nullset ef=nullendifendifif wait2>0 and wait<=0 thenset wait2=wait2-1call SaveInteger(udg_hash,h,4,wait2)
set anim=LoadInteger(udg_hash,h,6)set anim=anim+$F
if anim>=$AA thenset anim=0endifset stone=LoadUnitHandle(udg_hash,h,$D)call SetUnitAnimationByIndex(stone,anim)
call SaveInteger(udg_hash,h,6,anim)set damage2=LoadReal(udg_hash,h,$A)set angle=LoadReal(udg_hash,h,5)
set stuntime=LoadReal(udg_hash,h,$F)
set p=GetOwningPlayer(caster)set g=CreateGroup()set x=GetUnitX(stone)set y=GetUnitY(stone)call GroupEnumUnitsInRange(g,x,y,175.,null)call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",x,y))
set r=Rect(x-175.,y-175.,x+175.,y+175.)call EnumDestructablesInRect(r,null,function Trig_Rock_Strike_Move_Dest_Actions)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",Picked,"chest"))call UnitDamageTarget(caster,Picked,damage2,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call StunUnitTimed(Picked,stuntime)set angle2=bj_RADTODEG*Atan2(GetUnitY(Picked)-y,GetUnitX(Picked)-x)set dist=SquareRoot(((GetUnitX(Picked)-x)*(GetUnitX(Picked)-x))+((GetUnitY(Picked)-y)*(GetUnitY(Picked)-y)))
set angle3=(Atan2(y-GetUnitY(Picked),x-GetUnitX(Picked))*bj_RADTODEG)+360.if(angle3<=(angle+210.)and angle3>=(angle+180.))then
set angle2=angle2+45.endifif(angle3<=(angle+180.)and angle3>=(angle+150.))then
set angle2=angle2-45.endifcall MoveUnit(Picked,.5,(700.-dist),100.,angle2,.0,true)
call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RemoveRect(r)set r=nullset stone=nullcall SaveGroupHandle(udg_hash,h,2,gdamage)if wait2<=0 then
set stone=LoadUnitHandle(udg_hash,h,$D)set ef=LoadEffectHandle(udg_hash,h,$E)call DestroyEffect(ef)call DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\AncientProtectorMissile\\AncientProtectorMissile.mdl",x,y))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Volcano\\VolcanoDeath.mdl",x,y))set ef=nullcall RemoveUnit(stone)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set stone=nullendifset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall RemoveRect(r)set r=nullendifset t=nullset caster=nullset gdamage=null
endfunctionfunction Trig_Rock_Strike_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loclocal real xtlocal real ytlocal unit target=GetSpellTargetUnit()local real angle
local real distlocal integer lvl=GetUnitAbilityLevel(caster,'A0MM')
local real damage=(5.+135.*lvl)local real damage2=(15.+115.*lvl)local real stuntime=.75+(.25*lvl)local integer wait=6
local integer wait2=44local timer t=CreateTimer()local integer h=GetHandleId(t)local group gdamage=CreateGroup()if target!=null then
set xt=GetUnitX(target)set yt=GetUnitY(target)else
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
call RemoveLocation(loc)
set loc=null
endifset angle=bj_RADTODEG*Atan2((yt-y),(xt-x))set xt=x+100.*Cos(angle*bj_DEGTORAD)
set yt=y+100.*Sin(angle*bj_DEGTORAD)
call SetUnitTimeScale(caster,2.)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveInteger(udg_hash,h,3,wait)call SaveInteger(udg_hash,h,4,wait2)
call SaveReal(udg_hash,h,5,angle)call SaveInteger(udg_hash,h,6,0)
call SaveInteger(udg_hash,h,8,1)
call SaveReal(udg_hash,h,9,damage)call SaveReal(udg_hash,h,$A,damage2)
call SaveReal(udg_hash,h,$B,xt)call SaveReal(udg_hash,h,$C,yt)call SaveReal(udg_hash,h,$F,stuntime)call TimerStart(t,.03,true,function Trig_Rock_Strike_Move_Actions)set caster=nullset t=nullset target=nullset gdamage=null
endfunctionfunction Trig_Rock_Strike_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0MM'endfunctionfunction InitTrig_Rock_Strike takes nothing returns nothinglocal integer index=0set gg_trg_Rock_Strike=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Rock_Strike,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Rock_Strike,Condition(function Trig_Rock_Strike_Conditions))
call TriggerAddAction(gg_trg_Rock_Strike,function Trig_Rock_Strike_Actions)endfunctionfunction Trig_Archdruid_Load_Actions takes nothing returns nothingcall AbilityPreload('A0MN',6)call AbilityPreload('A0MP',6)call AbilityPreload('A0MQ',6)call AbilityPreload('A0MS',3)call AbilityPreload('A0MT',3)call AbilityPreload('A0MO',1)call AbilityPreload('A0MR',6)call AbilityPreload('B04M',1)call AbilityPreload('B04K',1)call AbilityPreload('B04L',1)call UnitPreload('e006')
call EffectPreload("Abilities\\Spells\\NightElf\\EntanglingRoots\\EntanglingRootsTarget.mdl")call EffectPreload("Effects\\Earth_Attach.mdx")call EffectPreload("Abilities\\Spells\\Other\\Drain\\DrainTarget.mdl")call EffectPreload("Effects\\Power_Orb.mdl")
call EffectPreload("Effects\\Healing Touch.mdl")
call EffectPreload("Effects\\SoulshotC-gradeTarget.mdl")
call EffectPreload("Effects\\naturebeam.mdl")call EffectPreload("Effects\\AncientExplode.mdx")call EffectPreload("Effects\\NatureBlessing.mdl")call EffectPreload("Effects\\LifeWave.mdl")call EffectPreload("Abilities\\Weapons\\GreenDragonMissile\\GreenDragonMissile.mdl")
call EffectPreload("Effects\\PlasmaMissileGreen.mdl")call EffectPreload("Effects\\GreenHeal.mdl")
call EffectPreload("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdl")call EffectPreload("Effects\\EarthNova.mdl")
call EnableTrigger(gg_trg_Energy_of_Nature)call EnableTrigger(gg_trg_Life_Chain)call EnableTrigger(gg_trg_Ent_Creation)call EnableTrigger(gg_trg_Nature_Wrath)endfunctionfunction InitTrig_Archdruid_Load takes nothing returns nothingset gg_trg_Archdruid_Load=CreateTrigger()call TriggerAddAction(gg_trg_Archdruid_Load,function Trig_Archdruid_Load_Actions)endfunctionfunction Trig_Energy_of_Nature_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damagelocal real heallocal integer wait=LoadInteger(udg_hash,h,4)
local unit orb=LoadUnitHandle(udg_hash,h,6)local effect eflocal real xtlocal real ytlocal player plocal group glocal unit Pickedlocal unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,4,wait)else
set damage=LoadReal(udg_hash,h,2)set heal=LoadReal(udg_hash,h,3)set xt=LoadReal(udg_hash,h,$B)set yt=LoadReal(udg_hash,h,$C)set p=GetOwningPlayer(caster)set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,270.,null)call DestroyEffect(AddSpecialEffect("Effects\\AncientExplode.mdx",xt,yt))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Effects\\SoulshotC-gradeTarget.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\naturebeam.mdl",Picked,"chest"))
set dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0MO')call IssueTargetOrderById(dammi,$D00CB,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifif IsUnitAlly(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' then
call DestroyEffect(AddSpecialEffectTarget("Effects\\Healing Touch.mdl",Picked,"origin"))
call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+heal)endifcall GroupRemoveUnit(g,Picked)endloopcall SetUnitScale(orb,.1,.1,.1)call KillUnit(orb)call ShowUnit(orb,false)
set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullset p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall DestroyTimer(t)
set Picked=nullcall FlushChildHashtable(udg_hash,h)
endifset t=nullset caster=nullset orb=null
endfunctionfunction Trig_Energy_of_Nature_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local integer lvl=GetUnitAbilityLevel(caster,'A0MN')
local real damage=($A+25*lvl)+(GetHeroInt(caster,true)*(.2+.3*lvl))local real heal=(75.+50*lvl)
local real time=dist/ 600.local real height=dist/ 4+75.local unit orb=CreateUnit(GetOwningPlayer(caster),'h00E',x,y,angle)local effect ef=AddSpecialEffectTarget("Effects\\Power_Orb.mdl",orb,"origin")local timer t=CreateTimer()local integer h=GetHandleId(t)if dist<50. then
set dist=50.
set time=.07
set angle=GetUnitFacing(caster)set height=dist/ 4+100.endifcall SetUnitX(orb,x+50.*Cos((angle)*bj_DEGTORAD))call SetUnitY(orb,y+50.*Sin((angle)*bj_DEGTORAD))call SetUnitTimeScale(orb,1.5)call SetUnitFlyHeight(orb,100.,.0)call MoveUnit(orb,time,600.,.0,angle,height,true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveReal(udg_hash,h,3,heal)
call SaveInteger(udg_hash,h,4,R2I(time/ .03))call SaveUnitHandle(udg_hash,h,6,orb)call SaveEffectHandle(udg_hash,h,7,ef)call SaveReal(udg_hash,h,$B,xt)call SaveReal(udg_hash,h,$C,yt)call TimerStart(t,.03,true,function Trig_Energy_of_Nature_Move_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset orb=null
set ef=nullendfunctionfunction Trig_Energy_of_Nature_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0MN'endfunctionfunction InitTrig_Energy_of_Nature takes nothing returns nothing
local integer index=0set gg_trg_Energy_of_Nature=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Energy_of_Nature,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Energy_of_Nature,Condition(function Trig_Energy_of_Nature_Conditions))call TriggerAddAction(gg_trg_Energy_of_Nature,function Trig_Energy_of_Nature_Actions)endfunctionfunction Trig_Life_Chain_Remove_Effect_Actions takes nothing returns nothing
local timer tef=GetExpiredTimer()local integer hef=GetHandleId(tef)local effect ef=LoadEffectHandle(udg_hash,hef,1)
local unit target=LoadUnitHandle(udg_hash,hef,2)
local integer regen=LoadInteger(udg_hash,hef,3)call SetUnitLifeAndManaRegeneration(target,"life",-regen)call FlushChildHashtable(udg_hash,hef)call DestroyEffect(ef)set tef=null
set ef=nullset target=nullendfunctionfunction Trig_Life_Chain_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,8)local integer wait2=LoadInteger(udg_hash,h,4)local integer count=LoadInteger(udg_hash,h,5)local unit orb=LoadUnitHandle(udg_hash,h,6)local unit target2local real damagelocal real heallocal group gdamagelocal real heightlocal effect eflocal real x=GetUnitX(orb)local real y=GetUnitY(orb)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real xorblocal real yorblocal real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local player plocal group glocal group grup
local unit Pickedlocal timer teflocal integer heflocal integer regenlocal boolean remove=falselocal boolean reselect=false
local unit orb2local effect ef2
if GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset wait2=wait2-1call SaveInteger(udg_hash,h,4,wait2)
set xorb=x+30.3*Cos(angle*bj_DEGTORAD)set yorb=y+30.3*Sin(angle*bj_DEGTORAD)call SetUnitPosition(orb,xorb,yorb)set dist=SquareRoot((xt-xorb)*(xt-xorb)+(yt-yorb)*(yt-yorb))
call SetUnitFacing(orb,angle)if dist<21. then
call SetUnitPosition(orb,xt,yt)set p=GetOwningPlayer(caster)set gdamage=LoadGroupHandle(udg_hash,h,$E)if IsUnitEnemy(target,p)and IsUnitInGroup(target,gdamage)==false and GetUnitState(target,UNIT_STATE_LIFE)>.0 and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(target)!='h00U' thenset damage=LoadReal(udg_hash,h,2)call DestroyEffect(AddSpecialEffectTarget("Effects\\SoulshotC-gradeTarget.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\naturebeam.mdl",target,"chest"))
call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call GroupAddUnit(gdamage,target)if GetUnitState(target,UNIT_STATE_LIFE)<.5 thenset count=count+1call SaveInteger(udg_hash,h,5,count)
endifendifif IsUnitAlly(target,p)and IsUnitInGroup(target,gdamage)==false and GetUnitState(target,UNIT_STATE_LIFE)>.0 and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(target)!='h00U' thenset heal=LoadReal(udg_hash,h,3)set regen=LoadInteger(udg_hash,h,$D)
call DestroyEffect(AddSpecialEffectTarget("Effects\\Healing Touch.mdl",target,"origin"))
call SetUnitState(target,UNIT_STATE_LIFE,GetUnitState(target,UNIT_STATE_LIFE)+heal)set ef=AddSpecialEffectTarget("Effects\\NatureBlessing.mdl",target,"chest")set tef=CreateTimer()set hef=GetHandleId(tef)
call SaveEffectHandle(udg_hash,hef,1,ef)
call SaveUnitHandle(udg_hash,hef,2,target)call SaveInteger(udg_hash,hef,3,regen)call SetUnitLifeAndManaRegeneration(target,"life",regen)
call TimerStart(tef,8.,false,function Trig_Life_Chain_Remove_Effect_Actions)
set tef=null
set ef=nullcall GroupAddUnit(gdamage,target)endifcall SaveGroupHandle(udg_hash,h,$E,gdamage)set count=count-1call SaveInteger(udg_hash,h,5,count)
set reselect=trueset p=nullset gdamage=null
endifendifif(count>0 and GetUnitState(target,UNIT_STATE_LIFE)<.405)or reselect thenset g=CreateGroup()set grup=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,600.,null)set gdamage=LoadGroupHandle(udg_hash,h,$E)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall RandomUnitFromGroup(1,grup)
call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set target2=FirstOfGroup(udg_GroupRandomUnitFromGroup)if target2!=null thenset x=GetUnitX(orb)set y=GetUnitY(orb)set xt=GetUnitX(target2)
set yt=GetUnitY(target2)
set dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))
set angle=bj_RADTODEG*Atan2((yt-y),(xt-x))set p=GetOwningPlayer(caster)call KillUnit(orb)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullset orb2=CreateUnit(p,'h00E',x,y,angle)set ef2=AddSpecialEffectTarget("Effects\\LifeWave.mdl",orb2,"origin")call SetUnitFlyHeight(orb2,60.,.0)call SaveUnitHandle(udg_hash,h,6,orb2)call SaveEffectHandle(udg_hash,h,7,ef2)call SaveInteger(udg_hash,h,4,R2I((dist/(1000.*2))))
call SaveUnitHandle(udg_hash,h,8,target2)call SaveReal(udg_hash,h,9,(dist/ 3))call SaveInteger(udg_hash,h,$A,R2I((dist/ 2000.)))set p=nullset orb2=nullset ef2=null
else
set remove=trueendifset target2=null
call GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullset gdamage=null
endifif count<=0 then
set remove=trueendifif remove thencall KillUnit(orb)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall DestroyTimer(t)
set Picked=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset orb=null
set target=nullendfunctionfunction Trig_Life_Chain_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local integer lvl=GetUnitAbilityLevel(caster,'A0MP')
local real damage=($F+$F*lvl)+(GetHeroInt(caster,true)*(.1+.1*lvl))local real heal=(30+30*lvl)+(GetHeroInt(caster,true)*(.2+.2*lvl))local integer regen=(2+3*lvl)local real speed=1000.local real time=dist/ speedlocal real height=dist/ 3local integer count=3+(lvl*3)local integer wait2=R2I((time/ 2))local unit orb=CreateUnit(p,'h00E',x,y,angle)local effect ef=AddSpecialEffectTarget("Effects\\LifeWave.mdl",orb,"origin")
local timer t=CreateTimer()local integer h=GetHandleId(t)local group gdamage=CreateGroup()call SetUnitX(orb,x+30.*Cos((angle)*bj_DEGTORAD))call SetUnitY(orb,y+30.*Sin((angle)*bj_DEGTORAD))call SetUnitFlyHeight(orb,60.,.0)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveReal(udg_hash,h,3,heal)
call SaveInteger(udg_hash,h,4,wait2)
call SaveInteger(udg_hash,h,5,count)
call SaveUnitHandle(udg_hash,h,6,orb)call SaveEffectHandle(udg_hash,h,7,ef)call SaveUnitHandle(udg_hash,h,8,target)
call SaveReal(udg_hash,h,9,height)call SaveInteger(udg_hash,h,$D,regen)call SaveGroupHandle(udg_hash,h,$E,gdamage)call TimerStart(t,.03,true,function Trig_Life_Chain_Move_Actions)set caster=nullset t=nullset orb=null
set ef=nullset p=nullset target=nullset gdamage=null
endfunctionfunction Trig_Life_Chain_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0MP'endfunctionfunction InitTrig_Life_Chain takes nothing returns nothinglocal integer index=0set gg_trg_Life_Chain=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Life_Chain,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Life_Chain,Condition(function Trig_Life_Chain_Conditions))call TriggerAddAction(gg_trg_Life_Chain,function Trig_Life_Chain_Actions)endfunctionfunction Trig_Ent_Creation_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,8)local unit orb=LoadUnitHandle(udg_hash,h,6)local effect eflocal real x=GetUnitX(orb)local real y=GetUnitY(orb)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real xorblocal real yorblocal real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local player plocal integer hp
local integer damage
local real lifetimelocal integer lvllocal unit dammi
set xorb=x+27.2*Cos(angle*bj_DEGTORAD)set yorb=y+27.2*Sin(angle*bj_DEGTORAD)call SetUnitPosition(orb,xorb,yorb)set dist=SquareRoot((xt-xorb)*(xt-xorb)+(yt-yorb)*(yt-yorb))
call SetUnitFacing(orb,angle)if dist<20. then
call SetUnitPosition(orb,xt,yt)set p=GetOwningPlayer(caster)set hp=LoadInteger(udg_hash,h,2)
set damage=LoadInteger(udg_hash,h,3)
set lifetime=LoadReal(udg_hash,h,4)set lvl=LoadInteger(udg_hash,h,5)if GetUnitState(target,UNIT_STATE_LIFE)>.0 and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(target)!='h00U' then
call DestroyEffect(AddSpecialEffectTarget("Effects\\SoulshotC-gradeTarget.mdl",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\PlasmaMissileGreen.mdl",target,"chest"))
set dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0MR')call SetUnitAbilityLevel(dammi,'A0MR',lvl)call IssueTargetOrderById(dammi,$D006B,target)set dammi=nullendifset dammi=CreateUnit(p,'e006',(xt-60.*Cos((angle)*bj_DEGTORAD)),(yt-60.*Sin((angle)*bj_DEGTORAD)),angle)
call UnitApplyTimedLife(dammi,'BTLF',lifetime)call SetUnitColor(dammi,PLAYER_COLOR_GREEN)call SetUnitScale(dammi,(.75+.05*lvl),(.75+.05*lvl),(.75+.05*lvl))call SetUnitMaxState(dammi,UNIT_STATE_MAX_LIFE,hp)call SetAttackAbilityLevel(dammi,damage)
set dammi=nullset p=nullcall KillUnit(orb)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset orb=null
set target=nullendfunctionfunction Trig_Ent_Creation_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local integer lvl=GetUnitAbilityLevel(caster,'A0MQ')
local integer hp=(-75+(75*lvl))+R2I(GetHeroInt(caster,true)*2)local integer damage=(-8+(8*lvl))+R2I(GetHeroInt(caster,true)*.3)local real lifetime=(12.+(3.*lvl))+(GetUnitState(caster,UNIT_STATE_MAX_MANA)/ 'd')local unit orb=CreateUnit(p,'h00E',x,y,angle)local effect ef=AddSpecialEffectTarget("Abilities\\Weapons\\GreenDragonMissile\\GreenDragonMissile.mdl",orb,"origin")local timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitX(orb,x+30.*Cos((angle)*bj_DEGTORAD))call SetUnitY(orb,y+30.*Sin((angle)*bj_DEGTORAD))call SetUnitFlyHeight(orb,60.,.0)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,hp)call SaveInteger(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,lifetime)
call SaveInteger(udg_hash,h,5,lvl)call SaveUnitHandle(udg_hash,h,6,orb)call SaveEffectHandle(udg_hash,h,7,ef)call SaveUnitHandle(udg_hash,h,8,target)
call TimerStart(t,.03,true,function Trig_Ent_Creation_Move_Actions)set caster=nullset t=nullset orb=null
set ef=nullset p=nullset target=nullendfunctionfunction Trig_Ent_Creation_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0MQ'endfunctionfunction InitTrig_Ent_Creation takes nothing returns nothing
local integer index=0set gg_trg_Ent_Creation=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ent_Creation,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ent_Creation,Condition(function Trig_Ent_Creation_Conditions))call TriggerAddAction(gg_trg_Ent_Creation,function Trig_Ent_Creation_Actions)endfunctionfunction Trig_Nature_Wrath_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gheal=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local integer addas=LoadInteger(udg_hash,h,4)local integer addarmor=LoadInteger(udg_hash,h,5)
local integer addregen=LoadInteger(udg_hash,h,6)
local integer addms=LoadInteger(udg_hash,h,7)local integer wait=LoadInteger(udg_hash,h,9)
local integer wait2=LoadInteger(udg_hash,h,$A)local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local group g=CreateGroup()local group g2=CreateGroup()
local group g3=CreateGroup()
local unit Pickedlocal unit dammi
local effect eflocal unit dammieflocal effect dammieffect
local integer lopa=0
local integer lopb=0
local integer countlocal real angleeflocal real distlocal integer dammicounter=$Flocal integer order=GetUnitCurrentOrder(caster)local integer orderIdset orderId=$D021Dif(orderId!=0)thenelse
set orderId=UnitId("decouple")if(orderId!=0)thenendifendifif wait>0 and order==orderId thenset wait=wait-1set wait2=wait2+1if wait2==26 thenset wait2=0call GroupEnumUnitsInRange(g,x,y,700.,null)call DestroyEffect(AddSpecialEffect("Effects\\EarthNova.mdl",x,y))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Effects\\SoulshotC-gradeTarget.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\naturebeam.mdl",Picked,"chest"))
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0MO')call IssueTargetOrderById(dammi,$D00CB,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset g=CreateGroup()endifloop
exitwhen lopa>=4
set count=16-(lopa*4)set angleef=(360./ count)set dist=(700.-150.*lopa)set lopb=0loop
exitwhen lopb>countset dammief=LoadUnitHandle(udg_hash,h,dammicounter)call SetUnitPosition(dammief,x+dist*Cos(angleef*lopb*bj_DEGTORAD),y+dist*Sin(angleef*lopb*bj_DEGTORAD))call SetUnitFacing(dammief,angleef+90.)set dammicounter=dammicounter+1set dammief=null
set lopb=lopb+1endloopset lopa=lopa+1endloopcall SaveInteger(udg_hash,h,9,wait)call SaveInteger(udg_hash,h,$A,wait2)call GroupEnumUnitsInRange(g,x,y,700.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitAlly(Picked,p)or GetOwningPlayer(Picked)==Player($D))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(g2,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupAddGroup(gheal,g3)
loop
set Picked=FirstOfGroup(g3)exitwhen Picked==nullif IsUnitInGroup(Picked,g2)==false thencall GroupRemoveUnit(gheal,Picked)call SetUnitLifeAndManaRegeneration(Picked,"life",-addregen)
call SetArmorAbilityLevel(Picked,-addarmor)call SetAttackSpeedAbilityLevel(Picked,-addas)else
if(wait2/ 5)*5==wait2 thenset dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0MT')call SetUnitAbilityLevel(dammi,'A0MT',addms)
call IssueTargetOrderById(dammi,$D0085,Picked)set dammi=nullendifendifcall GroupRemoveUnit(g3,Picked)endloopset Picked=nullcall GroupClear(g3)call DestroyGroup(g3)set g3=nullloop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullif IsUnitInGroup(Picked,gheal)==false thencall DestroyEffect(AddSpecialEffectTarget("Effects\\Healing Touch.mdl",Picked,"origin"))
call SetUnitLifeAndManaRegeneration(Picked,"life",addregen)call SetArmorAbilityLevel(Picked,addarmor)call SetAttackSpeedAbilityLevel(Picked,addas)call GroupAddUnit(gheal,Picked)endifif GetUnitAbilityLevel(Picked,'B04M')<=0 thenset dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0MT')call SetUnitAbilityLevel(dammi,'A0MT',addms)
call IssueTargetOrderById(dammi,$D0085,Picked)set dammi=nullendifcall GroupRemoveUnit(g2,Picked)endloopset Picked=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullcall SaveGroupHandle(udg_hash,h,2,gheal)
else
set ef=LoadEffectHandle(udg_hash,h,$B)call DestroyEffect(ef)set ef=nullloop
set Picked=FirstOfGroup(gheal)exitwhen Picked==nullcall SetUnitLifeAndManaRegeneration(Picked,"life",-addregen)
call SetArmorAbilityLevel(Picked,-addarmor)call SetAttackSpeedAbilityLevel(Picked,-addas)call GroupRemoveUnit(gheal,Picked)endloopcall GroupClear(gheal)call DestroyGroup(gheal)
set gheal=nullset Picked=nullset lopa=0set lopb=0set dammicounter=$Floop
exitwhen lopa>4set count=16-(lopa*4)set lopb=0loop
exitwhen lopb>countset dammief=LoadUnitHandle(udg_hash,h,dammicounter)set dammieffect=LoadEffectHandle(udg_hash,h,dammicounter+75)
call KillUnit(dammief)call DestroyEffect(dammieffect)set dammicounter=dammicounter+1set dammief=null
set dammieffect=null
set lopb=lopb+1endloopset lopa=lopa+1endloopcall SetUnitTimeScale(caster,1.)
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset p=nullset gheal=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullcall GroupClear(g3)call DestroyGroup(g3)set g3=nullset dammi=nullset Picked=nullendfunctionfunction Trig_Nature_Wrath_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0MS')
local integer lvlup=GetUnitAbilityLevel(caster,'A0Q2')local real x=GetUnitX(caster)local real y=GetUnitY(caster)local group gheal=CreateGroup()local integer addaslocal integer addarmorlocal integer addregenlocal integer addmslocal real damagelocal integer wait=80local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammieflocal effect dammieffect
local integer lopa=0
local integer lopb=0
local integer countlocal real angleeflocal real distlocal integer dammicounter=$Flocal effect ef=AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Tranquility\\Tranquility.mdl",caster,"origin")if lvl>0 thenset addas=$A+35*lvlset addarmor=5+(5*lvl)set addregen=$F+(30*lvl)
set addms=lvlset damage=20.+50.*lvlcall AddProgressBar(caster,195.+(15.*lvl),(1.+.15*lvl),(wait*.1),false,true,'u',0,$FF,0)
endifif lvlup>0 thenset addas=$A+35*lvlupset addarmor=5+(5*lvlup)
set addregen=25+(50*lvlup)set addms=lvlupset damage=25.+75.*lvlup
call AddProgressBar(caster,195.+(15.*lvlup),(1.+.15*lvlup),(wait*.1),false,true,'u',0,$FF,0)
endifloop
exitwhen lopa>=4
set count=16-(lopa*4)set angleef=(360./ count)set dist=(700.-150.*lopa)set lopb=0loop
exitwhen lopb>countset dammief=CreateUnit(p,'h00U',x+dist*Cos(angleef*lopb*bj_DEGTORAD),y+dist*Sin(angleef*lopb*bj_DEGTORAD),(angleef*lopb)+90.)set dammieffect=AddSpecialEffectTarget("Effects\\GreenHeal.mdl",dammief,"chest")
call SaveUnitHandle(udg_hash,h,dammicounter,dammief)
call SaveEffectHandle(udg_hash,h,dammicounter+75,dammieffect)set dammicounter=dammicounter+1set dammief=null
set dammieffect=null
set lopb=lopb+1endloopset lopa=lopa+1endloopcall SetUnitTimeScale(caster,1.05)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gheal)
call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,addas)
call SaveInteger(udg_hash,h,5,addarmor)call SaveInteger(udg_hash,h,6,addregen)call SaveInteger(udg_hash,h,7,addms)
call SaveInteger(udg_hash,h,9,wait)call SaveInteger(udg_hash,h,$A,0)call SaveEffectHandle(udg_hash,h,$B,ef)call TimerStart(t,.1,true,function Trig_Nature_Wrath_Periodic_Actions)set caster=nullset p=nullset gheal=nullset ef=nullset t=nullendfunctionfunction Trig_Nature_Wrath_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0MS' or GetSpellAbilityId()=='A0Q2')endfunctionfunction InitTrig_Nature_Wrath takes nothing returns nothing
local integer index=0set gg_trg_Nature_Wrath=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Nature_Wrath,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Nature_Wrath,Condition(function Trig_Nature_Wrath_Conditions))call TriggerAddAction(gg_trg_Nature_Wrath,function Trig_Nature_Wrath_Actions)endfunctionfunction Trig_Falling_Star_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,7)local integer count=LoadInteger(udg_hash,h,8)local player p=GetOwningPlayer(caster)local real damagelocal unit orblocal real stuntimelocal effect eflocal real xtlocal real ytlocal group glocal unit Pickedlocal real angle2local real distlocal integer lopa=1
local integer horblocal real knock
local group gdamage=CreateGroup()loop
exitwhen lopa>countset orb=LoadUnitHandle(udg_hash,h,lopa)set ef=LoadEffectHandle(udg_hash,h,lopa+3)set horb=GetHandleId(orb)set damage=LoadReal(udg_hash,horb,1)
set stuntime=LoadReal(udg_hash,horb,2)set knock=LoadReal(udg_hash,horb,3)set xt=LoadReal(udg_hash,horb,4)
set yt=LoadReal(udg_hash,horb,5)
set g=CreateGroup()call GroupEnumUnitsInRange(g,xt,yt,220.,null)call DestroyEffect(AddSpecialEffect("Effects\\Nebula.mdl",xt,yt))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl",xt,yt))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl",Picked,"origin"))call StunUnitTimed(Picked,stuntime)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set angle2=bj_RADTODEG*Atan2((GetUnitY(Picked)-yt),(GetUnitX(Picked)-xt))set dist=SquareRoot((((GetUnitX(Picked)-xt)*(GetUnitX(Picked)-xt)))+((GetUnitY(Picked)-yt)*(GetUnitY(Picked)-yt)))call MoveUnit(Picked,.5,($E6-dist)*2.5*knock,($DC-dist)*2.*knock,angle2,.0,true)
call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall KillUnit(orb)call DestroyEffect(ef)set ef=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset lopa=lopa+1endloopset p=nullcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset caster=nullendfunctionfunction Trig_Falling_Star_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local integer lvl=GetUnitAbilityLevel(caster,'A0NR')
local real damage=(40.*lvl)+(GetHeroAgi(caster,true)*(.25+.25*lvl))local real stuntime=.6+(.15*lvl)
local player p=GetOwningPlayer(caster)local unit orblocal effect eflocal timer t=CreateTimer()local integer h=GetHandleId(t)local integer lopa=1
local real angle2=GetRandomReal(.0,360.)
local boolean isultimate=LoadBoolean(udg_hash,GetHandleId(caster),$7F)local integer count=1if isultimate thenset count=3endifif dist<50. then
set dist=50.
set angle=GetUnitFacing(caster)endifif GetFloatGameState(GAME_STATE_TIME_OF_DAY)*1<6. or GetFloatGameState(GAME_STATE_TIME_OF_DAY)*1>18. thenset damage=damage*1.5endifloop
exitwhen lopa>countif lopa==1 thenset orb=CreateUnit(p,'h00E',x,y,angle)call SetUnitScale(orb,2.75,2.75,2.75)call SaveReal(udg_hash,GetHandleId(orb),1,damage)call SaveReal(udg_hash,GetHandleId(orb),2,stuntime)call SaveReal(udg_hash,GetHandleId(orb),3,1.)call SaveReal(udg_hash,GetHandleId(orb),4,xt)call SaveReal(udg_hash,GetHandleId(orb),5,yt)else
set orb=CreateUnit(p,'h00E',(x+200.*Cos(angle2*bj_DEGTORAD)),(y+200.*Sin(angle2*bj_DEGTORAD)),angle)
call SetUnitScale(orb,2.,2.,2.)call SaveReal(udg_hash,GetHandleId(orb),1,damage/ 2)
call SaveReal(udg_hash,GetHandleId(orb),2,stuntime/ 2)call SaveReal(udg_hash,GetHandleId(orb),3,.5)call SaveReal(udg_hash,GetHandleId(orb),4,GetUnitX(orb)+dist*Cos(angle*bj_DEGTORAD))
call SaveReal(udg_hash,GetHandleId(orb),5,GetUnitY(orb)+dist*Sin(angle*bj_DEGTORAD))
set angle2=angle2+GetRandomReal(45.,315.)endifset ef=AddSpecialEffectTarget("Effects\\StarfallTarget2.mdl",orb,"origin")call SetUnitAnimationByIndex(orb,45)
call SetUnitTimeScale(orb,2.5)call UnitAddAbility(orb,'Amrf')call UnitRemoveAbility(orb,'Amrf')call SetUnitFlyHeight(orb,800.,.0)call SetUnitFlyHeight(orb,.0,1600.)call MoveUnit(orb,.5,dist*2,.0,angle,.0,true)call SaveUnitHandle(udg_hash,h,lopa,orb)
call SaveEffectHandle(udg_hash,h,lopa+3,ef)set ef=nullset orb=null
set lopa=lopa+1endloopcall DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl",caster,"origin"),3.)call SaveUnitHandle(udg_hash,h,7,caster)
call SaveInteger(udg_hash,h,8,count)
call TimerStart(t,.5,false,function Trig_Falling_Star_Move_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset p=nullendfunctionfunction Trig_Falling_Star_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NR'endfunctionfunction InitTrig_Falling_Star takes nothing returns nothing
local integer index=0set gg_trg_Falling_Star=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Falling_Star,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Falling_Star,Condition(function Trig_Falling_Star_Conditions))call TriggerAddAction(gg_trg_Falling_Star,function Trig_Falling_Star_Actions)endfunctionfunction Trig_Moon_Chackram_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit casterlocal effect efif LoadBoolean(udg_hash,h,3) thencall SaveBoolean(udg_hash,h,3,false)
set ef=LoadEffectHandle(udg_hash,h,2)call DestroyEffect(ef)set ef=nullcall TimerStart(t,5.,false,function Trig_Moon_Chackram_Periodic_Actions)
else
set caster=LoadUnitHandle(udg_hash,h,1)call SaveBoolean(udg_hash,GetHandleId(caster),$80,false)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullendifendfunctionfunction Trig_Moon_Chackram_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local effect ef=AddSpecialEffectTarget("Effects\\MoonSight_Buff.mdx",caster,"overhead")call SaveBoolean(udg_hash,GetHandleId(caster),$80,true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveEffectHandle(udg_hash,h,2,ef)call SaveBoolean(udg_hash,h,3,true)call TimerStart(t,3.,false,function Trig_Moon_Chackram_Periodic_Actions)
set caster=nullset t=nullset ef=nullendfunctionfunction Trig_Moon_Chackram_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0NS'endfunctionfunction InitTrig_Moon_Chackram takes nothing returns nothinglocal integer index=0set gg_trg_Moon_Chackram=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Moon_Chackram,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Moon_Chackram,Condition(function Trig_Moon_Chackram_Conditions))
call TriggerAddAction(gg_trg_Moon_Chackram,function Trig_Moon_Chackram_Actions)endfunctionfunction Trig_Moon_Wind_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gheal=LoadGroupHandle(udg_hash,h,2)local integer adddamagelocal integer addas=LoadInteger(udg_hash,h,4)local integer addint=LoadInteger(udg_hash,h,5)local integer addagi=LoadInteger(udg_hash,h,6)local integer addregen=LoadInteger(udg_hash,h,7)
local integer wait=LoadInteger(udg_hash,h,9)
local real x=LoadReal(udg_hash,h,$C)
local real y=LoadReal(udg_hash,h,$D)
local player p=GetOwningPlayer(caster)local group g=CreateGroup()local group g2=CreateGroup()
local group g3=CreateGroup()
local unit Pickedlocal unit dammi
local unit dammieflocal effect dammieffect
local integer lopa=0
local integer lopb=0
local integer countlocal real angleeflocal real distif wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,9,wait)call GroupEnumUnitsInRange(g,x,y,450.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif(IsUnitAlly(Picked,p)or GetOwningPlayer(Picked)==Player($D))and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(g2,Picked)
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupAddGroup(gheal,g3)
loop
set Picked=FirstOfGroup(g3)exitwhen Picked==nullif IsUnitInGroup(Picked,g2)==false thencall GroupRemoveUnit(gheal,Picked)call SetUnitLifeAndManaRegeneration(Picked,"life",-addregen)
call SetAttackSpeedAbilityLevel(Picked,-addas)if IsUnitType(Picked,UNIT_TYPE_HERO) thencall SetHeroAgi(Picked,GetHeroAgi(Picked,false)-addagi,true)
call SetHeroInt(Picked,GetHeroInt(Picked,false)-addint,true)
endifif Picked==caster and LoadBoolean(udg_hash,h,$E) thencall SetUnitLifeAndManaRegeneration(Picked,"life",-R2I((addregen))/ 2)call SetAttackSpeedAbilityLevel(Picked,-R2I((addas))/ 2)
call SetHeroAgi(Picked,GetHeroAgi(Picked,false)-R2I((addagi))/ 2,true)call SetHeroInt(Picked,GetHeroInt(Picked,false)-R2I((addint))/ 2,true)endifif Picked==caster and LoadBoolean(udg_hash,h,$F) thenset adddamage=LoadInteger(udg_hash,h,3)call SetAttackAbilityLevel(Picked,-adddamage)endifelse
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0NU')call IssueTargetOrderById(dammi,$D0085,Picked)set dammi=nullendifcall GroupRemoveUnit(g3,Picked)endloopset Picked=nullcall GroupClear(g3)call DestroyGroup(g3)set g3=nullloop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullif IsUnitInGroup(Picked,gheal)==false thencall GroupAddUnit(gheal,Picked)call SetUnitLifeAndManaRegeneration(Picked,"life",addregen)call SetAttackSpeedAbilityLevel(Picked,addas)if IsUnitType(Picked,UNIT_TYPE_HERO) thencall SetHeroAgi(Picked,GetHeroAgi(Picked,false)+addagi,true)
call SetHeroInt(Picked,GetHeroInt(Picked,false)+addint,true)
endifif Picked==caster and LoadBoolean(udg_hash,h,$E) thencall SetUnitLifeAndManaRegeneration(Picked,"life",R2I(addregen/ 2))call SetAttackSpeedAbilityLevel(Picked,R2I(addas/ 2))call SetHeroAgi(Picked,GetHeroAgi(Picked,false)+R2I((addagi)/ 2),true)call SetHeroInt(Picked,GetHeroInt(Picked,false)+R2I((addint))/ 2,true)endifif Picked==caster and LoadBoolean(udg_hash,h,$F) thenset adddamage=LoadInteger(udg_hash,h,3)call SetAttackAbilityLevel(Picked,adddamage)
endifendifif GetUnitAbilityLevel(Picked,'B04M')<=0 thenset dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0NU')call IssueTargetOrderById(dammi,$D0085,Picked)set dammi=nullendifcall GroupRemoveUnit(g2,Picked)endloopset Picked=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullcall SaveGroupHandle(udg_hash,h,2,gheal)
else
loop
set Picked=FirstOfGroup(gheal)exitwhen Picked==nullcall SetUnitLifeAndManaRegeneration(Picked,"life",-addregen)
call SetAttackSpeedAbilityLevel(Picked,-addas)if IsUnitType(Picked,UNIT_TYPE_HERO) thencall SetHeroAgi(Picked,GetHeroAgi(Picked,false)-addagi,true)
call SetHeroInt(Picked,GetHeroInt(Picked,false)-addint,true)
endifif Picked==caster and LoadBoolean(udg_hash,h,$E) thencall SetUnitLifeAndManaRegeneration(Picked,"life",-R2I((addregen))/ 2)call SetAttackSpeedAbilityLevel(Picked,-R2I((addas))/ 2)
call SetHeroAgi(Picked,GetHeroAgi(Picked,false)-R2I((addagi))/ 2,true)call SetHeroInt(Picked,GetHeroInt(Picked,false)-R2I((addint))/ 2,true)endifif Picked==caster and LoadBoolean(udg_hash,h,$F) thenset adddamage=LoadInteger(udg_hash,h,3)call SetAttackAbilityLevel(Picked,-adddamage)endifcall GroupRemoveUnit(gheal,Picked)endloopcall GroupClear(gheal)call DestroyGroup(gheal)
set gheal=nullset Picked=nullset lopa=1loop
exitwhen lopa>=7
set dammief=LoadUnitHandle(udg_hash,h,50+lopa)set dammieffect=LoadEffectHandle(udg_hash,h,60+lopa)
call KillUnit(dammief)call DestroyEffect(dammieffect)set dammief=null
set dammieffect=null
set lopa=lopa+1endloopcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset p=nullset gheal=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullcall GroupClear(g3)call DestroyGroup(g3)set g3=nullset dammi=nullset Picked=nullendfunctionfunction Trig_Moon_Wind_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0NT')
local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local real angle=bj_RADTODEG*Atan2((yt-y),(xt-x))local real dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))local group gheal=CreateGroup()local integer addagi=6+(4*lvl)local integer addint=6+(4*lvl)local integer addas=8+(6*lvl)local integer adddamage=R2I(GetHeroAgi(caster,true)*.4)local integer addregen=$A+(6*lvl)local integer wait=20local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammieflocal effect dammieffect
local integer lopa=1
local integer lopb=0
local integer countlocal real angleeflocal integer dammicounter=6
local real smechenie=400.+133.local real angledummi=angle-90.local real x2=x-400.*Cos(angle*bj_DEGTORAD)local real y2=y-400.*Sin(angle*bj_DEGTORAD)local boolean halfbonus=falselocal boolean isultimate=LoadBoolean(udg_hash,GetHandleId(caster),$7F)if GetFloatGameState(GAME_STATE_TIME_OF_DAY)*1<6. or GetFloatGameState(GAME_STATE_TIME_OF_DAY)*1>18. thenset halfbonus=trueendifif isultimate thenset wait=30endifloop
exitwhen lopa>=7
set smechenie=smechenie-133.
set dammief=CreateUnit(p,'h00E',x2+smechenie*Cos(angledummi*bj_DEGTORAD),y2+smechenie*Sin(angledummi*bj_DEGTORAD),angle)
call SetUnitAnimationByIndex(dammief,45)
call SetUnitScale(dammief,2.,2.,2.)call SetUnitFlyHeight(dammief,200.,.0)set dammieffect=AddSpecialEffectTarget("Effects\\HolyBlessing.mdl",dammief,"chest")call SaveUnitHandle(udg_hash,h,lopa+50,dammief)call SaveEffectHandle(udg_hash,h,lopa+60,dammieffect)set dammief=null
set dammieffect=null
set lopa=lopa+1endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gheal)
call SaveInteger(udg_hash,h,3,adddamage)
call SaveInteger(udg_hash,h,4,addas)
call SaveInteger(udg_hash,h,5,addint)call SaveInteger(udg_hash,h,6,addagi)call SaveInteger(udg_hash,h,7,addregen)call SaveInteger(udg_hash,h,9,wait)call SaveReal(udg_hash,h,$C,x)call SaveReal(udg_hash,h,$D,y)call SaveBoolean(udg_hash,h,$E,halfbonus)call SaveBoolean(udg_hash,h,$F,isultimate)call TimerStart(t,.5,true,function Trig_Moon_Wind_Periodic_Actions)set caster=nullset p=nullset gheal=nullset t=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Moon_Wind_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0NT'endfunctionfunction InitTrig_Moon_Wind takes nothing returns nothinglocal integer index=0set gg_trg_Moon_Wind=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Moon_Wind,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Moon_Wind,Condition(function Trig_Moon_Wind_Conditions))
call TriggerAddAction(gg_trg_Moon_Wind,function Trig_Moon_Wind_Actions)endfunctionfunction Trig_Night_Heart_Periodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local effect ef=LoadEffectHandle(udg_hash,h,2)local integer bonus=LoadInteger(udg_hash,h,3)call SetHeroAgi(caster,GetHeroAgi(caster,false)-bonus,true)call SaveBoolean(udg_hash,GetHandleId(caster),$7F,false)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset caster=nullcall DestroyEffect(ef)set ef=nullendfunctionfunction Trig_Night_Heart_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local timer t=CreateTimer()local integer h=GetHandleId(t)local effect ef=AddSpecialEffectTarget("Effects\\StarfallCaster.mdl",caster,"origin")local integer bonus=$F+($F*GetUnitAbilityLevel(caster,'A0NV'))local unit dammi=CreateUnit(GetOwningPlayer(caster),'h00H',.0,.0,.0)
local item it=CreateItem('I010',.0,.0)call UnitApplyTimedLife(dammi,'BTLF',10.)call UnitAddItem(dammi,it)call UnitUseItem(dammi,GetItemOfTypeFromUnitBJ(dammi,'I010'))set dammi=nullset it=nullcall PlaySoundBJ(gg_snd_HuntressYesAttack4)call SetHeroAgi(caster,GetHeroAgi(caster,false)+bonus,true)call SaveBoolean(udg_hash,GetHandleId(caster),$7F,true)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveEffectHandle(udg_hash,h,2,ef)call SaveInteger(udg_hash,h,3,bonus)
call TimerStart(t,20.,false,function Trig_Night_Heart_Periodic_Actions)set caster=nullset t=nullset ef=nullendfunctionfunction Trig_Night_Heart_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0NV'endfunctionfunction InitTrig_Night_Heart takes nothing returns nothinglocal integer index=0set gg_trg_Night_Heart=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Night_Heart,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Night_Heart,Condition(function Trig_Night_Heart_Conditions))
call TriggerAddAction(gg_trg_Night_Heart,function Trig_Night_Heart_Actions)endfunctionfunction Trig_MoonWarrior_Load_Actions takes nothing returns nothing
call AbilityPreload('A0NR',6)call AbilityPreload('A0NS',6)call AbilityPreload('A0NT',6)call AbilityPreload('A0NV',3)call AbilityPreload('A0NU',1)call AbilityPreload('B04R',1)call UnitPreload('h00H')
call UnitPreload('I010')
call EffectPreload("Effects\\CosmicTouch.MDX")call EffectPreload("Effects\\BlueGlaivie.mdl")call EffectPreload("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl")call EffectPreload("Effects\\SoundTrauma.mdl")call EffectPreload("Effects\\StarfallCaster.mdl")call EffectPreload("Effects\\StarfallTarget2.mdl")call EffectPreload("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl")call EffectPreload("Effects\\Nebula.mdl")call EffectPreload("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl")call EffectPreload("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayDamage.mdl")call EffectPreload("Abilities\\Spells\\Undead\\DeathandDecay\\DeathandDecayTarget.mdl")call EffectPreload("Effects\\MoonSight_Buff.mdx")call EffectPreload("Effects\\HolyBlessing.mdl")call EnableTrigger(gg_trg_Falling_Star)call EnableTrigger(gg_trg_Moon_Chackram)
call EnableTrigger(gg_trg_Moon_Wind)
call EnableTrigger(gg_trg_Night_Heart)endfunctionfunction InitTrig_MoonWarrior_Load takes nothing returns nothing
set gg_trg_MoonWarrior_Load=CreateTrigger()call TriggerAddAction(gg_trg_MoonWarrior_Load,function Trig_MoonWarrior_Load_Actions)endfunctionfunction Trig_Ancient_Communication_Ligtning_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,2)local lightning l=LoadLightningHandle(udg_hash,h,3)local real time=LoadReal(udg_hash,h,4)local location locc=GetUnitLoc(caster)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local location loct=GetUnitLoc(target)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local real dx=xc-xtlocal real dy=yc-ytlocal real dist=SquareRoot(dx*dx+dy*dy)local integer damage
local group glocal unit Pickedlocal group g2local group g3local integer attackspeedlocal effect eflocal integer hpregenlocal integer armorif GetUnitState(caster,UNIT_STATE_LIFE)>.405 and GetUnitState(target,UNIT_STATE_LIFE)>.0 and dist<=725. and time>.0 then
set time=time-.04call SaveReal(udg_hash,h,4,time)
call MoveLightningEx(l,true,xc,yc,50.+GetLocationZ(locc),xt,yt,50.+GetLocationZ(loct))else
if GetUnitAbilityLevel(caster,'A0OO')>0 then
set attackspeed=$A+$A*GetUnitAbilityLevel(caster,'A0OO')
set ef=LoadEffectHandle(udg_hash,GetHandleId(target),$89)call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(target),$89,null)
call SetAttackSpeedAbilityLevel(target,-LoadInteger(udg_hash,GetHandleId(target),$8C))endifif GetUnitAbilityLevel(caster,'A0OT')>0 then
set armor=3+3*GetUnitAbilityLevel(caster,'A0OT')
set hpregen=5+$A*GetUnitAbilityLevel(caster,'A0OT')set ef=LoadEffectHandle(udg_hash,GetHandleId(target),$89)call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(target),$89,null)
call SetUnitLifeAndManaRegeneration(target,"life",-LoadInteger(udg_hash,GetHandleId(target),$8D))call SetArmorAbilityLevel(target,-LoadInteger(udg_hash,GetHandleId(target),$8E))
endifcall UnitRemoveAbility(target,'B04Z')set g=LoadGroupHandle(udg_hash,GetHandleId(caster),$88)call GroupRemoveUnit(g,target)set Picked=FirstOfGroup(g)if Picked==null then
call UnitRemoveAbility(caster,'B04Z')endifcall SaveGroupHandle(udg_hash,GetHandleId(caster),$88,g)
set damage=LoadInteger(udg_hash,h,5)
call SetAttackAbilityLevel(caster,-damage)call SetAttackAbilityLevel(target,-damage)call DestroyLightning(l)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset target=nullset l=nullcall RemoveLocation(locc)set locc=nullcall RemoveLocation(loct)set loct=nullendfunctionfunction Trig_Ancient_Communication_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local unit dammi
local location locc=GetUnitLoc(caster)local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local location loct=GetUnitLoc(target)local real xt=GetUnitX(target)local real yt=GetUnitY(target)local lightning llocal player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0OM')
local timer t=CreateTimer()local integer h=GetHandleId(t)local real time=11.+lvllocal integer damage=7+(8*lvl)local group g=LoadGroupHandle(udg_hash,GetHandleId(caster),$88)local effect eflocal integer attackspeedlocal integer hpregenlocal integer armorif g==null thenset g=CreateGroup()endifif IsUnitInGroup(target,g) thencall SimError(GetOwningPlayer(caster),"На этого героя уже наложена Связь Предков.")call UnitRemoveAbility(caster,'A0OM')call UnitAddAbility(caster,'A0OM')call SetUnitAbilityLevel(caster,'A0OM',lvl)call SetUnitState(caster,UNIT_STATE_MANA,GetUnitState(caster,UNIT_STATE_MANA)+120.+(5.*lvl))
else
set l=AddLightningEx("SPLK",true,xc,yc,50.+GetLocationZ(locc),xt,yt,50.+GetLocationZ(loct))call GroupAddUnit(g,target)call SaveGroupHandle(udg_hash,GetHandleId(caster),$88,g)
call SetAttackAbilityLevel(caster,damage)call SetAttackAbilityLevel(target,damage)set dammi=CreateUnit(p,'h00U',xc,yc,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A0ON')call IssueTargetOrderById(dammi,$D0085,caster)set dammi=nullset dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',1.5)call UnitAddAbility(dammi,'A0ON')call IssueTargetOrderById(dammi,$D0085,target)set dammi=nullif GetUnitAbilityLevel(caster,'A0OO')>0 then
set attackspeed=$A+$A*GetUnitAbilityLevel(caster,'A0OO')
set ef=AddSpecialEffectTarget("Effects\\PyroMissle.mdx",target,"chest")call SaveEffectHandle(udg_hash,GetHandleId(target),$89,ef)set ef=nullcall SetAttackSpeedAbilityLevel(target,attackspeed)call SaveInteger(udg_hash,GetHandleId(target),$8C,attackspeed)endifif GetUnitAbilityLevel(caster,'A0OT')>0 then
set armor=3+3*GetUnitAbilityLevel(caster,'A0OT')
set hpregen=5+$A*GetUnitAbilityLevel(caster,'A0OT')set ef=AddSpecialEffectTarget("Effects\\Nebula.mdx",target,"origin")
call SaveEffectHandle(udg_hash,GetHandleId(target),$89,ef)set ef=nullcall SetUnitLifeAndManaRegeneration(target,"life",hpregen)call SetArmorAbilityLevel(target,armor)call SaveInteger(udg_hash,GetHandleId(target),$8D,hpregen)call SaveInteger(udg_hash,GetHandleId(target),$8E,armor)
endifcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveUnitHandle(udg_hash,h,2,target)
call SaveLightningHandle(udg_hash,h,3,l)
call SaveReal(udg_hash,h,4,time)
call SaveInteger(udg_hash,h,5,damage)call TimerStart(t,.04,true,function Trig_Ancient_Communication_Ligtning_Move_Actions)set l=nullendifset caster=nullset target=nullset dammi=nullcall RemoveLocation(locc)set locc=nullcall RemoveLocation(loct)set loct=nullset p=nullset t=nullset g=nullendfunctionfunction Trig_Ancient_Communication_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0OM'endfunctionfunction InitTrig_Ancient_Communication takes nothing returns nothinglocal integer index=0set gg_trg_Ancient_Communication=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ancient_Communication,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ancient_Communication,Condition(function Trig_Ancient_Communication_Conditions))
call TriggerAddAction(gg_trg_Ancient_Communication,function Trig_Ancient_Communication_Actions)endfunctionfunction Trig_Learn_Power_of_Ancestors_Actions takes nothing returns nothing
local unit u=GetLearningUnit()local integer lvl=GetUnitAbilityLevel(u,'A0OP')if lvl==1 thencall UnitAddAbility(u,'A0OS')call UnitAddAbility(u,'A0OR')call UnitMakeAbilityPermanent(u,true,'A0OS')
call UnitMakeAbilityPermanent(u,true,'A0OR')
else
call SetUnitAbilityLevel(u,'A0OS',lvl)call SetUnitAbilityLevel(u,'A0OR',lvl)call SetUnitAbilityLevel(u,'A0OT',lvl)call SetUnitAbilityLevel(u,'A0OO',lvl)endifset u=nullendfunctionfunction Trig_Learn_Power_of_Ancestors_Conditions takes nothing returns booleanreturn GetLearnedSkill()=='A0OP' and GetUnitTypeId(GetLearningUnit())!='h00U'endfunctionfunction InitTrig_Learn_Power_of_Ancestors takes nothing returns nothing
local integer index=0set gg_trg_Learn_Power_of_Ancestors=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Power_of_Ancestors,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Power_of_Ancestors,Condition(function Trig_Learn_Power_of_Ancestors_Conditions))call TriggerAddAction(gg_trg_Learn_Power_of_Ancestors,function Trig_Learn_Power_of_Ancestors_Actions)endfunctionfunction Trig_Switch_Power_of_Ancestors_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local boolean nodestroy=LoadBoolean(udg_hash,h,2)local real mana=GetUnitState(caster,UNIT_STATE_MANA)
local group glocal group g2local unit Pickedlocal integer lvllocal integer h2
local integer mana2local effect efif mana>5. and GetUnitState(caster,UNIT_STATE_LIFE)>.0 and nodestroy thenelse
if nodestroy thenset h2=GetHandleId(caster)set mana2=LoadInteger(udg_hash,h2,$8A)set g=LoadGroupHandle(udg_hash,h2,$88)set g2=CreateGroup()
call GroupAddUnit(g2,caster)
call GroupAddGroup(g,g2)
loop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),$89)call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(Picked),$89,null)
if GetUnitAbilityLevel(caster,'A0OO')>0 then
call SetAttackSpeedAbilityLevel(Picked,-LoadInteger(udg_hash,GetHandleId(Picked),$8C))endifif GetUnitAbilityLevel(caster,'A0OT')>0 then
call SetUnitLifeAndManaRegeneration(Picked,"life",-LoadInteger(udg_hash,GetHandleId(Picked),$8D))call SetArmorAbilityLevel(Picked,-LoadInteger(udg_hash,GetHandleId(Picked),$8E))
endifcall GroupRemoveUnit(g2,Picked)endloopif GetUnitAbilityLevel(caster,'A0OO')>0 then
set lvl=GetUnitAbilityLevel(caster,'A0OO')call SetUnitLifeAndManaRegeneration(caster,"mana",mana2)
call UnitRemoveAbility(caster,'A0OO')call UnitAddAbility(caster,'A0OS')call SetUnitAbilityLevel(caster,'A0OS',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OS')endifif GetUnitAbilityLevel(caster,'A0OT')>0 then
set lvl=GetUnitAbilityLevel(caster,'A0OT')call SetUnitLifeAndManaRegeneration(caster,"mana",mana2)
call UnitRemoveAbility(caster,'A0OT')call UnitAddAbility(caster,'A0OR')call SetUnitAbilityLevel(caster,'A0OR',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OR')endifcall DestroyGroup(g2)set g2=nullset g=nullendifcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullendfunctionfunction Trig_Switch_Power_of_Ancestors_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer id=GetSpellAbilityId()
local integer lvl=GetUnitAbilityLevel(caster,id)
local effect eflocal integer h=GetHandleId(caster)local group g=LoadGroupHandle(udg_hash,h,$88)local group g2=CreateGroup()
local unit Pickedlocal integer mana=LoadInteger(udg_hash,h,$8A)local integer nowmana=3+lvl*2local timer tlocal integer attackspeed=$A+$A*lvllocal integer hpregen=5+$A*lvllocal integer armor=3+3*lvllocal boolean switch=falselocal boolean switch2=falsecall GroupAddUnit(g2,caster)
call GroupAddGroup(g,g2)
if id=='A0OS' thencall UnitRemoveAbility(caster,'A0OS')call UnitAddAbility(caster,'A0OO')call SetUnitAbilityLevel(caster,'A0OO',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OO')if GetUnitAbilityLevel(caster,'A0OT')>0 then
set switch2=true
call SetUnitLifeAndManaRegeneration(caster,"mana",mana)call UnitRemoveAbility(caster,'A0OT')call UnitAddAbility(caster,'A0OR')call SetUnitAbilityLevel(caster,'A0OR',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OR')endifcall SetUnitLifeAndManaRegeneration(caster,"mana",-nowmana)call SaveInteger(udg_hash,h,$8A,nowmana)
set t=CreateTimer()call SaveUnitHandle(udg_hash,GetHandleId(t),1,caster)call SaveBoolean(udg_hash,GetHandleId(t),2,true)
call TimerStart(t,.04,true,function Trig_Switch_Power_of_Ancestors_Move_Actions)
if LoadTimerHandle(udg_hash,h,$8B)!=null thencall FlushChildHashtable(udg_hash,GetHandleId(LoadTimerHandle(udg_hash,h,$8B)))call DestroyTimer(LoadTimerHandle(udg_hash,h,$8B))endifcall SaveTimerHandle(udg_hash,h,$8B,t)set t=nullloop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),$89)call DestroyEffect(ef)set ef=nullset ef=AddSpecialEffectTarget("Effects\\PyroMissle.mdx",Picked,"chest")call SaveEffectHandle(udg_hash,GetHandleId(Picked),$89,ef)set ef=nullif switch2 thencall SetUnitLifeAndManaRegeneration(Picked,"life",-LoadInteger(udg_hash,GetHandleId(Picked),$8D))call SetArmorAbilityLevel(Picked,-LoadInteger(udg_hash,GetHandleId(Picked),$8E))
endifcall SetAttackSpeedAbilityLevel(Picked,attackspeed)call SaveInteger(udg_hash,GetHandleId(Picked),$8C,attackspeed)call GroupRemoveUnit(g2,Picked)endloopendifif id=='A0OO' thencall UnitRemoveAbility(caster,'A0OO')call UnitAddAbility(caster,'A0OS')call SetUnitAbilityLevel(caster,'A0OS',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OS')call SetUnitLifeAndManaRegeneration(caster,"mana",mana)loop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),$89)call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(Picked),$89,null)
call SetAttackSpeedAbilityLevel(Picked,-LoadInteger(udg_hash,GetHandleId(Picked),$8C))call GroupRemoveUnit(g2,Picked)endloopendifif id=='A0OR' thencall UnitRemoveAbility(caster,'A0OR')call UnitAddAbility(caster,'A0OT')call SetUnitAbilityLevel(caster,'A0OT',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OT')call SetUnitLifeAndManaRegeneration(caster,"mana",-nowmana)call SaveInteger(udg_hash,h,$8A,nowmana)
if GetUnitAbilityLevel(caster,'A0OO')>0 then
set switch=truecall SetUnitLifeAndManaRegeneration(caster,"mana",mana)call UnitRemoveAbility(caster,'A0OO')call UnitAddAbility(caster,'A0OS')call SetUnitAbilityLevel(caster,'A0OS',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OS')endifset t=CreateTimer()call SaveUnitHandle(udg_hash,GetHandleId(t),1,caster)call SaveBoolean(udg_hash,GetHandleId(t),2,true)
call TimerStart(t,.04,true,function Trig_Switch_Power_of_Ancestors_Move_Actions)
if LoadTimerHandle(udg_hash,h,$8B)!=null thencall FlushChildHashtable(udg_hash,GetHandleId(LoadTimerHandle(udg_hash,h,$8B)))call DestroyTimer(LoadTimerHandle(udg_hash,h,$8B))endifcall SaveTimerHandle(udg_hash,h,$8B,t)set t=nullloop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),$89)call DestroyEffect(ef)set ef=nullif switch thencall SetAttackSpeedAbilityLevel(Picked,-LoadInteger(udg_hash,GetHandleId(Picked),$8C))endifcall SetUnitLifeAndManaRegeneration(Picked,"life",hpregen)call SetArmorAbilityLevel(Picked,armor)call SaveInteger(udg_hash,GetHandleId(Picked),$8D,hpregen)call SaveInteger(udg_hash,GetHandleId(Picked),$8E,armor)
set ef=AddSpecialEffectTarget("Effects\\Nebula.mdx",Picked,"origin")
call SaveEffectHandle(udg_hash,GetHandleId(Picked),$89,ef)set ef=nullcall GroupRemoveUnit(g2,Picked)endloopendifif id=='A0OT' thencall UnitRemoveAbility(caster,'A0OT')call UnitAddAbility(caster,'A0OR')call SetUnitAbilityLevel(caster,'A0OR',lvl)call UnitMakeAbilityPermanent(caster,true,'A0OR')call SetUnitLifeAndManaRegeneration(caster,"mana",mana)loop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullset ef=LoadEffectHandle(udg_hash,GetHandleId(Picked),$89)call DestroyEffect(ef)set ef=nullcall SaveEffectHandle(udg_hash,GetHandleId(Picked),$89,null)
call SetUnitLifeAndManaRegeneration(Picked,"life",-LoadInteger(udg_hash,GetHandleId(Picked),$8D))call SetArmorAbilityLevel(Picked,-LoadInteger(udg_hash,GetHandleId(Picked),$8E))
call GroupRemoveUnit(g2,Picked)endloopendifset g=nullcall DestroyGroup(g2)set g2=nullset caster=nullendfunctionfunction Trig_Switch_Power_of_Ancestors_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0OR' or GetSpellAbilityId()=='A0OS' or GetSpellAbilityId()=='A0OO' or GetSpellAbilityId()=='A0OT'endfunctionfunction InitTrig_Switch_Power_of_Ancestors takes nothing returns nothinglocal integer index=0set gg_trg_Switch_Power_of_Ancestors=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Switch_Power_of_Ancestors,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Switch_Power_of_Ancestors,Condition(function Trig_Switch_Power_of_Ancestors_Conditions))
call TriggerAddAction(gg_trg_Switch_Power_of_Ancestors,function Trig_Switch_Power_of_Ancestors_Actions)endfunctionfunction Trig_Earth_Split_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local unit dammi
local real xc=GetUnitX(caster)local real yc=GetUnitY(caster)local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0OQ')
local integer damage=$A+(35*lvl)
local group g=LoadGroupHandle(udg_hash,GetHandleId(caster),$88)local group g2=CreateGroup()
local group g3=CreateGroup()
local group g4=CreateGroup()
local unit Pickedlocal unit Picked2call GroupAddUnit(g2,caster)
call GroupAddGroup(g,g2)
loop
set Picked2=FirstOfGroup(g2)
exitwhen Picked2==nullcall GroupEnumUnitsInRange(g3,GetUnitX(Picked2),GetUnitY(Picked2),225.,null)
loop
set Picked=FirstOfGroup(g3)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset dammi=CreateUnit(p,'h00U',GetUnitX(Picked),GetUnitY(Picked),.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0OU')call IssueTargetOrderById(dammi,$D006B,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifcall GroupRemoveUnit(g3,Picked)endloopcall DestroyEffect(AddSpecialEffect("Effects\\RedAftershock.mdl",GetUnitX(Picked2),GetUnitY(Picked2)))call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",GetUnitX(Picked2),GetUnitY(Picked2)))
call GroupRemoveUnit(g2,Picked2)
endloopset caster=nullset target=nullset dammi=nullset p=nullset g=nullcall DestroyGroup(g2)set g2=nullcall DestroyGroup(g3)set g3=nullcall DestroyGroup(g4)set g4=nullendfunctionfunction Trig_Earth_Split_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0OQ'endfunctionfunction InitTrig_Earth_Split takes nothing returns nothinglocal integer index=0set gg_trg_Earth_Split=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Earth_Split,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Earth_Split,Condition(function Trig_Earth_Split_Conditions))
call TriggerAddAction(gg_trg_Earth_Split,function Trig_Earth_Split_Actions)endfunctionfunction Trig_Ancient_Help_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamagelocal real damagelocal real heallocal integer wait=LoadInteger(udg_hash,h,5)
local integer waitgo=LoadInteger(udg_hash,h,$D)local real facelocal unit dammi
local unit wavelocal real x
local real y
local player plocal group glocal unit Pickedlocal effect eflocal boolean alife=true
local real scale
local real aoeset wait=wait-1call SaveInteger(udg_hash,h,5,wait)if wait==waitgo then
call SaveBoolean(udg_hash,h,$A,false)set dammi=LoadUnitHandle(udg_hash,h,7)set face=LoadReal(udg_hash,h,6)set wave=CreateUnit(GetOwningPlayer(caster),'h00U',GetUnitX(dammi),GetUnitY(dammi),GetUnitFacing(dammi))
set ef=AddSpecialEffectTarget("Abilities\\Spells\\Orc\\Shockwave\\ShockwaveMissile.mdl",wave,"origin")call SaveUnitHandle(udg_hash,h,8,wave)set scale=LoadReal(udg_hash,h,$B)call SetUnitScale(wave,scale,scale,scale)call SaveEffectHandle(udg_hash,h,9,ef)set ef=nullset wave=nullcall RemoveUnit(dammi)set dammi=nullendifif(wait>0)and(wait<waitgo)thenset wave=LoadUnitHandle(udg_hash,h,8)set face=LoadReal(udg_hash,h,6)set x=GetUnitX(wave)+30.*Cos(face*bj_DEGTORAD)set y=GetUnitY(wave)+30.*Sin(face*bj_DEGTORAD)call SetUnitPosition(wave,x,y)set g=CreateGroup()set p=GetOwningPlayer(caster)set damage=LoadReal(udg_hash,h,3)set heal=LoadReal(udg_hash,h,4)set gdamage=LoadGroupHandle(udg_hash,h,2)set aoe=LoadReal(udg_hash,h,$C)call GroupEnumUnitsInRange(g,x,y,aoe,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\Burning Core.mdx",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\Burning Core.mdx",Picked,"origin"))call StunUnitTimed(Picked,2.5)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifif IsUnitAlly(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call SetUnitState(Picked,UNIT_STATE_LIFE,GetUnitState(Picked,UNIT_STATE_LIFE)+heal)call DestroyEffectWithWait(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Heal\\HealTarget.mdl",Picked,"origin"),1.85)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,2,gdamage)set wave=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset gdamage=null
endifif wait<=0 thenset wave=LoadUnitHandle(udg_hash,h,8)set ef=LoadEffectHandle(udg_hash,h,9)call KillUnit(wave)call DestroyEffect(ef)set gdamage=LoadGroupHandle(udg_hash,h,2)call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset p=nullset Picked=nullset dammi=nullendfunctionfunction Trig_Ancient_Help_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local integer lvl=GetUnitAbilityLevel(caster,'A0OV')
local integer lvlup=GetUnitAbilityLevel(caster,'A0PX')local real damagelocal real heallocal location loclocal real txlocal real tylocal integer wait=40+20
local timer t=CreateTimer()local integer h=GetHandleId(t)local unit dammi
local real scale
local real aoelocal integer waitgo
if lvl>0 thenset damage=(-25.+175.*lvl)+(GetHeroInt(caster,true)*((lvl*.75)+.25))
set heal=(200.*lvl)+(GetHeroInt(caster,true)*1.25*lvl)set scale=1.2set aoe=125.
set waitgo=40endifif lvlup>0 thenset damage=(-25.+175.*lvlup)+(GetHeroInt(caster,true)*((lvlup*.75)+.25))
set heal=(200.*lvlup)+(GetHeroInt(caster,true)*1.25*lvlup)set scale=1.6set wait=80+20set aoe=200.
set waitgo=80endifif target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dammi=CreateUnit(Player(5),'h00L',x-200.*Cos(angle*bj_DEGTORAD),y-200.*Sin(angle*bj_DEGTORAD),angle)
call SetUnitVertexColor(dammi,$F8,$9A,0,'d')
call SetUnitScale(dammi,1.5,1.5,1.5)
call SetUnitAnimation(dammi,"Attack Slam")call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,heal)
call SaveInteger(udg_hash,h,5,wait)call SaveReal(udg_hash,h,6,angle)call SaveUnitHandle(udg_hash,h,7,dammi)call SaveBoolean(udg_hash,h,$A,true)
call SaveReal(udg_hash,h,$B,scale)call SaveReal(udg_hash,h,$C,aoe)
call SaveInteger(udg_hash,h,$D,waitgo)call TimerStart(t,.03,true,function Trig_Ancient_Help_Move_Actions)set caster=nullset target=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
set t=nullset dammi=nullendfunctionfunction Trig_Ancient_Help_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0OV' or GetSpellAbilityId()=='A0PX')endfunctionfunction InitTrig_Ancient_Help takes nothing returns nothing
local integer index=0set gg_trg_Ancient_Help=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ancient_Help,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ancient_Help,Condition(function Trig_Ancient_Help_Conditions))call TriggerAddAction(gg_trg_Ancient_Help,function Trig_Ancient_Help_Actions)endfunctionfunction Trig_SpiritBreaker_Load_Actions takes nothing returns nothingcall AbilityPreload('A0OM',6)call AbilityPreload('A0OQ',6)call AbilityPreload('A0OP',6)call AbilityPreload('A0OV',3)call AbilityPreload('A0OU',1)call AbilityPreload('B04Z',1)call AbilityPreload('B050',1)call UnitPreload('h00L')
call EffectPreload("Abilities\\Spells\\Orc\\StasisTrap\\StasisTotemTarget.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPriest.mdl")call EffectPreload("Effects\\Nebula.mdx")call EffectPreload("Effects\\PyroMissle.mdx")call EffectPreload("Effects\\RedAftershock.mdl")
call EffectPreload("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl")call EffectPreload("Abilities\\Spells\\Orc\\Shockwave\\ShockwaveMissile.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl")call EffectPreload("Effects\\Burning Core.mdx")call EnableTrigger(gg_trg_Ancient_Communication)
call EnableTrigger(gg_trg_Learn_Power_of_Ancestors)call EnableTrigger(gg_trg_Switch_Power_of_Ancestors)
call EnableTrigger(gg_trg_Earth_Split)call EnableTrigger(gg_trg_Ancient_Help)endfunctionfunction InitTrig_SpiritBreaker_Load takes nothing returns nothingset gg_trg_SpiritBreaker_Load=CreateTrigger()call TriggerAddAction(gg_trg_SpiritBreaker_Load,function Trig_SpiritBreaker_Load_Actions)endfunctionfunction Trig_Dash_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Dash_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local integer lvl=LoadInteger(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local real face=LoadReal(udg_hash,h,6)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real angle
local real angle2local unit dammi
local boolean alife=true
local rect r=Rect(x-100.,y-100.,x+100.,y+100.)call EnumDestructablesInRect(r,null,function Trig_Dash_Dest_Actions)
if GetUnitState(caster,UNIT_STATE_LIFE)<.405 thenset alife=falseendifif wait>0 and alife then
set wait=wait-1call SaveInteger(udg_hash,h,5,wait)call SetUnitFacing(caster,face)if wait-(wait/ 5)*5==0 thencall SetUnitAnimationByIndex(caster,6)endifcall GroupEnumUnitsInRange(g,x,y,125.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",Picked,"origin"))set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',.5)
call UnitAddAbility(dammi,'A0P1')call SetUnitAbilityLevel(dammi,'A0P1',lvl)call IssueTargetOrderById(dammi,$D006B,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)set dammi=nullendifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,2,gdamage)else
call SetUnitPathing(caster,true)
call SetUnitTimeScale(caster,1.)
call SetUnitAnimation(caster,"stand")call GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset gdamage=null
call GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullset dammi=nullcall RemoveRect(r)set r=nullendfunctionfunction Trig_Dash_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local integer lvl=GetUnitAbilityLevel(caster,'A0P0')
local real damage=(10.+(30.*lvl))+(GetHeroAgi(caster,true)*(.3+.5*lvl))local location loclocal real txlocal real tylocal real distlocal real timelocal timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitAnimation(caster,"stand")call SetUnitPathing(caster,false)call SetUnitAnimationByIndex(caster,6)call SetUnitTimeScale(caster,2.)
if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
if target==caster thenset angle=GetUnitFacing(caster)set dist=900.endifset time=dist/ 900.call MoveUnit(caster,time,900.,.0,angle,.0,true)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,lvl)call SaveInteger(udg_hash,h,5,R2I(dist/ 27))
call SaveReal(udg_hash,h,6,angle)call TimerStart(t,.03,true,function Trig_Dash_Move_Actions)set caster=nullset target=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Dash_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0P0'endfunctionfunction InitTrig_Dash takes nothing returns nothing
local integer index=0set gg_trg_Dash=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dash,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dash,Condition(function Trig_Dash_Conditions))call TriggerAddAction(gg_trg_Dash,function Trig_Dash_Actions)endfunctionfunction Trig_Dash_Remove_Damge_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer alldamage=LoadInteger(udg_hash,h,2)local effect ef=LoadEffectHandle(udg_hash,h,3)call SetAttackAbilityLevel(caster,-alldamage)call DestroyEffect(ef)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set ef=nullset t=nullset caster=nullendfunctionfunction Trig_Dagger_Throw_Dest_Actions takes nothing returns nothingcall KillDestructable(GetEnumDestructable())
endfunctionfunction Trig_Dagger_Throw_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local real damage=LoadReal(udg_hash,h,3)
local integer adddamage=LoadInteger(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local real angle=LoadReal(udg_hash,h,6)local unit dagger=LoadUnitHandle(udg_hash,h,7)local boolean tuda=LoadBoolean(udg_hash,h,8)
local integer alldamage=LoadInteger(udg_hash,h,9)local real x=GetUnitX(dagger)local real y=GetUnitY(dagger)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal boolean alife=true
local real distlocal boolean dest=false
local rect r=Rect(x-100.,y-100.,x+100.,y+100.)local timer t2local integer h2
call EnumDestructablesInRect(r,null,function Trig_Dagger_Throw_Dest_Actions)
if(wait>0)and tuda thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)call SetUnitPosition(dagger,x+24.*Cos((angle)*bj_DEGTORAD),y+24.*Sin((angle)*bj_DEGTORAD))endifif wait==0 thenset tuda=falsecall SaveBoolean(udg_hash,h,8,tuda)endifif tuda==false thenset angle=bj_RADTODEG*Atan2((GetUnitY(caster)-y),(GetUnitX(caster)-x))set dist=SquareRoot((GetUnitX(caster)-x)*(GetUnitX(caster)-x)+(GetUnitY(caster)-y)*(GetUnitY(caster)-y))
call SetUnitPosition(dagger,x+24.*Cos((angle)*bj_DEGTORAD),y+24.*Sin((angle)*bj_DEGTORAD))if dist<50. then
set dest=trueendifendifcall GroupEnumUnitsInRange(g,x,y,125.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"head"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",Picked,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))set alldamage=alldamage+adddamagecall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveInteger(udg_hash,h,9,alldamage)
call SaveGroupHandle(udg_hash,h,2,gdamage)if dest then
call GroupClear(gdamage)
call DestroyGroup(gdamage)call RemoveUnit(dagger)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
if alldamage>0 thencall SetAttackAbilityLevel(caster,alldamage)
set t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,caster)call SaveInteger(udg_hash,h2,2,alldamage)call SaveEffectHandle(udg_hash,h2,3,AddSpecialEffectTarget("Effects\\Prismatic Missile Fixed.mdx",caster,"weapon"))call TimerStart(t2,6.,false,function Trig_Dash_Remove_Damge_Actions)
set t2=nullendifendifset t=nullset caster=nullset gdamage=null
call GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullcall RemoveRect(r)set r=nullset dagger=nullendfunctionfunction Trig_Dagger_Throw_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local integer lvl=GetUnitAbilityLevel(caster,'A0P2')
local real damage=(40.*lvl)local integer adddamage=2+lvllocal integer alldamage=0local location loclocal real txlocal real tylocal real distlocal unit daggerlocal timer t=CreateTimer()local integer h=GetHandleId(t)if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
if target==caster thenset angle=GetUnitFacing(caster)set dist=900.endifset dagger=CreateUnit(GetOwningPlayer(caster),'h00N',x,y,angle)call SetUnitX(dagger,x+20.*Cos((angle)*bj_DEGTORAD))
call SetUnitY(dagger,y+20.*Sin((angle)*bj_DEGTORAD))
call SetUnitTimeScale(dagger,4.)
call SetUnitScale(dagger,1.5,1.5,1.5)call SetUnitPathing(dagger,false)call SetUnitFlyHeight(dagger,50.,.0)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,adddamage)
call SaveInteger(udg_hash,h,5,R2I(dist/ 24))
call SaveReal(udg_hash,h,6,angle)call SaveUnitHandle(udg_hash,h,7,dagger)
call SaveBoolean(udg_hash,h,8,true)call SaveInteger(udg_hash,h,9,alldamage)
call TimerStart(t,.03,true,function Trig_Dagger_Throw_Move_Actions)set caster=nullset target=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Dagger_Throw_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0P2'endfunctionfunction InitTrig_Dagger_Throw takes nothing returns nothing
local integer index=0set gg_trg_Dagger_Throw=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dagger_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dagger_Throw,Condition(function Trig_Dagger_Throw_Conditions))call TriggerAddAction(gg_trg_Dagger_Throw,function Trig_Dagger_Throw_Actions)endfunctionfunction Trig_Kara_Justice_perodic_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamage=LoadGroupHandle(udg_hash,h,2)local group gdamage2=LoadGroupHandle(udg_hash,h,3)local real damage=LoadReal(udg_hash,h,4)
local real angle=LoadReal(udg_hash,h,5)local player p=GetOwningPlayer(caster)local unit Pickedlocal unit targetcall RandomUnitFromGroup(1,gdamage)set Picked=FirstOfGroup(udg_GroupRandomUnitFromGroup)if Picked!=null then
call GroupRemoveUnit(gdamage2,Picked)endifset gdamage=CreateGroup()call GroupToGroup(gdamage2,gdamage)call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveGroupHandle(udg_hash,h,3,gdamage2)if Picked!=null then
call PlaySoundBJ(gg_snd_WardenAttackEffort1)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl",Picked,"head"))
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl",Picked,"chest"))call SetUnitPosition(caster,GetUnitX(Picked)-50.*Cos(angle*bj_DEGTORAD),GetUnitY(Picked)-50.*Sin(angle*bj_DEGTORAD))
call SetUnitAnimation(caster,"stop")
call SetUnitAnimation(caster,"attack")if GetRandomInt(1,'d')<=($A+5*GetUnitAbilityLevel(caster,'A0P3'))and GetUnitAbilityLevel(caster,'A0P3')>0 thencall UnitDamageTarget(caster,Picked,2*damage,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)call CreateTexttag(udg_ColorString[1]+I2S(R2I(2*damage))+"!|r",.022,$FF,GetUnitX(Picked)-18.,GetUnitY(Picked)+15.,.0,.0,.035,3.5)else
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_MELEE,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)endifelse
call SetUnitVertexColor(caster,$FF,$FF,$FF,$FF)call SetUnitTimeScale(caster,1.)
call SetUnitInvulnerable(caster,false)call SetUnitPosition(caster,LoadReal(udg_hash,h,6),LoadReal(udg_hash,h,7))call GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call GroupClear(gdamage2)call DestroyGroup(gdamage2)set gdamage2=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset p=nullset gdamage=null
set gdamage2=nullset Picked=nullset target=nullendfunctionfunction Trig_Kara_Justice_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0P5')
local location loc=GetSpellTargetLoc()local real x=GetLocationX(loc)local real y=GetLocationY(loc)local real damage=75*lvl+(.25+(.75*lvl))*GetHeroAgi(caster,true)
local group g=CreateGroup()local group gdamage=CreateGroup()local group gdamage2=CreateGroup()local timer t=CreateTimer()local integer h=GetHandleId(t)local unit Pickedlocal real angle=bj_RADTODEG*Atan2(y-GetUnitY(caster),x-GetUnitX(caster))call GroupEnumUnitsInRange(g,x,y,500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call GroupAddUnit(gdamage2,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveGroupHandle(udg_hash,h,3,gdamage2)call SaveReal(udg_hash,h,4,damage)call SaveReal(udg_hash,h,5,angle)call SaveReal(udg_hash,h,6,GetUnitX(caster))
call SaveReal(udg_hash,h,7,GetUnitY(caster))
call SetUnitVertexColor(caster,$FF,$FF,$FF,'d')call SetUnitTimeScale(caster,4.)
call SetUnitInvulnerable(caster,true)call UnitPeriodicPostionMove(caster,.03,.2*CountUnitsInGroup(gdamage))call TimerStart(t,.2,true,function Trig_Kara_Justice_perodic_Actions)set caster=nullset p=nullcall RemoveLocation(loc)
set loc=null
set t=nullset g=nullset gdamage=null
set gdamage2=nullendfunctionfunction Trig_Kara_Justice_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0P5'endfunctionfunction InitTrig_Kara_Justice takes nothing returns nothing
local integer index=0set gg_trg_Kara_Justice=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Kara_Justice,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Kara_Justice,Condition(function Trig_Kara_Justice_Conditions))call TriggerAddAction(gg_trg_Kara_Justice,function Trig_Kara_Justice_Actions)endfunctionfunction Trig_Warden_Load_Actions takes nothing returns nothingcall AbilityPreload('A0P0',6)call AbilityPreload('A0P2',6)call AbilityPreload('A0P3',6)call AbilityPreload('A0P5',3)call AbilityPreload('A0P1',6)call AbilityPreload('B051',1)call EffectPreload("Effects\\CosmicTouch.MDX")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl")
call EffectPreload("Effects\\Prismatic Missile Fixed.mdx")call EffectPreload("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl")call EffectPreload("Objects\\Spawnmodels\\Critters\\Albatross\\CritterBloodAlbatross.mdl")call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\BloodElfSpellThiefBlood.mdl")call EnableTrigger(gg_trg_Dash)call EnableTrigger(gg_trg_Dagger_Throw)call EnableTrigger(gg_trg_Kara_Justice)endfunctionfunction InitTrig_Warden_Load takes nothing returns nothingset gg_trg_Warden_Load=CreateTrigger()call TriggerAddAction(gg_trg_Warden_Load,function Trig_SpiritBreaker_Load_Actions)endfunctionfunction Trig_Strength_Fist_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,7)local player p=GetOwningPlayer(caster)local real damage=LoadReal(udg_hash,h,1)
local integer lvl=LoadInteger(udg_hash,h,2)local unit orb=LoadUnitHandle(udg_hash,h,3)local real xt=LoadReal(udg_hash,h,4)
local real yt=LoadReal(udg_hash,h,5)
local group g=CreateGroup()local unit Pickedlocal unit dammi
call GroupEnumUnitsInRange(g,xt,yt,250.,null)call DestroyEffect(AddSpecialEffect("Effects\\RedAftershock.mdx",xt,yt))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl",xt,yt))loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset dammi=CreateUnit(p,'h00U',xt,yt,.0)call UnitApplyTimedLife(dammi,'BTLF',.5)
call UnitAddAbility(dammi,'A0P8')call SetUnitAbilityLevel(dammi,'A0P8',lvl)call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullcall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall KillUnit(orb)call GroupClear(g)call DestroyGroup(g)
set g=nullcall KillUnit(orb)set p=nullcall DestroyTimer(t)
set caster=nullset orb=null
call FlushChildHashtable(udg_hash,h)
set t=nullendfunctionfunction Trig_Strength_Fist_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local integer lvl=GetUnitAbilityLevel(caster,'A0P7')
local real damage=5.+(35.*lvl)+(GetHeroStr(caster,true)*.5*lvl)local player p=GetOwningPlayer(caster)local unit orblocal timer t=CreateTimer()local integer h=GetHandleId(t)set orb=CreateUnit(p,'h00K',xt,yt,270.)call UnitAddAbility(orb,'Amrf')call UnitRemoveAbility(orb,'Amrf')call SetUnitFlyHeight(orb,800.,.0)call SetUnitFlyHeight(orb,25.,1550.)
call SaveReal(udg_hash,h,1,damage)call SaveInteger(udg_hash,h,2,lvl)call SaveUnitHandle(udg_hash,h,3,orb)call SaveReal(udg_hash,h,4,xt)call SaveReal(udg_hash,h,5,yt)call SaveUnitHandle(udg_hash,h,7,caster)
call TimerStart(t,.5,false,function Trig_Strength_Fist_Move_Actions)
set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset p=nullset orb=null
endfunctionfunction Trig_Strength_Fist_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0P7'endfunctionfunction InitTrig_Strength_Fist takes nothing returns nothinglocal integer index=0set gg_trg_Strength_Fist=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Strength_Fist,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Strength_Fist,Condition(function Trig_Strength_Fist_Conditions))
call TriggerAddAction(gg_trg_Strength_Fist,function Trig_Strength_Fist_Actions)endfunctionfunction Trig_Fighting_Impact_14sec_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit target=LoadUnitHandle(udg_hash,h,1)local integer as=LoadInteger(udg_hash,h,2)local integer addarmor=LoadInteger(udg_hash,h,3)
local effect eflocal group g=CreateGroup()local unit Pickedlocal player p=GetOwningPlayer(target)local real damage=LoadReal(udg_hash,GetHandleId(target),$96)
local unit caster=LoadUnitHandle(udg_hash,GetHandleId(target),$97)call DestroyEffect(AddSpecialEffect("Effects\\LightNova.mdl",GetUnitX(target),GetUnitY(target)))
call DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",target,"origin"))call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",Picked,"origin"))call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopcall SetAttackSpeedAbilityLevel(target,-as)set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,5)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h,6)call DestroyEffect(ef)set ef=nullcall SaveReal(udg_hash,GetHandleId(target),$93,.0)call SaveInteger(udg_hash,GetHandleId(target),$94,0)
call SaveTimerHandle(udg_hash,GetHandleId(target),$95,null)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullset ef=nullcall DestroyGroup(g)
set g=nullset Picked=nullset p=nullset caster=nullendfunctionfunction Trig_Fighting_Impact_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer lvl=GetUnitAbilityLevel(caster,'A0P6')
local unit target=GetSpellTargetUnit()local integer as=20*lvl+$Alocal real shield=75.*lvllocal real damage=40*lvl
local effect eflocal timer t=CreateTimer()local integer h=GetHandleId(t)local timer t2local integer h2
local string smainstat=LoadStr(udg_hash,GetUnitTypeId(target),70)if LoadTimerHandle(udg_hash,GetHandleId(target),$95)!=null thenset t2=LoadTimerHandle(udg_hash,GetHandleId(target),$95)
set h2=GetHandleId(t2)set ef=LoadEffectHandle(udg_hash,h2,4)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h2,5)call DestroyEffect(ef)set ef=nullset ef=LoadEffectHandle(udg_hash,h2,6)call DestroyEffect(ef)set ef=nullcall SetAttackSpeedAbilityLevel(target,-LoadInteger(udg_hash,GetHandleId(target),$94))call FlushChildHashtable(udg_hash,h2)call DestroyTimer(t2)set t2=nullendifif smainstat=="str" then
set shield=shield+(.2+.3*lvl*GetHeroStr(target,true))endifif smainstat=="agi" then
set shield=shield+(.2+.3*lvl*GetHeroAgi(target,true))endifif smainstat=="int" then
set shield=shield+(.2+.3*lvl*GetHeroInt(target,true))endifset ef=AddSpecialEffectTarget("Effects\\LifeHigh.mdx",target,"weapon")call SaveEffectHandle(udg_hash,h,5,ef)set ef=nullset ef=AddSpecialEffectTarget("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl",target,"origin")call SaveEffectHandle(udg_hash,h,6,ef)set ef=nullcall SetAttackSpeedAbilityLevel(target,as)call SaveReal(udg_hash,GetHandleId(target),$93,shield)call SaveInteger(udg_hash,GetHandleId(target),$94,as)call SaveTimerHandle(udg_hash,GetHandleId(target),$95,t)
call SaveReal(udg_hash,GetHandleId(target),$96,damage)call SaveUnitHandle(udg_hash,GetHandleId(target),$97,caster)
call SaveUnitHandle(udg_hash,h,1,target)
call SaveInteger(udg_hash,h,2,as)call TimerStart(t,14.,false,function Trig_Fighting_Impact_14sec_Actions)
set caster=nullset ef=nullset t=nullendfunctionfunction Trig_Fighting_Impact_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0P6'endfunctionfunction InitTrig_Fighting_Impact takes nothing returns nothinglocal integer index=0set gg_trg_Fighting_Impact=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fighting_Impact,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fighting_Impact,Condition(function Trig_Fighting_Impact_Conditions))
call TriggerAddAction(gg_trg_Fighting_Impact,function Trig_Fighting_Impact_Actions)endfunctionfunction Trig_Learn_Marshal_Armor_Actions_Timer takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local texttag txt=LoadTextTagHandle(udg_hash,h,2)local real x=GetUnitX(hero)local real y=GetUnitY(hero)local boolean alife=LoadBoolean(udg_hash,h,3)local integer stackif(GetUnitState(hero,UNIT_STATE_LIFE)<.405 and alife)thenset alife=falsecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagVisibility(txt,false)
endifif(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife==false)then
set alife=truecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagVisibility(txt,true)endifif(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife)thenset stack=LoadInteger(udg_hash,GetHandleId(hero),$99)call SetTextTagText(txt,"|cFFDCDC32"+I2S(stack)+"|r|cFF969696/|r|cFFDCDC32"+I2S(5*GetUnitAbilityLevel(hero,'A0P9'))+"|r",.027)call SetTextTagPos(txt,GetUnitX(hero)-40.,GetUnitY(hero)+50.,.0)
endifset t=nullset hero=nullset txt=null
endfunctionfunction Trig_Learn_Marshal_Armor_Actions takes nothing returns nothinglocal integer lvl=GetUnitAbilityLevel(GetLearningUnit(),'A0P9')local timer tlocal integer hlocal texttag txtlocal unit hero=GetLearningUnit()local integer stack=LoadInteger(udg_hash,GetHandleId(hero),$99)if lvl==1 thenset t=CreateTimer()set h=GetHandleId(t)
set txt=CreateTextTag()call SetTextTagText(txt,"|cFFDCDC32"+I2S(stack)+"|r|cFF969696/|r|cFFDCDC32"+I2S(5*GetUnitAbilityLevel(hero,'A0P9'))+"|r",.033)call SetTextTagColor(txt,$FF,$FF,$FF,$FF)call SetTextTagPos(txt,GetUnitX(hero)-40.,GetUnitY(hero)+50.,.0)
call SetTextTagPermanent(txt,true)call SaveUnitHandle(udg_hash,h,1,hero)call SaveTextTagHandle(udg_hash,h,2,txt)
call SaveBoolean(udg_hash,h,3,true)call TimerStart(t,.03,true,function Trig_Learn_Marshal_Armor_Actions_Timer)set t=nullset hero=nullset txt=null
endifset hero=nullendfunctionfunction Trig_Learn_Marshal_Armor_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetLearningUnit())!='h00U' and GetLearnedSkill()=='A0P9'endfunctionfunction InitTrig_Learn_Marshal_Armor takes nothing returns nothinglocal integer index=0set gg_trg_Learn_Marshal_Armor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Marshal_Armor,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Marshal_Armor,Condition(function Trig_Learn_Marshal_Armor_Conditions))
call TriggerAddAction(gg_trg_Learn_Marshal_Armor,function Trig_Learn_Marshal_Armor_Actions)endfunctionfunction Trig_Illusive_Army_Periodic_Damage_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit knight=LoadUnitHandle(udg_hash,h,1)local real wait=LoadReal(udg_hash,h,2)local real damagelocal real stuntimelocal unit casterlocal group gdamagelocal player plocal group glocal unit Pickedset wait=wait-.04call SaveReal(udg_hash,h,2,wait)
if wait>0 thenset damage=LoadReal(udg_hash,h,3)set stuntime=LoadReal(udg_hash,h,4)set caster=LoadUnitHandle(udg_hash,h,5)set g=CreateGroup()set p=GetOwningPlayer(caster)set gdamage=LoadGroupHandle(udg_hash,h,7)call GroupEnumUnitsInRange(g,GetUnitX(knight),GetUnitY(knight),115.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(gdamage,Picked)call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\DivineRage.mdx",Picked,"origin"))call StunUnitTimed(Picked,stuntime)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,7,gdamage)set caster=nullcall DestroyGroup(g)
set g=nullset p=nullset gdamage=null
set Picked=nullelse
call DestroyEffect(AddSpecialEffect("Effects\\DivineRage.mdx",GetUnitX(knight),GetUnitY(knight)))call RemoveUnit(knight)set gdamage=LoadGroupHandle(udg_hash,h,7)call GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset knight=nullset t=nullendfunctionfunction Trig_Illusive_Army_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local real damagelocal real x
local real y
local real angle
local real stuntimelocal player plocal unit knightlocal real xnewlocal real ynewlocal real distlocal timer t2local integer h2
local integer perekluchatellocal integer order=GetUnitCurrentOrder(caster)local integer orderIdset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif wait>0 and order==orderId thenset wait=wait-1call SaveInteger(udg_hash,h,2,wait)set damage=LoadReal(udg_hash,h,3)set x=LoadReal(udg_hash,h,4)
set y=LoadReal(udg_hash,h,5)
set angle=LoadReal(udg_hash,h,8)
set stuntime=LoadReal(udg_hash,h,9)set p=GetOwningPlayer(caster)set perekluchatel=LoadInteger(udg_hash,h,$A)
if perekluchatel>0 thenset perekluchatel=-1
call SaveInteger(udg_hash,h,$A,perekluchatel)else
set perekluchatel=1call SaveInteger(udg_hash,h,$A,perekluchatel)endifset dist=perekluchatel*150.+GetRandomReal(-200.,200.)set xnew=x-200.*Cos(angle*bj_DEGTORAD)set ynew=y-200.*Sin(angle*bj_DEGTORAD)set xnew=xnew+dist*Cos((angle+90.)*bj_DEGTORAD)set ynew=ynew+dist*Sin((angle+90.)*bj_DEGTORAD)call DestroyEffect(AddSpecialEffect("Effects\\DivineRage.mdx",xnew,ynew))set knight=CreateUnit(p,'h00P',xnew,ynew,angle)call SetUnitVertexColor(knight,$FF,$FF,$E1,75)call SetUnitColor(knight,PLAYER_COLOR_YELLOW)call SetUnitAnimationByIndex(knight,0)call MoveUnit(knight,2.,450.,.0,angle,.0,true)set t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,knight)call SaveReal(udg_hash,h2,2,2.01)call SaveReal(udg_hash,h2,3,damage)call SaveReal(udg_hash,h2,4,stuntime)call SaveUnitHandle(udg_hash,h2,5,caster)call SaveGroupHandle(udg_hash,h2,7,CreateGroup())call TimerStart(t2,.04,true,function Trig_Illusive_Army_Periodic_Damage_Actions)
else
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullendfunctionfunction Trig_Illusive_Army_Actions takes nothing returns nothinglocal timer t=CreateTimer()local integer h=GetHandleId(t)local unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0PA')
local real x=GetUnitX(caster)local real y=GetUnitY(caster)local real txlocal real tylocal real stuntime=1.+.5*lvllocal real damage=75.*lvllocal integer count=5+5*lvllocal unit target=GetSpellTargetUnit()local real angle
local location locif target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)call AddProgressBar(caster,195.+(20.*lvl),(1.+.15*lvl),(count*.4),false,true,'u',$FF,$E1,80)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,count)
call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,x)call SaveReal(udg_hash,h,5,y)call SaveReal(udg_hash,h,8,angle)call SaveReal(udg_hash,h,9,stuntime)
call SaveInteger(udg_hash,h,$A,1)call TimerStart(t,.4,true,function Trig_Illusive_Army_Periodic_Actions)set caster=nullset p=nullset t=nullendfunctionfunction Trig_Illusive_Army_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0PA'endfunctionfunction InitTrig_Illusive_Army takes nothing returns nothinglocal integer index=0set gg_trg_Illusive_Army=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Illusive_Army,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Illusive_Army,Condition(function Trig_Illusive_Army_Conditions))
call TriggerAddAction(gg_trg_Illusive_Army,function Trig_Illusive_Army_Actions)endfunctionfunction Trig_Marshal_Load_Actions takes nothing returns nothing
call AbilityPreload('A0P7',6)call AbilityPreload('A0P6',6)call AbilityPreload('A0P9',6)call AbilityPreload('A0PA',3)call UnitPreload('h00K')
call AbilityPreload('A0P8',6)call AbilityPreload('B052',1)call EffectPreload("Effects\\RedAftershock.mdx")
call EffectPreload("Abilities\\Spells\\Orc\\WarStomp\\WarStompCaster.mdl")call EffectPreload("Effects\\LightNova.mdl")
call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodKnight.mdl")call EffectPreload("Effects\\DivineRage.mdx")call EffectPreload("Effects\\LifeHigh.mdx")call EffectPreload("Abilities\\Spells\\Human\\DivineShield\\DivineShieldTarget.mdl")
call EffectPreload("Abilities\\Weapons\\SentinelMissile\\SentinelMissile.mdl")call EnableTrigger(gg_trg_Strength_Fist)
call EnableTrigger(gg_trg_Fighting_Impact)call EnableTrigger(gg_trg_Learn_Marshal_Armor)call EnableTrigger(gg_trg_Illusive_Army)
endfunctionfunction InitTrig_Marshal_Load takes nothing returns nothing
set gg_trg_Marshal_Load=CreateTrigger()call TriggerAddAction(gg_trg_Marshal_Load,function Trig_Marshal_Load_Actions)endfunctionfunction Trig_Remove_Lightning_From_Chain_Lightning_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit Picked=LoadUnitHandle(udg_hash,h,1)local integer wait=LoadInteger(udg_hash,h,2)
local unit damaged=LoadUnitHandle(udg_hash,h,3)local lightning l=LoadLightningHandle(udg_hash,h,4)local location locr=GetUnitLoc(damaged)local location locd=GetUnitLoc(Picked)set wait=wait-1call SaveInteger(udg_hash,h,2,wait)if LoadInteger(udg_hash,h,5)==$E4 thencall MoveLightningEx(l,true,GetUnitX(damaged)+75.*Cos(LoadReal(udg_hash,h,6)*bj_DEGTORAD),GetUnitY(damaged)+75.*Sin(LoadReal(udg_hash,h,6)*bj_DEGTORAD),GetUnitFlyHeight(damaged)+100.+GetLocationZ(locr),GetUnitX(Picked),GetUnitY(Picked),GetUnitFlyHeight(Picked)+25.+GetLocationZ(locd))
else
call MoveLightningEx(l,true,GetUnitX(damaged),GetUnitY(damaged),GetUnitFlyHeight(damaged)+25.+GetLocationZ(locr),GetUnitX(Picked),GetUnitY(Picked),GetUnitFlyHeight(Picked)+25.+GetLocationZ(locd))endifif wait<=0 thencall DestroyLightning(l)
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset Picked=nullset damaged=null
set l=nullcall RemoveLocation(locr)call RemoveLocation(locd)set locr=nullset locd=nullendfunctionfunction Trig_Chain_Lightning_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real damage=LoadReal(udg_hash,h,2)
local unit target=LoadUnitHandle(udg_hash,h,8)local integer count=LoadInteger(udg_hash,h,5)local group gdamage=LoadGroupHandle(udg_hash,h,$E)local unit target2local player p=GetOwningPlayer(caster)local group glocal group grup
local unit Pickedlocal timer t2local integer h2
local boolean first=LoadBoolean(udg_hash,h,$F)local boolean destroy=falselocal location locrlocal lightning llocal location locdif count>0 thenset count=count-1call SaveInteger(udg_hash,h,5,count)
set g=CreateGroup()set grup=CreateGroup()call GroupEnumUnitsInRange(g,GetUnitX(target),GetUnitY(target),500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall RandomUnitFromGroup(1,grup)
call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set target2=FirstOfGroup(udg_GroupRandomUnitFromGroup)if target2!=null thencall DestroyEffect(AddSpecialEffectTarget("Effects\\EMPBomb.mdx",target2,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl",target2,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",target2,"origin"))call UnitDamageTarget(caster,target2,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)
call GroupAddUnit(gdamage,target2)set t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,target2)call SaveInteger(udg_hash,h2,2,$F)call SaveUnitHandle(udg_hash,h2,3,target)set locr=GetUnitLoc(target)set locd=GetUnitLoc(target2)
set l=AddLightningEx("CLPB",true,GetUnitX(target),GetUnitY(target),GetUnitFlyHeight(target)+25.+GetLocationZ(locr),GetUnitX(target2),GetUnitY(target2),GetUnitFlyHeight(target2)+25.+GetLocationZ(locd))
call SaveLightningHandle(udg_hash,h2,4,l)set l=nullcall RemoveLocation(locr)set locr=nullcall RemoveLocation(locd)set locd=nullcall TimerStart(t2,.04,true,function Trig_Remove_Lightning_From_Chain_Lightning_Actions)
set t2=nullcall SaveUnitHandle(udg_hash,h,8,target2)else
set destroy=true
endifcall SaveGroupHandle(udg_hash,h,$E,gdamage)set target2=null
call GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullelse
set destroy=true
endifif destroy thencall GroupClear(gdamage)
call DestroyGroup(gdamage)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset gdamage=null
set t=nullset p=nullset caster=nullset target=nullendfunctionfunction Trig_Chain_Lightning_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local unit target=GetSpellTargetUnit()local integer lvl=GetUnitAbilityLevel(caster,'A0PP')
local real damage=($A+40*lvl)+(GetHeroInt(caster,true)*(.3+.2*lvl))local integer count=8+(lvl*2)-1local timer t=CreateTimer()local integer h=GetHandleId(t)local group gdamage=CreateGroup()local location locrlocal lightning llocal location locdlocal timer t2local integer h2
local real angle=(bj_RADTODEG*Atan2(GetUnitY(target)-GetUnitY(caster),GetUnitX(target)-GetUnitX(caster)))call DestroyEffect(AddSpecialEffectTarget("Effects\\EMPBomb.mdx",target,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl",target,"chest"))
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Bolt\\BoltImpact.mdl",target,"origin"))call UnitDamageTarget(caster,target,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call GroupAddUnit(gdamage,target)set t2=CreateTimer()
set h2=GetHandleId(t2)call SaveUnitHandle(udg_hash,h2,1,target)call SaveInteger(udg_hash,h2,2,$F)call SaveUnitHandle(udg_hash,h2,3,caster)call SaveInteger(udg_hash,h2,5,$E4)call SaveReal(udg_hash,h2,6,angle)set locr=GetUnitLoc(caster)set locd=GetUnitLoc(target)set l=AddLightningEx("CLPB",true,GetUnitX(caster)+75.*Cos(angle*bj_DEGTORAD),GetUnitY(caster)+75.*Sin(angle*bj_DEGTORAD),GetUnitFlyHeight(caster)+100.+GetLocationZ(locr),GetUnitX(target),GetUnitY(target),GetUnitFlyHeight(target)+25.+GetLocationZ(locd))
call SaveLightningHandle(udg_hash,h2,4,l)set l=nullcall RemoveLocation(locr)set locr=nullcall RemoveLocation(locd)set locd=nullcall TimerStart(t2,.04,true,function Trig_Remove_Lightning_From_Chain_Lightning_Actions)
set t2=nullcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,damage)call SaveInteger(udg_hash,h,5,count)
call SaveUnitHandle(udg_hash,h,8,target)
call SaveGroupHandle(udg_hash,h,$E,gdamage)call SaveBoolean(udg_hash,h,$F,true)
call TimerStart(t,.3,true,function Trig_Chain_Lightning_Move_Actions)set caster=nullset t=nullset target=nullset gdamage=null
endfunctionfunction Trig_Chain_Lightning_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0PP'endfunctionfunction InitTrig_Chain_Lightning takes nothing returns nothinglocal integer index=0set gg_trg_Chain_Lightning=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Chain_Lightning,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Chain_Lightning,Condition(function Trig_Chain_Lightning_Conditions))
call TriggerAddAction(gg_trg_Chain_Lightning,function Trig_Chain_Lightning_Actions)endfunctionfunction Trig_Magic_Trap_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local real x=LoadReal(udg_hash,h,2)local real y=LoadReal(udg_hash,h,3)local integer lvl=LoadInteger(udg_hash,h,4)local group gdamage=LoadGroupHandle(udg_hash,h,6)local real damage=LoadReal(udg_hash,h,7)
local integer wait=LoadInteger(udg_hash,h,8)
local integer order=GetUnitCurrentOrder(caster)local unit dammi
local real pxlocal real pylocal integer orderIdlocal group g=CreateGroup()local player p=GetOwningPlayer(caster)local unit Pickedlocal lightning llocal location locclocal location loc=GetUnitLoc(caster)local real distlocal real angle
local real speed
local unit orblocal effect efset orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId and lvl>0 then
set wait=wait+1call SaveInteger(udg_hash,h,8,wait)call GroupAddGroup(gdamage,g)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h000' thenset l=LoadLightningHandle(udg_hash,GetHandleId(Picked),$A3)set locc=GetUnitLoc(Picked)call MoveLightningEx(l,true,x,y,250.+GetLocationZ(loc),GetUnitX(Picked),GetUnitY(Picked),50.+GetLocationZ(locc))
set dist=SquareRoot((x-GetUnitX(Picked))*(x-GetUnitX(Picked))+(y-GetUnitY(Picked))*(y-GetUnitY(Picked)))
set angle=bj_RADTODEG*Atan2(y-GetUnitY(Picked),x-GetUnitX(Picked))set speed=(dist-50)/ 50if speed<=0 then
set speed=.01endifcall SetUnitPosition(Picked,GetUnitX(Picked)+speed*Cos(angle*bj_DEGTORAD),GetUnitY(Picked)+speed*Sin(angle*bj_DEGTORAD))
set l=nullcall RemoveLocation(locc)set locc=nullelse
set l=LoadLightningHandle(udg_hash,GetHandleId(Picked),$A3)call DestroyLightning(l)
set l=nullcall GroupRemoveUnit(gdamage,Picked)
call SaveGroupHandle(udg_hash,h,6,gdamage)endifcall GroupRemoveUnit(g,Picked)endloopelse
call DestroyEffect(AddSpecialEffect("Effects\\MagicStomp.mdx",x,y))loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullif LoadLightningHandle(udg_hash,GetHandleId(Picked),$A3)!=null thenset l=LoadLightningHandle(udg_hash,GetHandleId(Picked),$A3)call DestroyLightning(l)
set l=nullendifcall SaveLightningHandle(udg_hash,GetHandleId(Picked),$A3,null)call SetUnitPathing(Picked,true)
if wait>=66 and GetUnitState(Picked,UNIT_STATE_LIFE)>.405 thencall UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)call DestroyEffect(AddSpecialEffectTarget("Effects\\SoundTrauma.mdx",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Effects\\Fireworksblue.mdx",Picked,"chest"))set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0PN')call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullendifcall GroupRemoveUnit(gdamage,Picked)
endloopset orb=LoadUnitHandle(udg_hash,h,9)
call KillUnit(orb)set ef=LoadEffectHandle(udg_hash,h,$A)call DestroyEffect(ef)set ef=nullset orb=null
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))endifset t=nullset caster=nullcall DestroyGroup(g)
set g=nullset p=nullset Picked=nullcall RemoveLocation(loc)
set loc=null
endfunctionfunction Trig_Magic_Trap_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local integer lvl=GetUnitAbilityLevel(caster,'A0PM')
local location loc=GetSpellTargetLoc()local real tx=GetLocationX(loc)local real ty=GetLocationY(loc)local location locclocal timer t=CreateTimer()local integer h=GetHandleId(t)local real damage=10.+30.*lvllocal real aoe=175.+75.*lvllocal lightning llocal group g=CreateGroup()local player p=GetOwningPlayer(caster)local unit Pickedlocal group gdamage=CreateGroup()local integer wait=0
local unit orb=CreateUnit(p,'h00U',tx,ty,270.)local effect ef=AddSpecialEffectTarget("Effects\\Spirit Orb.mdl",orb,"origin")call UnitAddAbility(orb,'Amrf')call UnitRemoveAbility(orb,'Amrf')call SetUnitFlyHeight(orb,250.,.0)call SetUnitScale(orb,2.+.5*lvl,2.+.5*lvl,2.+.5*lvl)
call GroupEnumUnitsInRange(g,tx,ty,aoe,null)
loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif GetUnitState(Picked,UNIT_STATE_LIFE)>.405 and IsUnitEnemy(Picked,p) and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h000' then
set locc=GetUnitLoc(Picked)set l=AddLightningEx("DRAM",true,tx,ty,250.+GetLocationZ(loc),GetUnitX(Picked),GetUnitY(Picked),50.+GetLocationZ(locc))call SaveLightningHandle(udg_hash,GetHandleId(Picked),$A3,l)
call GroupAddUnit(gdamage,Picked)call SetUnitPathing(Picked,false)set l=nullcall RemoveLocation(locc)set locc=nullendifcall GroupRemoveUnit(g,Picked)endloopcall SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,tx)call SaveReal(udg_hash,h,3,ty)call SaveInteger(udg_hash,h,4,lvl)call SaveGroupHandle(udg_hash,h,6,gdamage)call SaveReal(udg_hash,h,7,damage)call SaveInteger(udg_hash,h,8,wait)call SaveUnitHandle(udg_hash,h,9,orb)call SaveEffectHandle(udg_hash,h,$A,ef)call TimerStart(t,.03,true,function Trig_Magic_Trap_periodic_Actions)call AddProgressBar(caster,260.+(5.*lvl),(.85+.05*lvl),2.,false,true,'u',50,50,$FF)call DestroyGroup(g)
set g=nullset p=nullset Picked=nullset caster=nullset t=nullcall RemoveLocation(loc)
set loc=null
set gdamage=null
set orb=null
set ef=nullendfunctionfunction Trig_Magic_Trap_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0PM'endfunctionfunction InitTrig_Magic_Trap takes nothing returns nothinglocal integer index=0set gg_trg_Magic_Trap=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Magic_Trap,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Magic_Trap,Condition(function Trig_Magic_Trap_Conditions))call TriggerAddAction(gg_trg_Magic_Trap,function Trig_Magic_Trap_Actions)endfunctionfunction Trig_Remove_Lightning_Form_Dead_Units_Actions takes nothing returns nothing
call DestroyLightning(LoadLightningHandle(udg_hash,GetHandleId(GetDyingUnit()),$A3))
call SaveLightningHandle(udg_hash,GetHandleId(GetDyingUnit()),$A3,null)endfunctionfunction Trig_Remove_Lightning_Form_Dead_Units_Conditions takes nothing returns booleanreturn LoadLightningHandle(udg_hash,GetHandleId(GetDyingUnit()),$A3)!=nullendfunctionfunction InitTrig_Remove_Lightning_Form_Dead_Units takes nothing returns nothing
local integer index=0set gg_trg_Remove_Lightning_Form_Dead_Units=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Remove_Lightning_Form_Dead_Units,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Remove_Lightning_Form_Dead_Units,Condition(function Trig_Remove_Lightning_Form_Dead_Units_Conditions))call TriggerAddAction(gg_trg_Remove_Lightning_Form_Dead_Units,function Trig_Remove_Lightning_Form_Dead_Units_Actions)endfunctionfunction Trig_EnergyWave_periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,20)local integer count=LoadInteger(udg_hash,h,21)local real mana=LoadReal(udg_hash,h,22)local integer check=LoadInteger(udg_hash,h,23)local integer lvl=LoadInteger(udg_hash,h,26)
local group gdamage=LoadGroupHandle(udg_hash,h,25)local real manamax=LoadReal(udg_hash,h,27)local real time=LoadReal(udg_hash,h,28)local player p=GetOwningPlayer(caster)local unit arrow
local real axlocal real aylocal real facelocal integer lop=0local effect eflocal real angle
local unit dammi
local string sef
local group g=CreateGroup()local unit Pickedif check<47 then
set check=check+1call SaveInteger(udg_hash,h,23,check)loop
exitwhen lop>=countset arrow=LoadUnitHandle(udg_hash,h,lop)
set face=GetUnitFacing(arrow)set ax=GetUnitX(arrow)+17.*Cos(face*bj_DEGTORAD)
set ay=GetUnitY(arrow)+17.*Sin(face*bj_DEGTORAD)
if IsTerrainPathable(ax,ay,PATHING_TYPE_FLYABILITY)==false thencall SetUnitPosition(arrow,ax,ay)call GroupEnumUnitsInRange(g,ax,ay,100.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h000' thencall GroupAddUnit(gdamage,Picked)set dammi=CreateUnit(p,'h00U',ax,ay,.0)call UnitApplyTimedLife(dammi,'BTLF',.34)call UnitAddAbility(dammi,'A0PK')call SetUnitAbilityLevel(dammi,'A0PK',lvl)call IssueTargetOrderById(dammi,$D02BC,Picked)call RemoveUnitAttack(Picked,time)set angle=bj_RADTODEG*Atan2(GetUnitY(Picked)-GetUnitY(arrow),GetUnitX(Picked)-GetUnitX(arrow))call MoveUnit(Picked,1.5,200.,100.,angle,.0,true)endifif IsUnitAlly(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and GetUnitTypeId(Picked)!='h000' then
call GroupAddUnit(gdamage,Picked)call SetUnitState(Picked,UNIT_STATE_MANA,GetUnitState(Picked,UNIT_STATE_MANA)+mana+GetUnitState(Picked,UNIT_STATE_MAX_MANA)*manamax)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl",Picked,"origin"))
endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullendifset arrow=nullset lop=lop+1endloopelse
loop
exitwhen lop>=countset arrow=LoadUnitHandle(udg_hash,h,lop)
set ef=LoadEffectHandle(udg_hash,h,$A+lop)call KillUnit(arrow)
call DestroyEffect(ef)set arrow=nullset ef=nullset lop=lop+1endloopcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set t=nullendifset t=nullset caster=nullset gdamage=null
set p=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset Picked=nullendfunctionfunction Trig_EnergyWave_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real txlocal real tylocal location loclocal real angle
local real angle1local player p=GetOwningPlayer(caster)local integer lvl=GetUnitAbilityLevel(caster,'A0PJ')
local integer count=lvl+2local integer lop=0local real mana=50*lvllocal real manamax=.05*lvllocal real time=1.+.75*lvllocal unit arrow
local integer check=0local effect eflocal string slocal group gdamage=CreateGroup()local timer t=CreateTimer()local integer h=GetHandleId(t)local boolean perekluchatelangle=falselocal integer counterangle=0
if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=(bj_RADTODEG*Atan2(ty-y,tx-x))
if target==caster thenset angle=GetUnitFacing(caster)endifif count-((count/ 2)*2)==0 thenset angle=angle+6.endifloop
exitwhen lop>=countif perekluchatelangle thenset perekluchatelangle=false
set angle=angle-(counterangle*12.)else
set perekluchatelangle=trueset angle=angle+(counterangle*12.)endifset arrow=CreateUnit(p,'h00U',x,y,angle)
call SetUnitScale(arrow,1.2,1.2,1.2)
call UnitAddAbility(arrow,'Amrf')call UnitRemoveAbility(arrow,'Amrf')
call SetUnitFlyHeight(arrow,10.,.0)set ef=AddSpecialEffectTarget("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl",arrow,"chest")call SaveUnitHandle(udg_hash,h,lop,arrow)call SaveEffectHandle(udg_hash,h,$A+lop,ef)set arrow=nullset ef=nullset lop=lop+1set counterangle=counterangle+1endloopcall SaveUnitHandle(udg_hash,h,20,caster)call SaveInteger(udg_hash,h,21,count)call SaveReal(udg_hash,h,22,mana)call SaveInteger(udg_hash,h,23,check)call SaveGroupHandle(udg_hash,h,25,gdamage)call SaveInteger(udg_hash,h,26,lvl)call SaveReal(udg_hash,h,27,manamax)
call SaveReal(udg_hash,h,28,time)call TimerStart(t,.04,true,function Trig_EnergyWave_periodic_Actions)set caster=nullset target=nullcall RemoveLocation(loc)
set loc=null
set p=nullset gdamage=null
set t=nullendfunctionfunction Trig_EnergyWave_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0PJ'endfunctionfunction InitTrig_EnergyWave takes nothing returns nothinglocal integer index=0set gg_trg_EnergyWave=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_EnergyWave,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_EnergyWave,Condition(function Trig_EnergyWave_Conditions))call TriggerAddAction(gg_trg_EnergyWave,function Trig_EnergyWave_Actions)endfunctionfunction Trig_Magic_Epicenter_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local real damage=LoadReal(udg_hash,h,3)
local real stuntime=LoadReal(udg_hash,h,4)local real aoe=LoadReal(udg_hash,h,5)local unit caster=LoadUnitHandle(udg_hash,h,7)local real x=LoadReal(udg_hash,h,9)local real y=LoadReal(udg_hash,h,$A)
local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal unit dammi=CreateUnit(p,'h00U',x,y,270.)call SetUnitScale(dammi,1.8,1.8,1.8)
call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\NightElf\\NEDeathMedium\\NEDeath.mdl",dammi,"origin"))call DestroyEffect(AddSpecialEffect("Effects\\MagicStomp.mdl",x,y))call KillUnit(dammi)
set dammi=nullcall GroupEnumUnitsInRange(g,x,y,aoe,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Effects\\EMPBomb.mdx",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl",Picked,"origin"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl",Picked,"chest"))call StunUnitTimed(Picked,stuntime)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullset p=nullcall DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
set t=nullset caster=nullendfunctionfunction Trig_Magic_Epicenter_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local integer lvl=GetUnitAbilityLevel(caster,'A0PO')
local integer lvlup=GetUnitAbilityLevel(caster,'A0PW')local real damagelocal real stuntimelocal player p=GetOwningPlayer(caster)local real aoe=300.+50*lvllocal timer t=CreateTimer()local integer h=GetHandleId(t)if lvlup<=0 then
set damage=(-25.+(200.*lvl))+(GetHeroInt(caster,true)*(.5+1.*lvl))set stuntime=2.+(.5*lvl)
endifif lvlup>0 thenset damage=(-25.+(200.*lvlup))+(GetHeroInt(caster,true)*(.5+1.5*lvlup))set stuntime=3.+(.5*lvlup)endifcall DestroyEffectWithWait(AddSpecialEffect("Effects\\IonCannon.mdl",xt,yt),10.)
call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,stuntime)
call SaveReal(udg_hash,h,5,aoe)call SaveUnitHandle(udg_hash,h,7,caster)
call SaveReal(udg_hash,h,9,xt)call SaveReal(udg_hash,h,$A,yt)call TimerStart(t,6.5,false,function Trig_Magic_Epicenter_Move_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset p=nullendfunctionfunction Trig_Magic_Epicenter_Conditions takes nothing returns booleanreturn(GetSpellAbilityId()=='A0PO' or GetSpellAbilityId()=='A0PW')endfunctionfunction InitTrig_Magic_Epicenter takes nothing returns nothinglocal integer index=0set gg_trg_Magic_Epicenter=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Magic_Epicenter,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Magic_Epicenter,Condition(function Trig_Magic_Epicenter_Conditions))
call TriggerAddAction(gg_trg_Magic_Epicenter,function Trig_Magic_Epicenter_Actions)endfunctionfunction Trig_Load_ArchMage_Actions takes nothing returns nothingcall AbilityPreload('A0PP',6)call AbilityPreload('A0PM',6)call AbilityPreload('A0PJ',6)call AbilityPreload('A0PO',3)call AbilityPreload('A0PK',6)call AbilityPreload('A0PN',1)call AbilityPreload('B055',1)call AbilityPreload('B054',1)call EffectPreload("Effects\\EMPBomb.mdx")call EffectPreload("Abilities\\Spells\\Orc\\LightningBolt\\LightningBoltMissile.mdl")call EffectPreload("Effects\\Spirit Orb.mdl")call EffectPreload("Effects\\SoundTrauma.mdx")call EffectPreload("Effects\\Fireworksblue.mdx")
call EffectPreload("Abilities\\Weapons\\WingedSerpentMissile\\WingedSerpentMissile.mdl")
call EffectPreload("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl")
call EffectPreload("Abilities\\Spells\\Human\\ManaFlare\\ManaFlareBoltImpact.mdl")call EffectPreload("Abilities\\Weapons\\DragonHawkMissile\\DragonHawkMissile.mdl")call EffectPreload("Effects\\IonCannon.mdl")
call EffectPreload("Abilities\\Spells\\Other\\Silence\\SilenceTarget.mdl")call EffectPreload("Abilities\\Spells\\Other\\Drain\\ManaDrainCaster.mdl")call EffectPreload("Abilities\\Weapons\\Bolt\\BoltImpact.mdl")call EffectPreload("Objects\\Spawnmodels\\NightElf\\NEDeathMedium\\NEDeath.mdl")
call EffectPreload("Effects\\MagicStomp.mdl")call EnableTrigger(gg_trg_Chain_Lightning)call EnableTrigger(gg_trg_Magic_Trap)call EnableTrigger(gg_trg_Remove_Lightning_Form_Dead_Units)call EnableTrigger(gg_trg_EnergyWave)call EnableTrigger(gg_trg_Magic_Epicenter)endfunctionfunction InitTrig_Load_ArchMage takes nothing returns nothingset gg_trg_Load_ArchMage=CreateTrigger()
call TriggerAddAction(gg_trg_Load_ArchMage,function Trig_Load_ArchMage_Actions)endfunctionfunction Trig_Toxic_Field_Move_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit orblocal effect eflocal real damage=LoadReal(udg_hash,h,3)
local integer armor=LoadInteger(udg_hash,h,4)local integer wait=LoadInteger(udg_hash,h,5)
local unit caster=LoadUnitHandle(udg_hash,h,7)local group gdamage=LoadGroupHandle(udg_hash,h,8)local real x=LoadReal(udg_hash,h,9)local real y=LoadReal(udg_hash,h,$A)
local player p=GetOwningPlayer(caster)local group g=CreateGroup()local group g2=CreateGroup()
local group g3=CreateGroup()
local unit Pickedlocal unit dammi
if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)call GroupAddGroup(gdamage,g3)call GroupEnumUnitsInRange(g,x,y,325.,null)if wait==4 thenset orb=LoadUnitHandle(udg_hash,h,1)
set ef=LoadEffectHandle(udg_hash,h,2)call KillUnit(orb)call DestroyEffect(ef)set ef=nullset orb=null
set orb=CreateUnit(p,'h00U',x,y,GetRandomReal(.0,360.))set ef=AddSpecialEffectTarget("Effects\\ToxicField.mdx",orb,"origin")call SaveUnitHandle(udg_hash,h,1,orb)call SaveEffectHandle(udg_hash,h,2,ef)set orb=null
set ef=nullendifloop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0QE')call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullcall GroupAddUnit(g2,Picked)
call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endlooploop
set Picked=FirstOfGroup(g3)exitwhen Picked==nullif IsUnitInGroup(Picked,g2)==false thencall SetArmorAbilityLevel(Picked,armor)call GroupRemoveUnit(gdamage,Picked)
endifcall GroupRemoveUnit(g3,Picked)endlooploop
set Picked=FirstOfGroup(g2)exitwhen Picked==nullif IsUnitInGroup(Picked,gdamage)==false then
call SetArmorAbilityLevel(Picked,-armor)
call GroupAddUnit(gdamage,Picked)endifcall GroupRemoveUnit(g2,Picked)endloopcall SaveGroupHandle(udg_hash,h,8,gdamage)call TimerStart(t,1.,false,function Trig_Toxic_Field_Move_Actions)else
set orb=LoadUnitHandle(udg_hash,h,1)
set ef=LoadEffectHandle(udg_hash,h,2)call KillUnit(orb)call DestroyEffect(ef)set ef=nullset orb=null
loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullcall SetArmorAbilityLevel(Picked,armor)call GroupRemoveUnit(gdamage,Picked)
endloopcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
call DestroyTimer(t)
call FlushChildHashtable(udg_hash,h)
endifset Picked=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(g2)call DestroyGroup(g2)set g2=nullcall GroupClear(g3)call DestroyGroup(g3)set g3=nullset p=nullset gdamage=null
set t=nullset caster=nullendfunctionfunction Trig_Toxic_Field_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local location loc=GetSpellTargetLoc()local real xt=GetLocationX(loc)local real yt=GetLocationY(loc)local integer lvl=GetUnitAbilityLevel(caster,'A0QD')
local integer wait=8
local real damage=(-20.+(60.*lvl)+GetUnitState(caster,UNIT_STATE_MAX_LIFE)*.03*lvl)/(wait)local integer armor=2+3*lvllocal player p=GetOwningPlayer(caster)local unit orb=CreateUnit(p,'h00U',xt,yt,GetRandomReal(.0,360.))
local effect ef=AddSpecialEffectTarget("Effects\\ToxicField.mdx",orb,"origin")local timer t=CreateTimer()local integer h=GetHandleId(t)local group g=CreateGroup()call SaveUnitHandle(udg_hash,h,1,orb)call SaveEffectHandle(udg_hash,h,2,ef)call SaveReal(udg_hash,h,3,damage)call SaveInteger(udg_hash,h,4,armor)
call SaveInteger(udg_hash,h,5,wait)call SaveUnitHandle(udg_hash,h,7,caster)
call SaveGroupHandle(udg_hash,h,8,g)
call SaveReal(udg_hash,h,9,xt)call SaveReal(udg_hash,h,$A,yt)call TimerStart(t,.0,false,function Trig_Toxic_Field_Move_Actions)set caster=nullcall RemoveLocation(loc)
set loc=null
set t=nullset p=nullset orb=null
set ef=nullset g=nullendfunctionfunction Trig_Toxic_Field_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0QD'endfunctionfunction InitTrig_Toxic_Field takes nothing returns nothinglocal integer index=0set gg_trg_Toxic_Field=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Toxic_Field,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Toxic_Field,Condition(function Trig_Toxic_Field_Conditions))
call TriggerAddAction(gg_trg_Toxic_Field,function Trig_Toxic_Field_Actions)endfunctionfunction Trig_Poison_Bomb_MOVE_Actions takes nothing returns nothing
local timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local unit target=LoadUnitHandle(udg_hash,h,8)local real xload=LoadReal(udg_hash,h,16)
local real yload=LoadReal(udg_hash,h,17)
local integer count=LoadInteger(udg_hash,h,5)local unit orb=LoadUnitHandle(udg_hash,h,6)local unit target2local real stuntimelocal real heallocal group gdamagelocal real heightlocal effect eflocal real x=GetUnitX(orb)local real y=GetUnitY(orb)local real xtlocal real ytlocal real xorblocal real yorblocal real angle
local real distlocal player plocal group glocal group grup
local unit Pickedlocal timer teflocal integer heflocal integer regenlocal boolean remove=falselocal boolean reselect=false
local unit orb2local group gglocal effect ef2
if GetUnitState(target,UNIT_STATE_LIFE)>.405 thenset xt=GetUnitX(target)set yt=GetUnitY(target)else
set xt=xload
set yt=yload
endifset angle=bj_RADTODEG*Atan2((yt-y),(xt-x))set xorb=x+17.*Cos(angle*bj_DEGTORAD)set yorb=y+17.*Sin(angle*bj_DEGTORAD)call SetUnitPosition(orb,xorb,yorb)set dist=SquareRoot((xt-xorb)*(xt-xorb)+(yt-yorb)*(yt-yorb))
call SetUnitFacing(orb,angle)if dist<21. then
call SetUnitPosition(orb,xt,yt)set p=GetOwningPlayer(caster)set stuntime=LoadReal(udg_hash,h,2)set gg=CreateGroup()
call GroupEnumUnitsInRange(gg,xt,yt,150.,null)loop
set Picked=FirstOfGroup(gg)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(target,UNIT_STATE_LIFE)>.0 and IsUnitType(target,UNIT_TYPE_STRUCTURE)==false and IsUnitType(target,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(target)!='h00U' thencall StunUnitTimed(Picked,stuntime)endifcall GroupRemoveUnit(gg,Picked)endloopset count=count-1call SaveInteger(udg_hash,h,5,count)
set reselect=trueset p=nullendifif reselect then
set g=CreateGroup()set grup=CreateGroup()set p=GetOwningPlayer(caster)call GroupEnumUnitsInRange(g,xt,yt,500.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p) and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall GroupAddUnit(grup,Picked)endifcall GroupRemoveUnit(g,Picked)endloopcall RandomUnitFromGroup(1,grup)
call GroupAddGroup(udg_GroupRandomUnitFromGroup,g)set target2=FirstOfGroup(udg_GroupRandomUnitFromGroup)if target2!=null thencall DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\AcidBomb\\BottleMissile.mdl",xt,yt))set x=GetUnitX(orb)set y=GetUnitY(orb)set xt=GetUnitX(target2)
set yt=GetUnitY(target2)
set dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))
set angle=bj_RADTODEG*Atan2((yt-y),(xt-x))set p=GetOwningPlayer(caster)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall RemoveUnit(orb)
set orb2=CreateUnit(p,'h00U',x,y,angle)set ef2=AddSpecialEffectTarget("Abilities\\Spells\\Other\\AcidBomb\\BottleMissile.mdl",orb2,"chest")
call SetUnitScale(orb2,1.5,1.5,1.5)call SaveUnitHandle(udg_hash,h,6,orb2)call SaveEffectHandle(udg_hash,h,7,ef2)call SaveUnitHandle(udg_hash,h,8,target2)call SaveReal(udg_hash,h,9,(dist/ 3))call SaveReal(udg_hash,h,16,xt)call SaveReal(udg_hash,h,17,yt)set p=nullset orb2=nullset ef2=null
else
set remove=trueendifset target2=null
call GroupClear(g)call DestroyGroup(g)
set g=nullcall GroupClear(grup)call DestroyGroup(grup)set grup=nullset gdamage=null
endifif count<=0 then
set remove=trueendifif remove thencall KillUnit(orb)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall GroupClear(g)call DestroyGroup(g)
set g=nullcall DestroyTimer(t)
set Picked=nullcall FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset orb=null
set target=nullendfunctionfunction Trig_Poison_Bomb_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local player p=GetOwningPlayer(caster)local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local location loclocal real xtlocal real ytlocal real angle
local real distlocal integer lvl=GetUnitAbilityLevel(caster,'A0QF')
local real stuntime=4.local integer count=2+(lvl*2)local unit orb=CreateUnit(p,'h00U',x,y,.0)local effect ef=AddSpecialEffectTarget("Abilities\\Spells\\Other\\AcidBomb\\BottleMissile.mdl",orb,"chest")local timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitScale(orb,1.5,1.5,1.5)if target==null then
set loc=GetSpellTargetLoc()set xt=GetLocationX(loc)
set yt=GetLocationY(loc)
else
set xt=GetUnitX(target)set yt=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2((yt-y),(xt-x))set dist=SquareRoot(((xt-x)*(xt-x))+((yt-y)*(yt-y)))
call SetUnitX(orb,x+30.*Cos((angle)*bj_DEGTORAD))call SetUnitY(orb,y+30.*Sin((angle)*bj_DEGTORAD))call SaveUnitHandle(udg_hash,h,1,caster)
call SaveReal(udg_hash,h,2,stuntime)
call SaveInteger(udg_hash,h,5,count)
call SaveUnitHandle(udg_hash,h,6,orb)call SaveEffectHandle(udg_hash,h,7,ef)call SaveUnitHandle(udg_hash,h,8,target)
call SaveReal(udg_hash,h,16,xt)call SaveReal(udg_hash,h,17,yt)call TimerStart(t,.03,true,function Trig_Poison_Bomb_MOVE_Actions)set caster=nullset t=nullset orb=null
set ef=nullset p=nullset target=nullendfunctionfunction Trig_Poison_Bomb_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0QF'endfunctionfunction InitTrig_Poison_Bomb takes nothing returns nothinglocal integer index=0set gg_trg_Poison_Bomb=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Poison_Bomb,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Poison_Bomb,Condition(function Trig_Poison_Bomb_Conditions))
call TriggerAddAction(gg_trg_Poison_Bomb,function Trig_Poison_Bomb_Actions)endfunctionfunction Trig_Learn_Ogre_Rage_Actions_Timer takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local texttag txt=LoadTextTagHandle(udg_hash,h,2)local real x=GetUnitX(hero)local real y=GetUnitY(hero)local boolean alife=LoadBoolean(udg_hash,h,3)local integer hhero=GetHandleId(hero)local integer hpregenold=LoadInteger(udg_hash,hhero,$AE)
local integer asold=LoadInteger(udg_hash,hhero,$AF)local integer lvl=GetUnitAbilityLevel(hero,'A0QG')local integer hpstack=R2I((((GetUnitState(hero,UNIT_STATE_MAX_LIFE)-GetUnitState(hero,UNIT_STATE_LIFE))/ GetUnitState(hero,UNIT_STATE_MAX_LIFE))+.1)*$A)
local integer hpregennew=(1+1*lvl)*hpstacklocal integer asnew=(2+3*lvl)*hpstackif(GetUnitState(hero,UNIT_STATE_LIFE)<.405 and alife)thenset alife=falsecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagVisibility(txt,false)
endifif(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife==false)then
set alife=truecall SaveBoolean(udg_hash,h,3,alife)
call SetTextTagVisibility(txt,true)endifif(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife)thenif hpstack>=6 and LoadBoolean(udg_hash,h,$B0)==false thencall SaveBoolean(udg_hash,h,$B0,true)call AddUnitAnimationProperties(hero,"Alternate",true)call PlaySoundBJ(gg_snd_AlchemistChemicalBurst1)
endifif hpstack<5 and LoadBoolean(udg_hash,h,$B0) thencall SaveBoolean(udg_hash,h,$B0,false)call AddUnitAnimationProperties(hero,"Alternate",false)call PlaySoundBJ(gg_snd_AlchemistMorph1)
endifif hpregennew!=hpregenold thencall SetUnitLifeAndManaRegeneration(hero,"life",(hpregennew-hpregenold))
call SaveInteger(udg_hash,hhero,$AE,hpregennew)endifif asnew!=asold then
call SetAttackSpeedAbilityLevel(hero,(asnew-asold))call SaveInteger(udg_hash,hhero,$AF,asnew)endifcall SetTextTagText(txt,"|cff006400"+I2S(hpstack)+"|r|cFF969696/|r|cff00640010|r",.033)call SetTextTagPos(txt,GetUnitX(hero)-40.,GetUnitY(hero)+50.,.0)
endifset t=nullset hero=nullset txt=null
endfunctionfunction Trig_Learn_Ogre_Rage_Actions takes nothing returns nothinglocal integer lvl=GetUnitAbilityLevel(GetLearningUnit(),'A0QG')local timer tlocal integer hlocal texttag txtlocal unit hero=GetLearningUnit()if lvl==1 thenset t=CreateTimer()set h=GetHandleId(t)
set txt=CreateTextTag()call SetTextTagText(txt,"|cff006400"+I2S(0)+"|r|cFF969696/|r|cff00640010|r",.033)call SetTextTagColor(txt,$FF,$FF,$FF,$FF)call SetTextTagPos(txt,GetUnitX(hero)-40.,GetUnitY(hero)+50.,.0)
call SetTextTagPermanent(txt,true)call SaveUnitHandle(udg_hash,h,1,hero)call SaveTextTagHandle(udg_hash,h,2,txt)
call SaveBoolean(udg_hash,h,3,true)call TimerStart(t,.03,true,function Trig_Learn_Ogre_Rage_Actions_Timer)set t=nullset txt=null
endifset hero=nullendfunctionfunction Trig_Learn_Ogre_Rage_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetLearningUnit())!='h00U' and GetLearnedSkill()=='A0QG'endfunctionfunction InitTrig_Learn_Ogre_Rage takes nothing returns nothinglocal integer index=0set gg_trg_Learn_Ogre_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Ogre_Rage,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Ogre_Rage,Condition(function Trig_Learn_Ogre_Rage_Conditions))
call TriggerAddAction(gg_trg_Learn_Ogre_Rage,function Trig_Learn_Ogre_Rage_Actions)endfunctionfunction Trig_Potion_of_Growth_Periodic_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer str=LoadInteger(udg_hash,h,2)local integer wait=LoadInteger(udg_hash,h,3)
local integer wait2=LoadInteger(udg_hash,h,4)local real percentif wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,3,wait)if wait>=$A then
set percent=(GetUnitState(caster,UNIT_STATE_LIFE)/ GetUnitState(caster,UNIT_STATE_MAX_LIFE))
call SetHeroStr(caster,GetHeroStr(caster,false)+str,true)call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_MAX_LIFE)*percent)call SetUnitScale(caster,.9+(20-wait)*.05,.9+(20-wait)*.05,.9+(20-wait)*.05)
endifelse
if wait2==20 thencall TimerStart(t,.05,true,function Trig_Potion_of_Growth_Periodic_Actions)endifif wait2>0 thenset wait2=wait2-1call SaveInteger(udg_hash,h,4,wait2)
call SetUnitScale(caster,1.4-((20-wait2)*.025),1.4-((20-wait2)*.025),1.4-((20-wait2)*.025))endifif wait2==0 then
set percent=(GetUnitState(caster,UNIT_STATE_LIFE)/ GetUnitState(caster,UNIT_STATE_MAX_LIFE))
call SetHeroStr(caster,GetHeroStr(caster,false)-(str*$A),true)call SetUnitState(caster,UNIT_STATE_LIFE,GetUnitState(caster,UNIT_STATE_MAX_LIFE)*percent)call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl",caster,"origin"))call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifendifset t=nullset caster=nullendfunctionfunction Trig_Potion_of_Growth_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local integer wait=20local integer lvl=GetUnitAbilityLevel(caster,'A0QH')
local integer str=(5+5*lvl)local timer t=CreateTimer()local integer h=GetHandleId(t)call PlaySoundBJ(gg_snd_HeroAlchemistYesAttack1)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveInteger(udg_hash,h,2,str)call SaveInteger(udg_hash,h,3,wait)call SaveInteger(udg_hash,h,4,20)call TimerStart(t,1.,true,function Trig_Potion_of_Growth_Periodic_Actions)set caster=nullset t=nullendfunctionfunction Trig_Potion_of_Growth_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0QH'endfunctionfunction InitTrig_Potion_of_Growth takes nothing returns nothing
local integer index=0set gg_trg_Potion_of_Growth=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Potion_of_Growth,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Potion_of_Growth,Condition(function Trig_Potion_of_Growth_Conditions))call TriggerAddAction(gg_trg_Potion_of_Growth,function Trig_Potion_of_Growth_Actions)endfunctionfunction Trig_Load_Alchemist_Actions takes nothing returns nothingcall AbilityPreload('A0QD',6)call AbilityPreload('A0QF',6)call AbilityPreload('A0QG',6)call AbilityPreload('A0QH',3)call AbilityPreload('A0QE',1)call AbilityPreload('B058',1)call EffectPreload("Effects\\ToxicField.mdx")call EffectPreload("Abilities\\Spells\\Other\\AcidBomb\\BottleMissile.mdl")call EffectPreload("Abilities\\Spells\\NightElf\\ManaBurn\\ManaBurnTarget.mdl")call EffectPreload("Abilities\\Weapons\\PoisonSting\\PoisonStingTarget.mdl")
call EnableTrigger(gg_trg_Toxic_Field)call EnableTrigger(gg_trg_Poison_Bomb)call EnableTrigger(gg_trg_Learn_Ogre_Rage)call EnableTrigger(gg_trg_Potion_of_Growth)endfunctionfunction InitTrig_Load_Alchemist takes nothing returns nothingset gg_trg_Load_Alchemist=CreateTrigger()call TriggerAddAction(gg_trg_Load_Alchemist,function Trig_Load_Alchemist_Actions)endfunctionfunction Trig_Case_Shot_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local group gdamagelocal real damagelocal effect eflocal integer wait=LoadInteger(udg_hash,h,5)
local real angle=LoadReal(udg_hash,h,6)local unit dagger=LoadUnitHandle(udg_hash,h,7)local integer lvllocal real x=GetUnitX(dagger)+40.*Cos((angle)*bj_DEGTORAD)local real y=GetUnitY(dagger)+40.*Sin((angle)*bj_DEGTORAD)local player p=GetOwningPlayer(caster)local group g=CreateGroup()local unit Pickedlocal real distlocal boolean dest=false
local boolean explode=falselocal unit dammi
local real angle2if wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,5,wait)call SetUnitPosition(dagger,x,y)
call GroupEnumUnitsInRange(g,x,y,125.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thenset explode=true
endifcall GroupRemoveUnit(g,Picked)endloopcall GroupClear(g)call DestroyGroup(g)
set g=nullelse
set dest=trueendifif explode thenset dest=trueset gdamage=CreateGroup()set lvl=LoadInteger(udg_hash,h,9)set damage=LoadReal(udg_hash,h,3)call GroupEnumUnitsInRange(gdamage,x,y,300.,null)loop
set Picked=FirstOfGroup(gdamage)
exitwhen Picked==nullif IsUnitEnemy(Picked,p)and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Rifle\\RifleImpact.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GyroCopter\\GyroCopterImpact.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",Picked,"origin"))
set dammi=CreateUnit(p,'h00U',x,y,.0)call UnitApplyTimedLife(dammi,'BTLF',1.)
call UnitAddAbility(dammi,'A0QS')call SetUnitAbilityLevel(dammi,'A0QS',lvl)call IssueTargetOrderById(dammi,$D006B,Picked)set dammi=nullset angle2=bj_RADTODEG*Atan2(GetUnitY(Picked)-y,GetUnitX(Picked)-x)call MoveUnit(Picked,1.,600.,600.,angle2,.0,false)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(gdamage,Picked)
endloopcall GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
endifif dest then
set ef=LoadEffectHandle(udg_hash,h,4)call DestroyEffect(ef)set ef=nullcall DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl",x,y))call KillUnit(dagger)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
endifset t=nullset caster=nullset gdamage=null
set p=nullset Picked=nullset dagger=nullendfunctionfunction Trig_Case_Shot_Actions takes nothing returns nothinglocal unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local integer lvl=GetUnitAbilityLevel(caster,'A0QR')
local real damage=(20.*lvl)+10.local location loclocal real txlocal real tylocal real distlocal unit daggerlocal effect eflocal timer t=CreateTimer()local integer h=GetHandleId(t)if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)set dist=SquareRoot((tx-x)*(tx-x)+(ty-y)*(ty-y))
if target==caster thenset angle=GetUnitFacing(caster)set dist=800.endifset dagger=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,angle)set ef=AddSpecialEffectTarget("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl",dagger,"origin")call SetUnitX(dagger,x+20.*Cos((angle)*bj_DEGTORAD))
call SetUnitY(dagger,y+20.*Sin((angle)*bj_DEGTORAD))
call SetUnitTimeScale(dagger,2.)
call SetUnitScale(dagger,1.5,1.5,1.5)call SetUnitPathing(dagger,false)call SetUnitFlyHeight(dagger,50.,.0)
call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveEffectHandle(udg_hash,h,4,ef)call SaveInteger(udg_hash,h,5,R2I(900./ 40))
call SaveReal(udg_hash,h,6,angle)call SaveUnitHandle(udg_hash,h,7,dagger)
call SaveInteger(udg_hash,h,9,lvl)call TimerStart(t,.03,true,function Trig_Case_Shot_Move_Actions)
set caster=nullset target=nullset gdamage=null
set dagger=nullset ef=nullcall RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Case_Shot_Conditions takes nothing returns boolean
return GetSpellAbilityId()=='A0QR'endfunctionfunction InitTrig_Case_Shot takes nothing returns nothinglocal integer index=0set gg_trg_Case_Shot=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Case_Shot,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Case_Shot,Condition(function Trig_Case_Shot_Conditions))
call TriggerAddAction(gg_trg_Case_Shot,function Trig_Case_Shot_Actions)endfunctionfunction Trig_Learn_Fire_Position_Actions_Timer takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit hero=LoadUnitHandle(udg_hash,h,1)
local real time=LoadReal(udg_hash,h,2)local real x=GetUnitX(hero)local real y=GetUnitY(hero)local boolean alife=LoadBoolean(udg_hash,h,3)local boolean circlego=LoadBoolean(udg_hash,h,4)
local boolean maximum=LoadBoolean(udg_hash,h,9)local real xold=LoadReal(udg_hash,h,5)local real yold=LoadReal(udg_hash,h,6)local real xnewlocal real ynewlocal integer hhero=GetHandleId(hero)local integer attackold=LoadInteger(udg_hash,hhero,$B2)local integer lvl=GetUnitAbilityLevel(hero,'A0QV')local integer attackstacklocal integer attacknewlocal effect eflocal unit dammi
if(GetUnitState(hero,UNIT_STATE_LIFE)>.405 and alife)thenset xnew=GetUnitX(hero)set ynew=GetUnitY(hero)if RAbsBJ(xnew-xold)<125. and RAbsBJ(ynew-yold)<125. thenif time<10. then
set time=time+.1
call SaveReal(udg_hash,h,2,time)
endifif time>=3. then
if circlego==false thenset circlego=truecall SaveBoolean(udg_hash,h,4,circlego)set dammi=CreateUnit(GetOwningPlayer(hero),'h00U',xnew,ynew,.0)call SetUnitScale(dammi,3.,3.,3.)set ef=AddSpecialEffectTarget("Effects\\CircleOutBuff.mdx",dammi,"origin")call SaveEffectHandle(udg_hash,h,7,ef)call SaveUnitHandle(udg_hash,h,$A,dammi)
set ef=nullset dammi=nullcall AddProgressBar(hero,230.,1.1,7.,true,true,'v',$C0,$C0,$C0)endifif maximum==false and time>=10. then
set maximum=true
call SaveBoolean(udg_hash,h,9,maximum)call SaveBoolean(udg_hash,GetHandleId(hero),$B3,true)set ef=AddSpecialEffectTarget("Effects\\Fire Uber.mdx",hero,"weapon")call SaveEffectHandle(udg_hash,h,8,ef)set ef=nullendifset attacknew=(3+2*lvl)*R2I(time-3.)
if attackold!=attacknew then
call SetAttackAbilityLevel(hero,attacknew-attackold)
call SetAttackSpeedAbilityLevel(hero,attacknew-attackold)call SaveInteger(udg_hash,hhero,$B2,attacknew)endifendifelse
set xold=xnewset yold=ynewcall SaveReal(udg_hash,h,5,xold)
call SaveReal(udg_hash,h,6,yold)
if time>=3. then
call SetAttackAbilityLevel(hero,-attackold)call SetAttackSpeedAbilityLevel(hero,-attackold)
call SaveInteger(udg_hash,hhero,$B2,0)if circlego then
set circlego=falsecall SaveBoolean(udg_hash,h,4,circlego)set dammi=LoadUnitHandle(udg_hash,h,$A)set ef=LoadEffectHandle(udg_hash,h,7)call DestroyEffect(ef)set ef=nullcall KillUnit(dammi)
set dammi=nullcall RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(hero),'v'))endifif maximum thenset maximum=falsecall SaveBoolean(udg_hash,h,9,maximum)call SaveBoolean(udg_hash,GetHandleId(hero),$B3,false)set ef=LoadEffectHandle(udg_hash,h,8)call DestroyEffect(ef)set ef=nullendifendifset time=.0call SaveReal(udg_hash,h,2,time)
endifendifset t=nullset hero=nullendfunctionfunction Trig_Learn_Fire_Position_Actions takes nothing returns nothinglocal integer lvl=GetUnitAbilityLevel(GetLearningUnit(),'A0QV')local timer tlocal integer hlocal unit hero=GetLearningUnit()if lvl==1 thenset t=CreateTimer()set h=GetHandleId(t)
call SaveUnitHandle(udg_hash,h,1,hero)call SaveReal(udg_hash,h,2,.0)call SaveBoolean(udg_hash,h,3,true)call SaveBoolean(udg_hash,h,4,false)
call SaveReal(udg_hash,h,5,GetUnitX(hero))call SaveReal(udg_hash,h,6,GetUnitY(hero))call SaveBoolean(udg_hash,h,9,false)
call TimerStart(t,.1,true,function Trig_Learn_Fire_Position_Actions_Timer)set t=nullendifset hero=nullendfunctionfunction Trig_Learn_Fire_Position_Conditions takes nothing returns booleanreturn GetUnitTypeId(GetLearningUnit())!='h00U' and GetLearnedSkill()=='A0QV' and IsUnitIllusion(GetLearningUnit())==falseendfunctionfunction InitTrig_Learn_Fire_Position takes nothing returns nothinglocal integer index=0set gg_trg_Learn_Fire_Position=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Fire_Position,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Fire_Position,Condition(function Trig_Learn_Fire_Position_Conditions))
call TriggerAddAction(gg_trg_Learn_Fire_Position,function Trig_Learn_Fire_Position_Actions)endfunctionfunction Trig_Dwarf_Cannon_Move_Actions takes nothing returns nothinglocal timer t=GetExpiredTimer()local integer h=GetHandleId(t)local unit caster=LoadUnitHandle(udg_hash,h,1)local integer order=GetUnitCurrentOrder(caster)local integer orderIdlocal integer wait1=LoadInteger(udg_hash,h,20)local unit daggerlocal group gdamagelocal real x
local real y
local real angle
local effect eflocal integer wait=LoadInteger(udg_hash,h,19)local player plocal real damagelocal real stuntimelocal group glocal unit Pickedlocal boolean dest=false
set orderId=$D0278if(orderId!=0)thenelse
set orderId=UnitId("channel")if(orderId!=0)thenendifendifif order==orderId and wait1>0 thenset wait1=wait1-1call SaveInteger(udg_hash,h,20,wait1)if wait1==0 then
call SetUnitTimeScale(caster,1.)
set x=LoadReal(udg_hash,h,4)
set y=LoadReal(udg_hash,h,5)
set angle=LoadReal(udg_hash,h,7)
set dagger=CreateUnit(GetOwningPlayer(caster),'h00U',x,y,angle)set ef=AddSpecialEffectTarget("Abilities\\Weapons\\Mortar\\MortarMissile.mdl",dagger,"origin")call SetUnitX(dagger,x+20.*Cos((angle)*bj_DEGTORAD))
call SetUnitY(dagger,y+20.*Sin((angle)*bj_DEGTORAD))
call SetUnitTimeScale(dagger,2.)
call SetUnitScale(dagger,2.,2.,2.)call SetUnitPathing(dagger,false)call SetUnitFlyHeight(dagger,50.,.0)
call SaveUnitHandle(udg_hash,h,$A,dagger)call SaveEffectHandle(udg_hash,h,$B,ef)set ef=nullset dagger=nullcall RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))call SaveBoolean(udg_hash,h,21,true)
endifendifif order!=orderId and wait1>0 and LoadBoolean(udg_hash,h,21)==false then
call SetUnitTimeScale(caster,1.)
call RemoveUnit(LoadUnitHandle(udg_hash,GetHandleId(caster),'u'))set dest=trueendifif LoadBoolean(udg_hash,h,21) and wait>0 thenset wait=wait-1call SaveInteger(udg_hash,h,19,wait)
set angle=LoadReal(udg_hash,h,7)
set dagger=LoadUnitHandle(udg_hash,h,$A)
set gdamage=LoadGroupHandle(udg_hash,h,2)set p=GetOwningPlayer(caster)set damage=LoadReal(udg_hash,h,3)set stuntime=LoadReal(udg_hash,h,6)set g=CreateGroup()call SetUnitPosition(dagger,GetUnitX(dagger)+50.*Cos((angle)*bj_DEGTORAD),GetUnitY(dagger)+50.*Sin((angle)*bj_DEGTORAD))
call GroupEnumUnitsInRange(g,GetUnitX(dagger)+50.*Cos((angle)*bj_DEGTORAD),GetUnitY(dagger)+50.*Sin((angle)*bj_DEGTORAD),200.,null)loop
set Picked=FirstOfGroup(g)exitwhen Picked==nullif IsUnitEnemy(Picked,p)and IsUnitInGroup(Picked,gdamage)==false and GetUnitState(Picked,UNIT_STATE_LIFE)>.0 and IsUnitType(Picked,UNIT_TYPE_STRUCTURE)==false and IsUnitType(Picked,UNIT_TYPE_MAGIC_IMMUNE)==false and GetUnitTypeId(Picked)!='h00U' thencall DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\Rifle\\RifleImpact.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Abilities\\Weapons\\GyroCopter\\GyroCopterImpact.mdl",Picked,"chest"))call DestroyEffect(AddSpecialEffectTarget("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl",Picked,"origin"))
call StunUnitTimed(Picked,stuntime)call GroupAddUnit(gdamage,Picked)call UnitDamageTarget(caster,Picked,damage,false,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_UNKNOWN,WEAPON_TYPE_WHOKNOWS)endifcall GroupRemoveUnit(g,Picked)endloopcall SaveGroupHandle(udg_hash,h,2,gdamage)call GroupClear(g)call DestroyGroup(g)
set g=nullset dagger=nullset gdamage=null
set p=nullendifif LoadBoolean(udg_hash,h,21) and wait<=0 thenset dest=trueendifif dest then
set gdamage=LoadGroupHandle(udg_hash,h,2)call GroupClear(gdamage)
call DestroyGroup(gdamage)set gdamage=null
set dagger=LoadUnitHandle(udg_hash,h,$A)
set ef=LoadEffectHandle(udg_hash,h,$B)call DestroyEffect(ef)set ef=nullcall DestroyEffect(AddSpecialEffect("Abilities\\Weapons\\Mortar\\MortarMissile.mdl",GetUnitX(dagger),GetUnitY(dagger)))call KillUnit(dagger)call FlushChildHashtable(udg_hash,h)
call DestroyTimer(t)
set dagger=nullendifset t=nullset caster=nullendfunctionfunction Trig_Dwarf_Cannon_Actions takes nothing returns nothing
local unit caster=GetSpellAbilityUnit()local real x=GetUnitX(caster)local real y=GetUnitY(caster)local unit target=GetSpellTargetUnit()local real angle
local group gdamage=CreateGroup()local integer lvl=GetUnitAbilityLevel(caster,'A0QU')
local real damage=(150.*lvl)+50.
local real stuntime=1.+1.*lvllocal location loclocal real txlocal real tylocal real distlocal unit daggerlocal timer t=CreateTimer()local integer h=GetHandleId(t)call SetUnitTimeScale(caster,.15)call SetUnitAnimationByIndex(caster,3)if target==null then
set loc=GetSpellTargetLoc()set tx=GetLocationX(loc)
set ty=GetLocationY(loc)
else
set tx=GetUnitX(target)set ty=GetUnitY(target)endifset angle=bj_RADTODEG*Atan2(ty-y,tx-x)call AddProgressBar(caster,200.,1.,1.5,false,true,'u',$C0,$C0,$C0)call SaveUnitHandle(udg_hash,h,1,caster)
call SaveGroupHandle(udg_hash,h,2,gdamage)call SaveReal(udg_hash,h,3,damage)call SaveReal(udg_hash,h,4,x)call SaveReal(udg_hash,h,5,y)call SaveReal(udg_hash,h,6,stuntime)
call SaveReal(udg_hash,h,7,angle)call SaveInteger(udg_hash,h,9,lvl)call SaveInteger(udg_hash,h,19,30)call SaveInteger(udg_hash,h,20,50)call SaveBoolean(udg_hash,h,21,false)call TimerStart(t,.03,true,function Trig_Dwarf_Cannon_Move_Actions)set caster=nullset target=nullset gdamage=null
call RemoveLocation(loc)
set loc=null
set t=nullendfunctionfunction Trig_Dwarf_Cannon_Conditions takes nothing returns booleanreturn GetSpellAbilityId()=='A0QU'endfunctionfunction InitTrig_Dwarf_Cannon takes nothing returns nothing
local integer index=0set gg_trg_Dwarf_Cannon=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dwarf_Cannon,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dwarf_Cannon,Condition(function Trig_Dwarf_Cannon_Conditions))call TriggerAddAction(gg_trg_Dwarf_Cannon,function Trig_Dwarf_Cannon_Actions)endfunctionfunction Trig_Load_Sniper_Actions takes nothing returns nothingcall AbilityPreload('A0QR',6)call AbilityPreload('A0QV',6)call AbilityPreload('A0QT',6)call AbilityPreload('A0QU',3)call AbilityPreload('A0QS',6)call AbilityPreload('B05A',1)call EffectPreload("Abilities\\Weapons\\SteamTank\\SteamTankImpact.mdl")
call EffectPreload("Abilities\\Weapons\\GyroCopter\\GyroCopterMissile.mdl")call EffectPreload("Abilities\\Weapons\\GyroCopter\\GyroCopterImpact.mdl")call EffectPreload("Abilities\\Weapons\\CannonTowerMissile\\CannonTowerMissile.mdl")
call EffectPreload("Abilities\\Weapons\\Rifle\\RifleImpact.mdl")
call EffectPreload("Objects\\Spawnmodels\\Human\\HumanBlood\\HumanBloodPeasant.mdl")
call EffectPreload("Effects\\Fire Uber.mdx")
call EffectPreload("Effects\\CircleOutBuff.mdx")
call EffectPreload("Abilities\\Weapons\\Mortar\\MortarMissile.mdl")call EnableTrigger(gg_trg_Case_Shot)
call EnableTrigger(gg_trg_Learn_Fire_Position)call EnableTrigger(gg_trg_Dwarf_Cannon)endfunctionfunction InitTrig_Load_Sniper takes nothing returns nothingset gg_trg_Load_Sniper=CreateTrigger()call TriggerAddAction(gg_trg_Load_Sniper,function Trig_Load_Sniper_Actions)endfunctionfunction InitCustomTriggers takes nothing returns nothingcall InitTrig_Players_Start_Script()
call InitTrig_InitMap()call InitTrig_InitMapStage2()call InitTrig_System_Spells_Load()call InitTrig_Items_Preload()call InitTrig_Igrok_Massiv_Save()call InitTrig_Load_Vsiakoe()
call InitTrig_Igrok_Massiv_Liver()call InitTrig_Messager()
call InitTrig_Create_TExttags_about_Shops()call InitTrig_InitHashtable()call InitTrig_Save_Sounds()call InitTrig_HandleCounter()call InitTrig_Set_Chlenix()call InitTrig_Set_Energy_Walls()
call InitTrig_Nachalo_Eiti_aren()call InitTrig_HeroDeadonEitiArena()call InitTrig__PortalCheckTop()call InitTrig__PortalCheckBot()call InitTrig_LinkItemsInit()call InitTrig_ItemPickedUp()
call InitTrig_ChargesConnecting()call InitTrig_Remove_Dammi_Items()call InitTrig_Save_Items_Cost()call InitTrig_Ice_Boss()
call InitTrig_Ice_Wall()
call InitTrig_Ice_Storm()call InitTrig_Ice_Rain()
call InitTrig_Cold_Punishment()call InitTrig_Ice_Restoration()call InitTrig_BossStart()call InitTrig_FlameSpells()call InitTrig_Fire_Circle()call InitTrig_Fire_Meteor()call InitTrig_Upgrade_Summons()call InitTrig_UseBeornSpells()call InitTrig_Start_Beorn_Den()call InitTrig_Beorn_Push()call InitTrig_Beorn_Stomp()call InitTrig_HeroUnitGameSave()
call InitTrig_INIT()
call InitTrig_Pick_Hero_Upgrade()call InitTrig_Hero_Dead()call InitTrig_Start_Duel()call InitTrig_Hero_Death_On_Duel()call InitTrig_Timer_Check()call InitTrig_go_mochiytb_portal()call InitTrig_Start_game()call InitTrig_StartWave()call InitTrig_MobsAttackBase()call InitTrig_TeleportStuckedCreeps()call InitTrig_vhodit_v_zony()call InitTrig_Add_Gold_System_Receiving_Gold_for_Creeps()call InitTrig_Init_System_Receiving_Gold_for_Creeps()call InitTrig_Init_System_Receiving_Experience_for_Creeps()call InitTrig_Add_Experience_System_Receiving_Experience_for_Creeps()call InitTrig_Init_Potion_System()call InitTrig_Mob_Dead_Create_Potion()call InitTrig_Check_Potion_Picked_Up()call InitTrig_InitSystem()call InitTrig_EnterUnit()call InitTrig_AddDamage()call InitTrig_TimeTalisman()
call InitTrig_Take_Paladin_Armor()call InitTrig_Take_Archimagus_Staff()call InitTrig_Lost_Charged_Staff_of_Lightning()call InitTrig_Blood_Bow()call InitTrig_Balance_Ring()
call InitTrig_Armageddon_Staff()
call InitTrig_Sargeras_Crown()call InitTrig_Lost_Sargeras_Crown()call InitTrig_Take_Sargeras_Crown()call InitTrig_Lost_Archimagus_Armor()call InitTrig_Take_Archimagus_Armor()call InitTrig_Sorcerers_Talisman_Cast()call InitTrig_Sorcerers_Talisman()call InitTrig_Sorcerers_Talisman_Dead_Unit()
call InitTrig_Orc_Banner()call InitTrig_Devil_Axe()call InitTrig_Devil_Axe_Kill_Unit()call InitTrig_Tokugawas_Katan_Kill_Unit()call InitTrig_Tokugawas_Katan()call InitTrig_Kings_Armor()call InitTrig_Steel_Bib()call InitTrig_Archimagus_Staff()
call InitTrig_Isidors_Scepter()call InitTrig_Detached_Shield_Use()call InitTrig_Cuirass_of_Invulnerable_Use2()
call InitTrig_Lost_Cuirass_of_Invulnerable()
call InitTrig_Take_Cuirass_of_Invulnerable()
call InitTrig_Fire_Staff()call InitTrig_Demon_Axe()call InitTrig_Demon_Axe_Kill_Unit()call InitTrig_Boots_Rescue()
call InitTrig_Astral_Staff()
call InitTrig_Healer_Staff()
call InitTrig_Magic_Amulet()
call InitTrig_Blood_Dagger()
call InitTrig_Agility_Blade()call InitTrig_Bone_Staff_Set_Summon_Ability_Level()call InitTrig_Novice_Amulet()call InitTrig_Glove_of_Andromat()call InitTrig_Glove_of_Midas()call InitTrig_Heroes_more_attacked_priority_when_guards()call InitTrig_Player_Fast_Purchase_System()call InitTrig_Show_hint_abount_hints()call InitTrig_Show_Hint_Abount_Items()call InitTrig_Hint_About_Random()call InitTrig_Show_hint_abount_reference_panel()
call InitTrig_Show_Ability_Learn()call InitTrig_System_Personal_Items_Buy_Item()call InitTrig_System_Personal_Items_Pick_Up_Item()call InitTrig_no_attack()call InitTrig_Select_Refrence_Panel()call InitTrig_ShopAnimation()call InitTrig_ShopStopAnimation()call InitTrig_RedMarkToUnit()call InitTrig_UnSelectedDummyRedMark()call InitTrig_SpecEffect_on_Casters()call InitTrig_PortalSpecEffects()call InitTrig_Gates_Start_Animation()call InitTrig_PlayerEnterGameCommand()call InitTrig_PlayerUseSpellGameCommand()call InitTrig_GuardsExorcistDead()call InitTrig_PauseUnitWhenDefeat()call InitTrig_PauseUnitWhenWin()
call InitTrig_GameEndWin()call InitTrig_Respawn_trees_Init()call InitTrig_Respawn_trees()call InitTrig_Day_Weather()call InitTrig_Sky_Morning()call InitTrig_Sky_Day()call InitTrig_Night_Weather()call InitTrig_Sky_Evening()call InitTrig_Sky_Night()call InitTrig_Lightnings_Weather_Effect_Rainy()call InitTrig_Periodic_Rune_Creation()call InitTrig_Rune_PickedUp()call InitTrig_Initialization_MultiBoard()call InitTrig_Hero_MultiBoard_LvlUp()call InitTrig_Time_Check_and_Player_Gold_for_MultiBoard()call InitTrig_Reincarnation_Skeletons()call InitTrig_BossSkeletRaise()call InitTrig_BossSkeletSkillActiv()
call InitTrig_Fire_Arrow()call InitTrig_Use_UnholyFrenzy_and_Fire_Arrow()call InitTrig_Create_Tombstone()
call InitTrig_ZombieExploadDeath()call InitTrig_Damned_Soul()call InitTrig_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul()
call InitTrig_Throw_Meat()call InitTrig_Earth_Clap()call InitTrig_Ghoul_Jump()call InitTrig_BurrowStrike()
call InitTrig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump()call InitTrig_BeetleCorpseBurrowCast()call InitTrig_BeetleCorpseBurrow()call InitTrig_Cocoon_Creation()call InitTrig_Poisonous_Spittle_Cast()call InitTrig_Holes_Of_Grave_Diggers_Debug_Kill()call InitTrig_Holes_Of_Grave_Diggers_Cast()call InitTrig_Nerub_Spider()
call InitTrig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger()call InitTrig_Damned_Ents_Reincarnation()call InitTrig_Rage_of_Decay()call InitTrig_Use_ThrowStone_and_TurnIntoEnt()call InitTrig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay()call InitTrig_Troll_Dead_Remove_Bugs()call InitTrig_Boss_Troll_Entangle_Throw()call InitTrig_Use_Berserk_and_BerserkBoss()call InitTrig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle()call InitTrig_Aspect_of_Magic_Protection()call InitTrig_Remove_Effects_From_Bosses()call InitTrig_Metka_Dreneev()call InitTrig_Fast_Attack()call InitTrig_Bash_Attack()call InitTrig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack()call InitTrig_Blink_Strike()
call InitTrig_Victim_Search()call InitTrig_Black_Hole()call InitTrig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar()call InitTrig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH()
call InitTrig_Weakness()
call InitTrig_Astral_Dispersal()
call InitTrig_Infernal_Ram()
call InitTrig_Fiery_Blow()call InitTrig_Bloody_Jump()call InitTrig_Blood_Absorption()
call InitTrig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u()call InitTrig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4()call InitTrig_Hatred_of_fire()call InitTrig_set_fire()
call InitTrig_set_fire_2()call InitTrig_the_creation_of_the_image()call InitTrig_fiery_explosions()
call InitTrig_Breathoffire()
call InitTrig_Fire_Explosions()call InitTrig_BossStomp()call InitTrig_Mark_of_Fire()
call InitTrig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire()call InitTrig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp()call InitTrig_Power_of_Skeletons()call InitTrig_Water_Elemental_Load()
call InitTrig_Init_kreeps()call InitTrig_spirits_of_water_dead()call InitTrig_Skill_Gertva()
call InitTrig_Opening_Streams()call InitTrig_Water_Explosion()call InitTrig_Tsunami()call InitTrig_Guardsman_Load()call InitTrig_Protective_Stand_Switch()call InitTrig_Learn_Fighting_Skills()call InitTrig_Ram_Board()call InitTrig_Warcry()call InitTrig_Drenor_Bull_Load()
call InitTrig_Drenor_Bull_Show_Hint()call InitTrig_Drenor_Bull_Show_Rage()call InitTrig_Axe_Throw()call InitTrig_Violent_Roar()
call InitTrig_upgrade_Berserk()call InitTrig_Learn_Spell_Rage()
call InitTrig_GrogTarDead()call InitTrig_attack_hero_Rage()
call InitTrig_kill_hero_Rage()call InitTrig_Sniatie_Rage()
call InitTrig_Timer_Rage()call InitTrig_Illusionist_Load()
call InitTrig_Reflection()call InitTrig_Illusory_Attack()call InitTrig_Summon_Illusions_with_Reflection()
call InitTrig_Illusions_with_Phantoms_Dead()
call InitTrig_BladeMaster_Load()
call InitTrig_Dissection()call InitTrig_Whirlwind()call InitTrig_Imboweling()call InitTrig_Master_of_Lightnings_Load()call InitTrig_Thundercloud()
call InitTrig_Power_of_Lightnings()call InitTrig_Electric_Field()call InitTrig_Storm()call InitTrig_Respawnlol()call InitTrig_Ranger_Load()call InitTrig_MultiShotSwitch()call InitTrig_Learn_Release_of_Arrows()call InitTrig_Release_of_Arrows()call InitTrig_Dexterity_of_the_Ranger()call InitTrig_Healer_Load()call InitTrig_Good_Healing()
call InitTrig_Spiritual_Communication()call InitTrig_Curing_Light()
call InitTrig_Guardian_Angel()call InitTrig_Paladin_Load()
call InitTrig_Spiral_of_Light()call InitTrig_Keeper_Seal()call InitTrig_Light_Hammer()
call InitTrig_God_Hand()
call InitTrig_Stone_Guard_Load()
call InitTrig_Boulder_Throw()call InitTrig_Earth_Shiver()
call InitTrig_Learn_Stone_Armor()call InitTrig_Rock_Strike()call InitTrig_Archdruid_Load()call InitTrig_Energy_of_Nature()
call InitTrig_Life_Chain()call InitTrig_Ent_Creation()
call InitTrig_Nature_Wrath()
call InitTrig_Falling_Star()
call InitTrig_Moon_Chackram()call InitTrig_Moon_Wind()call InitTrig_Night_Heart()call InitTrig_MoonWarrior_Load()
call InitTrig_Ancient_Communication()call InitTrig_Learn_Power_of_Ancestors()
call InitTrig_Switch_Power_of_Ancestors()call InitTrig_Earth_Split()call InitTrig_Ancient_Help()
call InitTrig_SpiritBreaker_Load()call InitTrig_Dash()
call InitTrig_Dagger_Throw()
call InitTrig_Kara_Justice()
call InitTrig_Warden_Load()call InitTrig_Strength_Fist()call InitTrig_Fighting_Impact()call InitTrig_Learn_Marshal_Armor()call InitTrig_Illusive_Army()call InitTrig_Marshal_Load()
call InitTrig_Chain_Lightning()call InitTrig_Magic_Trap()call InitTrig_Remove_Lightning_Form_Dead_Units()
call InitTrig_EnergyWave()call InitTrig_Magic_Epicenter()call InitTrig_Load_ArchMage()call InitTrig_Toxic_Field()call InitTrig_Poison_Bomb()call InitTrig_Learn_Ogre_Rage()call InitTrig_Potion_of_Growth()
call InitTrig_Load_Alchemist()call InitTrig_Case_Shot()call InitTrig_Learn_Fire_Position()call InitTrig_Dwarf_Cannon()
call InitTrig_Load_Sniper()endfunctionfunction RunInitializationTriggers takes nothing returns nothing
call ConditionalTriggerExecute(gg_trg_InitHashtable)
call ConditionalTriggerExecute(gg_trg_InitSystem)call ConditionalTriggerExecute(gg_trg_Init_kreeps)call ConditionalTriggerExecute(gg_trg_Drenor_Bull_Load)endfunctionfunction InitCustomPlayerSlots takes nothing returns nothing
call SetPlayerStartLocation(Player(0),0)
call ForcePlayerStartLocation(Player(0),0)call SetPlayerColor(Player(0),ConvertPlayerColor(0))
call SetPlayerRacePreference(Player(0),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(0),false)call SetPlayerController(Player(0),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(1),1)
call ForcePlayerStartLocation(Player(1),1)call SetPlayerColor(Player(1),ConvertPlayerColor(1))
call SetPlayerRacePreference(Player(1),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(1),false)call SetPlayerController(Player(1),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(2),2)
call ForcePlayerStartLocation(Player(2),2)call SetPlayerColor(Player(2),ConvertPlayerColor(2))
call SetPlayerRacePreference(Player(2),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(2),false)call SetPlayerController(Player(2),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(3),3)
call ForcePlayerStartLocation(Player(3),3)call SetPlayerColor(Player(3),ConvertPlayerColor(3))
call SetPlayerRacePreference(Player(3),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(3),false)call SetPlayerController(Player(3),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(4),4)
call ForcePlayerStartLocation(Player(4),4)call SetPlayerColor(Player(4),ConvertPlayerColor(4))
call SetPlayerRacePreference(Player(4),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(4),false)call SetPlayerController(Player(4),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(5),5)
call ForcePlayerStartLocation(Player(5),5)call SetPlayerColor(Player(5),ConvertPlayerColor(5))
call SetPlayerRacePreference(Player(5),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(5),false)call SetPlayerController(Player(5),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(6),6)
call ForcePlayerStartLocation(Player(6),6)call SetPlayerColor(Player(6),ConvertPlayerColor(6))
call SetPlayerRacePreference(Player(6),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(6),false)call SetPlayerController(Player(6),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(7),7)
call ForcePlayerStartLocation(Player(7),7)call SetPlayerColor(Player(7),ConvertPlayerColor(7))
call SetPlayerRacePreference(Player(7),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(7),false)call SetPlayerController(Player(7),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(8),8)
call ForcePlayerStartLocation(Player(8),8)call SetPlayerColor(Player(8),ConvertPlayerColor(8))
call SetPlayerRacePreference(Player(8),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(8),false)call SetPlayerController(Player(8),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player($B),9)call ForcePlayerStartLocation(Player($B),9)call SetPlayerColor(Player($B),ConvertPlayerColor($B))call SetPlayerRacePreference(Player($B),RACE_PREF_UNDEAD)call SetPlayerRaceSelectable(Player($B),false)call SetPlayerController(Player($B),MAP_CONTROL_COMPUTER)endfunctionfunction InitCustomTeams takes nothing returns nothingcall SetPlayerTeam(Player(0),0)call SetPlayerState(Player(0),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(1),0)call SetPlayerState(Player(1),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(2),0)call SetPlayerState(Player(2),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(3),0)call SetPlayerState(Player(3),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(4),0)call SetPlayerState(Player(4),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(5),0)call SetPlayerState(Player(5),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(6),0)call SetPlayerState(Player(6),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(7),0)call SetPlayerState(Player(7),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(8),0)call SetPlayerState(Player(8),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerAllianceStateAllyBJ(Player(0),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(0),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(1),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(2),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(3),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(4),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(5),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(7),true)call SetPlayerAllianceStateAllyBJ(Player(6),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(7),Player(8),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(0),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(1),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(2),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(3),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(4),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(5),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(6),true)call SetPlayerAllianceStateAllyBJ(Player(8),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(0),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(1),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(2),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(3),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(4),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(5),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(7),true)call SetPlayerAllianceStateVisionBJ(Player(6),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(7),Player(8),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(0),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(1),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(2),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(3),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(4),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(5),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(6),true)call SetPlayerAllianceStateVisionBJ(Player(8),Player(7),true)call SetPlayerTeam(Player($B),1)
call SetPlayerState(Player($B),PLAYER_STATE_ALLIED_VICTORY,1)endfunctionfunction InitAllyPriorities takes nothing returns nothingcall SetStartLocPrioCount(0,8)call SetStartLocPrio(0,0,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,1,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,2,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(1,8)call SetStartLocPrio(1,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,1,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,2,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(2,8)call SetStartLocPrio(2,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,2,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(3,8)call SetStartLocPrio(3,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(4,8)call SetStartLocPrio(4,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(5,8)call SetStartLocPrio(5,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(6,8)call SetStartLocPrio(6,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,5,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(7,8)call SetStartLocPrio(7,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,5,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,6,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(8,8)call SetStartLocPrio(8,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,5,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,6,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,7,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(9,3)call SetStartLocPrio(9,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(9,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(9,2,2,MAP_LOC_PRIO_HIGH)endfunctionfunction main takes nothing returns nothinglocal weathereffect welocal integer ilocal player plocal unit u
local integer unitID
local trigger tlocal real lifelocal integer indexlocal region rectRegioncall SetCameraBounds(-5760.+GetCameraMargin(CAMERA_MARGIN_LEFT),-10624.+GetCameraMargin(CAMERA_MARGIN_BOTTOM),5504.-GetCameraMargin(CAMERA_MARGIN_RIGHT),4480.-GetCameraMargin(CAMERA_MARGIN_TOP),-5760.+GetCameraMargin(CAMERA_MARGIN_LEFT),4480.-GetCameraMargin(CAMERA_MARGIN_TOP),5504.-GetCameraMargin(CAMERA_MARGIN_RIGHT),-10624.+GetCameraMargin(CAMERA_MARGIN_BOTTOM))call SetDayNightModels("Environment\\DNC\\DNCDalaran\\DNCDalaranTerrain\\DNCDalaranTerrain.mdl","Environment\\DNC\\DNCDalaran\\DNCDalaranUnit\\DNCDalaranUnit.mdl")call SetWaterBaseColor(0,$80,0,$FF)call NewSoundEnvironment("Default")call SetAmbientDaySound("FelwoodDay")call SetAmbientNightSound("FelwoodNight")call SetMapMusic("Music",true,0)
set gg_snd_HeroFirelordYesAttack1=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordYesAttack1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordYesAttack1,"HeroFireLordYesAttack")call SetSoundDuration(gg_snd_HeroFirelordYesAttack1,$984)set gg_snd_HeroFirelordYesAttack2=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordYesAttack2.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordYesAttack2,"HeroFireLordYesAttack")call SetSoundDuration(gg_snd_HeroFirelordYesAttack2,$DAF)set gg_snd_HeroFirelordYesAttack3=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordYesAttack3.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordYesAttack3,"HeroFireLordYesAttack")call SetSoundDuration(gg_snd_HeroFirelordYesAttack3,$AD1)set gg_snd_HeroFirelordWarcry1=CreateSound("Units\\Creeps\\HeroFlameLord\\HeroFirelordWarcry1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroFirelordWarcry1,"HeroFireLordWarcry")call SetSoundDuration(gg_snd_HeroFirelordWarcry1,5072)set gg_snd_HeroLichReady1=CreateSound("Units\\Undead\\HeroLich\\HeroLichReady1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichReady1,"HeroLichReady")call SetSoundDuration(gg_snd_HeroLichReady1,4337)set gg_snd_HeroLichYesAttack1=CreateSound("Units\\Undead\\HeroLich\\HeroLichYesAttack1.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichYesAttack1,"HeroLichYesAttack")call SetSoundDuration(gg_snd_HeroLichYesAttack1,$A4C)set gg_snd_HeroLichYesAttack2=CreateSound("Units\\Undead\\HeroLich\\HeroLichYesAttack2.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichYesAttack2,"HeroLichYesAttack")call SetSoundDuration(gg_snd_HeroLichYesAttack2,$9D4)set gg_snd_HeroLichYesAttack3=CreateSound("Units\\Undead\\HeroLich\\HeroLichYesAttack3.wav",false,false,false,$A,$A,"HeroAcksEAX")call SetSoundParamsFromLabel(gg_snd_HeroLichYesAttack3,"HeroLichYesAttack")call SetSoundDuration(gg_snd_HeroLichYesAttack3,$872)set gg_snd_DeathSound1=CreateSound("Units\\Creeps\\Bandit\\BanditYesAttack1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_DeathSound1,"BanditYesAttack")call SetSoundDuration(gg_snd_DeathSound1,$4EE)set gg_snd_KnightNoGold1=CreateSound("Sound\\Interface\\Warning\\Human\\KnightNoGold1.wav",false,false,false,$A,$A,"")call SetSoundParamsFromLabel(gg_snd_KnightNoGold1,"NoGoldHuman")
call SetSoundDuration(gg_snd_KnightNoGold1,$57D)
set gg_snd_KnightInventoryFull1=CreateSound("Sound\\Interface\\Warning\\Human\\KnightInventoryFull1.wav",false,false,false,$A,$A,"")
call SetSoundParamsFromLabel(gg_snd_KnightInventoryFull1,"InventoryFullHuman")call SetSoundDuration(gg_snd_KnightInventoryFull1,$3E8)set gg_snd_HeroStep1=CreateSound("Sound\\Units\\Footsteps\\HeroStep1.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep1,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep1,947)set gg_snd_HeroStep2=CreateSound("Sound\\Units\\Footsteps\\HeroStep2.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep2,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep2,697)set gg_snd_HeroStep3=CreateSound("Sound\\Units\\Footsteps\\HeroStep3.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep3,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep3,599)set gg_snd_HeroStep4=CreateSound("Sound\\Units\\Footsteps\\HeroStep4.wav",false,true,true,$A,$A,"SpellsEAX")
call SetSoundParamsFromLabel(gg_snd_HeroStep4,"HeroCinematicStep")call SetSoundDuration(gg_snd_HeroStep4,$E5)set gg_snd_HuntressYesAttack4=CreateSound("Units\\NightElf\\Huntress\\HuntressYesAttack4.wav",false,false,false,'d',$A,"DefaultEAXON")call SetSoundParamsFromLabel(gg_snd_HuntressYesAttack4,"HuntressYesAttack")call SetSoundDuration(gg_snd_HuntressYesAttack4,$55E)call SetSoundChannel(gg_snd_HuntressYesAttack4,0)set gg_snd_WardenAttackEffort1=CreateSound("Units\\NightElf\\HeroWarden\\WardenAttackEffort1.wav",false,true,true,$A,$A,"CombatSoundsEAX")call SetSoundParamsFromLabel(gg_snd_WardenAttackEffort1,"WardenAttack")call SetSoundDuration(gg_snd_WardenAttackEffort1,$54E)set gg_snd_AlchemistChemicalBurst1=CreateSound("Units\\Creeps\\HEROGoblinALCHEMIST\\AlchemistChemicalBurst1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_AlchemistChemicalBurst1,"GoblinAlchemistMorph")call SetSoundDuration(gg_snd_AlchemistChemicalBurst1,$801)call SetSoundChannel(gg_snd_AlchemistChemicalBurst1,0)set gg_snd_AlchemistMorph1=CreateSound("Units\\Creeps\\HEROGoblinALCHEMIST\\AlchemistMorph1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_AlchemistMorph1,"GoblinAlchemistMorphAlternate")
call SetSoundDuration(gg_snd_AlchemistMorph1,$67F)call SetSoundChannel(gg_snd_AlchemistMorph1,0)set gg_snd_HeroAlchemistYesAttack1=CreateSound("Units\\Creeps\\HEROGoblinALCHEMIST\\HeroAlchemistYesAttack1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(gg_snd_HeroAlchemistYesAttack1,"HEROGoblinALCHEMISTYesAttack")call SetSoundDuration(gg_snd_HeroAlchemistYesAttack1,$942)call SetSoundChannel(gg_snd_HeroAlchemistYesAttack1,0)set gg_rct_Miners_Arena=Rect(-4128.,1952.,-2496.,3904.)set gg_rct_Duel_left=Rect(1216.,2784.,1472.,3040.)set gg_rct_Portal_1_down_left_Start=Rect(-1920.,-9536.,-1536.,-9184.)set gg_rct_Base=Rect(-288.,-7488.,2560.,-4128.)set gg_rct_Portal_baza=Rect(896.,-6016.,1408.,-5408.)set gg_rct_Les_2=Rect(-3616.,-8160.,-512.,320.)set gg_rct_Les_1=Rect(-320.,-10656.,2432.,-7904.)set gg_rct_Pogoda_v_bolote=Rect(3936.,-6944.,5280.,-3296.)set we=AddWeatherEffect(gg_rct_Pogoda_v_bolote,'FDgh')call EnableWeatherEffect(we,true)set gg_rct_cast_magi=Rect(832.,-6112.,1664.,-5312.)set gg_rct_Event_Bonus_Etei_arena_1=Rect(3488.,-256.,5088.,1824.)set gg_rct_Portal_3_up_Start=Rect(1024.,-1120.,1408.,-736.)set gg_rct_Portal_2_down_right_Start=Rect(3392.,-9376.,3744.,-8992.)
set gg_rct_Oblstb_Tavern=Rect(4352.,3360.,5504.,4448.)set gg_rct_Hero_Arena=Rect(1152.,2048.,2944.,3968.)set gg_rct_les_3=Rect(2592.,-7040.,3872.,-1280.)
set gg_rct_Respawn_Heroes=Rect(1056.,-6624.,1408.,-6112.)set gg_rct_Oblast_Teleporta_Arena_Bot=Rect(4224.,-32.,4416.,160.)set gg_rct_Oblast_Teleporta_Arena_Top=Rect(4224.,1408.,4416.,1600.)set gg_rct_6=Rect(-1792.,1888.,544.,3840.)set gg_rct_BaseDopVision=Rect(672.,-4160.,1664.,-3680.)set gg_rct_Center_Vision=Rect(960.,-5760.,1088.,-5632.)set gg_rct_Portal_Attack_Dummy_Left=Rect(-2112.,-9696.,-1952.,-9536.)set gg_rct_Portal_Attack_Dummy_Right=Rect(3584.,-9600.,3744.,-9440.)
set gg_rct_Portal_Attack_Dummy_Top=Rect(1120.,-576.,1280.,-416.)
set gg_rct_Duel_right=Rect(2592.,2784.,2848.,3040.)set gg_rct_PlayableAreaVisionDeBag=Rect(-3680.,-10400.,5504.,4544.)set gg_rct_MinusVision1=Rect(-3712.,800.,-2048.,4640.)set gg_rct_Les1_Dop1=Rect(2400.,-9184.,2912.,-8096.)
set gg_rct_Les1_Dop2=Rect(160.,-7936.,2208.,-7648.)set gg_rct_Beorn_Boss_Area=Rect(800.,-10368.,1952.,-9248.)set gg_rct_Beorn_Boss_Area2=Rect(992.,-10272.,1856.,-9376.)set gg_cam_Kamera_na_taverni=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Kamera_na_taverni,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Kamera_na_taverni,4928.7,3881.5,.0)set gg_cam_Kamera_glavnoi_bazi=CreateCameraSetup()call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_ROLL,.0,.0)
call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Kamera_glavnoi_bazi,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Kamera_glavnoi_bazi,1240.,-6378.1,.0)
set gg_cam_Camera_Eiti_Arena=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Eiti_Arena,4255.9,866.9,.0)set gg_cam_Camera_Eiti_Arena_Top_Portal=CreateCameraSetup()call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ZOFFSET,.0,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Top_Portal,CAMERA_FIELD_FARZ,5000.,.0)
call CameraSetupSetDestPosition(gg_cam_Camera_Eiti_Arena_Top_Portal,4394.2,1237.5,.0)set gg_cam_Camera_Eiti_Arena_Bot_Portal=CreateCameraSetup()call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ZOFFSET,.0,.0)
call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Camera_Eiti_Arena_Bot_Portal,CAMERA_FIELD_FARZ,5000.,.0)
call CameraSetupSetDestPosition(gg_cam_Camera_Eiti_Arena_Bot_Portal,4465.7,342.3,.0)
set gg_cam_Camera_miners_arena=CreateCameraSetup()call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_ROLL,.0,.0)
call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Camera_miners_arena,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_miners_arena,-3311.2,2967.9,.0)set gg_cam_Camera_BossFightStart=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ROTATION,180.9,.0)call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ANGLE_OF_ATTACK,336.5,.0)
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_BossFightStart,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_BossFightStart,-608.2,2881.,.0)set gg_cam_Camera_Duel_Arena=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Duel_Arena,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Duel_Arena,2139.4,2853.8,.0)set gg_cam_Kamera_cast_magi=CreateCameraSetup()call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ZOFFSET,.0,.0)
call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)call CameraSetupSetField(gg_cam_Kamera_cast_magi,CAMERA_FIELD_FARZ,5000.,.0)
call CameraSetupSetDestPosition(gg_cam_Kamera_cast_magi,1268.,-5714.3,.0)set gg_cam_Camera_Beorn_Den1=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ROTATION,233.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ANGLE_OF_ATTACK,299.3,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_TARGET_DISTANCE,1363.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den1,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den1,1384.,-9577.2,.0)set gg_cam_Camera_Beorn_Den2=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ROTATION,297.9,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ANGLE_OF_ATTACK,300.3,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_TARGET_DISTANCE,1363.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den2,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den2,1240.7,-9620.8,.0)set gg_cam_Camera_Beorn_Den3=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ROTATION,110.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ANGLE_OF_ATTACK,300.4,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_TARGET_DISTANCE,1127.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den3,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den3,562.8,-8241.1,.0)set gg_cam_Camera_Beorn_Den4=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ROTATION,110.6,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ANGLE_OF_ATTACK,300.4,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_TARGET_DISTANCE,1127.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den4,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den4,-15.3,-9035.4,.0)set gg_cam_Camera_Beorn_Den5=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den5,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den5,2191.,-8224.1,.0)set gg_cam_Camera_Beorn_Den6=CreateCameraSetup()
call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ZOFFSET,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ROTATION,90.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ANGLE_OF_ATTACK,304.,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_TARGET_DISTANCE,1650.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_ROLL,.0,.0)call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_FIELD_OF_VIEW,70.,.0)
call CameraSetupSetField(gg_cam_Camera_Beorn_Den6,CAMERA_FIELD_FARZ,5000.,.0)call CameraSetupSetDestPosition(gg_cam_Camera_Beorn_Den6,1474.8,-9613.2,.0)set p=Player($F)
set u=CreateUnit(p,'h00S',2144.,-5184.,225.)
set u=CreateUnit(p,'h002',2176.,-5760.,270.)
set u=CreateUnit(p,'h001',2144.,-5312.,225.)
set u=CreateUnit(p,'n004',5120.,4032.,270.)call SetUnitColor(u,ConvertPlayerColor(6))set u=CreateUnit(p,'n002',4736.,4032.,270.)call SetUnitColor(u,ConvertPlayerColor(0))set u=CreateUnit(p,'n005',4928.,3648.,270.)call SetUnitColor(u,ConvertPlayerColor(1))set u=CreateUnit(p,'h003',2176.,-6016.,270.)
set u=CreateUnit(p,'h000',2176.,-5504.,180.)
set u=CreateUnit(p,'h00D',2176.,-6272.,225.)
set u=CreateUnit(p,'h00Y',2176.,-4992.,270.)
set p=Player($F)
set u=CreateUnit(p,'h00I',2651.1,-8998.3,132.101)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',2737.1,-8462.,222.901)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',2208.,-7950.8,240.89)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',1508.5,-7799.1,271.992)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',761.9,-7825.8,270.894)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',108.7,-7927.1,297.652)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',-341.9,-8450.2,346.764)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',-340.3,-9154.9,16.661)
call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',-237.5,-9776.7,2.615)call SetUnitState(u,UNIT_STATE_MANA,$2710)set gg_unit_o003_0027=CreateUnit(p,'o003',1521.1,-5441.2,222.91)
set gg_unit_o003_0028=CreateUnit(p,'o003',1033.8,-5956.6,42.425)
set u=CreateUnit(p,'h00I',1358.5,-9356.4,270.)call SetUnitState(u,UNIT_STATE_MANA,$2710)set u=CreateUnit(p,'h00I',1357.3,-9244.8,270.)call SetUnitState(u,UNIT_STATE_MANA,$2710)set gg_unit_h01K_0100=CreateUnit(p,'h01K',1245.4,-5377.6,270.73)
set gg_unit_n00Y_0101=CreateUnit(p,'n00Y',1589.7,-5683.3,173.645)call SetUnitState(gg_unit_n00Y_0101,UNIT_STATE_MANA,0)set gg_unit_n00Y_0102=CreateUnit(p,'n00Y',939.4,-5689.8,.69)
call SetUnitState(gg_unit_n00Y_0102,UNIT_STATE_MANA,0)set gg_unit_e002_0106=CreateUnit(p,'e002',1007.4,-5428.7,316.082)call SetUnitState(gg_unit_e002_0106,UNIT_STATE_MANA,0)set gg_unit_e002_0108=CreateUnit(p,'e002',1526.5,-5954.4,138.892)call SetUnitState(gg_unit_e002_0108,UNIT_STATE_MANA,0)set gg_unit_h01K_0109=CreateUnit(p,'h01K',1268.,-6027.5,89.41)call InitBlizzard()set i=0set udg_IGRAET=CreateForce()
set udg_Multiboard=CreateMultiboard()set udg_Liver=CreateForce()set udg_Timer_Nomera_Volni=CreateTimer()
set i=0loop
exitwhen(i>1)set udg_Igraet_Igrok[i]=falseset udg_Duel_Igrok[i]=CreateForce()set udg_Heroes_Random_Data[i]=0set udg_Integer_Kolvo_Giznei_EtitArena[i]=0set udg_ColorString[i]=""set udg_Temp_Real[i]=0set udg_Temp_Integer[i]=0set udg_PlayerNumberInMB[i]=0set udg_MutliBoardHeroIcon[i]=""
set udg_MultiBoard_Player_Kills_Count[i]=0set udg_MultiBoard_Player_Deaths_Count[i]=0set udg_MultiBoard_Player_Assist_Count[i]=0set udg_Hero_Respawn_Time[i]=0set udg_Potion_Effect[i]=""set udg_Potion_Type[i]=""set udg_Potion_Heal_Amount[i]=0set udg_Potion_Size[i]=0
set udg_HintsTimerPlayer[i]=CreateTimer()set udg_Hero_Player_Color_String[i]=""set udg_Player_Taken_Damage_Current[i]=0
set udg_Player_Taken_Damage_All[i]=0
set udg_Player_Received_Damage_Current[i]=0set udg_System_ShowAbil_And_Items_Hint[i]=trueset udg_Boolean_Player_Fast_Purchase[i]=falseset udg_Integer_Creep_On_Line_Spawn[i]=0
set udg_Group_Pickeds_Refrence_Panel[i]=CreateGroup()set udg_Is_Player_Fast_Wave_Start[i]=falseset udg_Count_Item_Tips_Message[i]=0
set udg_Rune_On_Base_Dummy_X[i]=0set udg_Rune_On_Base_Dummy_Y[i]=0set udg_Rune_On_Base_Effect_String[i]=""
set udg_Bonus_Gold_ChestGold[i]=0set udg_Temp_Group[i]=CreateGroup()set udg_Is_Rune_On_Position[i]=false
set udg_Rune_Position_X[i]=0
set udg_Rune_Position_Y[i]=0
set udg_Arrow_Pointer_Guide_X[i]=0set udg_Arrow_Pointer_Guide_Y[i]=0set udg_Arrow_Pointer_Guide_Angle[i]=0set udg_EnergyWallX[i]=0
set udg_EnergyWallY[i]=0
set udg_EnergyWallAngle[i]=0
set udg_EnergyWallCount[i]=0
set udg_Is_Player_Got_Randomed[i]=falseset i=i+1endloopset udg_Weave_group=CreateGroup()set udg_Timer_Check_Forkreep_system=CreateTimer()set udg_Gruppa_Igrokov_Vibor_Heroev=CreateForce()set udg_Timer_Eiti_Areni=CreateTimer()set udg_Gruppa_HeroUnitov_Geroev=CreateGroup()set udg_OtriadPortalUnitsEitiArena=CreateGroup()
set udg_DamageGroup=CreateGroup()set udg_DrenorBugaiRageTimer=CreateTimer()set udg_GrogTarRageTimer=CreateTimer()set udg_GroupRandomUnitFromGroup=CreateGroup()set udg_Dialog_Select_Difficult=DialogCreate()set udg_TimerMobsAttackBase=CreateTimer()set udg_Players_Enemy_Group=CreateForce()set udg_Timer_Dialog_Select=CreateTimer()set udg_Players_Ally_Group=CreateForce()
set udg_MultiBoard=CreateMultiboard()set udg_PlayerGroup=CreateForce()set udg_ttt=CreateTimer()set udg_PortalCastersMagi=CreateGroup()set udg_InitMapTimer=CreateTimer()set udg_Drenor_Bull_Hint_Player_Group=CreateForce()set udg_TimerShowAndFlushAllPlayerDmg=CreateTimer()set udg_Timer_Lightning_Strike_Weather=CreateTimer()
set udg_Timer_Hint_About_Fast_Start=CreateTimer()set udg_Timer_Arrow_Pointer_Guide=CreateTimer()set udg_gdamageallnew=CreateGroup()set gg_trg_Players_Start_Script=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Players_Start_Script,2.)
call TriggerAddAction(gg_trg_Players_Start_Script,function Trig_Players_Start_Script_Actions)set gg_trg_InitMap=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_InitMap,.0)call TriggerAddAction(gg_trg_InitMap,function Trig_InitMap_Actions)set gg_trg_InitMapStage2=CreateTrigger()
call TriggerRegisterTimerExpireEvent(gg_trg_InitMapStage2,udg_InitMapTimer)call TriggerAddAction(gg_trg_InitMapStage2,function Trig_InitMapStage2_Actions)set gg_trg_System_Spells_Load=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_System_Spells_Load,2.,false)call TriggerAddAction(gg_trg_System_Spells_Load,function Trig_System_Spells_Load_Actions)set gg_trg_Items_Preload=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Items_Preload,17.,false)call TriggerAddAction(gg_trg_Items_Preload,function Trig_Items_Preload_Actions)set gg_trg_Igrok_Massiv_Save=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Igrok_Massiv_Save,.0)call TriggerAddAction(gg_trg_Igrok_Massiv_Save,function Trig_Igrok_Massiv_Save_Actions)set gg_trg_Load_Vsiakoe=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Load_Vsiakoe,2.)
call TriggerAddAction(gg_trg_Load_Vsiakoe,function Trig_Load_Vsiakoe_Actions)set gg_trg_Igrok_Massiv_Liver=CreateTrigger()call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(0))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(1))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(2))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(3))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(4))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(5))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(6))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(7))call TriggerRegisterPlayerEventLeave(gg_trg_Igrok_Massiv_Liver,Player(8))call TriggerAddAction(gg_trg_Igrok_Massiv_Liver,function Trig_Igrok_Massiv_Liver_Actions)set gg_trg_Messager=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Messager,8.)
call TriggerAddAction(gg_trg_Messager,function Trig_Messager_Actions)set gg_trg_Create_TExttags_about_Shops=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Create_TExttags_about_Shops,9.)call TriggerAddAction(gg_trg_Create_TExttags_about_Shops,function Trig_Create_TExttags_about_Shops_Actions)set gg_trg_InitHashtable=CreateTrigger()
call TriggerAddAction(gg_trg_InitHashtable,function Trig_InitHashtable_Actions)set gg_trg_Save_Sounds=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Save_Sounds,5.,false)call TriggerAddAction(gg_trg_Save_Sounds,function Trig_Save_Sounds_Actions)call TimerStart(CreateTimer(),0,false,function HandleCounter_Actions)set gg_trg_Set_Chlenix=CreateTrigger()call TriggerRegisterPlayerChatEvent(gg_trg_Set_Chlenix,Player(0),"-chlenix",false)call TriggerAddAction(gg_trg_Set_Chlenix,function Trig_Set_Chlenix_Actions)set gg_trg_Set_Energy_Walls=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Set_Energy_Walls,5.)
call TriggerAddAction(gg_trg_Set_Energy_Walls,function Trig_Set_Energy_Walls_Actions)set gg_trg_Nachalo_Eiti_aren=CreateTrigger()
call TriggerAddAction(gg_trg_Nachalo_Eiti_aren,function Trig_Nachalo_Eiti_aren_Actions)set index=0set gg_trg_HeroDeadonEitiArena=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_HeroDeadonEitiArena,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_HeroDeadonEitiArena,Condition(function Trig_HeroDeadonEitiArena_Conditions))
call TriggerAddAction(gg_trg_HeroDeadonEitiArena,function Trig_HeroDeadonEitiArena_Actions)set rectRegion=CreateRegion()set gg_trg__PortalCheckTop=CreateTrigger()call RegionAddRect(rectRegion,gg_rct_Oblast_Teleporta_Arena_Top)
call TriggerRegisterEnterRegion(gg_trg__PortalCheckTop,rectRegion,null)call TriggerAddCondition(gg_trg__PortalCheckTop,Condition(function Trig__PortalCheckTop_Conditions))
call TriggerAddAction(gg_trg__PortalCheckTop,function Trig__PortalCheckTop_Actions)set rectRegion=CreateRegion()set gg_trg__PortalCheckBot=CreateTrigger()call RegionAddRect(rectRegion,gg_rct_Oblast_Teleporta_Arena_Bot)
call TriggerRegisterEnterRegion(gg_trg__PortalCheckBot,rectRegion,null)call TriggerAddCondition(gg_trg__PortalCheckBot,Condition(function Trig__PortalCheckBot_Conditions))
call TriggerAddAction(gg_trg__PortalCheckBot,function Trig__PortalCheckBot_Actions)set gg_trg_LinkItemsInit=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_LinkItemsInit,6.,false)call TriggerAddAction(gg_trg_LinkItemsInit,function Trig_LinkItemsInit_Actions)set index=0set gg_trg_ItemPickedUp=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ItemPickedUp,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_ItemPickedUp,function Trig_ItemPickedUp_Actions)set gg_trg_ChargesConnecting=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_ChargesConnecting,EVENT_PLAYER_UNIT_PICKUP_ITEM)call TriggerAddCondition(gg_trg_ChargesConnecting,Condition(function Trig_ChargesConnecting_Conditions))
call TriggerAddAction(gg_trg_ChargesConnecting,function Trig_ChargesConnecting_Actions)set gg_trg_Remove_Dammi_Items=CreateTrigger()call DisableTrigger(gg_trg_Remove_Dammi_Items)call TriggerRegisterAnyUnitEventBJ(gg_trg_Remove_Dammi_Items,EVENT_PLAYER_UNIT_PICKUP_ITEM)call TriggerAddCondition(gg_trg_Remove_Dammi_Items,Condition(function Trig_Remove_Dammi_Items_Conditions))call TriggerAddAction(gg_trg_Remove_Dammi_Items,function Trig_Remove_Dammi_Items_Actions)set gg_trg_Save_Items_Cost=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Save_Items_Cost,10.,false)
call TriggerAddAction(gg_trg_Save_Items_Cost,function Trig_Save_Items_Cost_Actions)set gg_trg_Ice_Boss=CreateTrigger()call TriggerAddAction(gg_trg_Ice_Boss,function Trig_IceBoss_Actions)
set index=0set gg_trg_Ice_Wall=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Wall,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Wall,Condition(function Trig_Ice_Wall_Conditions))call TriggerAddAction(gg_trg_Ice_Wall,function Trig_Ice_Wall_Actions)set index=0set gg_trg_Ice_Storm=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Storm,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Storm,Condition(function Trig_Ice_Storm_Conditions))
call TriggerAddAction(gg_trg_Ice_Storm,function Trig_Ice_Storm_Actions)set index=0set gg_trg_Ice_Rain=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Rain,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Rain,Condition(function Trig_Ice_Rain_Conditions))call TriggerAddAction(gg_trg_Ice_Rain,function Trig_Ice_Rain_Actions)set index=0set gg_trg_Cold_Punishment=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Cold_Punishment,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Cold_Punishment,Condition(function Trig_Cold_Punishment_Conditions))
call TriggerAddAction(gg_trg_Cold_Punishment,function Trig_Cold_Punishment_Actions)set index=0set gg_trg_Ice_Restoration=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ice_Restoration,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ice_Restoration,Condition(function Trig_Ice_Restoration_Conditions))
call TriggerAddAction(gg_trg_Ice_Restoration,function Trig_Ice_Restoration_Actions)set gg_trg_BossStart=CreateTrigger()
call TriggerAddAction(gg_trg_BossStart,function Trig_BossStart_Actions)set index=0set gg_trg_FlameSpells=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_FlameSpells,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_FlameSpells,Condition(function Trig_FlameSpells_Conditions))
call TriggerAddAction(gg_trg_FlameSpells,function Trig_FlameSpells_Actions)set index=0set gg_trg_Fire_Circle=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Circle,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Circle,Condition(function Trig_Fire_Circle_Conditions))
call TriggerAddAction(gg_trg_Fire_Circle,function Trig_Fire_Circle_Actions)set index=0set gg_trg_Fire_Meteor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Meteor,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Meteor,Condition(function Trig_Fire_Meteor_Conditions))
call TriggerAddAction(gg_trg_Fire_Meteor,function Trig_Fire_Meteor_Actions)set rectRegion=CreateRegion()set gg_trg_Upgrade_Summons=CreateTrigger()call RegionAddRect(rectRegion,gg_rct_6)call TriggerRegisterEnterRegion(gg_trg_Upgrade_Summons,rectRegion,null)call TriggerAddCondition(gg_trg_Upgrade_Summons,Condition(function Trig_Upgrade_Summons_Conditions))
call TriggerAddAction(gg_trg_Upgrade_Summons,function Trig_Upgrade_Summons_Actions)set gg_trg_UseBeornSpells=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_UseBeornSpells,1.,true)call TriggerAddAction(gg_trg_UseBeornSpells,function Trig_UseBeornSpells_Actions)set gg_trg_Start_Beorn_Den=CreateTrigger()call TriggerAddAction(gg_trg_Start_Beorn_Den,function Trig_Start_Beorn_Den_Actions)set index=0set gg_trg_Beorn_Push=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Beorn_Push,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Beorn_Push,Condition(function Trig_Beorn_Push_Conditions))call TriggerAddAction(gg_trg_Beorn_Push,function Trig_Beorn_Push_Actions)set index=0set gg_trg_Beorn_Stomp=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Beorn_Stomp,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Beorn_Stomp,Condition(function Trig_Beorn_Stomp_Conditions))
call TriggerAddAction(gg_trg_Beorn_Stomp,function Trig_Beorn_Stomp_Actions)set gg_trg_HeroUnitGameSave=CreateTrigger()call TriggerRegisterEnterRectSimple(gg_trg_HeroUnitGameSave,gg_rct_Oblstb_Tavern)call TriggerAddAction(gg_trg_HeroUnitGameSave,function Trig_HeroUnitGameSave_Actions)set gg_trg_INIT=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_INIT,1.)
call TriggerAddAction(gg_trg_INIT,function Trig_INIT_Actions)set index=0set gg_trg_Pick_Hero_Upgrade=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Pick_Hero_Upgrade,Player(index),EVENT_PLAYER_UNIT_SELL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Pick_Hero_Upgrade,Condition(function Trig_Pick_Hero_Upgrade_Conditions))
call TriggerAddAction(gg_trg_Pick_Hero_Upgrade,function Trig_Pick_Hero_Upgrade_Actions)set index=0set gg_trg_Hero_Dead=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Hero_Dead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Hero_Dead,Condition(function Trig_Hero_Dead_Conditions))
call TriggerAddAction(gg_trg_Hero_Dead,function Trig_Hero_Dead_Actions)set gg_trg_Start_Duel=CreateTrigger()call TriggerAddAction(gg_trg_Start_Duel,function Trig_Start_Duel_Actions)set index=0set gg_trg_Hero_Death_On_Duel=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Hero_Death_On_Duel,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Hero_Death_On_Duel,Condition(function Trig_Hero_Death_On_Duel_Conditions))call TriggerAddAction(gg_trg_Hero_Death_On_Duel,function Trig_Hero_Death_On_Duel_Actions)set gg_trg_Timer_Check=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_Timer_Check,udg_Timer_Check_Forkreep_system)
call TriggerAddAction(gg_trg_Timer_Check,function Trig_Timer_Check_Actions)set gg_trg_go_mochiytb_portal=CreateTrigger()call DisableTrigger(gg_trg_go_mochiytb_portal)call TriggerRegisterTimerEvent(gg_trg_go_mochiytb_portal,2.,true)call TriggerAddAction(gg_trg_go_mochiytb_portal,function Trig_go_mochiytb_portal_Actions)set gg_trg_Start_game=CreateTrigger()call TriggerAddAction(gg_trg_Start_game,function Trig_Start_game_Actions)set gg_trg_StartWave=CreateTrigger()
call TriggerRegisterTimerExpireEvent(gg_trg_StartWave,udg_Timer_Nomera_Volni)call TriggerAddAction(gg_trg_StartWave,function Trig_StartWave_Actions)set gg_trg_MobsAttackBase=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_MobsAttackBase,udg_TimerMobsAttackBase)call TriggerAddAction(gg_trg_MobsAttackBase,function Trig_MobsAttackBase_Actions)set gg_trg_TeleportStuckedCreeps=CreateTrigger()
call DisableTrigger(gg_trg_TeleportStuckedCreeps)call TriggerRegisterTimerEvent(gg_trg_TeleportStuckedCreeps,2.,true)
call TriggerAddAction(gg_trg_TeleportStuckedCreeps,function Trig_TeleportStuckedCreeps_Actions)set rectRegion=CreateRegion()set gg_trg_vhodit_v_zony=CreateTrigger()
call RegionAddRect(rectRegion,gg_rct_cast_magi)call TriggerRegisterEnterRegion(gg_trg_vhodit_v_zony,rectRegion,null)call TriggerAddCondition(gg_trg_vhodit_v_zony,Condition(function Trig_vhodit_v_zony_Conditions))
call TriggerAddAction(gg_trg_vhodit_v_zony,function Trig_vhodit_v_zony_Actions)set index=0set gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps,Condition(function Trig_Add_Gold_System_Receiving_Gold_for_Creeps_Conditions))
call TriggerAddAction(gg_trg_Add_Gold_System_Receiving_Gold_for_Creeps,function Trig_Add_Gold_System_Receiving_Gold_for_Creeps_Actions)set gg_trg_Init_System_Receiving_Gold_for_Creeps=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Init_System_Receiving_Gold_for_Creeps,3.,false)call TriggerAddAction(gg_trg_Init_System_Receiving_Gold_for_Creeps,function Trig_Init_System_Receiving_Gold_for_Creeps_Actions)set gg_trg_Init_System_Receiving_Experience_for_Creeps=CreateTrigger()call TriggerAddAction(gg_trg_Init_System_Receiving_Experience_for_Creeps,function Trig_Init_System_Receiving_Experience_for_Creeps_Actions)set index=0set gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps,Condition(function Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Conditions))
call TriggerAddAction(gg_trg_Add_Experience_System_Receiving_Experience_for_Creeps,function Trig_Add_Experience_System_Receiving_Experience_for_Creeps_Actions)set gg_trg_Init_Potion_System=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Init_Potion_System,1.,false)call TriggerAddAction(gg_trg_Init_Potion_System,function Trig_Init_Potion_System_Actions)set index=0set gg_trg_Mob_Dead_Create_Potion=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Mob_Dead_Create_Potion,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Mob_Dead_Create_Potion,Condition(function Trig_Mob_Dead_Create_Potion_Conditions))call TriggerAddAction(gg_trg_Mob_Dead_Create_Potion,function Trig_Mob_Dead_Create_Potion_Actions)set gg_trg_Check_Potion_Picked_Up=CreateTrigger()call TriggerAddCondition(gg_trg_Check_Potion_Picked_Up,Condition(function Trig_Check_Potion_Picked_Up_Conditions))call TriggerAddAction(gg_trg_Check_Potion_Picked_Up,function Trig_Check_Potion_Picked_Up_Actions)set gg_trg_InitSystem=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_InitSystem,.01,false)call TriggerAddAction(gg_trg_InitSystem,function Trig_InitSystem_Actions)set rectRegion=CreateRegion()set gg_trg_EnterUnit=CreateTrigger()
call RegionAddRect(rectRegion,GetWorldBounds())call TriggerRegisterEnterRegion(gg_trg_EnterUnit,rectRegion,null)call TriggerAddCondition(gg_trg_EnterUnit,Condition(function Trig_EnterUnit_Conditions))
call TriggerAddAction(gg_trg_EnterUnit,function Trig_EnterUnit_Actions)set gg_trg_AddDamage=CreateTrigger()
call TriggerAddCondition(gg_trg_AddDamage,Condition(function Trig_Del_Conditions))call TriggerAddAction(gg_trg_AddDamage,function Trig_AddDamage_Actions)set index=0set gg_trg_TimeTalisman=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_TimeTalisman,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_TimeTalisman,Condition(function Trig_TimeTalisman_Conditions))call TriggerAddAction(gg_trg_TimeTalisman,function Trig_TimeTalisman_Actions)set index=0set gg_trg_Take_Paladin_Armor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Paladin_Armor,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Paladin_Armor,Condition(function Trig_Take_Paladin_Armor_Conditions))call TriggerAddAction(gg_trg_Take_Paladin_Armor,function Trig_Take_Paladin_Armor_Actions)set index=0set gg_trg_Take_Archimagus_Staff=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Archimagus_Staff,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Archimagus_Staff,Condition(function Trig_Take_Archimagus_Staff_Conditions))
call TriggerAddAction(gg_trg_Take_Archimagus_Staff,function Trig_Take_Archimagus_Staff_Actions)set index=0set gg_trg_Lost_Charged_Staff_of_Lightning=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Charged_Staff_of_Lightning,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Charged_Staff_of_Lightning,Condition(function Trig_Lost_Charged_Staff_of_Lightning_Conditions))
call TriggerAddAction(gg_trg_Lost_Charged_Staff_of_Lightning,function Trig_Lost_Charged_Staff_of_Lightning_Actions)set index=0set gg_trg_Blood_Bow=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blood_Bow,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blood_Bow,Condition(function Trig_Blood_Bow_Conditions))
call TriggerAddAction(gg_trg_Blood_Bow,function Trig_Blood_Bow_Actions)set index=0set gg_trg_Balance_Ring=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Balance_Ring,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Balance_Ring,Condition(function Trig_Balance_Ring_Conditions))call TriggerAddAction(gg_trg_Balance_Ring,function Trig_Balance_Ring_Actions)set index=0set gg_trg_Armageddon_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Armageddon_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Armageddon_Staff,Condition(function Trig_Armageddon_Staff_Conditions))call TriggerAddAction(gg_trg_Armageddon_Staff,function Trig_Armageddon_Staff_Actions)set index=0set gg_trg_Sargeras_Crown=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sargeras_Crown,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sargeras_Crown,Condition(function Trig_Sargeras_Crown_Conditions))call TriggerAddAction(gg_trg_Sargeras_Crown,function Trig_Sargeras_Crown_Actions)set index=0set gg_trg_Lost_Sargeras_Crown=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Sargeras_Crown,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Sargeras_Crown,Condition(function Trig_Lost_Sargeras_Crown_Conditions))
call TriggerAddAction(gg_trg_Lost_Sargeras_Crown,function Trig_Lost_Sargeras_Crown_Actions)set index=0set gg_trg_Take_Sargeras_Crown=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Sargeras_Crown,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Sargeras_Crown,Condition(function Trig_Take_Sargeras_Crown_Conditions))
call TriggerAddAction(gg_trg_Take_Sargeras_Crown,function Trig_Take_Sargeras_Crown_Actions)set index=0set gg_trg_Lost_Archimagus_Armor=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Archimagus_Armor,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Archimagus_Armor,Condition(function Trig_Lost_Archimagus_Armor_Conditions))
call TriggerAddAction(gg_trg_Lost_Archimagus_Armor,function Trig_Lost_Archimagus_Armor_Actions)set index=0set gg_trg_Take_Archimagus_Armor=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Archimagus_Armor,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Archimagus_Armor,Condition(function Trig_Take_Archimagus_Armor_Conditions))
call TriggerAddAction(gg_trg_Take_Archimagus_Armor,function Trig_Take_Archimagus_Armor_Actions)set index=0set gg_trg_Sorcerers_Talisman_Cast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sorcerers_Talisman_Cast,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sorcerers_Talisman_Cast,Condition(function Trig_Sorcerers_Talisman_Cast_Conditions))
call TriggerAddAction(gg_trg_Sorcerers_Talisman_Cast,function Trig_Sorcerers_Talisman_Cast_Actions)set index=0set gg_trg_Sorcerers_Talisman=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sorcerers_Talisman,Player(index),EVENT_PLAYER_UNIT_USE_ITEM,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sorcerers_Talisman,Condition(function Trig_Sorcerers_Talisman_Conditions))call TriggerAddAction(gg_trg_Sorcerers_Talisman,function Trig_Sorcerers_Talisman_Actions)set index=0set gg_trg_Sorcerers_Talisman_Dead_Unit=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Sorcerers_Talisman_Dead_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Sorcerers_Talisman_Dead_Unit,Condition(function Trig_Sorcerers_Talisman_Dead_Unit_Condition))call TriggerAddAction(gg_trg_Sorcerers_Talisman_Dead_Unit,function Trig_Sorcerers_Talisman_Dead_Unit_Actions)set index=0set gg_trg_Orc_Banner=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Orc_Banner,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Orc_Banner,Condition(function Trig_Orc_Banner_Conditions))call TriggerAddAction(gg_trg_Orc_Banner,function Trig_Orc_Banner_Actions)set index=0set gg_trg_Devil_Axe=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Devil_Axe,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Devil_Axe,Condition(function Trig_Devil_Axe_Conditions))
call TriggerAddAction(gg_trg_Devil_Axe,function Trig_Devil_Axe_Actions)set index=0set gg_trg_Devil_Axe_Kill_Unit=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Devil_Axe_Kill_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Devil_Axe_Kill_Unit,Condition(function Trig_Devil_Axe_Kill_Unit_Conditions))
call TriggerAddAction(gg_trg_Devil_Axe_Kill_Unit,function Trig_Devil_Axe_Kill_Unit_Actions)set index=0set gg_trg_Tokugawas_Katan_Kill_Unit=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Tokugawas_Katan_Kill_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Tokugawas_Katan_Kill_Unit,Condition(function Trig_Tokugawas_Katan_Kill_Unit_Conditions))
call TriggerAddAction(gg_trg_Tokugawas_Katan_Kill_Unit,function Trig_Tokugawas_Katan_Kill_Unit_Actions)set index=0set gg_trg_Tokugawas_Katan=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Tokugawas_Katan,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Tokugawas_Katan,Condition(function Trig_Tokugawas_Katan_Conditions))
call TriggerAddAction(gg_trg_Tokugawas_Katan,function Trig_Tokugawas_Katan_Actions)set index=0set gg_trg_Kings_Armor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Kings_Armor,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Kings_Armor,Condition(function Trig_Kings_Armor_Conditions))
call TriggerAddAction(gg_trg_Kings_Armor,function Trig_Kings_Armor_Actions)set index=0set gg_trg_Steel_Bib=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Steel_Bib,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Steel_Bib,Condition(function Trig_Steel_Bib_Conditions))
call TriggerAddAction(gg_trg_Steel_Bib,function Trig_Steel_Bib_Actions)set index=0set gg_trg_Archimagus_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Archimagus_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Archimagus_Staff,Condition(function Trig_Archimagus_Staff_Conditions))call TriggerAddAction(gg_trg_Archimagus_Staff,function Trig_Archimagus_Staff_Actions)set index=0set gg_trg_Isidors_Scepter=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Isidors_Scepter,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Isidors_Scepter,Condition(function Trig_Isidors_Scepter_Conditions))
call TriggerAddAction(gg_trg_Isidors_Scepter,function Trig_Isidors_Scepter_Actions)set index=0set gg_trg_Detached_Shield_Use=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Detached_Shield_Use,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Detached_Shield_Use,Condition(function Trig_Detached_Shield_Use_Conditions))
call TriggerAddAction(gg_trg_Detached_Shield_Use,function Trig_Detached_Shield_Use_Actions)set index=0set gg_trg_Cuirass_of_Invulnerable_Use2=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Cuirass_of_Invulnerable_Use2,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Cuirass_of_Invulnerable_Use2,Condition(function Trig_Cuirass_of_Invulnerable_Use2_Conditions))call TriggerAddAction(gg_trg_Cuirass_of_Invulnerable_Use2,function Trig_Cuirass_of_Invulnerable_Use2_Actions)set index=0set gg_trg_Lost_Cuirass_of_Invulnerable=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Lost_Cuirass_of_Invulnerable,Player(index),EVENT_PLAYER_UNIT_DROP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Lost_Cuirass_of_Invulnerable,Condition(function Trig_Lost_Cuirass_of_Invulnerable_Conditions))call TriggerAddAction(gg_trg_Lost_Cuirass_of_Invulnerable,function Trig_Lost_Cuirass_of_Invulnerable_Actions)set index=0set gg_trg_Take_Cuirass_of_Invulnerable=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Take_Cuirass_of_Invulnerable,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Take_Cuirass_of_Invulnerable,Condition(function Trig_Take_Cuirass_of_Invulnerable_Conditions))call TriggerAddAction(gg_trg_Take_Cuirass_of_Invulnerable,function Trig_Take_Cuirass_of_Invulnerable_Actions)set index=0set gg_trg_Fire_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Staff,Condition(function Trig_Fire_Staff_Conditions))call TriggerAddAction(gg_trg_Fire_Staff,function Trig_Fire_Staff_Actions)set index=0set gg_trg_Demon_Axe=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Demon_Axe,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Demon_Axe,Condition(function Trig_Demon_Axe_Conditions))
call TriggerAddAction(gg_trg_Demon_Axe,function Trig_Demon_Axe_Actions)set index=0set gg_trg_Demon_Axe_Kill_Unit=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Demon_Axe_Kill_Unit,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Demon_Axe_Kill_Unit,Condition(function Trig_Demon_Axe_Kill_Unit_Conditions))
call TriggerAddAction(gg_trg_Demon_Axe_Kill_Unit,function Trig_Demon_Axe_Kill_Unit_Actions)set index=0set gg_trg_Boots_Rescue=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Boots_Rescue,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Boots_Rescue,Condition(function Trig_Boots_Rescue_Conditions))call TriggerAddAction(gg_trg_Boots_Rescue,function Trig_Boots_Rescue_Actions)set index=0set gg_trg_Astral_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Astral_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Astral_Staff,Condition(function Trig_Astral_Staff_Conditions))call TriggerAddAction(gg_trg_Astral_Staff,function Trig_Astral_Staff_Actions)set index=0set gg_trg_Healer_Staff=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Healer_Staff,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Healer_Staff,Condition(function Trig_Healer_Staff_Conditions))call TriggerAddAction(gg_trg_Healer_Staff,function Trig_Healer_Staff_Actions)set index=0set gg_trg_Magic_Amulet=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Magic_Amulet,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Magic_Amulet,Condition(function Trig_Magic_Amulet_Conditions))call TriggerAddAction(gg_trg_Magic_Amulet,function Trig_Magic_Amulet_Actions)set index=0set gg_trg_Blood_Dagger=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blood_Dagger,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blood_Dagger,Condition(function Trig_Blood_Dagger_Conditions))call TriggerAddAction(gg_trg_Blood_Dagger,function Trig_Blood_Dagger_Actions)set index=0set gg_trg_Agility_Blade=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Agility_Blade,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Agility_Blade,Condition(function Trig_Agility_Blade_Conditions))
call TriggerAddAction(gg_trg_Agility_Blade,function Trig_Agility_Blade_Actions)set gg_trg_Bone_Staff_Set_Summon_Ability_Level=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Bone_Staff_Set_Summon_Ability_Level,EVENT_PLAYER_UNIT_SUMMON)call TriggerAddCondition(gg_trg_Bone_Staff_Set_Summon_Ability_Level,Condition(function Trig_Bone_Staff_Set_Summon_Ability_Level_Conditions))
call TriggerAddAction(gg_trg_Bone_Staff_Set_Summon_Ability_Level,function Trig_Bone_Staff_Set_Summon_Ability_Level_Actions)set gg_trg_Novice_Amulet=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Novice_Amulet,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_Novice_Amulet,Condition(function Trig_Novice_Amulet_Conditions))
call TriggerAddAction(gg_trg_Novice_Amulet,function Trig_Novice_Amulet_Actions)set index=0set gg_trg_Glove_of_Andromat=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Glove_of_Andromat,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Glove_of_Andromat,Condition(function Trig_Glove_of_Andromat_Conditions))
call TriggerAddAction(gg_trg_Glove_of_Andromat,function Trig_Glove_of_Andromat_Actions)set index=0set gg_trg_Glove_of_Midas=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Glove_of_Midas,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Glove_of_Midas,Condition(function Trig_Glove_of_Midas_Conditions))call TriggerAddAction(gg_trg_Glove_of_Midas,function Trig_Glove_of_Midas_Actions)set index=0set gg_trg_Heroes_more_attacked_priority_when_guards=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Heroes_more_attacked_priority_when_guards,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Heroes_more_attacked_priority_when_guards,Condition(function Trig_Heroes_more_attacked_priority_when_guards_Conditions))
call TriggerAddAction(gg_trg_Heroes_more_attacked_priority_when_guards,function Trig_Heroes_more_attacked_priority_when_guards_Actions)set index=0set gg_trg_Player_Fast_Purchase_System=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Player_Fast_Purchase_System,Player(index),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Player_Fast_Purchase_System,Condition(function Trig_Player_Fast_Purchase_System_Conditions))
call TriggerAddAction(gg_trg_Player_Fast_Purchase_System,function Trig_Player_Fast_Purchase_System_Actions)set gg_trg_Show_hint_abount_hints=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_hints,120.)
call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_hints,600.)
call TriggerAddAction(gg_trg_Show_hint_abount_hints,function Trig_Show_hint_abount_hints_Actions)set gg_trg_Show_Hint_Abount_Items=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Show_Hint_Abount_Items,600.)call TriggerAddAction(gg_trg_Show_Hint_Abount_Items,function Trig_Show_Hint_Abount_Items_Actions)set gg_trg_Hint_About_Random=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Hint_About_Random,13.)call TriggerAddAction(gg_trg_Hint_About_Random,function Trig_Hint_About_Random_Actions)set gg_trg_Show_hint_abount_reference_panel=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_reference_panel,200.)call TriggerRegisterTimerEventSingle(gg_trg_Show_hint_abount_reference_panel,1200.)call TriggerAddAction(gg_trg_Show_hint_abount_reference_panel,function Trig_Show_hint_abount_reference_panel_Actions)set index=0set gg_trg_Show_Ability_Learn=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Show_Ability_Learn,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Show_Ability_Learn,Condition(function Trig_Show_Ability_Learn_Conditions))call TriggerAddAction(gg_trg_Show_Ability_Learn,function Trig_Show_Ability_Learn_Actions)set index=0set gg_trg_System_Personal_Items_Buy_Item=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_System_Personal_Items_Buy_Item,Player(index),EVENT_PLAYER_UNIT_SELL_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_System_Personal_Items_Buy_Item,function Trig_System_Personal_Items_Buy_Item_Actions)set index=0set gg_trg_System_Personal_Items_Pick_Up_Item=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_System_Personal_Items_Pick_Up_Item,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_System_Personal_Items_Pick_Up_Item,function Trig_System_Personal_Items_Pick_Up_Item_Actions)set gg_trg_no_attack=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_no_attack,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_no_attack,Condition(function Trig_no_attack_Conditions))
call TriggerAddAction(gg_trg_no_attack,function Trig_no_attack_Actions)set index=0set gg_trg_Select_Refrence_Panel=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Select_Refrence_Panel,Player(index),EVENT_PLAYER_UNIT_SELECTED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Select_Refrence_Panel,Condition(function Trig_Select_Refrence_Panel_Conditions))
call TriggerAddAction(gg_trg_Select_Refrence_Panel,function Trig_Select_Refrence_Panel_Actions)set index=0set gg_trg_ShopAnimation=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ShopAnimation,Player(index),EVENT_PLAYER_UNIT_SELECTED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_ShopAnimation,Condition(function Trig_ShopAnimation_Conditions))
call TriggerAddAction(gg_trg_ShopAnimation,function Trig_ShopAnimation_Actions)set index=0set gg_trg_ShopStopAnimation=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ShopStopAnimation,Player(index),EVENT_PLAYER_UNIT_DESELECTED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_ShopStopAnimation,Condition(function Trig_ShopStopAnimation_Conditions))
call TriggerAddAction(gg_trg_ShopStopAnimation,function Trig_ShopStopAnimation_Actions)set rectRegion=CreateRegion()set gg_trg_RedMarkToUnit=CreateTrigger()
call RegionAddRect(rectRegion,bj_mapInitialPlayableArea)
call TriggerRegisterEnterRegion(gg_trg_RedMarkToUnit,rectRegion,null)call TriggerAddAction(gg_trg_RedMarkToUnit,function Trig_RedMarkToUnit_Actions)set index=0set gg_trg_UnSelectedDummyRedMark=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_UnSelectedDummyRedMark,Player(index),EVENT_PLAYER_UNIT_SELECTED,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_UnSelectedDummyRedMark,Condition(function Trig_UnSelectedDummyRedMark_Conditions))call TriggerAddAction(gg_trg_UnSelectedDummyRedMark,function Trig_UnSelectedDummyRedMark_Actions)set gg_trg_SpecEffect_on_Casters=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_SpecEffect_on_Casters,.0,false)call TriggerAddAction(gg_trg_SpecEffect_on_Casters,function Trig_SpecEffect_on_Casters_Actions)set gg_trg_PortalSpecEffects=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_PortalSpecEffects,2.,false)call TriggerAddAction(gg_trg_PortalSpecEffects,function Trig_PortalSpecEffects_Actions)set gg_trg_Gates_Start_Animation=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Gates_Start_Animation,2.)call TriggerAddAction(gg_trg_Gates_Start_Animation,function Trig_Gates_Start_Animation_Actions)set index=0set gg_trg_PlayerEnterGameCommand=CreateTrigger()loop
call TriggerRegisterPlayerChatEvent(gg_trg_PlayerEnterGameCommand,Player(index),"-",false)call TriggerRegisterPlayerChatEvent(gg_trg_PlayerEnterGameCommand,Player(index),"+",true)set index=index+1exitwhen index==16endloopcall TriggerAddAction(gg_trg_PlayerEnterGameCommand,function Trig_PlayerEnterGameCommand_Actions)set index=0set gg_trg_PlayerUseSpellGameCommand=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_PlayerUseSpellGameCommand,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_PlayerUseSpellGameCommand,Condition(function Trig_PlayerUseSpellGameCommand_Conditions))
call TriggerAddAction(gg_trg_PlayerUseSpellGameCommand,function Trig_PlayerUseSpellGameCommand_Actions)set index=0set gg_trg_GuardsExorcistDead=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_GuardsExorcistDead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_GuardsExorcistDead,Condition(function Trig_GuardsExorcistDead_Conditions))call TriggerAddAction(gg_trg_GuardsExorcistDead,function Trig_GuardsExorcistDead_Actions)set gg_trg_PauseUnitWhenDefeat=CreateTrigger()call DisableTrigger(gg_trg_PauseUnitWhenDefeat)call TriggerRegisterTimerEventPeriodic(gg_trg_PauseUnitWhenDefeat,.05)call TriggerAddAction(gg_trg_PauseUnitWhenDefeat,function Trig_PauseUnitWhenDefeat_Actions)set gg_trg_PauseUnitWhenWin=CreateTrigger()call DisableTrigger(gg_trg_PauseUnitWhenWin)
call TriggerRegisterEnterRectSimple(gg_trg_PauseUnitWhenWin,bj_mapInitialPlayableArea)call TriggerAddAction(gg_trg_PauseUnitWhenWin,function Trig_PauseUnitWhenWin_Actions)set gg_trg_GameEndWin=CreateTrigger()call DisableTrigger(gg_trg_GameEndWin)call TriggerAddAction(gg_trg_GameEndWin,function Trig_GameEndWin_Actions)set gg_trg_Respawn_trees_Init=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Respawn_trees_Init,5.,false)call TriggerAddAction(gg_trg_Respawn_trees_Init,function Trig_Respawn_trees_Init_Actions)set gg_trg_Respawn_trees=CreateTrigger()
call TriggerAddAction(gg_trg_Respawn_trees,function Trig_Respawn_trees_Actions)set gg_trg_Day_Weather=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Day_Weather,EQUAL,6.)
call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Day_Weather,EQUAL,12.)call TriggerAddAction(gg_trg_Day_Weather,function Trig_Day_Weather_Actions)set gg_trg_Sky_Morning=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Morning,EQUAL,6.)
call TriggerAddAction(gg_trg_Sky_Morning,function Trig_Sky_Morning_Actions)set gg_trg_Sky_Day=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Day,EQUAL,12.)call TriggerAddAction(gg_trg_Sky_Day,function Trig_Sky_Day_Actions)set gg_trg_Night_Weather=CreateTrigger()
call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Night_Weather,EQUAL,18.)call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Night_Weather,EQUAL,.0)call TriggerAddAction(gg_trg_Night_Weather,function Trig_Night_Weather_Actions)set gg_trg_Sky_Evening=CreateTrigger()call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Evening,EQUAL,18.)call TriggerAddAction(gg_trg_Sky_Evening,function Trig_Sky_Evening_Actions)set gg_trg_Sky_Night=CreateTrigger()
call TriggerRegisterGameStateEventTimeOfDay(gg_trg_Sky_Night,EQUAL,.0)call TriggerAddAction(gg_trg_Sky_Night,function Trig_Sky_Night_Actions)set gg_trg_Lightnings_Weather_Effect_Rainy=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_Lightnings_Weather_Effect_Rainy,udg_Timer_Lightning_Strike_Weather)call TriggerAddCondition(gg_trg_Lightnings_Weather_Effect_Rainy,Condition(function Trig_Lightnings_Weather_Effect_Rainy_Conditions))
call TriggerAddAction(gg_trg_Lightnings_Weather_Effect_Rainy,function Trig_Lightnings_Weather_Effect_Rainy_Actions)set gg_trg_Periodic_Rune_Creation=CreateTrigger()call DisableTrigger(gg_trg_Periodic_Rune_Creation)call TriggerRegisterTimerEventPeriodic(gg_trg_Periodic_Rune_Creation,60.1)call TriggerAddAction(gg_trg_Periodic_Rune_Creation,function Trig_Periodic_Rune_Creation_Actions)set index=0set gg_trg_Rune_PickedUp=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Rune_PickedUp,Player(index),EVENT_PLAYER_UNIT_PICKUP_ITEM,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Rune_PickedUp,Condition(function Trig_Rune_PickedUp_Conditions))
call TriggerAddAction(gg_trg_Rune_PickedUp,function Trig_Rune_PickedUp_Actions)set gg_trg_Initialization_MultiBoard=CreateTrigger()
call TriggerRegisterTimerEventSingle(gg_trg_Initialization_MultiBoard,3.)call TriggerAddAction(gg_trg_Initialization_MultiBoard,function Trig_Initialization_MultiBoard_Actions)set gg_trg_Hero_MultiBoard_LvlUp=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Hero_MultiBoard_LvlUp,EVENT_PLAYER_HERO_LEVEL)
call TriggerAddCondition(gg_trg_Hero_MultiBoard_LvlUp,Condition(function Trig_Hero_MultiBoard_LvlUp_Conditions))
call TriggerAddAction(gg_trg_Hero_MultiBoard_LvlUp,function Trig_Hero_MultiBoard_LvlUp_Actions)set gg_trg_Time_Check_and_Player_Gold_for_MultiBoard=CreateTrigger()
call TriggerRegisterTimerEventPeriodic(gg_trg_Time_Check_and_Player_Gold_for_MultiBoard,1.)call TriggerAddAction(gg_trg_Time_Check_and_Player_Gold_for_MultiBoard,function Trig_Time_Check_and_Player_Gold_for_MultiBoard_Actions)set index=0set gg_trg_Reincarnation_Skeletons=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Reincarnation_Skeletons,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Reincarnation_Skeletons,Condition(function Trig_Reincarnation_Skeletons_Conditions))
call TriggerAddAction(gg_trg_Reincarnation_Skeletons,function Trig_Reincarnation_Skeletons_Actions)set index=0set gg_trg_BossSkeletRaise=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BossSkeletRaise,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BossSkeletRaise,Condition(function Trig_BossSkeletRaise_Conditions))
call TriggerAddAction(gg_trg_BossSkeletRaise,function Trig_BossSkeletRaise_Actions)set index=0set gg_trg_BossSkeletSkillActiv=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BossSkeletSkillActiv,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BossSkeletSkillActiv,Condition(function Trig_BossSkeletSkillActiv_Conditions))call TriggerAddAction(gg_trg_BossSkeletSkillActiv,function Trig_BossSkeletSkillActiv_Actions)set index=0set gg_trg_Fire_Arrow=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Arrow,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Arrow,Condition(function Trig_Fire_Arrow_Conditions))call TriggerAddAction(gg_trg_Fire_Arrow,function Trig_Fire_Arrow_Actions)set gg_trg_Use_UnholyFrenzy_and_Fire_Arrow=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Use_UnholyFrenzy_and_Fire_Arrow,1.,true)call TriggerAddCondition(gg_trg_Use_UnholyFrenzy_and_Fire_Arrow,Condition(function Trig_Use_UnholyFrenzy_and_Fire_Arrow_Conditions))
call TriggerAddAction(gg_trg_Use_UnholyFrenzy_and_Fire_Arrow,function Trig_Use_UnholyFrenzy_and_Fire_Arrow_Actions)set index=0set gg_trg_Create_Tombstone=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Create_Tombstone,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Create_Tombstone,Condition(function Trig_Create_Tombstone_Conditions))call TriggerAddAction(gg_trg_Create_Tombstone,function Trig_Create_Tombstone_Actions)set index=0set gg_trg_ZombieExploadDeath=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_ZombieExploadDeath,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_ZombieExploadDeath,Condition(function Trig_ZombieExploadDeath_Conditions))call TriggerAddAction(gg_trg_ZombieExploadDeath,function Trig_ZombieExploadDeath_Actions)set index=0set gg_trg_Damned_Soul=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Damned_Soul,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Damned_Soul,Condition(function Trig_Damned_Soul_Conditions))
call TriggerAddAction(gg_trg_Damned_Soul,function Trig_Damned_Soul_Actions)set gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul,1.,true)call TriggerAddCondition(gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul,Condition(function Trig_Use_PowerofHorror_and_Curse_and_Slam_Conditions))call TriggerAddAction(gg_trg_Use_PowerofHorror_and_Curse_and_Slam_and_Dumned_Soul,function Trig_Use_PowerofHorror_and_Curse_and_Slam_Actions)set index=0set gg_trg_Throw_Meat=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Throw_Meat,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Throw_Meat,Condition(function Trig_Throw_Meat_Conditions))call TriggerAddAction(gg_trg_Throw_Meat,function Trig_Throw_Meat_Actions)set index=0set gg_trg_Earth_Clap=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Earth_Clap,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Earth_Clap,Condition(function Trig_Earth_Clap_Conditions))call TriggerAddAction(gg_trg_Earth_Clap,function Trig_Earth_Clap_Actions)set index=0set gg_trg_Ghoul_Jump=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ghoul_Jump,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ghoul_Jump,Condition(function Trig_Ghoul_Jump_Conditions))call TriggerAddAction(gg_trg_Ghoul_Jump,function Trig_Ghoul_Jump_Actions)set index=0set gg_trg_BurrowStrike=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BurrowStrike,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BurrowStrike,Condition(function Trig_BurrowStrike_Conditions))call TriggerAddAction(gg_trg_BurrowStrike,function Trig_BurrowStrike_Actions)set gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump,1.,true)
call TriggerAddCondition(gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump,Condition(function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Conditions))
call TriggerAddAction(gg_trg_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump,function Trig_Use_Raise_Skeletons_and_Death_Coil_and_Trupoedi_and_Pierce_and_Ghoul_Jump_Actions)set index=0set gg_trg_BeetleCorpseBurrowCast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BeetleCorpseBurrowCast,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BeetleCorpseBurrowCast,Condition(function Trig_BeetleCorpseBurrowCast_Conditions))call TriggerAddAction(gg_trg_BeetleCorpseBurrowCast,function Trig_BeetleCorpseBurrowCast_Actions)set index=0set gg_trg_BeetleCorpseBurrow=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BeetleCorpseBurrow,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BeetleCorpseBurrow,Condition(function Trig_BeetleCorpseBurrow_Conditions))call TriggerAddAction(gg_trg_BeetleCorpseBurrow,function Trig_BeetleCorpseBurrow_Actions)set index=0set gg_trg_Cocoon_Creation=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Cocoon_Creation,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Cocoon_Creation,Condition(function Trig_Cocoon_Creation_Conditions))
call TriggerAddAction(gg_trg_Cocoon_Creation,function Trig_Cocoon_Creation_Actions)set index=0set gg_trg_Poisonous_Spittle_Cast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Poisonous_Spittle_Cast,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Poisonous_Spittle_Cast,Condition(function Trig_Poisonous_Spittle_Cast_Conditions))call TriggerAddAction(gg_trg_Poisonous_Spittle_Cast,function Trig_Poisonous_Spittle_Cast_Actions)set index=0set gg_trg_Holes_Of_Grave_Diggers_Debug_Kill=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Holes_Of_Grave_Diggers_Debug_Kill,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Holes_Of_Grave_Diggers_Debug_Kill,Condition(function Trig_Holes_Of_Grave_Diggers_Debug_Kill_Conditions))
call TriggerAddAction(gg_trg_Holes_Of_Grave_Diggers_Debug_Kill,function Trig_Holes_Of_Grave_Diggers_Debug_Kill_Actions)set index=0set gg_trg_Holes_Of_Grave_Diggers_Cast=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Holes_Of_Grave_Diggers_Cast,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Holes_Of_Grave_Diggers_Cast,Condition(function Trig_Holes_Of_Grave_Diggers_Cast_Conditions))
call TriggerAddAction(gg_trg_Holes_Of_Grave_Diggers_Cast,function Trig_Holes_Of_Grave_Diggers_Cast_Actions)set index=0set gg_trg_Nerub_Spider=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Nerub_Spider,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Nerub_Spider,Condition(function Trig_Nerub_Spider_Conditions))call TriggerAddAction(gg_trg_Nerub_Spider,function Trig_Nerub_Spider_Actions)set gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger,1.,true)
call TriggerAddCondition(gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger,Condition(function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Conditions))
call TriggerAddAction(gg_trg_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger,function Trig_Use_Spiders_threads_and_Holes_of_Grave_And_Spider_Summon_and_PosionDagger_Actions)set index=0set gg_trg_Damned_Ents_Reincarnation=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Damned_Ents_Reincarnation,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Damned_Ents_Reincarnation,Condition(function Trig_Damned_Ents_Reincarnation_Conditions))
call TriggerAddAction(gg_trg_Damned_Ents_Reincarnation,function Trig_Damned_Ents_Reincarnation_Actions)set index=0set gg_trg_Rage_of_Decay=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Rage_of_Decay,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Rage_of_Decay,Condition(function Trig_Rage_of_Decay_Conditions))
call TriggerAddAction(gg_trg_Rage_of_Decay,function Trig_Rage_of_Decay_Actions)set gg_trg_Use_ThrowStone_and_TurnIntoEnt=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_ThrowStone_and_TurnIntoEnt,EVENT_PLAYER_UNIT_ATTACKED)
call TriggerAddCondition(gg_trg_Use_ThrowStone_and_TurnIntoEnt,Condition(function Trig_Use_ThrowStone_and_TurnIntoEnt_Conditions))call TriggerAddAction(gg_trg_Use_ThrowStone_and_TurnIntoEnt,function Trig_Use_ThrowStone_and_TurnIntoEnt_Actions)set gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay=CreateTrigger()
call TriggerRegisterTimerEventPeriodic(gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay,1.)call TriggerAddCondition(gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay,Condition(function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Conditions))
call TriggerAddAction(gg_trg_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay,function Trig_Use_RootSystem_and_Rejuvination_and_Powerlessness_and_RageOfDecay_Actions)set index=0set gg_trg_Troll_Dead_Remove_Bugs=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Troll_Dead_Remove_Bugs,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Troll_Dead_Remove_Bugs,Condition(function Trig_Troll_Dead_Remove_Bugs_Conditions))call TriggerAddAction(gg_trg_Troll_Dead_Remove_Bugs,function Trig_Troll_Dead_Remove_Bugs_Actions)set index=0set gg_trg_Boss_Troll_Entangle_Throw=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Boss_Troll_Entangle_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Boss_Troll_Entangle_Throw,Condition(function Trig_Boss_Troll_Entangle_Throw_Conditions))
call TriggerAddAction(gg_trg_Boss_Troll_Entangle_Throw,function Trig_Boss_Troll_Entangle_Throw_Actions)set gg_trg_Use_Berserk_and_BerserkBoss=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_Berserk_and_BerserkBoss,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_Use_Berserk_and_BerserkBoss,Condition(function Trig_Use_Berserk_and_BerserkBoss_Conditions))
call TriggerAddAction(gg_trg_Use_Berserk_and_BerserkBoss,function Trig_Use_Berserk_and_BerserkBoss_Actions)set gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle,1.)call TriggerAddCondition(gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle,Condition(function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Conditions))
call TriggerAddAction(gg_trg_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle,function Trig_Use_Heal_and_HealingWave_and_PowerOfCursed_and_Entangle_Actions)set index=0set gg_trg_Aspect_of_Magic_Protection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Aspect_of_Magic_Protection,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Aspect_of_Magic_Protection,Condition(function Trig_Aspect_of_Magic_Protection_Conditions))call TriggerAddAction(gg_trg_Aspect_of_Magic_Protection,function Trig_Aspect_of_Magic_Protection_Actions)set index=0set gg_trg_Remove_Effects_From_Bosses=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Remove_Effects_From_Bosses,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Remove_Effects_From_Bosses,Condition(function Trig_Remove_Effects_From_Bosses_Conditions))call TriggerAddAction(gg_trg_Remove_Effects_From_Bosses,function Trig_Remove_Effects_From_Bosses_Actions)set index=0set gg_trg_Metka_Dreneev=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Metka_Dreneev,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Metka_Dreneev,Condition(function Trig_Metka_Dreneev_Conditions))
call TriggerAddAction(gg_trg_Metka_Dreneev,function Trig_Metka_Dreneev_Actions)set index=0set gg_trg_Fast_Attack=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fast_Attack,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fast_Attack,Condition(function Trig_Fast_Attack_Conditions))
call TriggerAddAction(gg_trg_Fast_Attack,function Trig_Fast_Attack_Actions)set index=0set gg_trg_Bash_Attack=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Bash_Attack,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Bash_Attack,Condition(function Trig_Bash_Attack_Conditions))
call TriggerAddAction(gg_trg_Bash_Attack,function Trig_Bash_Attack_Actions)set gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack=CreateTrigger()
call TriggerRegisterTimerEvent(gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack,1.,true)
call TriggerAddCondition(gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack,Condition(function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Conditions))
call TriggerAddAction(gg_trg_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack,function Trig_Use_Aspect_Critical_Attacl_Fst_Attack_Bash_Attack_Actions)set index=0set gg_trg_Blink_Strike=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blink_Strike,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blink_Strike,Condition(function Trig_Blink_Strike_Conditions))call TriggerAddAction(gg_trg_Blink_Strike,function Trig_Blink_Strike_Actions)set index=0set gg_trg_Victim_Search=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Victim_Search,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Victim_Search,Condition(function Trig_Victim_Search_Conditions))
call TriggerAddAction(gg_trg_Victim_Search,function Trig_Victim_Search_Actions)set index=0set gg_trg_Black_Hole=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Black_Hole,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Black_Hole,Condition(function Trig_Black_Hole_Conditions))call TriggerAddAction(gg_trg_Black_Hole,function Trig_Black_Hole_Actions)set gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar,Condition(function Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Conditions))
call TriggerAddAction(gg_trg_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar,function Trig_Use_Magic_Fire_and_Dumned_Skull_and_Piercing_Strike_and_Infernal_Roar_Actions)set gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH,1.)call TriggerAddCondition(gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH,Condition(function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Conditions))call TriggerAddAction(gg_trg_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH,function Trig_Use_Blink_Strike_and_Dumned_Skull_and_Weakness_of_Emptiness_and_Search_Victim_BH_Actions)set index=0set gg_trg_Weakness=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Weakness,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Weakness,Condition(function Trig_Weakness_Conditions))call TriggerAddAction(gg_trg_Weakness,function Trig_Weakness_Actions)set index=0set gg_trg_Astral_Dispersal=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Astral_Dispersal,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Astral_Dispersal,Condition(function Trig_Astral_Dispersal_Conditions))call TriggerAddAction(gg_trg_Astral_Dispersal,function Trig_Astral_Dispersal_Actions)set index=0set gg_trg_Infernal_Ram=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Infernal_Ram,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Infernal_Ram,Condition(function Trig_Infernal_Ram_Conditions))call TriggerAddAction(gg_trg_Infernal_Ram,function Trig_Infernal_Ram_Actions)set index=0set gg_trg_Fiery_Blow=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fiery_Blow,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fiery_Blow,Condition(function Trig_Fiery_Blow_Conditions))call TriggerAddAction(gg_trg_Fiery_Blow,function Trig_Fiery_Blow_Actions)set index=0set gg_trg_Bloody_Jump=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Bloody_Jump,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Bloody_Jump,Condition(function Trig_Bloody_Jump_Conditions))
call TriggerAddAction(gg_trg_Bloody_Jump,function Trig_Bloody_Jump_Actions)set index=0set gg_trg_Blood_Absorption=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Blood_Absorption,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Blood_Absorption,Condition(function Trig_Blood_Absorption_Conditions))call TriggerAddAction(gg_trg_Blood_Absorption,function Trig_Blood_Absorption_Actions)set gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u,EVENT_PLAYER_UNIT_ATTACKED)
call TriggerAddCondition(gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u,Condition(function Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Conditions))call TriggerAddAction(gg_trg_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u,function Trig_Use_Weakness_and_Pain_Sphere_and_Fiery_Blow_and_Blood_Absorption_____________________u_Actions)set gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4=CreateTrigger()
call TriggerRegisterTimerEventPeriodic(gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4,1.)call TriggerAddCondition(gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4,Condition(function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Conditions))
call TriggerAddAction(gg_trg_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4,function Trig_Use_Astral_Disperasal_and_Infernal_Ram_and_Bloody_Jump______________________4_Actions)set gg_trg_Hatred_of_fire=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_Hatred_of_fire,EVENT_PLAYER_UNIT_SPELL_EFFECT)
call TriggerAddCondition(gg_trg_Hatred_of_fire,Condition(function Trig_Hatred_of_fire_Conditions))call TriggerAddAction(gg_trg_Hatred_of_fire,function Trig_Hatred_of_fire_Actions)set gg_trg_set_fire=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_set_fire,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_set_fire,Condition(function firess))
call TriggerAddAction(gg_trg_set_fire,function fires)set gg_trg_set_fire_2=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_set_fire_2,EVENT_PLAYER_UNIT_SPELL_EFFECT)
call TriggerAddCondition(gg_trg_set_fire_2,Condition(function firess2))call TriggerAddAction(gg_trg_set_fire_2,function fires2)
set gg_trg_the_creation_of_the_image=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_the_creation_of_the_image,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_the_creation_of_the_image,Condition(function Trig_the_creation_of_the_image_Conditions))
call TriggerAddAction(gg_trg_the_creation_of_the_image,function Trig_the_creation_of_the_image_Actions)set gg_trg_fiery_explosions=CreateTrigger()call TriggerRegisterAnyUnitEventBJ(gg_trg_fiery_explosions,EVENT_PLAYER_UNIT_SPELL_EFFECT)call TriggerAddCondition(gg_trg_fiery_explosions,Condition(function Trig_fiery_explosions_Conditions))call TriggerAddAction(gg_trg_fiery_explosions,function Trig_fiery_explosions_Actions)set index=0set gg_trg_Breathoffire=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Breathoffire,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Breathoffire,Condition(function Trig_Breathoffire_Conditions))call TriggerAddAction(gg_trg_Breathoffire,function Trig_Breathoffire_Actions)set index=0set gg_trg_Fire_Explosions=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fire_Explosions,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fire_Explosions,Condition(function Trig_Fire_Explosions_Conditions))
call TriggerAddAction(gg_trg_Fire_Explosions,function Trig_Fire_Explosions_Actions)set index=0set gg_trg_BossStomp=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_BossStomp,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_BossStomp,Condition(function Trig_BossStomp_Conditions))
call TriggerAddAction(gg_trg_BossStomp,function Trig_BossStomp_Actions)set index=0set gg_trg_Mark_of_Fire=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Mark_of_Fire,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Mark_of_Fire,Condition(function Trig_Mark_of_Fire_Conditions))call TriggerAddAction(gg_trg_Mark_of_Fire,function Trig_Mark_of_Fire_Actions)set gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire,EVENT_PLAYER_UNIT_ATTACKED)call TriggerAddCondition(gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire,Condition(function Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Conditions))
call TriggerAddAction(gg_trg_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire,function Trig_Use_HatredofFire_and_BreathOfFire_and_SoulBurn_and_MarkofFire_Actions)set gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp=CreateTrigger()call TriggerRegisterTimerEventPeriodic(gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp,1.)call TriggerAddCondition(gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp,Condition(function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Conditions))
call TriggerAddAction(gg_trg_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp,function Trig_Use_SetFire_a_FireSummon_a_WallofFire_a_Image_a_FireExplosions_a_FE_a_BossStomp_Actions)set index=0set gg_trg_Power_of_Skeletons=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Power_of_Skeletons,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Power_of_Skeletons,Condition(function Trig_Power_of_Skeletons_Conditions))call TriggerAddAction(gg_trg_Power_of_Skeletons,function Trig_Power_of_Skeletons_Actions)set gg_trg_Water_Elemental_Load=CreateTrigger()call TriggerAddAction(gg_trg_Water_Elemental_Load,function Trig_Water_Elemental_Load_Actions)set gg_trg_Init_kreeps=CreateTrigger()call TriggerAddAction(gg_trg_Init_kreeps,function Trig_Init_kreeps_Actions)set index=0set gg_trg_spirits_of_water_dead=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_spirits_of_water_dead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_spirits_of_water_dead,Condition(function Trig_spirits_of_water_dead_Conditions))
call TriggerAddAction(gg_trg_spirits_of_water_dead,function Trig_spirits_of_water_dead_Actions)set index=0set gg_trg_Skill_Gertva=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Skill_Gertva,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Skill_Gertva,Condition(function Trig_Skill_Gertva_Conditions))call TriggerAddAction(gg_trg_Skill_Gertva,function Trig_Skill_Gertva_Actions)set index=0set gg_trg_Opening_Streams=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Opening_Streams,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Opening_Streams,Condition(function Trig_Opening_Streams_Conditions))
call TriggerAddAction(gg_trg_Opening_Streams,function Trig_Opening_Streams_Actions)set index=0set gg_trg_Water_Explosion=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Water_Explosion,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Water_Explosion,Condition(function Trig_water_explosion_Conditions))
call TriggerAddAction(gg_trg_Water_Explosion,function Trig_water_explosion_Actions)set index=0set gg_trg_Tsunami=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Tsunami,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Tsunami,Condition(function Trig_Tsunami_Conditions))
call TriggerAddAction(gg_trg_Tsunami,function Trig_Tsunami_Actions)set gg_trg_Guardsman_Load=CreateTrigger()call TriggerAddAction(gg_trg_Guardsman_Load,function Trig_Guardsman_Load_Actions)set index=0set gg_trg_Protective_Stand_Switch=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Protective_Stand_Switch,Player(index),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)call TriggerRegisterPlayerUnitEvent(gg_trg_Protective_Stand_Switch,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Protective_Stand_Switch,Condition(function Trig_Protective_Stand_Switch_Conditions))
call TriggerAddAction(gg_trg_Protective_Stand_Switch,function Trig_Protective_Stand_Switch_Actions)set index=0set gg_trg_Learn_Fighting_Skills=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Fighting_Skills,Player(index),EVENT_PLAYER_HERO_SKILL,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Fighting_Skills,Condition(function Trig_Learn_Fighting_Skills_Conditions))
call TriggerAddAction(gg_trg_Learn_Fighting_Skills,function Trig_Learn_Fighting_Skills_Actions)set index=0set gg_trg_Ram_Board=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ram_Board,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ram_Board,Condition(function Trig_Ram_Board_Conditions))
call TriggerAddAction(gg_trg_Ram_Board,function Trig_Ram_Board_Actions)set index=0set gg_trg_Warcry=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Warcry,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Warcry,Condition(function Trig_Warcry_Conditions))call TriggerAddAction(gg_trg_Warcry,function Trig_Warcry_Actions)set gg_trg_Drenor_Bull_Load=CreateTrigger()call TriggerAddAction(gg_trg_Drenor_Bull_Load,function Trig_Drenor_Bull_Load_Actions)set gg_trg_Drenor_Bull_Show_Hint=CreateTrigger()
call DisableTrigger(gg_trg_Drenor_Bull_Show_Hint)call TriggerRegisterTimerEventPeriodic(gg_trg_Drenor_Bull_Show_Hint,120.)call TriggerAddAction(gg_trg_Drenor_Bull_Show_Hint,function Trig_Drenor_Bull_Show_Hint_Actions)set index=0set gg_trg_Drenor_Bull_Show_Rage=CreateTrigger()
call DisableTrigger(gg_trg_Drenor_Bull_Show_Rage)loop
call TriggerRegisterPlayerChatEvent(gg_trg_Drenor_Bull_Show_Rage,Player(index),"-rage",true)
call TriggerRegisterPlayerChatEvent(gg_trg_Drenor_Bull_Show_Rage,Player(index),"-r",true)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Drenor_Bull_Show_Rage,Condition(function Trig_Drenor_Bull_Show_Rage_Conditions))
call TriggerAddAction(gg_trg_Drenor_Bull_Show_Rage,function Trig_Drenor_Bull_Show_Rage_Actions)set index=0set gg_trg_Axe_Throw=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Axe_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Axe_Throw,Condition(function Trig_Axe_Throw_Conditions))
call TriggerAddAction(gg_trg_Axe_Throw,function Trig_Axe_Throw_Actions)set index=0set gg_trg_Violent_Roar=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Violent_Roar,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Violent_Roar,Condition(function Trig_Violent_Roar_Conditions))call TriggerAddAction(gg_trg_Violent_Roar,function Trig_Violent_Roar_Actions)set index=0set gg_trg_upgrade_Berserk=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_upgrade_Berserk,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_upgrade_Berserk,Condition(function Trig_upgrade_Berserk_Conditions))
call TriggerAddAction(gg_trg_upgrade_Berserk,function Trig_upgrade_Berserk_Actions)set index=0set gg_trg_Learn_Spell_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Spell_Rage,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Spell_Rage,Condition(function Trig_Learn_Spell_Rage_Conditions))call TriggerAddAction(gg_trg_Learn_Spell_Rage,function Trig_Learn_Spell_Rage_Actions)set index=0set gg_trg_GrogTarDead=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_GrogTarDead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_GrogTarDead,Condition(function Trig_GrogTarDead_Conditions))
call TriggerAddAction(gg_trg_GrogTarDead,function Trig_GrogTarDead_Actions)set index=0set gg_trg_attack_hero_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_attack_hero_Rage,Player(index),EVENT_PLAYER_UNIT_ATTACKED,null)set index=index+1exitwhen index==16endloopcall DisableTrigger(gg_trg_attack_hero_Rage)
call TriggerAddCondition(gg_trg_attack_hero_Rage,Condition(function Trig_attack_hero_Rage_Conditions))call TriggerAddAction(gg_trg_attack_hero_Rage,function Trig_attack_hero_Rage_Actions)set index=0set gg_trg_kill_hero_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_kill_hero_Rage,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall DisableTrigger(gg_trg_kill_hero_Rage)call TriggerAddCondition(gg_trg_kill_hero_Rage,Condition(function Trig_kill_hero_Rage_Conditions))call TriggerAddAction(gg_trg_kill_hero_Rage,function Trig_kill_hero_Rage_Actions)set gg_trg_Sniatie_Rage=CreateTrigger()call TriggerRegisterTimerEvent(gg_trg_Sniatie_Rage,3.,true)call TriggerAddAction(gg_trg_Sniatie_Rage,function Trig_Sniatie_Rage_Action)
call DisableTrigger(gg_trg_Sniatie_Rage)
set gg_trg_Timer_Rage=CreateTrigger()call TriggerRegisterTimerExpireEvent(gg_trg_Timer_Rage,udg_GrogTarRageTimer)
call TriggerAddAction(gg_trg_Timer_Rage,function Trig_Timer_last_Actions)set gg_trg_Illusionist_Load=CreateTrigger()call TriggerAddAction(gg_trg_Illusionist_Load,function Trig_Illusionist_Load_Actions)set index=0set gg_trg_Reflection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Reflection,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Reflection,Condition(function Trig_Reflection_Conditions))call TriggerAddAction(gg_trg_Reflection,function Trig_Reflection_Actions)set index=0set gg_trg_Illusory_Attack=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Illusory_Attack,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Illusory_Attack,Condition(function Trig_Illusory_Attack_Conditions))
call TriggerAddAction(gg_trg_Illusory_Attack,function Trig_Illusory_Attack_Actions)set index=0set gg_trg_Summon_Illusions_with_Reflection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Summon_Illusions_with_Reflection,Player(index),EVENT_PLAYER_UNIT_SUMMON,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Summon_Illusions_with_Reflection,Condition(function Trig_Summon_Illusions_with_Reflection_Conditions))call TriggerAddAction(gg_trg_Summon_Illusions_with_Reflection,function Trig_Summon_Illusions_with_Reflection_Actions)set index=0set gg_trg_Illusions_with_Phantoms_Dead=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Illusions_with_Phantoms_Dead,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Illusions_with_Phantoms_Dead,Condition(function Trig_Illusions_with_Phantoms_Dead_Conditions))call TriggerAddAction(gg_trg_Illusions_with_Phantoms_Dead,function Trig_Illusions_with_Phantoms_Dead_Actions)set gg_trg_BladeMaster_Load=CreateTrigger()call TriggerAddAction(gg_trg_BladeMaster_Load,function Trig_BladeMaster_Load_Actions)set index=0set gg_trg_Dissection=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dissection,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dissection,Condition(function Trig_Dissection_Conditions))call TriggerAddAction(gg_trg_Dissection,function Trig_Dissection_Actions)set index=0set gg_trg_Whirlwind=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Whirlwind,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Whirlwind,Condition(function Trig_Whirlwind_Conditions))
call TriggerAddAction(gg_trg_Whirlwind,function Trig_Whirlwind_Actions)set index=0set gg_trg_Imboweling=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Imboweling,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Imboweling,Condition(function Trig_Imboweling_Conditions))call TriggerAddAction(gg_trg_Imboweling,function Trig_Imboweling_Actions)set gg_trg_Master_of_Lightnings_Load=CreateTrigger()
call TriggerAddAction(gg_trg_Master_of_Lightnings_Load,function Trig_Master_of_Lightnings_Load_Actions)set index=0set gg_trg_Thundercloud=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Thundercloud,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Thundercloud,Condition(function Trig_Thundercloud_Conditions))call TriggerAddAction(gg_trg_Thundercloud,function Trig_Thundercloud_Actions)set index=0set gg_trg_Power_of_Lightnings=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Power_of_Lightnings,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Power_of_Lightnings,Condition(function Trig_Power_of_Lightnings_Conditions))
call TriggerAddAction(gg_trg_Power_of_Lightnings,function Trig_Power_of_Lightnings_Actions)set index=0set gg_trg_Electric_Field=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Electric_Field,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Electric_Field,Condition(function Trig_Learn_Skill_Electric_Field_Conditions))call TriggerAddAction(gg_trg_Electric_Field,function Trig_Learn_Skill_Electric_Field_Actions)set index=0set gg_trg_Storm=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Storm,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Storm,Condition(function Trig_Storm_Conditions))
call TriggerAddAction(gg_trg_Storm,function Trig_Storm_Actions)set gg_trg_Respawnlol=CreateTrigger()call TriggerRegisterTimerEventSingle(gg_trg_Respawnlol,5)call TriggerAddAction(gg_trg_Respawnlol,function Trig_Respawnlol_Actions)set gg_trg_Ranger_Load=CreateTrigger()call TriggerAddAction(gg_trg_Ranger_Load,function Trig_Ranger_Load_Actions)set index=0set gg_trg_MultiShotSwitch=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_MultiShotSwitch,Player(index),EVENT_PLAYER_UNIT_ISSUED_ORDER,null)call TriggerRegisterPlayerUnitEvent(gg_trg_MultiShotSwitch,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_MultiShotSwitch,Condition(function Trig_MultiShotSwitch_Conditions))
call TriggerAddAction(gg_trg_MultiShotSwitch,function Trig_MultiShotSwitch_Actions)set index=0set gg_trg_Learn_Release_of_Arrows=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Release_of_Arrows,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Release_of_Arrows,Condition(function Trig_Learn_Release_of_Arrows_Conditions))
call TriggerAddAction(gg_trg_Learn_Release_of_Arrows,function Trig_Learn_Release_of_Arrows_Actions)set index=0set gg_trg_Release_of_Arrows=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Release_of_Arrows,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Release_of_Arrows,Condition(function Trig_Release_of_Arrows_Conditions))
call TriggerAddAction(gg_trg_Release_of_Arrows,function Trig_Release_of_Arrows_Actions)set index=0set gg_trg_Dexterity_of_the_Ranger=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dexterity_of_the_Ranger,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dexterity_of_the_Ranger,Condition(function Trig_Dexterity_of_the_Ranger_Conditions))
call TriggerAddAction(gg_trg_Dexterity_of_the_Ranger,function Trig_Dexterity_of_the_Ranger_Actions)set gg_trg_Healer_Load=CreateTrigger()call TriggerAddAction(gg_trg_Healer_Load,function Trig_Healer_Load_Actions)set index=0set gg_trg_Good_Healing=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Good_Healing,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Good_Healing,Condition(function Trig_Good_Healing_Conditions))call TriggerAddAction(gg_trg_Good_Healing,function Trig_Good_Healing_Actions)set index=0set gg_trg_Spiritual_Communication=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Spiritual_Communication,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Spiritual_Communication,Condition(function Trig_Spiritual_Communication_Conditions))
call TriggerAddAction(gg_trg_Spiritual_Communication,function Trig_Spiritual_Communication_Actions)set index=0set gg_trg_Curing_Light=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Curing_Light,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Curing_Light,Condition(function Trig_Curing_Light_Conditions))call TriggerAddAction(gg_trg_Curing_Light,function Trig_Curing_Light_Actions)set index=0set gg_trg_Guardian_Angel=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Guardian_Angel,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Guardian_Angel,Condition(function Trig_Guardian_Angel_Conditions))call TriggerAddAction(gg_trg_Guardian_Angel,function Trig_Guardian_Angel_Actions)set gg_trg_Paladin_Load=CreateTrigger()call TriggerAddAction(gg_trg_Paladin_Load,function Trig_Paladin_Load_Actions)set index=0set gg_trg_Spiral_of_Light=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Spiral_of_Light,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Spiral_of_Light,Condition(function Trig_Spiral_of_Light_Conditions))
call TriggerAddAction(gg_trg_Spiral_of_Light,function Trig_Spiral_of_Light_Actions)set index=0set gg_trg_Keeper_Seal=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Keeper_Seal,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Keeper_Seal,Condition(function Trig_Keeper_Seal_Conditions))
call TriggerAddAction(gg_trg_Keeper_Seal,function Trig_Keeper_Seal_Actions)set index=0set gg_trg_Light_Hammer=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Light_Hammer,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Light_Hammer,Condition(function Trig_Light_Hammer_Conditions))call TriggerAddAction(gg_trg_Light_Hammer,function Trig_Light_Hammer_Actions)set index=0set gg_trg_God_Hand=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_God_Hand,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_God_Hand,Condition(function Trig_God_Hand_Conditions))call TriggerAddAction(gg_trg_God_Hand,function Trig_God_Hand_Actions)set gg_trg_Stone_Guard_Load=CreateTrigger()call TriggerAddAction(gg_trg_Stone_Guard_Load,function Trig_Stone_Guard_Load_Actions)set index=0set gg_trg_Boulder_Throw=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Boulder_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Boulder_Throw,Condition(function Trig_Boulder_Throw_Conditions))
call TriggerAddAction(gg_trg_Boulder_Throw,function Trig_Boulder_Throw_Actions)set index=0set gg_trg_Earth_Shiver=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Earth_Shiver,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Earth_Shiver,Condition(function Trig_Earth_Shiver_Conditions))call TriggerAddAction(gg_trg_Earth_Shiver,function Trig_Earth_Shiver_Actions)set index=0set gg_trg_Learn_Stone_Armor=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Stone_Armor,Player(index),EVENT_PLAYER_HERO_SKILL,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Stone_Armor,Condition(function Trig_Learn_Stone_Armor_Conditions))
call TriggerAddAction(gg_trg_Learn_Stone_Armor,function Trig_Learn_Stone_Armor_Actions)set index=0set gg_trg_Rock_Strike=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Rock_Strike,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Rock_Strike,Condition(function Trig_Rock_Strike_Conditions))
call TriggerAddAction(gg_trg_Rock_Strike,function Trig_Rock_Strike_Actions)set gg_trg_Archdruid_Load=CreateTrigger()call TriggerAddAction(gg_trg_Archdruid_Load,function Trig_Archdruid_Load_Actions)set index=0set gg_trg_Energy_of_Nature=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Energy_of_Nature,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Energy_of_Nature,Condition(function Trig_Energy_of_Nature_Conditions))call TriggerAddAction(gg_trg_Energy_of_Nature,function Trig_Energy_of_Nature_Actions)set index=0set gg_trg_Life_Chain=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Life_Chain,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Life_Chain,Condition(function Trig_Life_Chain_Conditions))call TriggerAddAction(gg_trg_Life_Chain,function Trig_Life_Chain_Actions)set index=0set gg_trg_Ent_Creation=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ent_Creation,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ent_Creation,Condition(function Trig_Ent_Creation_Conditions))call TriggerAddAction(gg_trg_Ent_Creation,function Trig_Ent_Creation_Actions)set index=0set gg_trg_Nature_Wrath=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Nature_Wrath,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Nature_Wrath,Condition(function Trig_Nature_Wrath_Conditions))call TriggerAddAction(gg_trg_Nature_Wrath,function Trig_Nature_Wrath_Actions)set index=0set gg_trg_Falling_Star=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Falling_Star,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Falling_Star,Condition(function Trig_Falling_Star_Conditions))call TriggerAddAction(gg_trg_Falling_Star,function Trig_Falling_Star_Actions)set index=0set gg_trg_Moon_Chackram=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Moon_Chackram,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Moon_Chackram,Condition(function Trig_Moon_Chackram_Conditions))
call TriggerAddAction(gg_trg_Moon_Chackram,function Trig_Moon_Chackram_Actions)set index=0set gg_trg_Moon_Wind=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Moon_Wind,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Moon_Wind,Condition(function Trig_Moon_Wind_Conditions))
call TriggerAddAction(gg_trg_Moon_Wind,function Trig_Moon_Wind_Actions)set index=0set gg_trg_Night_Heart=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Night_Heart,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Night_Heart,Condition(function Trig_Night_Heart_Conditions))
call TriggerAddAction(gg_trg_Night_Heart,function Trig_Night_Heart_Actions)set gg_trg_MoonWarrior_Load=CreateTrigger()call TriggerAddAction(gg_trg_MoonWarrior_Load,function Trig_MoonWarrior_Load_Actions)set index=0set gg_trg_Ancient_Communication=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ancient_Communication,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ancient_Communication,Condition(function Trig_Ancient_Communication_Conditions))
call TriggerAddAction(gg_trg_Ancient_Communication,function Trig_Ancient_Communication_Actions)set index=0set gg_trg_Learn_Power_of_Ancestors=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Power_of_Ancestors,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Power_of_Ancestors,Condition(function Trig_Learn_Power_of_Ancestors_Conditions))call TriggerAddAction(gg_trg_Learn_Power_of_Ancestors,function Trig_Learn_Power_of_Ancestors_Actions)set index=0set gg_trg_Switch_Power_of_Ancestors=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Switch_Power_of_Ancestors,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Switch_Power_of_Ancestors,Condition(function Trig_Switch_Power_of_Ancestors_Conditions))
call TriggerAddAction(gg_trg_Switch_Power_of_Ancestors,function Trig_Switch_Power_of_Ancestors_Actions)set index=0set gg_trg_Earth_Split=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Earth_Split,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Earth_Split,Condition(function Trig_Earth_Split_Conditions))
call TriggerAddAction(gg_trg_Earth_Split,function Trig_Earth_Split_Actions)set index=0set gg_trg_Ancient_Help=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Ancient_Help,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Ancient_Help,Condition(function Trig_Ancient_Help_Conditions))call TriggerAddAction(gg_trg_Ancient_Help,function Trig_Ancient_Help_Actions)set gg_trg_SpiritBreaker_Load=CreateTrigger()call TriggerAddAction(gg_trg_SpiritBreaker_Load,function Trig_SpiritBreaker_Load_Actions)set index=0set gg_trg_Dash=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dash,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dash,Condition(function Trig_Dash_Conditions))call TriggerAddAction(gg_trg_Dash,function Trig_Dash_Actions)set index=0set gg_trg_Dagger_Throw=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dagger_Throw,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dagger_Throw,Condition(function Trig_Dagger_Throw_Conditions))call TriggerAddAction(gg_trg_Dagger_Throw,function Trig_Dagger_Throw_Actions)set index=0set gg_trg_Kara_Justice=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Kara_Justice,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Kara_Justice,Condition(function Trig_Kara_Justice_Conditions))call TriggerAddAction(gg_trg_Kara_Justice,function Trig_Kara_Justice_Actions)set gg_trg_Warden_Load=CreateTrigger()call TriggerAddAction(gg_trg_Warden_Load,function Trig_SpiritBreaker_Load_Actions)set index=0set gg_trg_Strength_Fist=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Strength_Fist,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Strength_Fist,Condition(function Trig_Strength_Fist_Conditions))
call TriggerAddAction(gg_trg_Strength_Fist,function Trig_Strength_Fist_Actions)set index=0set gg_trg_Fighting_Impact=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Fighting_Impact,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Fighting_Impact,Condition(function Trig_Fighting_Impact_Conditions))
call TriggerAddAction(gg_trg_Fighting_Impact,function Trig_Fighting_Impact_Actions)set index=0set gg_trg_Learn_Marshal_Armor=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Marshal_Armor,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Marshal_Armor,Condition(function Trig_Learn_Marshal_Armor_Conditions))
call TriggerAddAction(gg_trg_Learn_Marshal_Armor,function Trig_Learn_Marshal_Armor_Actions)set index=0set gg_trg_Illusive_Army=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Illusive_Army,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Illusive_Army,Condition(function Trig_Illusive_Army_Conditions))
call TriggerAddAction(gg_trg_Illusive_Army,function Trig_Illusive_Army_Actions)set gg_trg_Marshal_Load=CreateTrigger()call TriggerAddAction(gg_trg_Marshal_Load,function Trig_Marshal_Load_Actions)set index=0set gg_trg_Chain_Lightning=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Chain_Lightning,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Chain_Lightning,Condition(function Trig_Chain_Lightning_Conditions))
call TriggerAddAction(gg_trg_Chain_Lightning,function Trig_Chain_Lightning_Actions)set index=0set gg_trg_Magic_Trap=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Magic_Trap,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Magic_Trap,Condition(function Trig_Magic_Trap_Conditions))call TriggerAddAction(gg_trg_Magic_Trap,function Trig_Magic_Trap_Actions)set index=0set gg_trg_Remove_Lightning_Form_Dead_Units=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Remove_Lightning_Form_Dead_Units,Player(index),EVENT_PLAYER_UNIT_DEATH,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Remove_Lightning_Form_Dead_Units,Condition(function Trig_Remove_Lightning_Form_Dead_Units_Conditions))call TriggerAddAction(gg_trg_Remove_Lightning_Form_Dead_Units,function Trig_Remove_Lightning_Form_Dead_Units_Actions)set index=0set gg_trg_EnergyWave=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_EnergyWave,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)
set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_EnergyWave,Condition(function Trig_EnergyWave_Conditions))call TriggerAddAction(gg_trg_EnergyWave,function Trig_EnergyWave_Actions)set index=0set gg_trg_Magic_Epicenter=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Magic_Epicenter,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Magic_Epicenter,Condition(function Trig_Magic_Epicenter_Conditions))
call TriggerAddAction(gg_trg_Magic_Epicenter,function Trig_Magic_Epicenter_Actions)set gg_trg_Load_ArchMage=CreateTrigger()
call TriggerAddAction(gg_trg_Load_ArchMage,function Trig_Load_ArchMage_Actions)set index=0set gg_trg_Toxic_Field=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Toxic_Field,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Toxic_Field,Condition(function Trig_Toxic_Field_Conditions))
call TriggerAddAction(gg_trg_Toxic_Field,function Trig_Toxic_Field_Actions)set index=0set gg_trg_Poison_Bomb=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Poison_Bomb,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Poison_Bomb,Condition(function Trig_Poison_Bomb_Conditions))
call TriggerAddAction(gg_trg_Poison_Bomb,function Trig_Poison_Bomb_Actions)set index=0set gg_trg_Learn_Ogre_Rage=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Ogre_Rage,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Ogre_Rage,Condition(function Trig_Learn_Ogre_Rage_Conditions))
call TriggerAddAction(gg_trg_Learn_Ogre_Rage,function Trig_Learn_Ogre_Rage_Actions)set index=0set gg_trg_Potion_of_Growth=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Potion_of_Growth,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Potion_of_Growth,Condition(function Trig_Potion_of_Growth_Conditions))call TriggerAddAction(gg_trg_Potion_of_Growth,function Trig_Potion_of_Growth_Actions)set gg_trg_Load_Alchemist=CreateTrigger()call TriggerAddAction(gg_trg_Load_Alchemist,function Trig_Load_Alchemist_Actions)set index=0set gg_trg_Case_Shot=CreateTrigger()
loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Case_Shot,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Case_Shot,Condition(function Trig_Case_Shot_Conditions))
call TriggerAddAction(gg_trg_Case_Shot,function Trig_Case_Shot_Actions)set index=0set gg_trg_Learn_Fire_Position=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Learn_Fire_Position,Player(index),EVENT_PLAYER_HERO_SKILL,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Learn_Fire_Position,Condition(function Trig_Learn_Fire_Position_Conditions))
call TriggerAddAction(gg_trg_Learn_Fire_Position,function Trig_Learn_Fire_Position_Actions)set index=0set gg_trg_Dwarf_Cannon=CreateTrigger()loop
call TriggerRegisterPlayerUnitEvent(gg_trg_Dwarf_Cannon,Player(index),EVENT_PLAYER_UNIT_SPELL_EFFECT,null)set index=index+1exitwhen index==16endloopcall TriggerAddCondition(gg_trg_Dwarf_Cannon,Condition(function Trig_Dwarf_Cannon_Conditions))call TriggerAddAction(gg_trg_Dwarf_Cannon,function Trig_Dwarf_Cannon_Actions)set gg_trg_Load_Sniper=CreateTrigger()call TriggerAddAction(gg_trg_Load_Sniper,function Trig_Load_Sniper_Actions)call ConditionalTriggerExecute(gg_trg_InitHashtable)
call ConditionalTriggerExecute(gg_trg_InitSystem)call ConditionalTriggerExecute(gg_trg_Init_kreeps)call ConditionalTriggerExecute(gg_trg_Drenor_Bull_Load)endfunctionfunction config takes nothing returns nothingcall SetMapName("TRIGSTR_001")call SetMapDescription("TRIGSTR_003")call SetPlayers($A)call SetTeams($A)call SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)call DefineStartLocation(0,4928.,3840.)call DefineStartLocation(1,4928.,3840.)call DefineStartLocation(2,4928.,3840.)call DefineStartLocation(3,4928.,3840.)call DefineStartLocation(4,4928.,3840.)call DefineStartLocation(5,4928.,3840.)call DefineStartLocation(6,4928.,3840.)call DefineStartLocation(7,4928.,3840.)call DefineStartLocation(8,4928.,3840.)call DefineStartLocation(9,4928.,3840.)call SetPlayerStartLocation(Player(0),0)
call ForcePlayerStartLocation(Player(0),0)call SetPlayerColor(Player(0),ConvertPlayerColor(0))
call SetPlayerRacePreference(Player(0),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(0),false)call SetPlayerController(Player(0),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(1),1)
call ForcePlayerStartLocation(Player(1),1)call SetPlayerColor(Player(1),ConvertPlayerColor(1))
call SetPlayerRacePreference(Player(1),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(1),false)call SetPlayerController(Player(1),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(2),2)
call ForcePlayerStartLocation(Player(2),2)call SetPlayerColor(Player(2),ConvertPlayerColor(2))
call SetPlayerRacePreference(Player(2),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(2),false)call SetPlayerController(Player(2),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(3),3)
call ForcePlayerStartLocation(Player(3),3)call SetPlayerColor(Player(3),ConvertPlayerColor(3))
call SetPlayerRacePreference(Player(3),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(3),false)call SetPlayerController(Player(3),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(4),4)
call ForcePlayerStartLocation(Player(4),4)call SetPlayerColor(Player(4),ConvertPlayerColor(4))
call SetPlayerRacePreference(Player(4),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(4),false)call SetPlayerController(Player(4),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(5),5)
call ForcePlayerStartLocation(Player(5),5)call SetPlayerColor(Player(5),ConvertPlayerColor(5))
call SetPlayerRacePreference(Player(5),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(5),false)call SetPlayerController(Player(5),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(6),6)
call ForcePlayerStartLocation(Player(6),6)call SetPlayerColor(Player(6),ConvertPlayerColor(6))
call SetPlayerRacePreference(Player(6),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(6),false)call SetPlayerController(Player(6),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(7),7)
call ForcePlayerStartLocation(Player(7),7)call SetPlayerColor(Player(7),ConvertPlayerColor(7))
call SetPlayerRacePreference(Player(7),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(7),false)call SetPlayerController(Player(7),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(8),8)
call ForcePlayerStartLocation(Player(8),8)call SetPlayerColor(Player(8),ConvertPlayerColor(8))
call SetPlayerRacePreference(Player(8),RACE_PREF_HUMAN)call SetPlayerRaceSelectable(Player(8),false)call SetPlayerController(Player(8),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player($B),9)call ForcePlayerStartLocation(Player($B),9)call SetPlayerColor(Player($B),ConvertPlayerColor($B))call SetPlayerRacePreference(Player($B),RACE_PREF_UNDEAD)call SetPlayerRaceSelectable(Player($B),false)call SetPlayerController(Player($B),MAP_CONTROL_COMPUTER)call InitCustomTeams()call SetStartLocPrioCount(0,8)call SetStartLocPrio(0,0,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,1,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,2,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(0,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(1,8)call SetStartLocPrio(1,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,1,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,2,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(1,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(2,8)call SetStartLocPrio(2,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,2,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(2,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(3,8)call SetStartLocPrio(3,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,3,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(3,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(4,8)call SetStartLocPrio(4,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,4,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(4,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(5,8)call SetStartLocPrio(5,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,5,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(5,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(6,8)call SetStartLocPrio(6,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,5,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,6,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(6,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(7,8)call SetStartLocPrio(7,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,5,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,6,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(7,7,8,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(8,8)call SetStartLocPrio(8,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,2,2,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,3,3,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,4,4,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,5,5,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,6,6,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(8,7,7,MAP_LOC_PRIO_HIGH)call SetStartLocPrioCount(9,3)call SetStartLocPrio(9,0,0,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(9,1,1,MAP_LOC_PRIO_HIGH)call SetStartLocPrio(9,2,2,MAP_LOC_PRIO_HIGH)endfunction